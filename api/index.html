
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://zkbt.github.com/chromatic/api/">
      
      
        <link rel="prev" href="../tools/transits/">
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.9">
    
    
      
        <title>Reference - chromatic</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.4af4bdda.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#reference" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="chromatic" class="md-header__button md-logo" aria-label="chromatic" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            chromatic
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Reference
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/zkbt/chromatic/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="chromatic" class="md-nav__button md-logo" aria-label="chromatic" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    chromatic
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/zkbt/chromatic/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Welcome
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../installation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Installation
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../quickstart/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    🌈 Quickstart
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    User Guide
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            User Guide
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../basics/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Basics of 🌈 Objects
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../io/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Reading/Writing a 🌈
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../creating/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Creating a 🌈 from Arrays
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../actions/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    🌈 Actions
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../visualizing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    🌈 Visualizations
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../models/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    🌈 Models
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Examples
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Examples
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../example-timeseries-spectra/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    🌈⏰🌊 time-series spectra
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Developer Guide
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Developer Guide
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../designing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Designing New 🌈 Features
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../documentation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Writing 🌈 Documentation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../github/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Contributing 🌈 Code with GitHub
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Related Tools
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            Related Tools
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tools/spectra/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Retrieving Model Spectra
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tools/binning/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Binning Data to a New Grid
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tools/colormaps/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Creating Custom Colormaps
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tools/transits/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Making Model Transits
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Reference
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Reference
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.read_rainbow" class="md-nav__link">
    <span class="md-ellipsis">
      read_rainbow
    </span>
  </a>
  
    <nav class="md-nav" aria-label="read_rainbow">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.read_rainbow--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.read_rainbow--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.rainbow.Rainbow" class="md-nav__link">
    <span class="md-ellipsis">
      Rainbow
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Rainbow">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.rainbow.Rainbow--attributes" class="md-nav__link">
    <span class="md-ellipsis">
      Attributes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.rainbow.Rainbow.dt" class="md-nav__link">
    <span class="md-ellipsis">
      dt
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.rainbow.Rainbow.flux" class="md-nav__link">
    <span class="md-ellipsis">
      flux
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.rainbow.Rainbow.name" class="md-nav__link">
    <span class="md-ellipsis">
      name
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.rainbow.Rainbow.nflux" class="md-nav__link">
    <span class="md-ellipsis">
      nflux
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.rainbow.Rainbow.ntime" class="md-nav__link">
    <span class="md-ellipsis">
      ntime
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.rainbow.Rainbow.nwave" class="md-nav__link">
    <span class="md-ellipsis">
      nwave
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.rainbow.Rainbow.ok" class="md-nav__link">
    <span class="md-ellipsis">
      ok
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.rainbow.Rainbow.shape" class="md-nav__link">
    <span class="md-ellipsis">
      shape
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.rainbow.Rainbow.time" class="md-nav__link">
    <span class="md-ellipsis">
      time
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.rainbow.Rainbow.uncertainty" class="md-nav__link">
    <span class="md-ellipsis">
      uncertainty
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.rainbow.Rainbow.wavelength" class="md-nav__link">
    <span class="md-ellipsis">
      wavelength
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.rainbow.Rainbow.__getattr__" class="md-nav__link">
    <span class="md-ellipsis">
      __getattr__
    </span>
  </a>
  
    <nav class="md-nav" aria-label="__getattr__">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.rainbow.Rainbow.__getattr__--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.rainbow.Rainbow.__getitem__" class="md-nav__link">
    <span class="md-ellipsis">
      __getitem__
    </span>
  </a>
  
    <nav class="md-nav" aria-label="__getitem__">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.rainbow.Rainbow.__getitem__--examples" class="md-nav__link">
    <span class="md-ellipsis">
      Examples
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.rainbow.Rainbow.__getitem__--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.rainbow.Rainbow.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
    <nav class="md-nav" aria-label="__init__">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.rainbow.Rainbow.__init__--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.rainbow.Rainbow.__init__--examples" class="md-nav__link">
    <span class="md-ellipsis">
      Examples
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.rainbow.Rainbow.__repr__" class="md-nav__link">
    <span class="md-ellipsis">
      __repr__
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.rainbow.Rainbow.__setattr__" class="md-nav__link">
    <span class="md-ellipsis">
      __setattr__
    </span>
  </a>
  
    <nav class="md-nav" aria-label="__setattr__">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.rainbow.Rainbow.__setattr__--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.withmodel.RainbowWithModel" class="md-nav__link">
    <span class="md-ellipsis">
      RainbowWithModel
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.withmodel.RainbowWithModel.chi_squared" class="md-nav__link">
    <span class="md-ellipsis">
      chi_squared
    </span>
  </a>
  
    <nav class="md-nav" aria-label="chi_squared">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.withmodel.RainbowWithModel.chi_squared--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.withmodel.RainbowWithModel.ones" class="md-nav__link">
    <span class="md-ellipsis">
      ones
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ones">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.withmodel.RainbowWithModel.ones--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.withmodel.RainbowWithModel.residuals" class="md-nav__link">
    <span class="md-ellipsis">
      residuals
    </span>
  </a>
  
    <nav class="md-nav" aria-label="residuals">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.withmodel.RainbowWithModel.residuals--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.withmodel.RainbowWithModel.residuals_plus_one" class="md-nav__link">
    <span class="md-ellipsis">
      residuals_plus_one
    </span>
  </a>
  
    <nav class="md-nav" aria-label="residuals_plus_one">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.withmodel.RainbowWithModel.residuals_plus_one--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.simulated.SimulatedRainbow" class="md-nav__link">
    <span class="md-ellipsis">
      SimulatedRainbow
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.simulated.SimulatedRainbow.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
    <nav class="md-nav" aria-label="__init__">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.simulated.SimulatedRainbow.__init__--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#helpers" class="md-nav__link">
    <span class="md-ellipsis">
      🌈 Helpers
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.helpers.get" class="md-nav__link">
    <span class="md-ellipsis">
      get
    </span>
  </a>
  
    <nav class="md-nav" aria-label="get">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.helpers.get--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.helpers.get--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.helpers.help" class="md-nav__link">
    <span class="md-ellipsis">
      help
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.helpers.history" class="md-nav__link">
    <span class="md-ellipsis">
      history
    </span>
  </a>
  
    <nav class="md-nav" aria-label="history">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.helpers.history--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.helpers.save" class="md-nav__link">
    <span class="md-ellipsis">
      save
    </span>
  </a>
  
    <nav class="md-nav" aria-label="save">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.helpers.save--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#actions" class="md-nav__link">
    <span class="md-ellipsis">
      🌈 Actions
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.align_wavelengths" class="md-nav__link">
    <span class="md-ellipsis">
      align_wavelengths
    </span>
  </a>
  
    <nav class="md-nav" aria-label="align_wavelengths">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.align_wavelengths--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.align_wavelengths--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.attach_model" class="md-nav__link">
    <span class="md-ellipsis">
      attach_model
    </span>
  </a>
  
    <nav class="md-nav" aria-label="attach_model">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.attach_model--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.attach_model--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.binning" class="md-nav__link">
    <span class="md-ellipsis">
      binning
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.binning.bin" class="md-nav__link">
    <span class="md-ellipsis">
      bin
    </span>
  </a>
  
    <nav class="md-nav" aria-label="bin">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.binning.bin--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.binning.bin--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.binning.bin_in_time" class="md-nav__link">
    <span class="md-ellipsis">
      bin_in_time
    </span>
  </a>
  
    <nav class="md-nav" aria-label="bin_in_time">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.binning.bin_in_time--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.binning.bin_in_time--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.binning.bin_in_wavelength" class="md-nav__link">
    <span class="md-ellipsis">
      bin_in_wavelength
    </span>
  </a>
  
    <nav class="md-nav" aria-label="bin_in_wavelength">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.binning.bin_in_wavelength--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.binning.bin_in_wavelength--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.binning.bintoR" class="md-nav__link">
    <span class="md-ellipsis">
      bintoR
    </span>
  </a>
  
    <nav class="md-nav" aria-label="bintoR">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.binning.bintoR--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.binning.bintoR--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.binning.bintogrid" class="md-nav__link">
    <span class="md-ellipsis">
      bintogrid
    </span>
  </a>
  
    <nav class="md-nav" aria-label="bintogrid">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.binning.bintogrid--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.binning.bintogrid--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.binning.calculate_bin_leftright" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_bin_leftright
    </span>
  </a>
  
    <nav class="md-nav" aria-label="calculate_bin_leftright">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.binning.calculate_bin_leftright--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.binning.calculate_bin_leftright--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.binning.edges_to_leftright" class="md-nav__link">
    <span class="md-ellipsis">
      edges_to_leftright
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.binning.expand_filenames" class="md-nav__link">
    <span class="md-ellipsis">
      expand_filenames
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.binning.get_average_lightcurve_as_rainbow" class="md-nav__link">
    <span class="md-ellipsis">
      get_average_lightcurve_as_rainbow
    </span>
  </a>
  
    <nav class="md-nav" aria-label="get_average_lightcurve_as_rainbow">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.binning.get_average_lightcurve_as_rainbow--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.binning.get_average_spectrum_as_rainbow" class="md-nav__link">
    <span class="md-ellipsis">
      get_average_spectrum_as_rainbow
    </span>
  </a>
  
    <nav class="md-nav" aria-label="get_average_spectrum_as_rainbow">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.binning.get_average_spectrum_as_rainbow--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.binning.leftright_to_edges" class="md-nav__link">
    <span class="md-ellipsis">
      leftright_to_edges
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.binning.name2color" class="md-nav__link">
    <span class="md-ellipsis">
      name2color
    </span>
  </a>
  
    <nav class="md-nav" aria-label="name2color">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.binning.name2color--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.binning.name2color--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.binning.one2another" class="md-nav__link">
    <span class="md-ellipsis">
      one2another
    </span>
  </a>
  
    <nav class="md-nav" aria-label="one2another">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.binning.one2another--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.binning.one2another--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.binning.remove_unit" class="md-nav__link">
    <span class="md-ellipsis">
      remove_unit
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.binning.resample_while_conserving_flux" class="md-nav__link">
    <span class="md-ellipsis">
      resample_while_conserving_flux
    </span>
  </a>
  
    <nav class="md-nav" aria-label="resample_while_conserving_flux">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.binning.resample_while_conserving_flux--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.binning.resample_while_conserving_flux--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.compare" class="md-nav__link">
    <span class="md-ellipsis">
      compare
    </span>
  </a>
  
    <nav class="md-nav" aria-label="compare">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.compare--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.compare--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.flag_outliers" class="md-nav__link">
    <span class="md-ellipsis">
      flag_outliers
    </span>
  </a>
  
    <nav class="md-nav" aria-label="flag_outliers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.flag_outliers--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.flag_outliers--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.fold" class="md-nav__link">
    <span class="md-ellipsis">
      fold
    </span>
  </a>
  
    <nav class="md-nav" aria-label="fold">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.fold--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.fold--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.inflate_uncertainty" class="md-nav__link">
    <span class="md-ellipsis">
      inflate_uncertainty
    </span>
  </a>
  
    <nav class="md-nav" aria-label="inflate_uncertainty">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.inflate_uncertainty--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.inflate_uncertainty--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.inject_noise" class="md-nav__link">
    <span class="md-ellipsis">
      inject_noise
    </span>
  </a>
  
    <nav class="md-nav" aria-label="inject_noise">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.inject_noise--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.inject_noise--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.inject_outliers" class="md-nav__link">
    <span class="md-ellipsis">
      inject_outliers
    </span>
  </a>
  
    <nav class="md-nav" aria-label="inject_outliers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.inject_outliers--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.inject_outliers--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.inject_spectrum" class="md-nav__link">
    <span class="md-ellipsis">
      inject_spectrum
    </span>
  </a>
  
    <nav class="md-nav" aria-label="inject_spectrum">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.inject_spectrum--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.inject_spectrum--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.inject_systematics" class="md-nav__link">
    <span class="md-ellipsis">
      inject_systematics
    </span>
  </a>
  
    <nav class="md-nav" aria-label="inject_systematics">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.inject_systematics--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.inject_systematics--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.inject_transit" class="md-nav__link">
    <span class="md-ellipsis">
      inject_transit
    </span>
  </a>
  
    <nav class="md-nav" aria-label="inject_transit">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.inject_transit--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.normalization" class="md-nav__link">
    <span class="md-ellipsis">
      normalization
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.normalization.bintoR" class="md-nav__link">
    <span class="md-ellipsis">
      bintoR
    </span>
  </a>
  
    <nav class="md-nav" aria-label="bintoR">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.normalization.bintoR--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.normalization.bintoR--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.normalization.bintogrid" class="md-nav__link">
    <span class="md-ellipsis">
      bintogrid
    </span>
  </a>
  
    <nav class="md-nav" aria-label="bintogrid">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.normalization.bintogrid--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.normalization.bintogrid--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.normalization.calculate_bin_leftright" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_bin_leftright
    </span>
  </a>
  
    <nav class="md-nav" aria-label="calculate_bin_leftright">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.normalization.calculate_bin_leftright--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.normalization.calculate_bin_leftright--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.normalization.edges_to_leftright" class="md-nav__link">
    <span class="md-ellipsis">
      edges_to_leftright
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.normalization.expand_filenames" class="md-nav__link">
    <span class="md-ellipsis">
      expand_filenames
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.normalization.leftright_to_edges" class="md-nav__link">
    <span class="md-ellipsis">
      leftright_to_edges
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.normalization.name2color" class="md-nav__link">
    <span class="md-ellipsis">
      name2color
    </span>
  </a>
  
    <nav class="md-nav" aria-label="name2color">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.normalization.name2color--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.normalization.name2color--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.normalization.normalize" class="md-nav__link">
    <span class="md-ellipsis">
      normalize
    </span>
  </a>
  
    <nav class="md-nav" aria-label="normalize">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.normalization.normalize--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.normalization.normalize--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.normalization.one2another" class="md-nav__link">
    <span class="md-ellipsis">
      one2another
    </span>
  </a>
  
    <nav class="md-nav" aria-label="one2another">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.normalization.one2another--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.normalization.one2another--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.normalization.remove_unit" class="md-nav__link">
    <span class="md-ellipsis">
      remove_unit
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.normalization.resample_while_conserving_flux" class="md-nav__link">
    <span class="md-ellipsis">
      resample_while_conserving_flux
    </span>
  </a>
  
    <nav class="md-nav" aria-label="resample_while_conserving_flux">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.normalization.resample_while_conserving_flux--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.normalization.resample_while_conserving_flux--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.operations" class="md-nav__link">
    <span class="md-ellipsis">
      operations
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.operations.__add__" class="md-nav__link">
    <span class="md-ellipsis">
      __add__
    </span>
  </a>
  
    <nav class="md-nav" aria-label="__add__">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.operations.__add__--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.operations.__add__--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.operations.__eq__" class="md-nav__link">
    <span class="md-ellipsis">
      __eq__
    </span>
  </a>
  
    <nav class="md-nav" aria-label="__eq__">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.operations.__eq__--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.operations.__eq__--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.operations.__mul__" class="md-nav__link">
    <span class="md-ellipsis">
      __mul__
    </span>
  </a>
  
    <nav class="md-nav" aria-label="__mul__">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.operations.__mul__--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.operations.__mul__--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.operations.__sub__" class="md-nav__link">
    <span class="md-ellipsis">
      __sub__
    </span>
  </a>
  
    <nav class="md-nav" aria-label="__sub__">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.operations.__sub__--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.operations.__sub__--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.operations.__truediv__" class="md-nav__link">
    <span class="md-ellipsis">
      __truediv__
    </span>
  </a>
  
    <nav class="md-nav" aria-label="__truediv__">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.operations.__truediv__--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.operations.__truediv__--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.operations.bintoR" class="md-nav__link">
    <span class="md-ellipsis">
      bintoR
    </span>
  </a>
  
    <nav class="md-nav" aria-label="bintoR">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.operations.bintoR--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.operations.bintoR--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.operations.bintogrid" class="md-nav__link">
    <span class="md-ellipsis">
      bintogrid
    </span>
  </a>
  
    <nav class="md-nav" aria-label="bintogrid">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.operations.bintogrid--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.operations.bintogrid--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.operations.calculate_bin_leftright" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_bin_leftright
    </span>
  </a>
  
    <nav class="md-nav" aria-label="calculate_bin_leftright">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.operations.calculate_bin_leftright--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.operations.calculate_bin_leftright--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.operations.diff" class="md-nav__link">
    <span class="md-ellipsis">
      diff
    </span>
  </a>
  
    <nav class="md-nav" aria-label="diff">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.operations.diff--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.operations.diff--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.operations.edges_to_leftright" class="md-nav__link">
    <span class="md-ellipsis">
      edges_to_leftright
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.operations.expand_filenames" class="md-nav__link">
    <span class="md-ellipsis">
      expand_filenames
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.operations.leftright_to_edges" class="md-nav__link">
    <span class="md-ellipsis">
      leftright_to_edges
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.operations.name2color" class="md-nav__link">
    <span class="md-ellipsis">
      name2color
    </span>
  </a>
  
    <nav class="md-nav" aria-label="name2color">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.operations.name2color--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.operations.name2color--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.operations.one2another" class="md-nav__link">
    <span class="md-ellipsis">
      one2another
    </span>
  </a>
  
    <nav class="md-nav" aria-label="one2another">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.operations.one2another--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.operations.one2another--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.operations.remove_unit" class="md-nav__link">
    <span class="md-ellipsis">
      remove_unit
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.operations.resample_while_conserving_flux" class="md-nav__link">
    <span class="md-ellipsis">
      resample_while_conserving_flux
    </span>
  </a>
  
    <nav class="md-nav" aria-label="resample_while_conserving_flux">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.operations.resample_while_conserving_flux--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.operations.resample_while_conserving_flux--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.remove_trends" class="md-nav__link">
    <span class="md-ellipsis">
      remove_trends
    </span>
  </a>
  
    <nav class="md-nav" aria-label="remove_trends">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.remove_trends--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.remove_trends--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.shift" class="md-nav__link">
    <span class="md-ellipsis">
      shift
    </span>
  </a>
  
    <nav class="md-nav" aria-label="shift">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.shift--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.trim" class="md-nav__link">
    <span class="md-ellipsis">
      trim
    </span>
  </a>
  
    <nav class="md-nav" aria-label="trim">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.trim--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.trim--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gettimelike" class="md-nav__link">
    <span class="md-ellipsis">
      🌈 Get/Timelike
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.average_lightcurve" class="md-nav__link">
    <span class="md-ellipsis">
      average_lightcurve
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.average_lightcurve.bintoR" class="md-nav__link">
    <span class="md-ellipsis">
      bintoR
    </span>
  </a>
  
    <nav class="md-nav" aria-label="bintoR">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.average_lightcurve.bintoR--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.average_lightcurve.bintoR--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.average_lightcurve.bintogrid" class="md-nav__link">
    <span class="md-ellipsis">
      bintogrid
    </span>
  </a>
  
    <nav class="md-nav" aria-label="bintogrid">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.average_lightcurve.bintogrid--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.average_lightcurve.bintogrid--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.average_lightcurve.calculate_bin_leftright" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_bin_leftright
    </span>
  </a>
  
    <nav class="md-nav" aria-label="calculate_bin_leftright">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.average_lightcurve.calculate_bin_leftright--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.average_lightcurve.calculate_bin_leftright--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.average_lightcurve.edges_to_leftright" class="md-nav__link">
    <span class="md-ellipsis">
      edges_to_leftright
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.average_lightcurve.expand_filenames" class="md-nav__link">
    <span class="md-ellipsis">
      expand_filenames
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.average_lightcurve.get_average_lightcurve" class="md-nav__link">
    <span class="md-ellipsis">
      get_average_lightcurve
    </span>
  </a>
  
    <nav class="md-nav" aria-label="get_average_lightcurve">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.average_lightcurve.get_average_lightcurve--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.average_lightcurve.leftright_to_edges" class="md-nav__link">
    <span class="md-ellipsis">
      leftright_to_edges
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.average_lightcurve.name2color" class="md-nav__link">
    <span class="md-ellipsis">
      name2color
    </span>
  </a>
  
    <nav class="md-nav" aria-label="name2color">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.average_lightcurve.name2color--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.average_lightcurve.name2color--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.average_lightcurve.one2another" class="md-nav__link">
    <span class="md-ellipsis">
      one2another
    </span>
  </a>
  
    <nav class="md-nav" aria-label="one2another">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.average_lightcurve.one2another--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.average_lightcurve.one2another--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.average_lightcurve.remove_unit" class="md-nav__link">
    <span class="md-ellipsis">
      remove_unit
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.average_lightcurve.resample_while_conserving_flux" class="md-nav__link">
    <span class="md-ellipsis">
      resample_while_conserving_flux
    </span>
  </a>
  
    <nav class="md-nav" aria-label="resample_while_conserving_flux">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.average_lightcurve.resample_while_conserving_flux--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.average_lightcurve.resample_while_conserving_flux--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.median_lightcurve" class="md-nav__link">
    <span class="md-ellipsis">
      median_lightcurve
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.median_lightcurve.bintoR" class="md-nav__link">
    <span class="md-ellipsis">
      bintoR
    </span>
  </a>
  
    <nav class="md-nav" aria-label="bintoR">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.median_lightcurve.bintoR--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.median_lightcurve.bintoR--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.median_lightcurve.bintogrid" class="md-nav__link">
    <span class="md-ellipsis">
      bintogrid
    </span>
  </a>
  
    <nav class="md-nav" aria-label="bintogrid">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.median_lightcurve.bintogrid--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.median_lightcurve.bintogrid--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.median_lightcurve.calculate_bin_leftright" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_bin_leftright
    </span>
  </a>
  
    <nav class="md-nav" aria-label="calculate_bin_leftright">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.median_lightcurve.calculate_bin_leftright--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.median_lightcurve.calculate_bin_leftright--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.median_lightcurve.edges_to_leftright" class="md-nav__link">
    <span class="md-ellipsis">
      edges_to_leftright
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.median_lightcurve.expand_filenames" class="md-nav__link">
    <span class="md-ellipsis">
      expand_filenames
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.median_lightcurve.get_median_lightcurve" class="md-nav__link">
    <span class="md-ellipsis">
      get_median_lightcurve
    </span>
  </a>
  
    <nav class="md-nav" aria-label="get_median_lightcurve">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.median_lightcurve.get_median_lightcurve--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.median_lightcurve.leftright_to_edges" class="md-nav__link">
    <span class="md-ellipsis">
      leftright_to_edges
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.median_lightcurve.name2color" class="md-nav__link">
    <span class="md-ellipsis">
      name2color
    </span>
  </a>
  
    <nav class="md-nav" aria-label="name2color">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.median_lightcurve.name2color--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.median_lightcurve.name2color--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.median_lightcurve.one2another" class="md-nav__link">
    <span class="md-ellipsis">
      one2another
    </span>
  </a>
  
    <nav class="md-nav" aria-label="one2another">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.median_lightcurve.one2another--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.median_lightcurve.one2another--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.median_lightcurve.remove_unit" class="md-nav__link">
    <span class="md-ellipsis">
      remove_unit
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.median_lightcurve.resample_while_conserving_flux" class="md-nav__link">
    <span class="md-ellipsis">
      resample_while_conserving_flux
    </span>
  </a>
  
    <nav class="md-nav" aria-label="resample_while_conserving_flux">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.median_lightcurve.resample_while_conserving_flux--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.median_lightcurve.resample_while_conserving_flux--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.subset" class="md-nav__link">
    <span class="md-ellipsis">
      subset
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.subset.bintoR" class="md-nav__link">
    <span class="md-ellipsis">
      bintoR
    </span>
  </a>
  
    <nav class="md-nav" aria-label="bintoR">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.subset.bintoR--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.subset.bintoR--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.subset.bintogrid" class="md-nav__link">
    <span class="md-ellipsis">
      bintogrid
    </span>
  </a>
  
    <nav class="md-nav" aria-label="bintogrid">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.subset.bintogrid--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.subset.bintogrid--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.subset.calculate_bin_leftright" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_bin_leftright
    </span>
  </a>
  
    <nav class="md-nav" aria-label="calculate_bin_leftright">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.subset.calculate_bin_leftright--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.subset.calculate_bin_leftright--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.subset.edges_to_leftright" class="md-nav__link">
    <span class="md-ellipsis">
      edges_to_leftright
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.subset.expand_filenames" class="md-nav__link">
    <span class="md-ellipsis">
      expand_filenames
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.subset.get_for_time" class="md-nav__link">
    <span class="md-ellipsis">
      get_for_time
    </span>
  </a>
  
    <nav class="md-nav" aria-label="get_for_time">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.subset.get_for_time--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.subset.get_for_time--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.subset.get_ok_data_for_time" class="md-nav__link">
    <span class="md-ellipsis">
      get_ok_data_for_time
    </span>
  </a>
  
    <nav class="md-nav" aria-label="get_ok_data_for_time">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.subset.get_ok_data_for_time--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.subset.get_ok_data_for_time--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.subset.leftright_to_edges" class="md-nav__link">
    <span class="md-ellipsis">
      leftright_to_edges
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.subset.name2color" class="md-nav__link">
    <span class="md-ellipsis">
      name2color
    </span>
  </a>
  
    <nav class="md-nav" aria-label="name2color">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.subset.name2color--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.subset.name2color--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.subset.one2another" class="md-nav__link">
    <span class="md-ellipsis">
      one2another
    </span>
  </a>
  
    <nav class="md-nav" aria-label="one2another">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.subset.one2another--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.subset.one2another--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.subset.remove_unit" class="md-nav__link">
    <span class="md-ellipsis">
      remove_unit
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.subset.resample_while_conserving_flux" class="md-nav__link">
    <span class="md-ellipsis">
      resample_while_conserving_flux
    </span>
  </a>
  
    <nav class="md-nav" aria-label="resample_while_conserving_flux">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.subset.resample_while_conserving_flux--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.subset.resample_while_conserving_flux--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.time" class="md-nav__link">
    <span class="md-ellipsis">
      time
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.time.bintoR" class="md-nav__link">
    <span class="md-ellipsis">
      bintoR
    </span>
  </a>
  
    <nav class="md-nav" aria-label="bintoR">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.time.bintoR--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.time.bintoR--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.time.bintogrid" class="md-nav__link">
    <span class="md-ellipsis">
      bintogrid
    </span>
  </a>
  
    <nav class="md-nav" aria-label="bintogrid">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.time.bintogrid--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.time.bintogrid--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.time.calculate_bin_leftright" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_bin_leftright
    </span>
  </a>
  
    <nav class="md-nav" aria-label="calculate_bin_leftright">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.time.calculate_bin_leftright--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.time.calculate_bin_leftright--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.time.edges_to_leftright" class="md-nav__link">
    <span class="md-ellipsis">
      edges_to_leftright
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.time.expand_filenames" class="md-nav__link">
    <span class="md-ellipsis">
      expand_filenames
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.time.get_times_as_astropy" class="md-nav__link">
    <span class="md-ellipsis">
      get_times_as_astropy
    </span>
  </a>
  
    <nav class="md-nav" aria-label="get_times_as_astropy">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.time.get_times_as_astropy--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.time.get_times_as_astropy--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.time.leftright_to_edges" class="md-nav__link">
    <span class="md-ellipsis">
      leftright_to_edges
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.time.name2color" class="md-nav__link">
    <span class="md-ellipsis">
      name2color
    </span>
  </a>
  
    <nav class="md-nav" aria-label="name2color">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.time.name2color--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.time.name2color--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.time.one2another" class="md-nav__link">
    <span class="md-ellipsis">
      one2another
    </span>
  </a>
  
    <nav class="md-nav" aria-label="one2another">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.time.one2another--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.time.one2another--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.time.remove_unit" class="md-nav__link">
    <span class="md-ellipsis">
      remove_unit
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.time.resample_while_conserving_flux" class="md-nav__link">
    <span class="md-ellipsis">
      resample_while_conserving_flux
    </span>
  </a>
  
    <nav class="md-nav" aria-label="resample_while_conserving_flux">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.time.resample_while_conserving_flux--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.time.resample_while_conserving_flux--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.time.set_times_from_astropy" class="md-nav__link">
    <span class="md-ellipsis">
      set_times_from_astropy
    </span>
  </a>
  
    <nav class="md-nav" aria-label="set_times_from_astropy">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.time.set_times_from_astropy--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.time.set_times_from_astropy--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#getwavelike" class="md-nav__link">
    <span class="md-ellipsis">
      🌈 Get/Wavelike
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.average_spectrum" class="md-nav__link">
    <span class="md-ellipsis">
      average_spectrum
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.average_spectrum.bintoR" class="md-nav__link">
    <span class="md-ellipsis">
      bintoR
    </span>
  </a>
  
    <nav class="md-nav" aria-label="bintoR">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.average_spectrum.bintoR--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.average_spectrum.bintoR--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.average_spectrum.bintogrid" class="md-nav__link">
    <span class="md-ellipsis">
      bintogrid
    </span>
  </a>
  
    <nav class="md-nav" aria-label="bintogrid">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.average_spectrum.bintogrid--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.average_spectrum.bintogrid--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.average_spectrum.calculate_bin_leftright" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_bin_leftright
    </span>
  </a>
  
    <nav class="md-nav" aria-label="calculate_bin_leftright">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.average_spectrum.calculate_bin_leftright--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.average_spectrum.calculate_bin_leftright--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.average_spectrum.edges_to_leftright" class="md-nav__link">
    <span class="md-ellipsis">
      edges_to_leftright
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.average_spectrum.expand_filenames" class="md-nav__link">
    <span class="md-ellipsis">
      expand_filenames
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.average_spectrum.get_average_spectrum" class="md-nav__link">
    <span class="md-ellipsis">
      get_average_spectrum
    </span>
  </a>
  
    <nav class="md-nav" aria-label="get_average_spectrum">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.average_spectrum.get_average_spectrum--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.average_spectrum.leftright_to_edges" class="md-nav__link">
    <span class="md-ellipsis">
      leftright_to_edges
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.average_spectrum.name2color" class="md-nav__link">
    <span class="md-ellipsis">
      name2color
    </span>
  </a>
  
    <nav class="md-nav" aria-label="name2color">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.average_spectrum.name2color--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.average_spectrum.name2color--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.average_spectrum.one2another" class="md-nav__link">
    <span class="md-ellipsis">
      one2another
    </span>
  </a>
  
    <nav class="md-nav" aria-label="one2another">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.average_spectrum.one2another--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.average_spectrum.one2another--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.average_spectrum.remove_unit" class="md-nav__link">
    <span class="md-ellipsis">
      remove_unit
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.average_spectrum.resample_while_conserving_flux" class="md-nav__link">
    <span class="md-ellipsis">
      resample_while_conserving_flux
    </span>
  </a>
  
    <nav class="md-nav" aria-label="resample_while_conserving_flux">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.average_spectrum.resample_while_conserving_flux--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.average_spectrum.resample_while_conserving_flux--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.expected_uncertainty" class="md-nav__link">
    <span class="md-ellipsis">
      expected_uncertainty
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.expected_uncertainty.bintoR" class="md-nav__link">
    <span class="md-ellipsis">
      bintoR
    </span>
  </a>
  
    <nav class="md-nav" aria-label="bintoR">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.expected_uncertainty.bintoR--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.expected_uncertainty.bintoR--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.expected_uncertainty.bintogrid" class="md-nav__link">
    <span class="md-ellipsis">
      bintogrid
    </span>
  </a>
  
    <nav class="md-nav" aria-label="bintogrid">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.expected_uncertainty.bintogrid--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.expected_uncertainty.bintogrid--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.expected_uncertainty.calculate_bin_leftright" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_bin_leftright
    </span>
  </a>
  
    <nav class="md-nav" aria-label="calculate_bin_leftright">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.expected_uncertainty.calculate_bin_leftright--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.expected_uncertainty.calculate_bin_leftright--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.expected_uncertainty.edges_to_leftright" class="md-nav__link">
    <span class="md-ellipsis">
      edges_to_leftright
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.expected_uncertainty.expand_filenames" class="md-nav__link">
    <span class="md-ellipsis">
      expand_filenames
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.expected_uncertainty.get_expected_uncertainty" class="md-nav__link">
    <span class="md-ellipsis">
      get_expected_uncertainty
    </span>
  </a>
  
    <nav class="md-nav" aria-label="get_expected_uncertainty">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.expected_uncertainty.get_expected_uncertainty--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.expected_uncertainty.get_expected_uncertainty--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.expected_uncertainty.leftright_to_edges" class="md-nav__link">
    <span class="md-ellipsis">
      leftright_to_edges
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.expected_uncertainty.name2color" class="md-nav__link">
    <span class="md-ellipsis">
      name2color
    </span>
  </a>
  
    <nav class="md-nav" aria-label="name2color">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.expected_uncertainty.name2color--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.expected_uncertainty.name2color--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.expected_uncertainty.one2another" class="md-nav__link">
    <span class="md-ellipsis">
      one2another
    </span>
  </a>
  
    <nav class="md-nav" aria-label="one2another">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.expected_uncertainty.one2another--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.expected_uncertainty.one2another--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.expected_uncertainty.remove_unit" class="md-nav__link">
    <span class="md-ellipsis">
      remove_unit
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.expected_uncertainty.resample_while_conserving_flux" class="md-nav__link">
    <span class="md-ellipsis">
      resample_while_conserving_flux
    </span>
  </a>
  
    <nav class="md-nav" aria-label="resample_while_conserving_flux">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.expected_uncertainty.resample_while_conserving_flux--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.expected_uncertainty.resample_while_conserving_flux--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.measured_scatter_in_bins" class="md-nav__link">
    <span class="md-ellipsis">
      measured_scatter_in_bins
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.measured_scatter_in_bins.bintoR" class="md-nav__link">
    <span class="md-ellipsis">
      bintoR
    </span>
  </a>
  
    <nav class="md-nav" aria-label="bintoR">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.measured_scatter_in_bins.bintoR--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.measured_scatter_in_bins.bintoR--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.measured_scatter_in_bins.bintogrid" class="md-nav__link">
    <span class="md-ellipsis">
      bintogrid
    </span>
  </a>
  
    <nav class="md-nav" aria-label="bintogrid">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.measured_scatter_in_bins.bintogrid--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.measured_scatter_in_bins.bintogrid--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.measured_scatter_in_bins.calculate_bin_leftright" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_bin_leftright
    </span>
  </a>
  
    <nav class="md-nav" aria-label="calculate_bin_leftright">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.measured_scatter_in_bins.calculate_bin_leftright--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.measured_scatter_in_bins.calculate_bin_leftright--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.measured_scatter_in_bins.edges_to_leftright" class="md-nav__link">
    <span class="md-ellipsis">
      edges_to_leftright
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.measured_scatter_in_bins.expand_filenames" class="md-nav__link">
    <span class="md-ellipsis">
      expand_filenames
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.measured_scatter_in_bins.get_measured_scatter_in_bins" class="md-nav__link">
    <span class="md-ellipsis">
      get_measured_scatter_in_bins
    </span>
  </a>
  
    <nav class="md-nav" aria-label="get_measured_scatter_in_bins">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.measured_scatter_in_bins.get_measured_scatter_in_bins--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.measured_scatter_in_bins.get_measured_scatter_in_bins--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.measured_scatter_in_bins.leftright_to_edges" class="md-nav__link">
    <span class="md-ellipsis">
      leftright_to_edges
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.measured_scatter_in_bins.name2color" class="md-nav__link">
    <span class="md-ellipsis">
      name2color
    </span>
  </a>
  
    <nav class="md-nav" aria-label="name2color">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.measured_scatter_in_bins.name2color--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.measured_scatter_in_bins.name2color--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.measured_scatter_in_bins.one2another" class="md-nav__link">
    <span class="md-ellipsis">
      one2another
    </span>
  </a>
  
    <nav class="md-nav" aria-label="one2another">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.measured_scatter_in_bins.one2another--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.measured_scatter_in_bins.one2another--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.measured_scatter_in_bins.remove_unit" class="md-nav__link">
    <span class="md-ellipsis">
      remove_unit
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.measured_scatter_in_bins.resample_while_conserving_flux" class="md-nav__link">
    <span class="md-ellipsis">
      resample_while_conserving_flux
    </span>
  </a>
  
    <nav class="md-nav" aria-label="resample_while_conserving_flux">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.measured_scatter_in_bins.resample_while_conserving_flux--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.measured_scatter_in_bins.resample_while_conserving_flux--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.measured_scatter" class="md-nav__link">
    <span class="md-ellipsis">
      measured_scatter
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.measured_scatter.bintoR" class="md-nav__link">
    <span class="md-ellipsis">
      bintoR
    </span>
  </a>
  
    <nav class="md-nav" aria-label="bintoR">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.measured_scatter.bintoR--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.measured_scatter.bintoR--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.measured_scatter.bintogrid" class="md-nav__link">
    <span class="md-ellipsis">
      bintogrid
    </span>
  </a>
  
    <nav class="md-nav" aria-label="bintogrid">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.measured_scatter.bintogrid--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.measured_scatter.bintogrid--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.measured_scatter.calculate_bin_leftright" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_bin_leftright
    </span>
  </a>
  
    <nav class="md-nav" aria-label="calculate_bin_leftright">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.measured_scatter.calculate_bin_leftright--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.measured_scatter.calculate_bin_leftright--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.measured_scatter.edges_to_leftright" class="md-nav__link">
    <span class="md-ellipsis">
      edges_to_leftright
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.measured_scatter.expand_filenames" class="md-nav__link">
    <span class="md-ellipsis">
      expand_filenames
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.measured_scatter.get_measured_scatter" class="md-nav__link">
    <span class="md-ellipsis">
      get_measured_scatter
    </span>
  </a>
  
    <nav class="md-nav" aria-label="get_measured_scatter">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.measured_scatter.get_measured_scatter--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.measured_scatter.get_measured_scatter--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.measured_scatter.leftright_to_edges" class="md-nav__link">
    <span class="md-ellipsis">
      leftright_to_edges
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.measured_scatter.name2color" class="md-nav__link">
    <span class="md-ellipsis">
      name2color
    </span>
  </a>
  
    <nav class="md-nav" aria-label="name2color">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.measured_scatter.name2color--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.measured_scatter.name2color--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.measured_scatter.one2another" class="md-nav__link">
    <span class="md-ellipsis">
      one2another
    </span>
  </a>
  
    <nav class="md-nav" aria-label="one2another">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.measured_scatter.one2another--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.measured_scatter.one2another--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.measured_scatter.remove_unit" class="md-nav__link">
    <span class="md-ellipsis">
      remove_unit
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.measured_scatter.resample_while_conserving_flux" class="md-nav__link">
    <span class="md-ellipsis">
      resample_while_conserving_flux
    </span>
  </a>
  
    <nav class="md-nav" aria-label="resample_while_conserving_flux">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.measured_scatter.resample_while_conserving_flux--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.measured_scatter.resample_while_conserving_flux--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.median_spectrum" class="md-nav__link">
    <span class="md-ellipsis">
      median_spectrum
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.median_spectrum.bintoR" class="md-nav__link">
    <span class="md-ellipsis">
      bintoR
    </span>
  </a>
  
    <nav class="md-nav" aria-label="bintoR">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.median_spectrum.bintoR--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.median_spectrum.bintoR--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.median_spectrum.bintogrid" class="md-nav__link">
    <span class="md-ellipsis">
      bintogrid
    </span>
  </a>
  
    <nav class="md-nav" aria-label="bintogrid">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.median_spectrum.bintogrid--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.median_spectrum.bintogrid--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.median_spectrum.calculate_bin_leftright" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_bin_leftright
    </span>
  </a>
  
    <nav class="md-nav" aria-label="calculate_bin_leftright">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.median_spectrum.calculate_bin_leftright--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.median_spectrum.calculate_bin_leftright--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.median_spectrum.edges_to_leftright" class="md-nav__link">
    <span class="md-ellipsis">
      edges_to_leftright
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.median_spectrum.expand_filenames" class="md-nav__link">
    <span class="md-ellipsis">
      expand_filenames
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.median_spectrum.get_median_spectrum" class="md-nav__link">
    <span class="md-ellipsis">
      get_median_spectrum
    </span>
  </a>
  
    <nav class="md-nav" aria-label="get_median_spectrum">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.median_spectrum.get_median_spectrum--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.median_spectrum.leftright_to_edges" class="md-nav__link">
    <span class="md-ellipsis">
      leftright_to_edges
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.median_spectrum.name2color" class="md-nav__link">
    <span class="md-ellipsis">
      name2color
    </span>
  </a>
  
    <nav class="md-nav" aria-label="name2color">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.median_spectrum.name2color--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.median_spectrum.name2color--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.median_spectrum.one2another" class="md-nav__link">
    <span class="md-ellipsis">
      one2another
    </span>
  </a>
  
    <nav class="md-nav" aria-label="one2another">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.median_spectrum.one2another--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.median_spectrum.one2another--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.median_spectrum.remove_unit" class="md-nav__link">
    <span class="md-ellipsis">
      remove_unit
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.median_spectrum.resample_while_conserving_flux" class="md-nav__link">
    <span class="md-ellipsis">
      resample_while_conserving_flux
    </span>
  </a>
  
    <nav class="md-nav" aria-label="resample_while_conserving_flux">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.median_spectrum.resample_while_conserving_flux--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.median_spectrum.resample_while_conserving_flux--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.spectral_resolution" class="md-nav__link">
    <span class="md-ellipsis">
      spectral_resolution
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.spectral_resolution.bintoR" class="md-nav__link">
    <span class="md-ellipsis">
      bintoR
    </span>
  </a>
  
    <nav class="md-nav" aria-label="bintoR">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.spectral_resolution.bintoR--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.spectral_resolution.bintoR--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.spectral_resolution.bintogrid" class="md-nav__link">
    <span class="md-ellipsis">
      bintogrid
    </span>
  </a>
  
    <nav class="md-nav" aria-label="bintogrid">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.spectral_resolution.bintogrid--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.spectral_resolution.bintogrid--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.spectral_resolution.calculate_bin_leftright" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_bin_leftright
    </span>
  </a>
  
    <nav class="md-nav" aria-label="calculate_bin_leftright">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.spectral_resolution.calculate_bin_leftright--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.spectral_resolution.calculate_bin_leftright--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.spectral_resolution.edges_to_leftright" class="md-nav__link">
    <span class="md-ellipsis">
      edges_to_leftright
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.spectral_resolution.expand_filenames" class="md-nav__link">
    <span class="md-ellipsis">
      expand_filenames
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.spectral_resolution.get_spectral_resolution" class="md-nav__link">
    <span class="md-ellipsis">
      get_spectral_resolution
    </span>
  </a>
  
    <nav class="md-nav" aria-label="get_spectral_resolution">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.spectral_resolution.get_spectral_resolution--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.spectral_resolution.get_spectral_resolution--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.spectral_resolution.leftright_to_edges" class="md-nav__link">
    <span class="md-ellipsis">
      leftright_to_edges
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.spectral_resolution.name2color" class="md-nav__link">
    <span class="md-ellipsis">
      name2color
    </span>
  </a>
  
    <nav class="md-nav" aria-label="name2color">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.spectral_resolution.name2color--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.spectral_resolution.name2color--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.spectral_resolution.one2another" class="md-nav__link">
    <span class="md-ellipsis">
      one2another
    </span>
  </a>
  
    <nav class="md-nav" aria-label="one2another">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.spectral_resolution.one2another--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.spectral_resolution.one2another--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.spectral_resolution.remove_unit" class="md-nav__link">
    <span class="md-ellipsis">
      remove_unit
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.spectral_resolution.resample_while_conserving_flux" class="md-nav__link">
    <span class="md-ellipsis">
      resample_while_conserving_flux
    </span>
  </a>
  
    <nav class="md-nav" aria-label="resample_while_conserving_flux">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.spectral_resolution.resample_while_conserving_flux--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.spectral_resolution.resample_while_conserving_flux--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.subset" class="md-nav__link">
    <span class="md-ellipsis">
      subset
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.subset.bintoR" class="md-nav__link">
    <span class="md-ellipsis">
      bintoR
    </span>
  </a>
  
    <nav class="md-nav" aria-label="bintoR">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.subset.bintoR--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.subset.bintoR--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.subset.bintogrid" class="md-nav__link">
    <span class="md-ellipsis">
      bintogrid
    </span>
  </a>
  
    <nav class="md-nav" aria-label="bintogrid">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.subset.bintogrid--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.subset.bintogrid--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.subset.calculate_bin_leftright" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_bin_leftright
    </span>
  </a>
  
    <nav class="md-nav" aria-label="calculate_bin_leftright">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.subset.calculate_bin_leftright--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.subset.calculate_bin_leftright--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.subset.edges_to_leftright" class="md-nav__link">
    <span class="md-ellipsis">
      edges_to_leftright
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.subset.expand_filenames" class="md-nav__link">
    <span class="md-ellipsis">
      expand_filenames
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.subset.get_for_wavelength" class="md-nav__link">
    <span class="md-ellipsis">
      get_for_wavelength
    </span>
  </a>
  
    <nav class="md-nav" aria-label="get_for_wavelength">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.subset.get_for_wavelength--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.subset.get_for_wavelength--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.subset.get_ok_data_for_wavelength" class="md-nav__link">
    <span class="md-ellipsis">
      get_ok_data_for_wavelength
    </span>
  </a>
  
    <nav class="md-nav" aria-label="get_ok_data_for_wavelength">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.subset.get_ok_data_for_wavelength--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.subset.get_ok_data_for_wavelength--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.subset.leftright_to_edges" class="md-nav__link">
    <span class="md-ellipsis">
      leftright_to_edges
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.subset.name2color" class="md-nav__link">
    <span class="md-ellipsis">
      name2color
    </span>
  </a>
  
    <nav class="md-nav" aria-label="name2color">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.subset.name2color--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.subset.name2color--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.subset.one2another" class="md-nav__link">
    <span class="md-ellipsis">
      one2another
    </span>
  </a>
  
    <nav class="md-nav" aria-label="one2another">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.subset.one2another--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.subset.one2another--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.subset.remove_unit" class="md-nav__link">
    <span class="md-ellipsis">
      remove_unit
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.subset.resample_while_conserving_flux" class="md-nav__link">
    <span class="md-ellipsis">
      resample_while_conserving_flux
    </span>
  </a>
  
    <nav class="md-nav" aria-label="resample_while_conserving_flux">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.subset.resample_while_conserving_flux--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.subset.resample_while_conserving_flux--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#visualizations" class="md-nav__link">
    <span class="md-ellipsis">
      🌈 Visualizations
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.animate" class="md-nav__link">
    <span class="md-ellipsis">
      animate
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.animate.animate_lightcurves" class="md-nav__link">
    <span class="md-ellipsis">
      animate_lightcurves
    </span>
  </a>
  
    <nav class="md-nav" aria-label="animate_lightcurves">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.animate.animate_lightcurves--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.animate.animate_spectra" class="md-nav__link">
    <span class="md-ellipsis">
      animate_spectra
    </span>
  </a>
  
    <nav class="md-nav" aria-label="animate_spectra">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.animate.animate_spectra--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.animate.bintoR" class="md-nav__link">
    <span class="md-ellipsis">
      bintoR
    </span>
  </a>
  
    <nav class="md-nav" aria-label="bintoR">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.animate.bintoR--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.animate.bintoR--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.animate.bintogrid" class="md-nav__link">
    <span class="md-ellipsis">
      bintogrid
    </span>
  </a>
  
    <nav class="md-nav" aria-label="bintogrid">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.animate.bintogrid--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.animate.bintogrid--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.animate.calculate_bin_leftright" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_bin_leftright
    </span>
  </a>
  
    <nav class="md-nav" aria-label="calculate_bin_leftright">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.animate.calculate_bin_leftright--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.animate.calculate_bin_leftright--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.animate.edges_to_leftright" class="md-nav__link">
    <span class="md-ellipsis">
      edges_to_leftright
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.animate.expand_filenames" class="md-nav__link">
    <span class="md-ellipsis">
      expand_filenames
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.animate.get_animation_writer_and_displayer" class="md-nav__link">
    <span class="md-ellipsis">
      get_animation_writer_and_displayer
    </span>
  </a>
  
    <nav class="md-nav" aria-label="get_animation_writer_and_displayer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.animate.get_animation_writer_and_displayer--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.animate.get_animation_writer_and_displayer--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.animate.leftright_to_edges" class="md-nav__link">
    <span class="md-ellipsis">
      leftright_to_edges
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.animate.name2color" class="md-nav__link">
    <span class="md-ellipsis">
      name2color
    </span>
  </a>
  
    <nav class="md-nav" aria-label="name2color">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.animate.name2color--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.animate.name2color--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.animate.one2another" class="md-nav__link">
    <span class="md-ellipsis">
      one2another
    </span>
  </a>
  
    <nav class="md-nav" aria-label="one2another">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.animate.one2another--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.animate.one2another--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.animate.remove_unit" class="md-nav__link">
    <span class="md-ellipsis">
      remove_unit
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.animate.resample_while_conserving_flux" class="md-nav__link">
    <span class="md-ellipsis">
      resample_while_conserving_flux
    </span>
  </a>
  
    <nav class="md-nav" aria-label="resample_while_conserving_flux">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.animate.resample_while_conserving_flux--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.animate.resample_while_conserving_flux--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.colors" class="md-nav__link">
    <span class="md-ellipsis">
      colors
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.colors.bintoR" class="md-nav__link">
    <span class="md-ellipsis">
      bintoR
    </span>
  </a>
  
    <nav class="md-nav" aria-label="bintoR">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.colors.bintoR--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.colors.bintoR--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.colors.bintogrid" class="md-nav__link">
    <span class="md-ellipsis">
      bintogrid
    </span>
  </a>
  
    <nav class="md-nav" aria-label="bintogrid">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.colors.bintogrid--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.colors.bintogrid--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.colors.calculate_bin_leftright" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_bin_leftright
    </span>
  </a>
  
    <nav class="md-nav" aria-label="calculate_bin_leftright">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.colors.calculate_bin_leftright--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.colors.calculate_bin_leftright--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.colors.edges_to_leftright" class="md-nav__link">
    <span class="md-ellipsis">
      edges_to_leftright
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.colors.expand_filenames" class="md-nav__link">
    <span class="md-ellipsis">
      expand_filenames
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.colors.get_wavelength_color" class="md-nav__link">
    <span class="md-ellipsis">
      get_wavelength_color
    </span>
  </a>
  
    <nav class="md-nav" aria-label="get_wavelength_color">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.colors.get_wavelength_color--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.colors.get_wavelength_color--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.colors.leftright_to_edges" class="md-nav__link">
    <span class="md-ellipsis">
      leftright_to_edges
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.colors.name2color" class="md-nav__link">
    <span class="md-ellipsis">
      name2color
    </span>
  </a>
  
    <nav class="md-nav" aria-label="name2color">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.colors.name2color--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.colors.name2color--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.colors.one2another" class="md-nav__link">
    <span class="md-ellipsis">
      one2another
    </span>
  </a>
  
    <nav class="md-nav" aria-label="one2another">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.colors.one2another--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.colors.one2another--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.colors.remove_unit" class="md-nav__link">
    <span class="md-ellipsis">
      remove_unit
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.colors.resample_while_conserving_flux" class="md-nav__link">
    <span class="md-ellipsis">
      resample_while_conserving_flux
    </span>
  </a>
  
    <nav class="md-nav" aria-label="resample_while_conserving_flux">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.colors.resample_while_conserving_flux--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.colors.resample_while_conserving_flux--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.colors.setup_wavelength_colors" class="md-nav__link">
    <span class="md-ellipsis">
      setup_wavelength_colors
    </span>
  </a>
  
    <nav class="md-nav" aria-label="setup_wavelength_colors">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.colors.setup_wavelength_colors--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.imshow" class="md-nav__link">
    <span class="md-ellipsis">
      imshow
    </span>
  </a>
  
    <nav class="md-nav" aria-label="imshow">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.imshow--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.interactive" class="md-nav__link">
    <span class="md-ellipsis">
      interactive
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.interactive.bintoR" class="md-nav__link">
    <span class="md-ellipsis">
      bintoR
    </span>
  </a>
  
    <nav class="md-nav" aria-label="bintoR">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.interactive.bintoR--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.interactive.bintoR--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.interactive.bintogrid" class="md-nav__link">
    <span class="md-ellipsis">
      bintogrid
    </span>
  </a>
  
    <nav class="md-nav" aria-label="bintogrid">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.interactive.bintogrid--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.interactive.bintogrid--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.interactive.calculate_bin_leftright" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_bin_leftright
    </span>
  </a>
  
    <nav class="md-nav" aria-label="calculate_bin_leftright">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.interactive.calculate_bin_leftright--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.interactive.calculate_bin_leftright--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.interactive.edges_to_leftright" class="md-nav__link">
    <span class="md-ellipsis">
      edges_to_leftright
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.interactive.expand_filenames" class="md-nav__link">
    <span class="md-ellipsis">
      expand_filenames
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.interactive.imshow_interact" class="md-nav__link">
    <span class="md-ellipsis">
      imshow_interact
    </span>
  </a>
  
    <nav class="md-nav" aria-label="imshow_interact">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.interactive.imshow_interact--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.interactive.leftright_to_edges" class="md-nav__link">
    <span class="md-ellipsis">
      leftright_to_edges
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.interactive.name2color" class="md-nav__link">
    <span class="md-ellipsis">
      name2color
    </span>
  </a>
  
    <nav class="md-nav" aria-label="name2color">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.interactive.name2color--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.interactive.name2color--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.interactive.one2another" class="md-nav__link">
    <span class="md-ellipsis">
      one2another
    </span>
  </a>
  
    <nav class="md-nav" aria-label="one2another">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.interactive.one2another--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.interactive.one2another--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.interactive.remove_unit" class="md-nav__link">
    <span class="md-ellipsis">
      remove_unit
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.interactive.resample_while_conserving_flux" class="md-nav__link">
    <span class="md-ellipsis">
      resample_while_conserving_flux
    </span>
  </a>
  
    <nav class="md-nav" aria-label="resample_while_conserving_flux">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.interactive.resample_while_conserving_flux--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.interactive.resample_while_conserving_flux--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.pcolormesh" class="md-nav__link">
    <span class="md-ellipsis">
      pcolormesh
    </span>
  </a>
  
    <nav class="md-nav" aria-label="pcolormesh">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.pcolormesh--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.plot_lightcurves" class="md-nav__link">
    <span class="md-ellipsis">
      plot_lightcurves
    </span>
  </a>
  
    <nav class="md-nav" aria-label="plot_lightcurves">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.plot_lightcurves--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.plot_spectra" class="md-nav__link">
    <span class="md-ellipsis">
      plot_spectra
    </span>
  </a>
  
    <nav class="md-nav" aria-label="plot_spectra">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.plot_spectra--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.plot" class="md-nav__link">
    <span class="md-ellipsis">
      plot
    </span>
  </a>
  
    <nav class="md-nav" aria-label="plot">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.plot--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tools" class="md-nav__link">
    <span class="md-ellipsis">
      🔨 Tools
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.spectra.planck.get_planck_photons" class="md-nav__link">
    <span class="md-ellipsis">
      get_planck_photons
    </span>
  </a>
  
    <nav class="md-nav" aria-label="get_planck_photons">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.spectra.planck.get_planck_photons--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.spectra.planck.get_planck_photons--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.spectra.phoenix.get_phoenix_photons" class="md-nav__link">
    <span class="md-ellipsis">
      get_phoenix_photons
    </span>
  </a>
  
    <nav class="md-nav" aria-label="get_phoenix_photons">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.spectra.phoenix.get_phoenix_photons--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.spectra.phoenix.get_phoenix_photons--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.tools.resampling" class="md-nav__link">
    <span class="md-ellipsis">
      resampling
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.tools.resampling.bintoR" class="md-nav__link">
    <span class="md-ellipsis">
      bintoR
    </span>
  </a>
  
    <nav class="md-nav" aria-label="bintoR">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.tools.resampling.bintoR--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.tools.resampling.bintoR--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.tools.resampling.bintogrid" class="md-nav__link">
    <span class="md-ellipsis">
      bintogrid
    </span>
  </a>
  
    <nav class="md-nav" aria-label="bintogrid">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.tools.resampling.bintogrid--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.tools.resampling.bintogrid--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.tools.resampling.calculate_bin_leftright" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_bin_leftright
    </span>
  </a>
  
    <nav class="md-nav" aria-label="calculate_bin_leftright">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.tools.resampling.calculate_bin_leftright--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.tools.resampling.calculate_bin_leftright--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.tools.resampling.calculate_bin_widths" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_bin_widths
    </span>
  </a>
  
    <nav class="md-nav" aria-label="calculate_bin_widths">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.tools.resampling.calculate_bin_widths--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.tools.resampling.calculate_bin_widths--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.tools.resampling.edges_to_leftright" class="md-nav__link">
    <span class="md-ellipsis">
      edges_to_leftright
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.tools.resampling.leftright_to_edges" class="md-nav__link">
    <span class="md-ellipsis">
      leftright_to_edges
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.tools.resampling.plot_as_boxes" class="md-nav__link">
    <span class="md-ellipsis">
      plot_as_boxes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="plot_as_boxes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.tools.resampling.plot_as_boxes--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.tools.resampling.resample_while_conserving_flux" class="md-nav__link">
    <span class="md-ellipsis">
      resample_while_conserving_flux
    </span>
  </a>
  
    <nav class="md-nav" aria-label="resample_while_conserving_flux">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.tools.resampling.resample_while_conserving_flux--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.tools.resampling.resample_while_conserving_flux--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.imports" class="md-nav__link">
    <span class="md-ellipsis">
      imports
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.imports.bintoR" class="md-nav__link">
    <span class="md-ellipsis">
      bintoR
    </span>
  </a>
  
    <nav class="md-nav" aria-label="bintoR">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.imports.bintoR--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.imports.bintoR--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.imports.bintogrid" class="md-nav__link">
    <span class="md-ellipsis">
      bintogrid
    </span>
  </a>
  
    <nav class="md-nav" aria-label="bintogrid">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.imports.bintogrid--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.imports.bintogrid--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.imports.calculate_bin_leftright" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_bin_leftright
    </span>
  </a>
  
    <nav class="md-nav" aria-label="calculate_bin_leftright">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.imports.calculate_bin_leftright--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.imports.calculate_bin_leftright--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.imports.edges_to_leftright" class="md-nav__link">
    <span class="md-ellipsis">
      edges_to_leftright
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.imports.expand_filenames" class="md-nav__link">
    <span class="md-ellipsis">
      expand_filenames
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.imports.leftright_to_edges" class="md-nav__link">
    <span class="md-ellipsis">
      leftright_to_edges
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.imports.name2color" class="md-nav__link">
    <span class="md-ellipsis">
      name2color
    </span>
  </a>
  
    <nav class="md-nav" aria-label="name2color">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.imports.name2color--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.imports.name2color--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.imports.one2another" class="md-nav__link">
    <span class="md-ellipsis">
      one2another
    </span>
  </a>
  
    <nav class="md-nav" aria-label="one2another">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.imports.one2another--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.imports.one2another--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.imports.remove_unit" class="md-nav__link">
    <span class="md-ellipsis">
      remove_unit
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.imports.resample_while_conserving_flux" class="md-nav__link">
    <span class="md-ellipsis">
      resample_while_conserving_flux
    </span>
  </a>
  
    <nav class="md-nav" aria-label="resample_while_conserving_flux">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.imports.resample_while_conserving_flux--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.imports.resample_while_conserving_flux--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.read_rainbow" class="md-nav__link">
    <span class="md-ellipsis">
      read_rainbow
    </span>
  </a>
  
    <nav class="md-nav" aria-label="read_rainbow">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.read_rainbow--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.read_rainbow--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.rainbow.Rainbow" class="md-nav__link">
    <span class="md-ellipsis">
      Rainbow
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Rainbow">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.rainbow.Rainbow--attributes" class="md-nav__link">
    <span class="md-ellipsis">
      Attributes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.rainbow.Rainbow.dt" class="md-nav__link">
    <span class="md-ellipsis">
      dt
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.rainbow.Rainbow.flux" class="md-nav__link">
    <span class="md-ellipsis">
      flux
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.rainbow.Rainbow.name" class="md-nav__link">
    <span class="md-ellipsis">
      name
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.rainbow.Rainbow.nflux" class="md-nav__link">
    <span class="md-ellipsis">
      nflux
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.rainbow.Rainbow.ntime" class="md-nav__link">
    <span class="md-ellipsis">
      ntime
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.rainbow.Rainbow.nwave" class="md-nav__link">
    <span class="md-ellipsis">
      nwave
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.rainbow.Rainbow.ok" class="md-nav__link">
    <span class="md-ellipsis">
      ok
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.rainbow.Rainbow.shape" class="md-nav__link">
    <span class="md-ellipsis">
      shape
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.rainbow.Rainbow.time" class="md-nav__link">
    <span class="md-ellipsis">
      time
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.rainbow.Rainbow.uncertainty" class="md-nav__link">
    <span class="md-ellipsis">
      uncertainty
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.rainbow.Rainbow.wavelength" class="md-nav__link">
    <span class="md-ellipsis">
      wavelength
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.rainbow.Rainbow.__getattr__" class="md-nav__link">
    <span class="md-ellipsis">
      __getattr__
    </span>
  </a>
  
    <nav class="md-nav" aria-label="__getattr__">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.rainbow.Rainbow.__getattr__--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.rainbow.Rainbow.__getitem__" class="md-nav__link">
    <span class="md-ellipsis">
      __getitem__
    </span>
  </a>
  
    <nav class="md-nav" aria-label="__getitem__">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.rainbow.Rainbow.__getitem__--examples" class="md-nav__link">
    <span class="md-ellipsis">
      Examples
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.rainbow.Rainbow.__getitem__--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.rainbow.Rainbow.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
    <nav class="md-nav" aria-label="__init__">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.rainbow.Rainbow.__init__--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.rainbow.Rainbow.__init__--examples" class="md-nav__link">
    <span class="md-ellipsis">
      Examples
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.rainbow.Rainbow.__repr__" class="md-nav__link">
    <span class="md-ellipsis">
      __repr__
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.rainbow.Rainbow.__setattr__" class="md-nav__link">
    <span class="md-ellipsis">
      __setattr__
    </span>
  </a>
  
    <nav class="md-nav" aria-label="__setattr__">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.rainbow.Rainbow.__setattr__--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.withmodel.RainbowWithModel" class="md-nav__link">
    <span class="md-ellipsis">
      RainbowWithModel
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.withmodel.RainbowWithModel.chi_squared" class="md-nav__link">
    <span class="md-ellipsis">
      chi_squared
    </span>
  </a>
  
    <nav class="md-nav" aria-label="chi_squared">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.withmodel.RainbowWithModel.chi_squared--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.withmodel.RainbowWithModel.ones" class="md-nav__link">
    <span class="md-ellipsis">
      ones
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ones">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.withmodel.RainbowWithModel.ones--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.withmodel.RainbowWithModel.residuals" class="md-nav__link">
    <span class="md-ellipsis">
      residuals
    </span>
  </a>
  
    <nav class="md-nav" aria-label="residuals">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.withmodel.RainbowWithModel.residuals--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.withmodel.RainbowWithModel.residuals_plus_one" class="md-nav__link">
    <span class="md-ellipsis">
      residuals_plus_one
    </span>
  </a>
  
    <nav class="md-nav" aria-label="residuals_plus_one">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.withmodel.RainbowWithModel.residuals_plus_one--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.simulated.SimulatedRainbow" class="md-nav__link">
    <span class="md-ellipsis">
      SimulatedRainbow
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.simulated.SimulatedRainbow.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
    <nav class="md-nav" aria-label="__init__">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.simulated.SimulatedRainbow.__init__--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#helpers" class="md-nav__link">
    <span class="md-ellipsis">
      🌈 Helpers
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.helpers.get" class="md-nav__link">
    <span class="md-ellipsis">
      get
    </span>
  </a>
  
    <nav class="md-nav" aria-label="get">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.helpers.get--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.helpers.get--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.helpers.help" class="md-nav__link">
    <span class="md-ellipsis">
      help
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.helpers.history" class="md-nav__link">
    <span class="md-ellipsis">
      history
    </span>
  </a>
  
    <nav class="md-nav" aria-label="history">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.helpers.history--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.helpers.save" class="md-nav__link">
    <span class="md-ellipsis">
      save
    </span>
  </a>
  
    <nav class="md-nav" aria-label="save">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.helpers.save--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#actions" class="md-nav__link">
    <span class="md-ellipsis">
      🌈 Actions
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.align_wavelengths" class="md-nav__link">
    <span class="md-ellipsis">
      align_wavelengths
    </span>
  </a>
  
    <nav class="md-nav" aria-label="align_wavelengths">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.align_wavelengths--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.align_wavelengths--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.attach_model" class="md-nav__link">
    <span class="md-ellipsis">
      attach_model
    </span>
  </a>
  
    <nav class="md-nav" aria-label="attach_model">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.attach_model--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.attach_model--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.binning" class="md-nav__link">
    <span class="md-ellipsis">
      binning
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.binning.bin" class="md-nav__link">
    <span class="md-ellipsis">
      bin
    </span>
  </a>
  
    <nav class="md-nav" aria-label="bin">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.binning.bin--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.binning.bin--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.binning.bin_in_time" class="md-nav__link">
    <span class="md-ellipsis">
      bin_in_time
    </span>
  </a>
  
    <nav class="md-nav" aria-label="bin_in_time">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.binning.bin_in_time--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.binning.bin_in_time--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.binning.bin_in_wavelength" class="md-nav__link">
    <span class="md-ellipsis">
      bin_in_wavelength
    </span>
  </a>
  
    <nav class="md-nav" aria-label="bin_in_wavelength">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.binning.bin_in_wavelength--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.binning.bin_in_wavelength--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.binning.bintoR" class="md-nav__link">
    <span class="md-ellipsis">
      bintoR
    </span>
  </a>
  
    <nav class="md-nav" aria-label="bintoR">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.binning.bintoR--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.binning.bintoR--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.binning.bintogrid" class="md-nav__link">
    <span class="md-ellipsis">
      bintogrid
    </span>
  </a>
  
    <nav class="md-nav" aria-label="bintogrid">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.binning.bintogrid--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.binning.bintogrid--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.binning.calculate_bin_leftright" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_bin_leftright
    </span>
  </a>
  
    <nav class="md-nav" aria-label="calculate_bin_leftright">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.binning.calculate_bin_leftright--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.binning.calculate_bin_leftright--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.binning.edges_to_leftright" class="md-nav__link">
    <span class="md-ellipsis">
      edges_to_leftright
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.binning.expand_filenames" class="md-nav__link">
    <span class="md-ellipsis">
      expand_filenames
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.binning.get_average_lightcurve_as_rainbow" class="md-nav__link">
    <span class="md-ellipsis">
      get_average_lightcurve_as_rainbow
    </span>
  </a>
  
    <nav class="md-nav" aria-label="get_average_lightcurve_as_rainbow">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.binning.get_average_lightcurve_as_rainbow--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.binning.get_average_spectrum_as_rainbow" class="md-nav__link">
    <span class="md-ellipsis">
      get_average_spectrum_as_rainbow
    </span>
  </a>
  
    <nav class="md-nav" aria-label="get_average_spectrum_as_rainbow">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.binning.get_average_spectrum_as_rainbow--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.binning.leftright_to_edges" class="md-nav__link">
    <span class="md-ellipsis">
      leftright_to_edges
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.binning.name2color" class="md-nav__link">
    <span class="md-ellipsis">
      name2color
    </span>
  </a>
  
    <nav class="md-nav" aria-label="name2color">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.binning.name2color--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.binning.name2color--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.binning.one2another" class="md-nav__link">
    <span class="md-ellipsis">
      one2another
    </span>
  </a>
  
    <nav class="md-nav" aria-label="one2another">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.binning.one2another--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.binning.one2another--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.binning.remove_unit" class="md-nav__link">
    <span class="md-ellipsis">
      remove_unit
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.binning.resample_while_conserving_flux" class="md-nav__link">
    <span class="md-ellipsis">
      resample_while_conserving_flux
    </span>
  </a>
  
    <nav class="md-nav" aria-label="resample_while_conserving_flux">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.binning.resample_while_conserving_flux--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.binning.resample_while_conserving_flux--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.compare" class="md-nav__link">
    <span class="md-ellipsis">
      compare
    </span>
  </a>
  
    <nav class="md-nav" aria-label="compare">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.compare--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.compare--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.flag_outliers" class="md-nav__link">
    <span class="md-ellipsis">
      flag_outliers
    </span>
  </a>
  
    <nav class="md-nav" aria-label="flag_outliers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.flag_outliers--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.flag_outliers--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.fold" class="md-nav__link">
    <span class="md-ellipsis">
      fold
    </span>
  </a>
  
    <nav class="md-nav" aria-label="fold">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.fold--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.fold--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.inflate_uncertainty" class="md-nav__link">
    <span class="md-ellipsis">
      inflate_uncertainty
    </span>
  </a>
  
    <nav class="md-nav" aria-label="inflate_uncertainty">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.inflate_uncertainty--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.inflate_uncertainty--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.inject_noise" class="md-nav__link">
    <span class="md-ellipsis">
      inject_noise
    </span>
  </a>
  
    <nav class="md-nav" aria-label="inject_noise">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.inject_noise--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.inject_noise--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.inject_outliers" class="md-nav__link">
    <span class="md-ellipsis">
      inject_outliers
    </span>
  </a>
  
    <nav class="md-nav" aria-label="inject_outliers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.inject_outliers--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.inject_outliers--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.inject_spectrum" class="md-nav__link">
    <span class="md-ellipsis">
      inject_spectrum
    </span>
  </a>
  
    <nav class="md-nav" aria-label="inject_spectrum">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.inject_spectrum--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.inject_spectrum--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.inject_systematics" class="md-nav__link">
    <span class="md-ellipsis">
      inject_systematics
    </span>
  </a>
  
    <nav class="md-nav" aria-label="inject_systematics">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.inject_systematics--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.inject_systematics--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.inject_transit" class="md-nav__link">
    <span class="md-ellipsis">
      inject_transit
    </span>
  </a>
  
    <nav class="md-nav" aria-label="inject_transit">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.inject_transit--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.normalization" class="md-nav__link">
    <span class="md-ellipsis">
      normalization
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.normalization.bintoR" class="md-nav__link">
    <span class="md-ellipsis">
      bintoR
    </span>
  </a>
  
    <nav class="md-nav" aria-label="bintoR">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.normalization.bintoR--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.normalization.bintoR--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.normalization.bintogrid" class="md-nav__link">
    <span class="md-ellipsis">
      bintogrid
    </span>
  </a>
  
    <nav class="md-nav" aria-label="bintogrid">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.normalization.bintogrid--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.normalization.bintogrid--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.normalization.calculate_bin_leftright" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_bin_leftright
    </span>
  </a>
  
    <nav class="md-nav" aria-label="calculate_bin_leftright">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.normalization.calculate_bin_leftright--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.normalization.calculate_bin_leftright--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.normalization.edges_to_leftright" class="md-nav__link">
    <span class="md-ellipsis">
      edges_to_leftright
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.normalization.expand_filenames" class="md-nav__link">
    <span class="md-ellipsis">
      expand_filenames
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.normalization.leftright_to_edges" class="md-nav__link">
    <span class="md-ellipsis">
      leftright_to_edges
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.normalization.name2color" class="md-nav__link">
    <span class="md-ellipsis">
      name2color
    </span>
  </a>
  
    <nav class="md-nav" aria-label="name2color">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.normalization.name2color--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.normalization.name2color--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.normalization.normalize" class="md-nav__link">
    <span class="md-ellipsis">
      normalize
    </span>
  </a>
  
    <nav class="md-nav" aria-label="normalize">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.normalization.normalize--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.normalization.normalize--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.normalization.one2another" class="md-nav__link">
    <span class="md-ellipsis">
      one2another
    </span>
  </a>
  
    <nav class="md-nav" aria-label="one2another">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.normalization.one2another--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.normalization.one2another--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.normalization.remove_unit" class="md-nav__link">
    <span class="md-ellipsis">
      remove_unit
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.normalization.resample_while_conserving_flux" class="md-nav__link">
    <span class="md-ellipsis">
      resample_while_conserving_flux
    </span>
  </a>
  
    <nav class="md-nav" aria-label="resample_while_conserving_flux">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.normalization.resample_while_conserving_flux--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.normalization.resample_while_conserving_flux--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.operations" class="md-nav__link">
    <span class="md-ellipsis">
      operations
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.operations.__add__" class="md-nav__link">
    <span class="md-ellipsis">
      __add__
    </span>
  </a>
  
    <nav class="md-nav" aria-label="__add__">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.operations.__add__--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.operations.__add__--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.operations.__eq__" class="md-nav__link">
    <span class="md-ellipsis">
      __eq__
    </span>
  </a>
  
    <nav class="md-nav" aria-label="__eq__">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.operations.__eq__--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.operations.__eq__--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.operations.__mul__" class="md-nav__link">
    <span class="md-ellipsis">
      __mul__
    </span>
  </a>
  
    <nav class="md-nav" aria-label="__mul__">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.operations.__mul__--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.operations.__mul__--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.operations.__sub__" class="md-nav__link">
    <span class="md-ellipsis">
      __sub__
    </span>
  </a>
  
    <nav class="md-nav" aria-label="__sub__">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.operations.__sub__--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.operations.__sub__--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.operations.__truediv__" class="md-nav__link">
    <span class="md-ellipsis">
      __truediv__
    </span>
  </a>
  
    <nav class="md-nav" aria-label="__truediv__">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.operations.__truediv__--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.operations.__truediv__--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.operations.bintoR" class="md-nav__link">
    <span class="md-ellipsis">
      bintoR
    </span>
  </a>
  
    <nav class="md-nav" aria-label="bintoR">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.operations.bintoR--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.operations.bintoR--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.operations.bintogrid" class="md-nav__link">
    <span class="md-ellipsis">
      bintogrid
    </span>
  </a>
  
    <nav class="md-nav" aria-label="bintogrid">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.operations.bintogrid--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.operations.bintogrid--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.operations.calculate_bin_leftright" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_bin_leftright
    </span>
  </a>
  
    <nav class="md-nav" aria-label="calculate_bin_leftright">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.operations.calculate_bin_leftright--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.operations.calculate_bin_leftright--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.operations.diff" class="md-nav__link">
    <span class="md-ellipsis">
      diff
    </span>
  </a>
  
    <nav class="md-nav" aria-label="diff">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.operations.diff--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.operations.diff--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.operations.edges_to_leftright" class="md-nav__link">
    <span class="md-ellipsis">
      edges_to_leftright
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.operations.expand_filenames" class="md-nav__link">
    <span class="md-ellipsis">
      expand_filenames
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.operations.leftright_to_edges" class="md-nav__link">
    <span class="md-ellipsis">
      leftright_to_edges
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.operations.name2color" class="md-nav__link">
    <span class="md-ellipsis">
      name2color
    </span>
  </a>
  
    <nav class="md-nav" aria-label="name2color">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.operations.name2color--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.operations.name2color--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.operations.one2another" class="md-nav__link">
    <span class="md-ellipsis">
      one2another
    </span>
  </a>
  
    <nav class="md-nav" aria-label="one2another">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.operations.one2another--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.operations.one2another--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.operations.remove_unit" class="md-nav__link">
    <span class="md-ellipsis">
      remove_unit
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.operations.resample_while_conserving_flux" class="md-nav__link">
    <span class="md-ellipsis">
      resample_while_conserving_flux
    </span>
  </a>
  
    <nav class="md-nav" aria-label="resample_while_conserving_flux">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.operations.resample_while_conserving_flux--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.operations.resample_while_conserving_flux--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.remove_trends" class="md-nav__link">
    <span class="md-ellipsis">
      remove_trends
    </span>
  </a>
  
    <nav class="md-nav" aria-label="remove_trends">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.remove_trends--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.remove_trends--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.shift" class="md-nav__link">
    <span class="md-ellipsis">
      shift
    </span>
  </a>
  
    <nav class="md-nav" aria-label="shift">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.shift--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.trim" class="md-nav__link">
    <span class="md-ellipsis">
      trim
    </span>
  </a>
  
    <nav class="md-nav" aria-label="trim">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.trim--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.actions.trim--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gettimelike" class="md-nav__link">
    <span class="md-ellipsis">
      🌈 Get/Timelike
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.average_lightcurve" class="md-nav__link">
    <span class="md-ellipsis">
      average_lightcurve
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.average_lightcurve.bintoR" class="md-nav__link">
    <span class="md-ellipsis">
      bintoR
    </span>
  </a>
  
    <nav class="md-nav" aria-label="bintoR">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.average_lightcurve.bintoR--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.average_lightcurve.bintoR--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.average_lightcurve.bintogrid" class="md-nav__link">
    <span class="md-ellipsis">
      bintogrid
    </span>
  </a>
  
    <nav class="md-nav" aria-label="bintogrid">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.average_lightcurve.bintogrid--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.average_lightcurve.bintogrid--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.average_lightcurve.calculate_bin_leftright" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_bin_leftright
    </span>
  </a>
  
    <nav class="md-nav" aria-label="calculate_bin_leftright">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.average_lightcurve.calculate_bin_leftright--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.average_lightcurve.calculate_bin_leftright--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.average_lightcurve.edges_to_leftright" class="md-nav__link">
    <span class="md-ellipsis">
      edges_to_leftright
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.average_lightcurve.expand_filenames" class="md-nav__link">
    <span class="md-ellipsis">
      expand_filenames
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.average_lightcurve.get_average_lightcurve" class="md-nav__link">
    <span class="md-ellipsis">
      get_average_lightcurve
    </span>
  </a>
  
    <nav class="md-nav" aria-label="get_average_lightcurve">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.average_lightcurve.get_average_lightcurve--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.average_lightcurve.leftright_to_edges" class="md-nav__link">
    <span class="md-ellipsis">
      leftright_to_edges
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.average_lightcurve.name2color" class="md-nav__link">
    <span class="md-ellipsis">
      name2color
    </span>
  </a>
  
    <nav class="md-nav" aria-label="name2color">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.average_lightcurve.name2color--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.average_lightcurve.name2color--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.average_lightcurve.one2another" class="md-nav__link">
    <span class="md-ellipsis">
      one2another
    </span>
  </a>
  
    <nav class="md-nav" aria-label="one2another">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.average_lightcurve.one2another--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.average_lightcurve.one2another--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.average_lightcurve.remove_unit" class="md-nav__link">
    <span class="md-ellipsis">
      remove_unit
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.average_lightcurve.resample_while_conserving_flux" class="md-nav__link">
    <span class="md-ellipsis">
      resample_while_conserving_flux
    </span>
  </a>
  
    <nav class="md-nav" aria-label="resample_while_conserving_flux">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.average_lightcurve.resample_while_conserving_flux--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.average_lightcurve.resample_while_conserving_flux--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.median_lightcurve" class="md-nav__link">
    <span class="md-ellipsis">
      median_lightcurve
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.median_lightcurve.bintoR" class="md-nav__link">
    <span class="md-ellipsis">
      bintoR
    </span>
  </a>
  
    <nav class="md-nav" aria-label="bintoR">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.median_lightcurve.bintoR--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.median_lightcurve.bintoR--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.median_lightcurve.bintogrid" class="md-nav__link">
    <span class="md-ellipsis">
      bintogrid
    </span>
  </a>
  
    <nav class="md-nav" aria-label="bintogrid">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.median_lightcurve.bintogrid--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.median_lightcurve.bintogrid--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.median_lightcurve.calculate_bin_leftright" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_bin_leftright
    </span>
  </a>
  
    <nav class="md-nav" aria-label="calculate_bin_leftright">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.median_lightcurve.calculate_bin_leftright--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.median_lightcurve.calculate_bin_leftright--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.median_lightcurve.edges_to_leftright" class="md-nav__link">
    <span class="md-ellipsis">
      edges_to_leftright
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.median_lightcurve.expand_filenames" class="md-nav__link">
    <span class="md-ellipsis">
      expand_filenames
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.median_lightcurve.get_median_lightcurve" class="md-nav__link">
    <span class="md-ellipsis">
      get_median_lightcurve
    </span>
  </a>
  
    <nav class="md-nav" aria-label="get_median_lightcurve">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.median_lightcurve.get_median_lightcurve--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.median_lightcurve.leftright_to_edges" class="md-nav__link">
    <span class="md-ellipsis">
      leftright_to_edges
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.median_lightcurve.name2color" class="md-nav__link">
    <span class="md-ellipsis">
      name2color
    </span>
  </a>
  
    <nav class="md-nav" aria-label="name2color">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.median_lightcurve.name2color--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.median_lightcurve.name2color--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.median_lightcurve.one2another" class="md-nav__link">
    <span class="md-ellipsis">
      one2another
    </span>
  </a>
  
    <nav class="md-nav" aria-label="one2another">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.median_lightcurve.one2another--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.median_lightcurve.one2another--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.median_lightcurve.remove_unit" class="md-nav__link">
    <span class="md-ellipsis">
      remove_unit
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.median_lightcurve.resample_while_conserving_flux" class="md-nav__link">
    <span class="md-ellipsis">
      resample_while_conserving_flux
    </span>
  </a>
  
    <nav class="md-nav" aria-label="resample_while_conserving_flux">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.median_lightcurve.resample_while_conserving_flux--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.median_lightcurve.resample_while_conserving_flux--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.subset" class="md-nav__link">
    <span class="md-ellipsis">
      subset
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.subset.bintoR" class="md-nav__link">
    <span class="md-ellipsis">
      bintoR
    </span>
  </a>
  
    <nav class="md-nav" aria-label="bintoR">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.subset.bintoR--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.subset.bintoR--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.subset.bintogrid" class="md-nav__link">
    <span class="md-ellipsis">
      bintogrid
    </span>
  </a>
  
    <nav class="md-nav" aria-label="bintogrid">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.subset.bintogrid--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.subset.bintogrid--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.subset.calculate_bin_leftright" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_bin_leftright
    </span>
  </a>
  
    <nav class="md-nav" aria-label="calculate_bin_leftright">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.subset.calculate_bin_leftright--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.subset.calculate_bin_leftright--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.subset.edges_to_leftright" class="md-nav__link">
    <span class="md-ellipsis">
      edges_to_leftright
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.subset.expand_filenames" class="md-nav__link">
    <span class="md-ellipsis">
      expand_filenames
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.subset.get_for_time" class="md-nav__link">
    <span class="md-ellipsis">
      get_for_time
    </span>
  </a>
  
    <nav class="md-nav" aria-label="get_for_time">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.subset.get_for_time--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.subset.get_for_time--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.subset.get_ok_data_for_time" class="md-nav__link">
    <span class="md-ellipsis">
      get_ok_data_for_time
    </span>
  </a>
  
    <nav class="md-nav" aria-label="get_ok_data_for_time">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.subset.get_ok_data_for_time--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.subset.get_ok_data_for_time--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.subset.leftright_to_edges" class="md-nav__link">
    <span class="md-ellipsis">
      leftright_to_edges
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.subset.name2color" class="md-nav__link">
    <span class="md-ellipsis">
      name2color
    </span>
  </a>
  
    <nav class="md-nav" aria-label="name2color">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.subset.name2color--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.subset.name2color--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.subset.one2another" class="md-nav__link">
    <span class="md-ellipsis">
      one2another
    </span>
  </a>
  
    <nav class="md-nav" aria-label="one2another">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.subset.one2another--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.subset.one2another--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.subset.remove_unit" class="md-nav__link">
    <span class="md-ellipsis">
      remove_unit
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.subset.resample_while_conserving_flux" class="md-nav__link">
    <span class="md-ellipsis">
      resample_while_conserving_flux
    </span>
  </a>
  
    <nav class="md-nav" aria-label="resample_while_conserving_flux">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.subset.resample_while_conserving_flux--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.subset.resample_while_conserving_flux--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.time" class="md-nav__link">
    <span class="md-ellipsis">
      time
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.time.bintoR" class="md-nav__link">
    <span class="md-ellipsis">
      bintoR
    </span>
  </a>
  
    <nav class="md-nav" aria-label="bintoR">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.time.bintoR--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.time.bintoR--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.time.bintogrid" class="md-nav__link">
    <span class="md-ellipsis">
      bintogrid
    </span>
  </a>
  
    <nav class="md-nav" aria-label="bintogrid">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.time.bintogrid--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.time.bintogrid--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.time.calculate_bin_leftright" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_bin_leftright
    </span>
  </a>
  
    <nav class="md-nav" aria-label="calculate_bin_leftright">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.time.calculate_bin_leftright--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.time.calculate_bin_leftright--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.time.edges_to_leftright" class="md-nav__link">
    <span class="md-ellipsis">
      edges_to_leftright
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.time.expand_filenames" class="md-nav__link">
    <span class="md-ellipsis">
      expand_filenames
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.time.get_times_as_astropy" class="md-nav__link">
    <span class="md-ellipsis">
      get_times_as_astropy
    </span>
  </a>
  
    <nav class="md-nav" aria-label="get_times_as_astropy">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.time.get_times_as_astropy--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.time.get_times_as_astropy--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.time.leftright_to_edges" class="md-nav__link">
    <span class="md-ellipsis">
      leftright_to_edges
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.time.name2color" class="md-nav__link">
    <span class="md-ellipsis">
      name2color
    </span>
  </a>
  
    <nav class="md-nav" aria-label="name2color">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.time.name2color--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.time.name2color--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.time.one2another" class="md-nav__link">
    <span class="md-ellipsis">
      one2another
    </span>
  </a>
  
    <nav class="md-nav" aria-label="one2another">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.time.one2another--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.time.one2another--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.time.remove_unit" class="md-nav__link">
    <span class="md-ellipsis">
      remove_unit
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.time.resample_while_conserving_flux" class="md-nav__link">
    <span class="md-ellipsis">
      resample_while_conserving_flux
    </span>
  </a>
  
    <nav class="md-nav" aria-label="resample_while_conserving_flux">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.time.resample_while_conserving_flux--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.time.resample_while_conserving_flux--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.time.set_times_from_astropy" class="md-nav__link">
    <span class="md-ellipsis">
      set_times_from_astropy
    </span>
  </a>
  
    <nav class="md-nav" aria-label="set_times_from_astropy">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.time.set_times_from_astropy--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.timelike.time.set_times_from_astropy--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#getwavelike" class="md-nav__link">
    <span class="md-ellipsis">
      🌈 Get/Wavelike
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.average_spectrum" class="md-nav__link">
    <span class="md-ellipsis">
      average_spectrum
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.average_spectrum.bintoR" class="md-nav__link">
    <span class="md-ellipsis">
      bintoR
    </span>
  </a>
  
    <nav class="md-nav" aria-label="bintoR">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.average_spectrum.bintoR--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.average_spectrum.bintoR--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.average_spectrum.bintogrid" class="md-nav__link">
    <span class="md-ellipsis">
      bintogrid
    </span>
  </a>
  
    <nav class="md-nav" aria-label="bintogrid">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.average_spectrum.bintogrid--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.average_spectrum.bintogrid--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.average_spectrum.calculate_bin_leftright" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_bin_leftright
    </span>
  </a>
  
    <nav class="md-nav" aria-label="calculate_bin_leftright">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.average_spectrum.calculate_bin_leftright--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.average_spectrum.calculate_bin_leftright--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.average_spectrum.edges_to_leftright" class="md-nav__link">
    <span class="md-ellipsis">
      edges_to_leftright
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.average_spectrum.expand_filenames" class="md-nav__link">
    <span class="md-ellipsis">
      expand_filenames
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.average_spectrum.get_average_spectrum" class="md-nav__link">
    <span class="md-ellipsis">
      get_average_spectrum
    </span>
  </a>
  
    <nav class="md-nav" aria-label="get_average_spectrum">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.average_spectrum.get_average_spectrum--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.average_spectrum.leftright_to_edges" class="md-nav__link">
    <span class="md-ellipsis">
      leftright_to_edges
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.average_spectrum.name2color" class="md-nav__link">
    <span class="md-ellipsis">
      name2color
    </span>
  </a>
  
    <nav class="md-nav" aria-label="name2color">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.average_spectrum.name2color--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.average_spectrum.name2color--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.average_spectrum.one2another" class="md-nav__link">
    <span class="md-ellipsis">
      one2another
    </span>
  </a>
  
    <nav class="md-nav" aria-label="one2another">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.average_spectrum.one2another--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.average_spectrum.one2another--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.average_spectrum.remove_unit" class="md-nav__link">
    <span class="md-ellipsis">
      remove_unit
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.average_spectrum.resample_while_conserving_flux" class="md-nav__link">
    <span class="md-ellipsis">
      resample_while_conserving_flux
    </span>
  </a>
  
    <nav class="md-nav" aria-label="resample_while_conserving_flux">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.average_spectrum.resample_while_conserving_flux--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.average_spectrum.resample_while_conserving_flux--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.expected_uncertainty" class="md-nav__link">
    <span class="md-ellipsis">
      expected_uncertainty
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.expected_uncertainty.bintoR" class="md-nav__link">
    <span class="md-ellipsis">
      bintoR
    </span>
  </a>
  
    <nav class="md-nav" aria-label="bintoR">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.expected_uncertainty.bintoR--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.expected_uncertainty.bintoR--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.expected_uncertainty.bintogrid" class="md-nav__link">
    <span class="md-ellipsis">
      bintogrid
    </span>
  </a>
  
    <nav class="md-nav" aria-label="bintogrid">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.expected_uncertainty.bintogrid--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.expected_uncertainty.bintogrid--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.expected_uncertainty.calculate_bin_leftright" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_bin_leftright
    </span>
  </a>
  
    <nav class="md-nav" aria-label="calculate_bin_leftright">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.expected_uncertainty.calculate_bin_leftright--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.expected_uncertainty.calculate_bin_leftright--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.expected_uncertainty.edges_to_leftright" class="md-nav__link">
    <span class="md-ellipsis">
      edges_to_leftright
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.expected_uncertainty.expand_filenames" class="md-nav__link">
    <span class="md-ellipsis">
      expand_filenames
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.expected_uncertainty.get_expected_uncertainty" class="md-nav__link">
    <span class="md-ellipsis">
      get_expected_uncertainty
    </span>
  </a>
  
    <nav class="md-nav" aria-label="get_expected_uncertainty">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.expected_uncertainty.get_expected_uncertainty--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.expected_uncertainty.get_expected_uncertainty--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.expected_uncertainty.leftright_to_edges" class="md-nav__link">
    <span class="md-ellipsis">
      leftright_to_edges
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.expected_uncertainty.name2color" class="md-nav__link">
    <span class="md-ellipsis">
      name2color
    </span>
  </a>
  
    <nav class="md-nav" aria-label="name2color">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.expected_uncertainty.name2color--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.expected_uncertainty.name2color--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.expected_uncertainty.one2another" class="md-nav__link">
    <span class="md-ellipsis">
      one2another
    </span>
  </a>
  
    <nav class="md-nav" aria-label="one2another">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.expected_uncertainty.one2another--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.expected_uncertainty.one2another--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.expected_uncertainty.remove_unit" class="md-nav__link">
    <span class="md-ellipsis">
      remove_unit
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.expected_uncertainty.resample_while_conserving_flux" class="md-nav__link">
    <span class="md-ellipsis">
      resample_while_conserving_flux
    </span>
  </a>
  
    <nav class="md-nav" aria-label="resample_while_conserving_flux">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.expected_uncertainty.resample_while_conserving_flux--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.expected_uncertainty.resample_while_conserving_flux--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.measured_scatter_in_bins" class="md-nav__link">
    <span class="md-ellipsis">
      measured_scatter_in_bins
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.measured_scatter_in_bins.bintoR" class="md-nav__link">
    <span class="md-ellipsis">
      bintoR
    </span>
  </a>
  
    <nav class="md-nav" aria-label="bintoR">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.measured_scatter_in_bins.bintoR--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.measured_scatter_in_bins.bintoR--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.measured_scatter_in_bins.bintogrid" class="md-nav__link">
    <span class="md-ellipsis">
      bintogrid
    </span>
  </a>
  
    <nav class="md-nav" aria-label="bintogrid">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.measured_scatter_in_bins.bintogrid--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.measured_scatter_in_bins.bintogrid--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.measured_scatter_in_bins.calculate_bin_leftright" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_bin_leftright
    </span>
  </a>
  
    <nav class="md-nav" aria-label="calculate_bin_leftright">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.measured_scatter_in_bins.calculate_bin_leftright--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.measured_scatter_in_bins.calculate_bin_leftright--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.measured_scatter_in_bins.edges_to_leftright" class="md-nav__link">
    <span class="md-ellipsis">
      edges_to_leftright
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.measured_scatter_in_bins.expand_filenames" class="md-nav__link">
    <span class="md-ellipsis">
      expand_filenames
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.measured_scatter_in_bins.get_measured_scatter_in_bins" class="md-nav__link">
    <span class="md-ellipsis">
      get_measured_scatter_in_bins
    </span>
  </a>
  
    <nav class="md-nav" aria-label="get_measured_scatter_in_bins">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.measured_scatter_in_bins.get_measured_scatter_in_bins--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.measured_scatter_in_bins.get_measured_scatter_in_bins--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.measured_scatter_in_bins.leftright_to_edges" class="md-nav__link">
    <span class="md-ellipsis">
      leftright_to_edges
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.measured_scatter_in_bins.name2color" class="md-nav__link">
    <span class="md-ellipsis">
      name2color
    </span>
  </a>
  
    <nav class="md-nav" aria-label="name2color">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.measured_scatter_in_bins.name2color--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.measured_scatter_in_bins.name2color--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.measured_scatter_in_bins.one2another" class="md-nav__link">
    <span class="md-ellipsis">
      one2another
    </span>
  </a>
  
    <nav class="md-nav" aria-label="one2another">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.measured_scatter_in_bins.one2another--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.measured_scatter_in_bins.one2another--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.measured_scatter_in_bins.remove_unit" class="md-nav__link">
    <span class="md-ellipsis">
      remove_unit
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.measured_scatter_in_bins.resample_while_conserving_flux" class="md-nav__link">
    <span class="md-ellipsis">
      resample_while_conserving_flux
    </span>
  </a>
  
    <nav class="md-nav" aria-label="resample_while_conserving_flux">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.measured_scatter_in_bins.resample_while_conserving_flux--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.measured_scatter_in_bins.resample_while_conserving_flux--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.measured_scatter" class="md-nav__link">
    <span class="md-ellipsis">
      measured_scatter
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.measured_scatter.bintoR" class="md-nav__link">
    <span class="md-ellipsis">
      bintoR
    </span>
  </a>
  
    <nav class="md-nav" aria-label="bintoR">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.measured_scatter.bintoR--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.measured_scatter.bintoR--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.measured_scatter.bintogrid" class="md-nav__link">
    <span class="md-ellipsis">
      bintogrid
    </span>
  </a>
  
    <nav class="md-nav" aria-label="bintogrid">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.measured_scatter.bintogrid--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.measured_scatter.bintogrid--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.measured_scatter.calculate_bin_leftright" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_bin_leftright
    </span>
  </a>
  
    <nav class="md-nav" aria-label="calculate_bin_leftright">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.measured_scatter.calculate_bin_leftright--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.measured_scatter.calculate_bin_leftright--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.measured_scatter.edges_to_leftright" class="md-nav__link">
    <span class="md-ellipsis">
      edges_to_leftright
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.measured_scatter.expand_filenames" class="md-nav__link">
    <span class="md-ellipsis">
      expand_filenames
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.measured_scatter.get_measured_scatter" class="md-nav__link">
    <span class="md-ellipsis">
      get_measured_scatter
    </span>
  </a>
  
    <nav class="md-nav" aria-label="get_measured_scatter">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.measured_scatter.get_measured_scatter--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.measured_scatter.get_measured_scatter--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.measured_scatter.leftright_to_edges" class="md-nav__link">
    <span class="md-ellipsis">
      leftright_to_edges
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.measured_scatter.name2color" class="md-nav__link">
    <span class="md-ellipsis">
      name2color
    </span>
  </a>
  
    <nav class="md-nav" aria-label="name2color">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.measured_scatter.name2color--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.measured_scatter.name2color--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.measured_scatter.one2another" class="md-nav__link">
    <span class="md-ellipsis">
      one2another
    </span>
  </a>
  
    <nav class="md-nav" aria-label="one2another">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.measured_scatter.one2another--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.measured_scatter.one2another--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.measured_scatter.remove_unit" class="md-nav__link">
    <span class="md-ellipsis">
      remove_unit
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.measured_scatter.resample_while_conserving_flux" class="md-nav__link">
    <span class="md-ellipsis">
      resample_while_conserving_flux
    </span>
  </a>
  
    <nav class="md-nav" aria-label="resample_while_conserving_flux">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.measured_scatter.resample_while_conserving_flux--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.measured_scatter.resample_while_conserving_flux--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.median_spectrum" class="md-nav__link">
    <span class="md-ellipsis">
      median_spectrum
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.median_spectrum.bintoR" class="md-nav__link">
    <span class="md-ellipsis">
      bintoR
    </span>
  </a>
  
    <nav class="md-nav" aria-label="bintoR">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.median_spectrum.bintoR--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.median_spectrum.bintoR--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.median_spectrum.bintogrid" class="md-nav__link">
    <span class="md-ellipsis">
      bintogrid
    </span>
  </a>
  
    <nav class="md-nav" aria-label="bintogrid">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.median_spectrum.bintogrid--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.median_spectrum.bintogrid--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.median_spectrum.calculate_bin_leftright" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_bin_leftright
    </span>
  </a>
  
    <nav class="md-nav" aria-label="calculate_bin_leftright">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.median_spectrum.calculate_bin_leftright--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.median_spectrum.calculate_bin_leftright--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.median_spectrum.edges_to_leftright" class="md-nav__link">
    <span class="md-ellipsis">
      edges_to_leftright
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.median_spectrum.expand_filenames" class="md-nav__link">
    <span class="md-ellipsis">
      expand_filenames
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.median_spectrum.get_median_spectrum" class="md-nav__link">
    <span class="md-ellipsis">
      get_median_spectrum
    </span>
  </a>
  
    <nav class="md-nav" aria-label="get_median_spectrum">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.median_spectrum.get_median_spectrum--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.median_spectrum.leftright_to_edges" class="md-nav__link">
    <span class="md-ellipsis">
      leftright_to_edges
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.median_spectrum.name2color" class="md-nav__link">
    <span class="md-ellipsis">
      name2color
    </span>
  </a>
  
    <nav class="md-nav" aria-label="name2color">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.median_spectrum.name2color--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.median_spectrum.name2color--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.median_spectrum.one2another" class="md-nav__link">
    <span class="md-ellipsis">
      one2another
    </span>
  </a>
  
    <nav class="md-nav" aria-label="one2another">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.median_spectrum.one2another--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.median_spectrum.one2another--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.median_spectrum.remove_unit" class="md-nav__link">
    <span class="md-ellipsis">
      remove_unit
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.median_spectrum.resample_while_conserving_flux" class="md-nav__link">
    <span class="md-ellipsis">
      resample_while_conserving_flux
    </span>
  </a>
  
    <nav class="md-nav" aria-label="resample_while_conserving_flux">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.median_spectrum.resample_while_conserving_flux--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.median_spectrum.resample_while_conserving_flux--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.spectral_resolution" class="md-nav__link">
    <span class="md-ellipsis">
      spectral_resolution
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.spectral_resolution.bintoR" class="md-nav__link">
    <span class="md-ellipsis">
      bintoR
    </span>
  </a>
  
    <nav class="md-nav" aria-label="bintoR">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.spectral_resolution.bintoR--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.spectral_resolution.bintoR--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.spectral_resolution.bintogrid" class="md-nav__link">
    <span class="md-ellipsis">
      bintogrid
    </span>
  </a>
  
    <nav class="md-nav" aria-label="bintogrid">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.spectral_resolution.bintogrid--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.spectral_resolution.bintogrid--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.spectral_resolution.calculate_bin_leftright" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_bin_leftright
    </span>
  </a>
  
    <nav class="md-nav" aria-label="calculate_bin_leftright">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.spectral_resolution.calculate_bin_leftright--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.spectral_resolution.calculate_bin_leftright--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.spectral_resolution.edges_to_leftright" class="md-nav__link">
    <span class="md-ellipsis">
      edges_to_leftright
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.spectral_resolution.expand_filenames" class="md-nav__link">
    <span class="md-ellipsis">
      expand_filenames
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.spectral_resolution.get_spectral_resolution" class="md-nav__link">
    <span class="md-ellipsis">
      get_spectral_resolution
    </span>
  </a>
  
    <nav class="md-nav" aria-label="get_spectral_resolution">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.spectral_resolution.get_spectral_resolution--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.spectral_resolution.get_spectral_resolution--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.spectral_resolution.leftright_to_edges" class="md-nav__link">
    <span class="md-ellipsis">
      leftright_to_edges
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.spectral_resolution.name2color" class="md-nav__link">
    <span class="md-ellipsis">
      name2color
    </span>
  </a>
  
    <nav class="md-nav" aria-label="name2color">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.spectral_resolution.name2color--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.spectral_resolution.name2color--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.spectral_resolution.one2another" class="md-nav__link">
    <span class="md-ellipsis">
      one2another
    </span>
  </a>
  
    <nav class="md-nav" aria-label="one2another">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.spectral_resolution.one2another--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.spectral_resolution.one2another--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.spectral_resolution.remove_unit" class="md-nav__link">
    <span class="md-ellipsis">
      remove_unit
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.spectral_resolution.resample_while_conserving_flux" class="md-nav__link">
    <span class="md-ellipsis">
      resample_while_conserving_flux
    </span>
  </a>
  
    <nav class="md-nav" aria-label="resample_while_conserving_flux">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.spectral_resolution.resample_while_conserving_flux--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.spectral_resolution.resample_while_conserving_flux--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.subset" class="md-nav__link">
    <span class="md-ellipsis">
      subset
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.subset.bintoR" class="md-nav__link">
    <span class="md-ellipsis">
      bintoR
    </span>
  </a>
  
    <nav class="md-nav" aria-label="bintoR">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.subset.bintoR--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.subset.bintoR--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.subset.bintogrid" class="md-nav__link">
    <span class="md-ellipsis">
      bintogrid
    </span>
  </a>
  
    <nav class="md-nav" aria-label="bintogrid">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.subset.bintogrid--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.subset.bintogrid--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.subset.calculate_bin_leftright" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_bin_leftright
    </span>
  </a>
  
    <nav class="md-nav" aria-label="calculate_bin_leftright">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.subset.calculate_bin_leftright--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.subset.calculate_bin_leftright--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.subset.edges_to_leftright" class="md-nav__link">
    <span class="md-ellipsis">
      edges_to_leftright
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.subset.expand_filenames" class="md-nav__link">
    <span class="md-ellipsis">
      expand_filenames
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.subset.get_for_wavelength" class="md-nav__link">
    <span class="md-ellipsis">
      get_for_wavelength
    </span>
  </a>
  
    <nav class="md-nav" aria-label="get_for_wavelength">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.subset.get_for_wavelength--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.subset.get_for_wavelength--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.subset.get_ok_data_for_wavelength" class="md-nav__link">
    <span class="md-ellipsis">
      get_ok_data_for_wavelength
    </span>
  </a>
  
    <nav class="md-nav" aria-label="get_ok_data_for_wavelength">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.subset.get_ok_data_for_wavelength--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.subset.get_ok_data_for_wavelength--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.subset.leftright_to_edges" class="md-nav__link">
    <span class="md-ellipsis">
      leftright_to_edges
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.subset.name2color" class="md-nav__link">
    <span class="md-ellipsis">
      name2color
    </span>
  </a>
  
    <nav class="md-nav" aria-label="name2color">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.subset.name2color--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.subset.name2color--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.subset.one2another" class="md-nav__link">
    <span class="md-ellipsis">
      one2another
    </span>
  </a>
  
    <nav class="md-nav" aria-label="one2another">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.subset.one2another--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.subset.one2another--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.subset.remove_unit" class="md-nav__link">
    <span class="md-ellipsis">
      remove_unit
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.subset.resample_while_conserving_flux" class="md-nav__link">
    <span class="md-ellipsis">
      resample_while_conserving_flux
    </span>
  </a>
  
    <nav class="md-nav" aria-label="resample_while_conserving_flux">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.subset.resample_while_conserving_flux--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.get.wavelike.subset.resample_while_conserving_flux--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#visualizations" class="md-nav__link">
    <span class="md-ellipsis">
      🌈 Visualizations
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.animate" class="md-nav__link">
    <span class="md-ellipsis">
      animate
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.animate.animate_lightcurves" class="md-nav__link">
    <span class="md-ellipsis">
      animate_lightcurves
    </span>
  </a>
  
    <nav class="md-nav" aria-label="animate_lightcurves">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.animate.animate_lightcurves--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.animate.animate_spectra" class="md-nav__link">
    <span class="md-ellipsis">
      animate_spectra
    </span>
  </a>
  
    <nav class="md-nav" aria-label="animate_spectra">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.animate.animate_spectra--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.animate.bintoR" class="md-nav__link">
    <span class="md-ellipsis">
      bintoR
    </span>
  </a>
  
    <nav class="md-nav" aria-label="bintoR">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.animate.bintoR--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.animate.bintoR--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.animate.bintogrid" class="md-nav__link">
    <span class="md-ellipsis">
      bintogrid
    </span>
  </a>
  
    <nav class="md-nav" aria-label="bintogrid">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.animate.bintogrid--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.animate.bintogrid--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.animate.calculate_bin_leftright" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_bin_leftright
    </span>
  </a>
  
    <nav class="md-nav" aria-label="calculate_bin_leftright">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.animate.calculate_bin_leftright--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.animate.calculate_bin_leftright--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.animate.edges_to_leftright" class="md-nav__link">
    <span class="md-ellipsis">
      edges_to_leftright
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.animate.expand_filenames" class="md-nav__link">
    <span class="md-ellipsis">
      expand_filenames
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.animate.get_animation_writer_and_displayer" class="md-nav__link">
    <span class="md-ellipsis">
      get_animation_writer_and_displayer
    </span>
  </a>
  
    <nav class="md-nav" aria-label="get_animation_writer_and_displayer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.animate.get_animation_writer_and_displayer--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.animate.get_animation_writer_and_displayer--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.animate.leftright_to_edges" class="md-nav__link">
    <span class="md-ellipsis">
      leftright_to_edges
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.animate.name2color" class="md-nav__link">
    <span class="md-ellipsis">
      name2color
    </span>
  </a>
  
    <nav class="md-nav" aria-label="name2color">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.animate.name2color--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.animate.name2color--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.animate.one2another" class="md-nav__link">
    <span class="md-ellipsis">
      one2another
    </span>
  </a>
  
    <nav class="md-nav" aria-label="one2another">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.animate.one2another--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.animate.one2another--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.animate.remove_unit" class="md-nav__link">
    <span class="md-ellipsis">
      remove_unit
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.animate.resample_while_conserving_flux" class="md-nav__link">
    <span class="md-ellipsis">
      resample_while_conserving_flux
    </span>
  </a>
  
    <nav class="md-nav" aria-label="resample_while_conserving_flux">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.animate.resample_while_conserving_flux--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.animate.resample_while_conserving_flux--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.colors" class="md-nav__link">
    <span class="md-ellipsis">
      colors
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.colors.bintoR" class="md-nav__link">
    <span class="md-ellipsis">
      bintoR
    </span>
  </a>
  
    <nav class="md-nav" aria-label="bintoR">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.colors.bintoR--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.colors.bintoR--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.colors.bintogrid" class="md-nav__link">
    <span class="md-ellipsis">
      bintogrid
    </span>
  </a>
  
    <nav class="md-nav" aria-label="bintogrid">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.colors.bintogrid--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.colors.bintogrid--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.colors.calculate_bin_leftright" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_bin_leftright
    </span>
  </a>
  
    <nav class="md-nav" aria-label="calculate_bin_leftright">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.colors.calculate_bin_leftright--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.colors.calculate_bin_leftright--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.colors.edges_to_leftright" class="md-nav__link">
    <span class="md-ellipsis">
      edges_to_leftright
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.colors.expand_filenames" class="md-nav__link">
    <span class="md-ellipsis">
      expand_filenames
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.colors.get_wavelength_color" class="md-nav__link">
    <span class="md-ellipsis">
      get_wavelength_color
    </span>
  </a>
  
    <nav class="md-nav" aria-label="get_wavelength_color">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.colors.get_wavelength_color--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.colors.get_wavelength_color--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.colors.leftright_to_edges" class="md-nav__link">
    <span class="md-ellipsis">
      leftright_to_edges
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.colors.name2color" class="md-nav__link">
    <span class="md-ellipsis">
      name2color
    </span>
  </a>
  
    <nav class="md-nav" aria-label="name2color">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.colors.name2color--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.colors.name2color--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.colors.one2another" class="md-nav__link">
    <span class="md-ellipsis">
      one2another
    </span>
  </a>
  
    <nav class="md-nav" aria-label="one2another">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.colors.one2another--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.colors.one2another--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.colors.remove_unit" class="md-nav__link">
    <span class="md-ellipsis">
      remove_unit
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.colors.resample_while_conserving_flux" class="md-nav__link">
    <span class="md-ellipsis">
      resample_while_conserving_flux
    </span>
  </a>
  
    <nav class="md-nav" aria-label="resample_while_conserving_flux">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.colors.resample_while_conserving_flux--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.colors.resample_while_conserving_flux--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.colors.setup_wavelength_colors" class="md-nav__link">
    <span class="md-ellipsis">
      setup_wavelength_colors
    </span>
  </a>
  
    <nav class="md-nav" aria-label="setup_wavelength_colors">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.colors.setup_wavelength_colors--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.imshow" class="md-nav__link">
    <span class="md-ellipsis">
      imshow
    </span>
  </a>
  
    <nav class="md-nav" aria-label="imshow">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.imshow--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.interactive" class="md-nav__link">
    <span class="md-ellipsis">
      interactive
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.interactive.bintoR" class="md-nav__link">
    <span class="md-ellipsis">
      bintoR
    </span>
  </a>
  
    <nav class="md-nav" aria-label="bintoR">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.interactive.bintoR--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.interactive.bintoR--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.interactive.bintogrid" class="md-nav__link">
    <span class="md-ellipsis">
      bintogrid
    </span>
  </a>
  
    <nav class="md-nav" aria-label="bintogrid">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.interactive.bintogrid--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.interactive.bintogrid--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.interactive.calculate_bin_leftright" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_bin_leftright
    </span>
  </a>
  
    <nav class="md-nav" aria-label="calculate_bin_leftright">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.interactive.calculate_bin_leftright--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.interactive.calculate_bin_leftright--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.interactive.edges_to_leftright" class="md-nav__link">
    <span class="md-ellipsis">
      edges_to_leftright
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.interactive.expand_filenames" class="md-nav__link">
    <span class="md-ellipsis">
      expand_filenames
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.interactive.imshow_interact" class="md-nav__link">
    <span class="md-ellipsis">
      imshow_interact
    </span>
  </a>
  
    <nav class="md-nav" aria-label="imshow_interact">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.interactive.imshow_interact--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.interactive.leftright_to_edges" class="md-nav__link">
    <span class="md-ellipsis">
      leftright_to_edges
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.interactive.name2color" class="md-nav__link">
    <span class="md-ellipsis">
      name2color
    </span>
  </a>
  
    <nav class="md-nav" aria-label="name2color">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.interactive.name2color--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.interactive.name2color--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.interactive.one2another" class="md-nav__link">
    <span class="md-ellipsis">
      one2another
    </span>
  </a>
  
    <nav class="md-nav" aria-label="one2another">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.interactive.one2another--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.interactive.one2another--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.interactive.remove_unit" class="md-nav__link">
    <span class="md-ellipsis">
      remove_unit
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.interactive.resample_while_conserving_flux" class="md-nav__link">
    <span class="md-ellipsis">
      resample_while_conserving_flux
    </span>
  </a>
  
    <nav class="md-nav" aria-label="resample_while_conserving_flux">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.interactive.resample_while_conserving_flux--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.interactive.resample_while_conserving_flux--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.pcolormesh" class="md-nav__link">
    <span class="md-ellipsis">
      pcolormesh
    </span>
  </a>
  
    <nav class="md-nav" aria-label="pcolormesh">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.pcolormesh--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.plot_lightcurves" class="md-nav__link">
    <span class="md-ellipsis">
      plot_lightcurves
    </span>
  </a>
  
    <nav class="md-nav" aria-label="plot_lightcurves">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.plot_lightcurves--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.plot_spectra" class="md-nav__link">
    <span class="md-ellipsis">
      plot_spectra
    </span>
  </a>
  
    <nav class="md-nav" aria-label="plot_spectra">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.plot_spectra--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.plot" class="md-nav__link">
    <span class="md-ellipsis">
      plot
    </span>
  </a>
  
    <nav class="md-nav" aria-label="plot">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.rainbows.visualizations.plot--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tools" class="md-nav__link">
    <span class="md-ellipsis">
      🔨 Tools
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.spectra.planck.get_planck_photons" class="md-nav__link">
    <span class="md-ellipsis">
      get_planck_photons
    </span>
  </a>
  
    <nav class="md-nav" aria-label="get_planck_photons">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.spectra.planck.get_planck_photons--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.spectra.planck.get_planck_photons--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.spectra.phoenix.get_phoenix_photons" class="md-nav__link">
    <span class="md-ellipsis">
      get_phoenix_photons
    </span>
  </a>
  
    <nav class="md-nav" aria-label="get_phoenix_photons">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.spectra.phoenix.get_phoenix_photons--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.spectra.phoenix.get_phoenix_photons--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.tools.resampling" class="md-nav__link">
    <span class="md-ellipsis">
      resampling
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.tools.resampling.bintoR" class="md-nav__link">
    <span class="md-ellipsis">
      bintoR
    </span>
  </a>
  
    <nav class="md-nav" aria-label="bintoR">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.tools.resampling.bintoR--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.tools.resampling.bintoR--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.tools.resampling.bintogrid" class="md-nav__link">
    <span class="md-ellipsis">
      bintogrid
    </span>
  </a>
  
    <nav class="md-nav" aria-label="bintogrid">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.tools.resampling.bintogrid--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.tools.resampling.bintogrid--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.tools.resampling.calculate_bin_leftright" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_bin_leftright
    </span>
  </a>
  
    <nav class="md-nav" aria-label="calculate_bin_leftright">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.tools.resampling.calculate_bin_leftright--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.tools.resampling.calculate_bin_leftright--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.tools.resampling.calculate_bin_widths" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_bin_widths
    </span>
  </a>
  
    <nav class="md-nav" aria-label="calculate_bin_widths">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.tools.resampling.calculate_bin_widths--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.tools.resampling.calculate_bin_widths--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.tools.resampling.edges_to_leftright" class="md-nav__link">
    <span class="md-ellipsis">
      edges_to_leftright
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.tools.resampling.leftright_to_edges" class="md-nav__link">
    <span class="md-ellipsis">
      leftright_to_edges
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.tools.resampling.plot_as_boxes" class="md-nav__link">
    <span class="md-ellipsis">
      plot_as_boxes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="plot_as_boxes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.tools.resampling.plot_as_boxes--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.tools.resampling.resample_while_conserving_flux" class="md-nav__link">
    <span class="md-ellipsis">
      resample_while_conserving_flux
    </span>
  </a>
  
    <nav class="md-nav" aria-label="resample_while_conserving_flux">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.tools.resampling.resample_while_conserving_flux--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.tools.resampling.resample_while_conserving_flux--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.imports" class="md-nav__link">
    <span class="md-ellipsis">
      imports
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.imports.bintoR" class="md-nav__link">
    <span class="md-ellipsis">
      bintoR
    </span>
  </a>
  
    <nav class="md-nav" aria-label="bintoR">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.imports.bintoR--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.imports.bintoR--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.imports.bintogrid" class="md-nav__link">
    <span class="md-ellipsis">
      bintogrid
    </span>
  </a>
  
    <nav class="md-nav" aria-label="bintogrid">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.imports.bintogrid--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.imports.bintogrid--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.imports.calculate_bin_leftright" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_bin_leftright
    </span>
  </a>
  
    <nav class="md-nav" aria-label="calculate_bin_leftright">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.imports.calculate_bin_leftright--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.imports.calculate_bin_leftright--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.imports.edges_to_leftright" class="md-nav__link">
    <span class="md-ellipsis">
      edges_to_leftright
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.imports.expand_filenames" class="md-nav__link">
    <span class="md-ellipsis">
      expand_filenames
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.imports.leftright_to_edges" class="md-nav__link">
    <span class="md-ellipsis">
      leftright_to_edges
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.imports.name2color" class="md-nav__link">
    <span class="md-ellipsis">
      name2color
    </span>
  </a>
  
    <nav class="md-nav" aria-label="name2color">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.imports.name2color--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.imports.name2color--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.imports.one2another" class="md-nav__link">
    <span class="md-ellipsis">
      one2another
    </span>
  </a>
  
    <nav class="md-nav" aria-label="one2another">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.imports.one2another--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.imports.one2another--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.imports.remove_unit" class="md-nav__link">
    <span class="md-ellipsis">
      remove_unit
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chromatic.imports.resample_while_conserving_flux" class="md-nav__link">
    <span class="md-ellipsis">
      resample_while_conserving_flux
    </span>
  </a>
  
    <nav class="md-nav" aria-label="resample_while_conserving_flux">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chromatic.imports.resample_while_conserving_flux--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chromatic.imports.resample_while_conserving_flux--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="reference">Reference<a class="headerlink" href="#reference" title="Permanent link">#</a></h1>


<div class="doc doc-object doc-function">



<a id="chromatic.rainbows.read_rainbow"></a>
    <div class="doc doc-contents first">

        <p>A friendly wrapper to load time-series spectra and/or
multiwavelength light curves into a <code>chromatic</code> Rainbow
object. It will try its best to pick the best reader
and return the most useful kind of object.
🦋🌅2️⃣🪜🎬👀🇮🇹📕🧑‍🏫🌈</p>
<h3 id="chromatic.rainbows.read_rainbow--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.read_rainbow--parameters" title="Permanent link">#</a></h3>
<p>filepath : str, list
    The file or files to open.
**kw : dict
    All other keyword arguments will be passed to
    the <code>Rainbow</code> initialization.</p>
<h3 id="chromatic.rainbows.read_rainbow--returns">Returns<a class="headerlink" href="#chromatic.rainbows.read_rainbow--returns" title="Permanent link">#</a></h3>
<p>rainbow : Rainbow, RainbowWithModel
    The loaded data!</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/rainbows/__init__.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">read_rainbow</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A friendly wrapper to load time-series spectra and/or</span>
<span class="sd">    multiwavelength light curves into a `chromatic` Rainbow</span>
<span class="sd">    object. It will try its best to pick the best reader</span>
<span class="sd">    and return the most useful kind of object.</span>
<span class="sd">    🦋🌅2️⃣🪜🎬👀🇮🇹📕🧑‍🏫🌈</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    filepath : str, list</span>
<span class="sd">        The file or files to open.</span>
<span class="sd">    **kw : dict</span>
<span class="sd">        All other keyword arguments will be passed to</span>
<span class="sd">        the `Rainbow` initialization.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    rainbow : Rainbow, RainbowWithModel</span>
<span class="sd">        The loaded data!</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">Rainbow</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
    <span class="k">if</span> <span class="s2">&quot;model&quot;</span> <span class="ow">in</span> <span class="n">r</span><span class="o">.</span><span class="n">fluxlike</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">RainbowWithModel</span><span class="p">(</span><span class="o">**</span><span class="n">r</span><span class="o">.</span><span class="n">_get_core_dictionaries</span><span class="p">())</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">r</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-class">



<a id="chromatic.rainbows.rainbow.Rainbow"></a>
    <div class="doc doc-contents first">


        <p><code>Rainbow</code> (🌈) objects represent brightness as a function
of both wavelength and time.</p>
<p>These objects are useful for reading or writing multiwavelength
time-series datasets in a variety of formats, visualizing these
data with simple commands, and performing basic calculations.
<code>RainbowWithModel</code> and <code>SimulatedRainbow</code> objects inherit from
<code>Rainbow</code>, so all basically all methods and attributes described
below are available for them too.</p>
<h3 id="chromatic.rainbows.rainbow.Rainbow--attributes">Attributes<a class="headerlink" href="#chromatic.rainbows.rainbow.Rainbow--attributes" title="Permanent link">#</a></h3>
<p>wavelike : dict
    A dictionary for quantities with shape <code>(nwave,),
    for which there's one value for each wavelength.
timelike : dict
    A dictionary for quantities with shape</code>(ntime,),
    for which there's one value for each time.
fluxlike : dict
    A dictionary for quantities with shape <code>(nwave,ntime),
    for which there's one value for each wavelength and time.
metadata : dict
    A dictionary containing all other useful information
    that should stay connected to the</code>Rainbow<code>, in any format.
wavelength : Quantity
    The 1D array of wavelengths for this</code>Rainbow<code>.
    (This is a property, not an actual attribute.)
time : Quantity
    The 1D array of times for this</code>Rainbow<code>.
    (This is a property, not an actual attribute.)
flux : array, Quantity
    The 2D array of fluxes for this</code>Rainbow<code>.
    (This is a property, not an actual attribute.)
uncertainty : array, Quantity
    The 2D array of flux uncertainties for this</code>Rainbow<code>.
    (This is a property, not an actual attribute.)
ok : array
    The 2D array of "ok-ness" for this</code>Rainbow<code>.
    (This is a property, not an actual attribute.)
shape : tuple
    The shape of this</code>Rainbow<code>'s flux array.
    (This is a property, not an actual attribute.)
nwave : int
    The number of wavelengths in this</code>Rainbow<code>'.
    (This is a property, not an actual attribute.)
ntime : int
    The number of times in this</code>Rainbow<code>'.
    (This is a property, not an actual attribute.)
nflux : int
    The total number of fluxes in this</code>Rainbow<code>' (=</code>nwave*ntime<code>).
    (This is a property, not an actual attribute.)
dt : Quantity
    The typical time offset between adjacent times in this</code>Rainbow<code>.
    (This is a property, not an actual attribute.)
name : array, Quantity
    The name of this</code>Rainbow`, if one has been set.
    (This is a property, not an actual attribute.)</p>







              <details class="quote">
                <summary>Source code in <code>chromatic/rainbows/rainbow.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">   6</span>
<span class="normal">   7</span>
<span class="normal">   8</span>
<span class="normal">   9</span>
<span class="normal">  10</span>
<span class="normal">  11</span>
<span class="normal">  12</span>
<span class="normal">  13</span>
<span class="normal">  14</span>
<span class="normal">  15</span>
<span class="normal">  16</span>
<span class="normal">  17</span>
<span class="normal">  18</span>
<span class="normal">  19</span>
<span class="normal">  20</span>
<span class="normal">  21</span>
<span class="normal">  22</span>
<span class="normal">  23</span>
<span class="normal">  24</span>
<span class="normal">  25</span>
<span class="normal">  26</span>
<span class="normal">  27</span>
<span class="normal">  28</span>
<span class="normal">  29</span>
<span class="normal">  30</span>
<span class="normal">  31</span>
<span class="normal">  32</span>
<span class="normal">  33</span>
<span class="normal">  34</span>
<span class="normal">  35</span>
<span class="normal">  36</span>
<span class="normal">  37</span>
<span class="normal">  38</span>
<span class="normal">  39</span>
<span class="normal">  40</span>
<span class="normal">  41</span>
<span class="normal">  42</span>
<span class="normal">  43</span>
<span class="normal">  44</span>
<span class="normal">  45</span>
<span class="normal">  46</span>
<span class="normal">  47</span>
<span class="normal">  48</span>
<span class="normal">  49</span>
<span class="normal">  50</span>
<span class="normal">  51</span>
<span class="normal">  52</span>
<span class="normal">  53</span>
<span class="normal">  54</span>
<span class="normal">  55</span>
<span class="normal">  56</span>
<span class="normal">  57</span>
<span class="normal">  58</span>
<span class="normal">  59</span>
<span class="normal">  60</span>
<span class="normal">  61</span>
<span class="normal">  62</span>
<span class="normal">  63</span>
<span class="normal">  64</span>
<span class="normal">  65</span>
<span class="normal">  66</span>
<span class="normal">  67</span>
<span class="normal">  68</span>
<span class="normal">  69</span>
<span class="normal">  70</span>
<span class="normal">  71</span>
<span class="normal">  72</span>
<span class="normal">  73</span>
<span class="normal">  74</span>
<span class="normal">  75</span>
<span class="normal">  76</span>
<span class="normal">  77</span>
<span class="normal">  78</span>
<span class="normal">  79</span>
<span class="normal">  80</span>
<span class="normal">  81</span>
<span class="normal">  82</span>
<span class="normal">  83</span>
<span class="normal">  84</span>
<span class="normal">  85</span>
<span class="normal">  86</span>
<span class="normal">  87</span>
<span class="normal">  88</span>
<span class="normal">  89</span>
<span class="normal">  90</span>
<span class="normal">  91</span>
<span class="normal">  92</span>
<span class="normal">  93</span>
<span class="normal">  94</span>
<span class="normal">  95</span>
<span class="normal">  96</span>
<span class="normal">  97</span>
<span class="normal">  98</span>
<span class="normal">  99</span>
<span class="normal"> 100</span>
<span class="normal"> 101</span>
<span class="normal"> 102</span>
<span class="normal"> 103</span>
<span class="normal"> 104</span>
<span class="normal"> 105</span>
<span class="normal"> 106</span>
<span class="normal"> 107</span>
<span class="normal"> 108</span>
<span class="normal"> 109</span>
<span class="normal"> 110</span>
<span class="normal"> 111</span>
<span class="normal"> 112</span>
<span class="normal"> 113</span>
<span class="normal"> 114</span>
<span class="normal"> 115</span>
<span class="normal"> 116</span>
<span class="normal"> 117</span>
<span class="normal"> 118</span>
<span class="normal"> 119</span>
<span class="normal"> 120</span>
<span class="normal"> 121</span>
<span class="normal"> 122</span>
<span class="normal"> 123</span>
<span class="normal"> 124</span>
<span class="normal"> 125</span>
<span class="normal"> 126</span>
<span class="normal"> 127</span>
<span class="normal"> 128</span>
<span class="normal"> 129</span>
<span class="normal"> 130</span>
<span class="normal"> 131</span>
<span class="normal"> 132</span>
<span class="normal"> 133</span>
<span class="normal"> 134</span>
<span class="normal"> 135</span>
<span class="normal"> 136</span>
<span class="normal"> 137</span>
<span class="normal"> 138</span>
<span class="normal"> 139</span>
<span class="normal"> 140</span>
<span class="normal"> 141</span>
<span class="normal"> 142</span>
<span class="normal"> 143</span>
<span class="normal"> 144</span>
<span class="normal"> 145</span>
<span class="normal"> 146</span>
<span class="normal"> 147</span>
<span class="normal"> 148</span>
<span class="normal"> 149</span>
<span class="normal"> 150</span>
<span class="normal"> 151</span>
<span class="normal"> 152</span>
<span class="normal"> 153</span>
<span class="normal"> 154</span>
<span class="normal"> 155</span>
<span class="normal"> 156</span>
<span class="normal"> 157</span>
<span class="normal"> 158</span>
<span class="normal"> 159</span>
<span class="normal"> 160</span>
<span class="normal"> 161</span>
<span class="normal"> 162</span>
<span class="normal"> 163</span>
<span class="normal"> 164</span>
<span class="normal"> 165</span>
<span class="normal"> 166</span>
<span class="normal"> 167</span>
<span class="normal"> 168</span>
<span class="normal"> 169</span>
<span class="normal"> 170</span>
<span class="normal"> 171</span>
<span class="normal"> 172</span>
<span class="normal"> 173</span>
<span class="normal"> 174</span>
<span class="normal"> 175</span>
<span class="normal"> 176</span>
<span class="normal"> 177</span>
<span class="normal"> 178</span>
<span class="normal"> 179</span>
<span class="normal"> 180</span>
<span class="normal"> 181</span>
<span class="normal"> 182</span>
<span class="normal"> 183</span>
<span class="normal"> 184</span>
<span class="normal"> 185</span>
<span class="normal"> 186</span>
<span class="normal"> 187</span>
<span class="normal"> 188</span>
<span class="normal"> 189</span>
<span class="normal"> 190</span>
<span class="normal"> 191</span>
<span class="normal"> 192</span>
<span class="normal"> 193</span>
<span class="normal"> 194</span>
<span class="normal"> 195</span>
<span class="normal"> 196</span>
<span class="normal"> 197</span>
<span class="normal"> 198</span>
<span class="normal"> 199</span>
<span class="normal"> 200</span>
<span class="normal"> 201</span>
<span class="normal"> 202</span>
<span class="normal"> 203</span>
<span class="normal"> 204</span>
<span class="normal"> 205</span>
<span class="normal"> 206</span>
<span class="normal"> 207</span>
<span class="normal"> 208</span>
<span class="normal"> 209</span>
<span class="normal"> 210</span>
<span class="normal"> 211</span>
<span class="normal"> 212</span>
<span class="normal"> 213</span>
<span class="normal"> 214</span>
<span class="normal"> 215</span>
<span class="normal"> 216</span>
<span class="normal"> 217</span>
<span class="normal"> 218</span>
<span class="normal"> 219</span>
<span class="normal"> 220</span>
<span class="normal"> 221</span>
<span class="normal"> 222</span>
<span class="normal"> 223</span>
<span class="normal"> 224</span>
<span class="normal"> 225</span>
<span class="normal"> 226</span>
<span class="normal"> 227</span>
<span class="normal"> 228</span>
<span class="normal"> 229</span>
<span class="normal"> 230</span>
<span class="normal"> 231</span>
<span class="normal"> 232</span>
<span class="normal"> 233</span>
<span class="normal"> 234</span>
<span class="normal"> 235</span>
<span class="normal"> 236</span>
<span class="normal"> 237</span>
<span class="normal"> 238</span>
<span class="normal"> 239</span>
<span class="normal"> 240</span>
<span class="normal"> 241</span>
<span class="normal"> 242</span>
<span class="normal"> 243</span>
<span class="normal"> 244</span>
<span class="normal"> 245</span>
<span class="normal"> 246</span>
<span class="normal"> 247</span>
<span class="normal"> 248</span>
<span class="normal"> 249</span>
<span class="normal"> 250</span>
<span class="normal"> 251</span>
<span class="normal"> 252</span>
<span class="normal"> 253</span>
<span class="normal"> 254</span>
<span class="normal"> 255</span>
<span class="normal"> 256</span>
<span class="normal"> 257</span>
<span class="normal"> 258</span>
<span class="normal"> 259</span>
<span class="normal"> 260</span>
<span class="normal"> 261</span>
<span class="normal"> 262</span>
<span class="normal"> 263</span>
<span class="normal"> 264</span>
<span class="normal"> 265</span>
<span class="normal"> 266</span>
<span class="normal"> 267</span>
<span class="normal"> 268</span>
<span class="normal"> 269</span>
<span class="normal"> 270</span>
<span class="normal"> 271</span>
<span class="normal"> 272</span>
<span class="normal"> 273</span>
<span class="normal"> 274</span>
<span class="normal"> 275</span>
<span class="normal"> 276</span>
<span class="normal"> 277</span>
<span class="normal"> 278</span>
<span class="normal"> 279</span>
<span class="normal"> 280</span>
<span class="normal"> 281</span>
<span class="normal"> 282</span>
<span class="normal"> 283</span>
<span class="normal"> 284</span>
<span class="normal"> 285</span>
<span class="normal"> 286</span>
<span class="normal"> 287</span>
<span class="normal"> 288</span>
<span class="normal"> 289</span>
<span class="normal"> 290</span>
<span class="normal"> 291</span>
<span class="normal"> 292</span>
<span class="normal"> 293</span>
<span class="normal"> 294</span>
<span class="normal"> 295</span>
<span class="normal"> 296</span>
<span class="normal"> 297</span>
<span class="normal"> 298</span>
<span class="normal"> 299</span>
<span class="normal"> 300</span>
<span class="normal"> 301</span>
<span class="normal"> 302</span>
<span class="normal"> 303</span>
<span class="normal"> 304</span>
<span class="normal"> 305</span>
<span class="normal"> 306</span>
<span class="normal"> 307</span>
<span class="normal"> 308</span>
<span class="normal"> 309</span>
<span class="normal"> 310</span>
<span class="normal"> 311</span>
<span class="normal"> 312</span>
<span class="normal"> 313</span>
<span class="normal"> 314</span>
<span class="normal"> 315</span>
<span class="normal"> 316</span>
<span class="normal"> 317</span>
<span class="normal"> 318</span>
<span class="normal"> 319</span>
<span class="normal"> 320</span>
<span class="normal"> 321</span>
<span class="normal"> 322</span>
<span class="normal"> 323</span>
<span class="normal"> 324</span>
<span class="normal"> 325</span>
<span class="normal"> 326</span>
<span class="normal"> 327</span>
<span class="normal"> 328</span>
<span class="normal"> 329</span>
<span class="normal"> 330</span>
<span class="normal"> 331</span>
<span class="normal"> 332</span>
<span class="normal"> 333</span>
<span class="normal"> 334</span>
<span class="normal"> 335</span>
<span class="normal"> 336</span>
<span class="normal"> 337</span>
<span class="normal"> 338</span>
<span class="normal"> 339</span>
<span class="normal"> 340</span>
<span class="normal"> 341</span>
<span class="normal"> 342</span>
<span class="normal"> 343</span>
<span class="normal"> 344</span>
<span class="normal"> 345</span>
<span class="normal"> 346</span>
<span class="normal"> 347</span>
<span class="normal"> 348</span>
<span class="normal"> 349</span>
<span class="normal"> 350</span>
<span class="normal"> 351</span>
<span class="normal"> 352</span>
<span class="normal"> 353</span>
<span class="normal"> 354</span>
<span class="normal"> 355</span>
<span class="normal"> 356</span>
<span class="normal"> 357</span>
<span class="normal"> 358</span>
<span class="normal"> 359</span>
<span class="normal"> 360</span>
<span class="normal"> 361</span>
<span class="normal"> 362</span>
<span class="normal"> 363</span>
<span class="normal"> 364</span>
<span class="normal"> 365</span>
<span class="normal"> 366</span>
<span class="normal"> 367</span>
<span class="normal"> 368</span>
<span class="normal"> 369</span>
<span class="normal"> 370</span>
<span class="normal"> 371</span>
<span class="normal"> 372</span>
<span class="normal"> 373</span>
<span class="normal"> 374</span>
<span class="normal"> 375</span>
<span class="normal"> 376</span>
<span class="normal"> 377</span>
<span class="normal"> 378</span>
<span class="normal"> 379</span>
<span class="normal"> 380</span>
<span class="normal"> 381</span>
<span class="normal"> 382</span>
<span class="normal"> 383</span>
<span class="normal"> 384</span>
<span class="normal"> 385</span>
<span class="normal"> 386</span>
<span class="normal"> 387</span>
<span class="normal"> 388</span>
<span class="normal"> 389</span>
<span class="normal"> 390</span>
<span class="normal"> 391</span>
<span class="normal"> 392</span>
<span class="normal"> 393</span>
<span class="normal"> 394</span>
<span class="normal"> 395</span>
<span class="normal"> 396</span>
<span class="normal"> 397</span>
<span class="normal"> 398</span>
<span class="normal"> 399</span>
<span class="normal"> 400</span>
<span class="normal"> 401</span>
<span class="normal"> 402</span>
<span class="normal"> 403</span>
<span class="normal"> 404</span>
<span class="normal"> 405</span>
<span class="normal"> 406</span>
<span class="normal"> 407</span>
<span class="normal"> 408</span>
<span class="normal"> 409</span>
<span class="normal"> 410</span>
<span class="normal"> 411</span>
<span class="normal"> 412</span>
<span class="normal"> 413</span>
<span class="normal"> 414</span>
<span class="normal"> 415</span>
<span class="normal"> 416</span>
<span class="normal"> 417</span>
<span class="normal"> 418</span>
<span class="normal"> 419</span>
<span class="normal"> 420</span>
<span class="normal"> 421</span>
<span class="normal"> 422</span>
<span class="normal"> 423</span>
<span class="normal"> 424</span>
<span class="normal"> 425</span>
<span class="normal"> 426</span>
<span class="normal"> 427</span>
<span class="normal"> 428</span>
<span class="normal"> 429</span>
<span class="normal"> 430</span>
<span class="normal"> 431</span>
<span class="normal"> 432</span>
<span class="normal"> 433</span>
<span class="normal"> 434</span>
<span class="normal"> 435</span>
<span class="normal"> 436</span>
<span class="normal"> 437</span>
<span class="normal"> 438</span>
<span class="normal"> 439</span>
<span class="normal"> 440</span>
<span class="normal"> 441</span>
<span class="normal"> 442</span>
<span class="normal"> 443</span>
<span class="normal"> 444</span>
<span class="normal"> 445</span>
<span class="normal"> 446</span>
<span class="normal"> 447</span>
<span class="normal"> 448</span>
<span class="normal"> 449</span>
<span class="normal"> 450</span>
<span class="normal"> 451</span>
<span class="normal"> 452</span>
<span class="normal"> 453</span>
<span class="normal"> 454</span>
<span class="normal"> 455</span>
<span class="normal"> 456</span>
<span class="normal"> 457</span>
<span class="normal"> 458</span>
<span class="normal"> 459</span>
<span class="normal"> 460</span>
<span class="normal"> 461</span>
<span class="normal"> 462</span>
<span class="normal"> 463</span>
<span class="normal"> 464</span>
<span class="normal"> 465</span>
<span class="normal"> 466</span>
<span class="normal"> 467</span>
<span class="normal"> 468</span>
<span class="normal"> 469</span>
<span class="normal"> 470</span>
<span class="normal"> 471</span>
<span class="normal"> 472</span>
<span class="normal"> 473</span>
<span class="normal"> 474</span>
<span class="normal"> 475</span>
<span class="normal"> 476</span>
<span class="normal"> 477</span>
<span class="normal"> 478</span>
<span class="normal"> 479</span>
<span class="normal"> 480</span>
<span class="normal"> 481</span>
<span class="normal"> 482</span>
<span class="normal"> 483</span>
<span class="normal"> 484</span>
<span class="normal"> 485</span>
<span class="normal"> 486</span>
<span class="normal"> 487</span>
<span class="normal"> 488</span>
<span class="normal"> 489</span>
<span class="normal"> 490</span>
<span class="normal"> 491</span>
<span class="normal"> 492</span>
<span class="normal"> 493</span>
<span class="normal"> 494</span>
<span class="normal"> 495</span>
<span class="normal"> 496</span>
<span class="normal"> 497</span>
<span class="normal"> 498</span>
<span class="normal"> 499</span>
<span class="normal"> 500</span>
<span class="normal"> 501</span>
<span class="normal"> 502</span>
<span class="normal"> 503</span>
<span class="normal"> 504</span>
<span class="normal"> 505</span>
<span class="normal"> 506</span>
<span class="normal"> 507</span>
<span class="normal"> 508</span>
<span class="normal"> 509</span>
<span class="normal"> 510</span>
<span class="normal"> 511</span>
<span class="normal"> 512</span>
<span class="normal"> 513</span>
<span class="normal"> 514</span>
<span class="normal"> 515</span>
<span class="normal"> 516</span>
<span class="normal"> 517</span>
<span class="normal"> 518</span>
<span class="normal"> 519</span>
<span class="normal"> 520</span>
<span class="normal"> 521</span>
<span class="normal"> 522</span>
<span class="normal"> 523</span>
<span class="normal"> 524</span>
<span class="normal"> 525</span>
<span class="normal"> 526</span>
<span class="normal"> 527</span>
<span class="normal"> 528</span>
<span class="normal"> 529</span>
<span class="normal"> 530</span>
<span class="normal"> 531</span>
<span class="normal"> 532</span>
<span class="normal"> 533</span>
<span class="normal"> 534</span>
<span class="normal"> 535</span>
<span class="normal"> 536</span>
<span class="normal"> 537</span>
<span class="normal"> 538</span>
<span class="normal"> 539</span>
<span class="normal"> 540</span>
<span class="normal"> 541</span>
<span class="normal"> 542</span>
<span class="normal"> 543</span>
<span class="normal"> 544</span>
<span class="normal"> 545</span>
<span class="normal"> 546</span>
<span class="normal"> 547</span>
<span class="normal"> 548</span>
<span class="normal"> 549</span>
<span class="normal"> 550</span>
<span class="normal"> 551</span>
<span class="normal"> 552</span>
<span class="normal"> 553</span>
<span class="normal"> 554</span>
<span class="normal"> 555</span>
<span class="normal"> 556</span>
<span class="normal"> 557</span>
<span class="normal"> 558</span>
<span class="normal"> 559</span>
<span class="normal"> 560</span>
<span class="normal"> 561</span>
<span class="normal"> 562</span>
<span class="normal"> 563</span>
<span class="normal"> 564</span>
<span class="normal"> 565</span>
<span class="normal"> 566</span>
<span class="normal"> 567</span>
<span class="normal"> 568</span>
<span class="normal"> 569</span>
<span class="normal"> 570</span>
<span class="normal"> 571</span>
<span class="normal"> 572</span>
<span class="normal"> 573</span>
<span class="normal"> 574</span>
<span class="normal"> 575</span>
<span class="normal"> 576</span>
<span class="normal"> 577</span>
<span class="normal"> 578</span>
<span class="normal"> 579</span>
<span class="normal"> 580</span>
<span class="normal"> 581</span>
<span class="normal"> 582</span>
<span class="normal"> 583</span>
<span class="normal"> 584</span>
<span class="normal"> 585</span>
<span class="normal"> 586</span>
<span class="normal"> 587</span>
<span class="normal"> 588</span>
<span class="normal"> 589</span>
<span class="normal"> 590</span>
<span class="normal"> 591</span>
<span class="normal"> 592</span>
<span class="normal"> 593</span>
<span class="normal"> 594</span>
<span class="normal"> 595</span>
<span class="normal"> 596</span>
<span class="normal"> 597</span>
<span class="normal"> 598</span>
<span class="normal"> 599</span>
<span class="normal"> 600</span>
<span class="normal"> 601</span>
<span class="normal"> 602</span>
<span class="normal"> 603</span>
<span class="normal"> 604</span>
<span class="normal"> 605</span>
<span class="normal"> 606</span>
<span class="normal"> 607</span>
<span class="normal"> 608</span>
<span class="normal"> 609</span>
<span class="normal"> 610</span>
<span class="normal"> 611</span>
<span class="normal"> 612</span>
<span class="normal"> 613</span>
<span class="normal"> 614</span>
<span class="normal"> 615</span>
<span class="normal"> 616</span>
<span class="normal"> 617</span>
<span class="normal"> 618</span>
<span class="normal"> 619</span>
<span class="normal"> 620</span>
<span class="normal"> 621</span>
<span class="normal"> 622</span>
<span class="normal"> 623</span>
<span class="normal"> 624</span>
<span class="normal"> 625</span>
<span class="normal"> 626</span>
<span class="normal"> 627</span>
<span class="normal"> 628</span>
<span class="normal"> 629</span>
<span class="normal"> 630</span>
<span class="normal"> 631</span>
<span class="normal"> 632</span>
<span class="normal"> 633</span>
<span class="normal"> 634</span>
<span class="normal"> 635</span>
<span class="normal"> 636</span>
<span class="normal"> 637</span>
<span class="normal"> 638</span>
<span class="normal"> 639</span>
<span class="normal"> 640</span>
<span class="normal"> 641</span>
<span class="normal"> 642</span>
<span class="normal"> 643</span>
<span class="normal"> 644</span>
<span class="normal"> 645</span>
<span class="normal"> 646</span>
<span class="normal"> 647</span>
<span class="normal"> 648</span>
<span class="normal"> 649</span>
<span class="normal"> 650</span>
<span class="normal"> 651</span>
<span class="normal"> 652</span>
<span class="normal"> 653</span>
<span class="normal"> 654</span>
<span class="normal"> 655</span>
<span class="normal"> 656</span>
<span class="normal"> 657</span>
<span class="normal"> 658</span>
<span class="normal"> 659</span>
<span class="normal"> 660</span>
<span class="normal"> 661</span>
<span class="normal"> 662</span>
<span class="normal"> 663</span>
<span class="normal"> 664</span>
<span class="normal"> 665</span>
<span class="normal"> 666</span>
<span class="normal"> 667</span>
<span class="normal"> 668</span>
<span class="normal"> 669</span>
<span class="normal"> 670</span>
<span class="normal"> 671</span>
<span class="normal"> 672</span>
<span class="normal"> 673</span>
<span class="normal"> 674</span>
<span class="normal"> 675</span>
<span class="normal"> 676</span>
<span class="normal"> 677</span>
<span class="normal"> 678</span>
<span class="normal"> 679</span>
<span class="normal"> 680</span>
<span class="normal"> 681</span>
<span class="normal"> 682</span>
<span class="normal"> 683</span>
<span class="normal"> 684</span>
<span class="normal"> 685</span>
<span class="normal"> 686</span>
<span class="normal"> 687</span>
<span class="normal"> 688</span>
<span class="normal"> 689</span>
<span class="normal"> 690</span>
<span class="normal"> 691</span>
<span class="normal"> 692</span>
<span class="normal"> 693</span>
<span class="normal"> 694</span>
<span class="normal"> 695</span>
<span class="normal"> 696</span>
<span class="normal"> 697</span>
<span class="normal"> 698</span>
<span class="normal"> 699</span>
<span class="normal"> 700</span>
<span class="normal"> 701</span>
<span class="normal"> 702</span>
<span class="normal"> 703</span>
<span class="normal"> 704</span>
<span class="normal"> 705</span>
<span class="normal"> 706</span>
<span class="normal"> 707</span>
<span class="normal"> 708</span>
<span class="normal"> 709</span>
<span class="normal"> 710</span>
<span class="normal"> 711</span>
<span class="normal"> 712</span>
<span class="normal"> 713</span>
<span class="normal"> 714</span>
<span class="normal"> 715</span>
<span class="normal"> 716</span>
<span class="normal"> 717</span>
<span class="normal"> 718</span>
<span class="normal"> 719</span>
<span class="normal"> 720</span>
<span class="normal"> 721</span>
<span class="normal"> 722</span>
<span class="normal"> 723</span>
<span class="normal"> 724</span>
<span class="normal"> 725</span>
<span class="normal"> 726</span>
<span class="normal"> 727</span>
<span class="normal"> 728</span>
<span class="normal"> 729</span>
<span class="normal"> 730</span>
<span class="normal"> 731</span>
<span class="normal"> 732</span>
<span class="normal"> 733</span>
<span class="normal"> 734</span>
<span class="normal"> 735</span>
<span class="normal"> 736</span>
<span class="normal"> 737</span>
<span class="normal"> 738</span>
<span class="normal"> 739</span>
<span class="normal"> 740</span>
<span class="normal"> 741</span>
<span class="normal"> 742</span>
<span class="normal"> 743</span>
<span class="normal"> 744</span>
<span class="normal"> 745</span>
<span class="normal"> 746</span>
<span class="normal"> 747</span>
<span class="normal"> 748</span>
<span class="normal"> 749</span>
<span class="normal"> 750</span>
<span class="normal"> 751</span>
<span class="normal"> 752</span>
<span class="normal"> 753</span>
<span class="normal"> 754</span>
<span class="normal"> 755</span>
<span class="normal"> 756</span>
<span class="normal"> 757</span>
<span class="normal"> 758</span>
<span class="normal"> 759</span>
<span class="normal"> 760</span>
<span class="normal"> 761</span>
<span class="normal"> 762</span>
<span class="normal"> 763</span>
<span class="normal"> 764</span>
<span class="normal"> 765</span>
<span class="normal"> 766</span>
<span class="normal"> 767</span>
<span class="normal"> 768</span>
<span class="normal"> 769</span>
<span class="normal"> 770</span>
<span class="normal"> 771</span>
<span class="normal"> 772</span>
<span class="normal"> 773</span>
<span class="normal"> 774</span>
<span class="normal"> 775</span>
<span class="normal"> 776</span>
<span class="normal"> 777</span>
<span class="normal"> 778</span>
<span class="normal"> 779</span>
<span class="normal"> 780</span>
<span class="normal"> 781</span>
<span class="normal"> 782</span>
<span class="normal"> 783</span>
<span class="normal"> 784</span>
<span class="normal"> 785</span>
<span class="normal"> 786</span>
<span class="normal"> 787</span>
<span class="normal"> 788</span>
<span class="normal"> 789</span>
<span class="normal"> 790</span>
<span class="normal"> 791</span>
<span class="normal"> 792</span>
<span class="normal"> 793</span>
<span class="normal"> 794</span>
<span class="normal"> 795</span>
<span class="normal"> 796</span>
<span class="normal"> 797</span>
<span class="normal"> 798</span>
<span class="normal"> 799</span>
<span class="normal"> 800</span>
<span class="normal"> 801</span>
<span class="normal"> 802</span>
<span class="normal"> 803</span>
<span class="normal"> 804</span>
<span class="normal"> 805</span>
<span class="normal"> 806</span>
<span class="normal"> 807</span>
<span class="normal"> 808</span>
<span class="normal"> 809</span>
<span class="normal"> 810</span>
<span class="normal"> 811</span>
<span class="normal"> 812</span>
<span class="normal"> 813</span>
<span class="normal"> 814</span>
<span class="normal"> 815</span>
<span class="normal"> 816</span>
<span class="normal"> 817</span>
<span class="normal"> 818</span>
<span class="normal"> 819</span>
<span class="normal"> 820</span>
<span class="normal"> 821</span>
<span class="normal"> 822</span>
<span class="normal"> 823</span>
<span class="normal"> 824</span>
<span class="normal"> 825</span>
<span class="normal"> 826</span>
<span class="normal"> 827</span>
<span class="normal"> 828</span>
<span class="normal"> 829</span>
<span class="normal"> 830</span>
<span class="normal"> 831</span>
<span class="normal"> 832</span>
<span class="normal"> 833</span>
<span class="normal"> 834</span>
<span class="normal"> 835</span>
<span class="normal"> 836</span>
<span class="normal"> 837</span>
<span class="normal"> 838</span>
<span class="normal"> 839</span>
<span class="normal"> 840</span>
<span class="normal"> 841</span>
<span class="normal"> 842</span>
<span class="normal"> 843</span>
<span class="normal"> 844</span>
<span class="normal"> 845</span>
<span class="normal"> 846</span>
<span class="normal"> 847</span>
<span class="normal"> 848</span>
<span class="normal"> 849</span>
<span class="normal"> 850</span>
<span class="normal"> 851</span>
<span class="normal"> 852</span>
<span class="normal"> 853</span>
<span class="normal"> 854</span>
<span class="normal"> 855</span>
<span class="normal"> 856</span>
<span class="normal"> 857</span>
<span class="normal"> 858</span>
<span class="normal"> 859</span>
<span class="normal"> 860</span>
<span class="normal"> 861</span>
<span class="normal"> 862</span>
<span class="normal"> 863</span>
<span class="normal"> 864</span>
<span class="normal"> 865</span>
<span class="normal"> 866</span>
<span class="normal"> 867</span>
<span class="normal"> 868</span>
<span class="normal"> 869</span>
<span class="normal"> 870</span>
<span class="normal"> 871</span>
<span class="normal"> 872</span>
<span class="normal"> 873</span>
<span class="normal"> 874</span>
<span class="normal"> 875</span>
<span class="normal"> 876</span>
<span class="normal"> 877</span>
<span class="normal"> 878</span>
<span class="normal"> 879</span>
<span class="normal"> 880</span>
<span class="normal"> 881</span>
<span class="normal"> 882</span>
<span class="normal"> 883</span>
<span class="normal"> 884</span>
<span class="normal"> 885</span>
<span class="normal"> 886</span>
<span class="normal"> 887</span>
<span class="normal"> 888</span>
<span class="normal"> 889</span>
<span class="normal"> 890</span>
<span class="normal"> 891</span>
<span class="normal"> 892</span>
<span class="normal"> 893</span>
<span class="normal"> 894</span>
<span class="normal"> 895</span>
<span class="normal"> 896</span>
<span class="normal"> 897</span>
<span class="normal"> 898</span>
<span class="normal"> 899</span>
<span class="normal"> 900</span>
<span class="normal"> 901</span>
<span class="normal"> 902</span>
<span class="normal"> 903</span>
<span class="normal"> 904</span>
<span class="normal"> 905</span>
<span class="normal"> 906</span>
<span class="normal"> 907</span>
<span class="normal"> 908</span>
<span class="normal"> 909</span>
<span class="normal"> 910</span>
<span class="normal"> 911</span>
<span class="normal"> 912</span>
<span class="normal"> 913</span>
<span class="normal"> 914</span>
<span class="normal"> 915</span>
<span class="normal"> 916</span>
<span class="normal"> 917</span>
<span class="normal"> 918</span>
<span class="normal"> 919</span>
<span class="normal"> 920</span>
<span class="normal"> 921</span>
<span class="normal"> 922</span>
<span class="normal"> 923</span>
<span class="normal"> 924</span>
<span class="normal"> 925</span>
<span class="normal"> 926</span>
<span class="normal"> 927</span>
<span class="normal"> 928</span>
<span class="normal"> 929</span>
<span class="normal"> 930</span>
<span class="normal"> 931</span>
<span class="normal"> 932</span>
<span class="normal"> 933</span>
<span class="normal"> 934</span>
<span class="normal"> 935</span>
<span class="normal"> 936</span>
<span class="normal"> 937</span>
<span class="normal"> 938</span>
<span class="normal"> 939</span>
<span class="normal"> 940</span>
<span class="normal"> 941</span>
<span class="normal"> 942</span>
<span class="normal"> 943</span>
<span class="normal"> 944</span>
<span class="normal"> 945</span>
<span class="normal"> 946</span>
<span class="normal"> 947</span>
<span class="normal"> 948</span>
<span class="normal"> 949</span>
<span class="normal"> 950</span>
<span class="normal"> 951</span>
<span class="normal"> 952</span>
<span class="normal"> 953</span>
<span class="normal"> 954</span>
<span class="normal"> 955</span>
<span class="normal"> 956</span>
<span class="normal"> 957</span>
<span class="normal"> 958</span>
<span class="normal"> 959</span>
<span class="normal"> 960</span>
<span class="normal"> 961</span>
<span class="normal"> 962</span>
<span class="normal"> 963</span>
<span class="normal"> 964</span>
<span class="normal"> 965</span>
<span class="normal"> 966</span>
<span class="normal"> 967</span>
<span class="normal"> 968</span>
<span class="normal"> 969</span>
<span class="normal"> 970</span>
<span class="normal"> 971</span>
<span class="normal"> 972</span>
<span class="normal"> 973</span>
<span class="normal"> 974</span>
<span class="normal"> 975</span>
<span class="normal"> 976</span>
<span class="normal"> 977</span>
<span class="normal"> 978</span>
<span class="normal"> 979</span>
<span class="normal"> 980</span>
<span class="normal"> 981</span>
<span class="normal"> 982</span>
<span class="normal"> 983</span>
<span class="normal"> 984</span>
<span class="normal"> 985</span>
<span class="normal"> 986</span>
<span class="normal"> 987</span>
<span class="normal"> 988</span>
<span class="normal"> 989</span>
<span class="normal"> 990</span>
<span class="normal"> 991</span>
<span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Rainbow</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    `Rainbow` (🌈) objects represent brightness as a function</span>
<span class="sd">    of both wavelength and time.</span>

<span class="sd">    These objects are useful for reading or writing multiwavelength</span>
<span class="sd">    time-series datasets in a variety of formats, visualizing these</span>
<span class="sd">    data with simple commands, and performing basic calculations.</span>
<span class="sd">    `RainbowWithModel` and `SimulatedRainbow` objects inherit from</span>
<span class="sd">    `Rainbow`, so all basically all methods and attributes described</span>
<span class="sd">    below are available for them too.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    wavelike : dict</span>
<span class="sd">        A dictionary for quantities with shape `(nwave,),</span>
<span class="sd">        for which there&#39;s one value for each wavelength.</span>
<span class="sd">    timelike : dict</span>
<span class="sd">        A dictionary for quantities with shape `(ntime,),</span>
<span class="sd">        for which there&#39;s one value for each time.</span>
<span class="sd">    fluxlike : dict</span>
<span class="sd">        A dictionary for quantities with shape `(nwave,ntime),</span>
<span class="sd">        for which there&#39;s one value for each wavelength and time.</span>
<span class="sd">    metadata : dict</span>
<span class="sd">        A dictionary containing all other useful information</span>
<span class="sd">        that should stay connected to the `Rainbow`, in any format.</span>
<span class="sd">    wavelength : Quantity</span>
<span class="sd">        The 1D array of wavelengths for this `Rainbow`.</span>
<span class="sd">        (This is a property, not an actual attribute.)</span>
<span class="sd">    time : Quantity</span>
<span class="sd">        The 1D array of times for this `Rainbow`.</span>
<span class="sd">        (This is a property, not an actual attribute.)</span>
<span class="sd">    flux : array, Quantity</span>
<span class="sd">        The 2D array of fluxes for this `Rainbow`.</span>
<span class="sd">        (This is a property, not an actual attribute.)</span>
<span class="sd">    uncertainty : array, Quantity</span>
<span class="sd">        The 2D array of flux uncertainties for this `Rainbow`.</span>
<span class="sd">        (This is a property, not an actual attribute.)</span>
<span class="sd">    ok : array</span>
<span class="sd">        The 2D array of &quot;ok-ness&quot; for this `Rainbow`.</span>
<span class="sd">        (This is a property, not an actual attribute.)</span>
<span class="sd">    shape : tuple</span>
<span class="sd">        The shape of this `Rainbow`&#39;s flux array.</span>
<span class="sd">        (This is a property, not an actual attribute.)</span>
<span class="sd">    nwave : int</span>
<span class="sd">        The number of wavelengths in this `Rainbow`&#39;.</span>
<span class="sd">        (This is a property, not an actual attribute.)</span>
<span class="sd">    ntime : int</span>
<span class="sd">        The number of times in this `Rainbow`&#39;.</span>
<span class="sd">        (This is a property, not an actual attribute.)</span>
<span class="sd">    nflux : int</span>
<span class="sd">        The total number of fluxes in this `Rainbow`&#39; (= `nwave*ntime`).</span>
<span class="sd">        (This is a property, not an actual attribute.)</span>
<span class="sd">    dt : Quantity</span>
<span class="sd">        The typical time offset between adjacent times in this `Rainbow`.</span>
<span class="sd">        (This is a property, not an actual attribute.)</span>
<span class="sd">    name : array, Quantity</span>
<span class="sd">        The name of this `Rainbow`, if one has been set.</span>
<span class="sd">        (This is a property, not an actual attribute.)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># all Rainbows must contain these core dictionaries</span>
    <span class="n">_core_dictionaries</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;fluxlike&quot;</span><span class="p">,</span> <span class="s2">&quot;timelike&quot;</span><span class="p">,</span> <span class="s2">&quot;wavelike&quot;</span><span class="p">,</span> <span class="s2">&quot;metadata&quot;</span><span class="p">]</span>

    <span class="c1"># define which axis is which</span>
    <span class="n">waveaxis</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">timeaxis</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="c1"># which fluxlike keys will respond to math between objects</span>
    <span class="n">_keys_that_respond_to_math</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;flux&quot;</span><span class="p">]</span>

    <span class="c1"># which keys get uncertainty weighting during binning</span>
    <span class="n">_keys_that_get_uncertainty_weighting</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;flux&quot;</span><span class="p">,</span> <span class="s2">&quot;uncertainty&quot;</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">filepath</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="nb">format</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">wavelength</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">time</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">flux</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">uncertainty</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">wavelike</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">timelike</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">fluxlike</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">metadata</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kw</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize a `Rainbow` object.</span>

<span class="sd">        The `__init__` function is called when a new `Rainbow` is</span>
<span class="sd">        instantiated as `r = Rainbow(some, kinds, of=inputs)`.</span>

<span class="sd">        The options for inputs are flexible, including the possibility</span>
<span class="sd">        to initialize from a file, from arrays with appropriate units,</span>
<span class="sd">        from dictionaries with appropriate ingredients, or simply as</span>
<span class="sd">        an empty object if no arguments are given.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filepath : str, optional</span>
<span class="sd">            The filepath pointing to the file or group of files</span>
<span class="sd">            that should be read.</span>
<span class="sd">        format : str, optional</span>
<span class="sd">            The file format of the file to be read. If None,</span>
<span class="sd">            the format will be guessed automatically from the</span>
<span class="sd">            filepath.</span>
<span class="sd">        wavelength : Quantity, optional</span>
<span class="sd">            A 1D array of wavelengths, in any unit.</span>
<span class="sd">        time : Quantity, Time, optional</span>
<span class="sd">            A 1D array of times, in any unit.</span>
<span class="sd">        flux : array, optional</span>
<span class="sd">            A 2D array of flux values.</span>
<span class="sd">        uncertainty : array, optional</span>
<span class="sd">            A 2D array of uncertainties, associated with the flux.</span>
<span class="sd">        wavelike : dict, optional</span>
<span class="sd">            A dictionary containing 1D arrays with the same</span>
<span class="sd">            shape as the wavelength axis. It must at least</span>
<span class="sd">            contain the key &#39;wavelength&#39;, which should have</span>
<span class="sd">            astropy units of wavelength associated with it.</span>
<span class="sd">        timelike : dict, optional</span>
<span class="sd">            A dictionary containing 1D arrays with the same</span>
<span class="sd">            shape as the time axis. It must at least</span>
<span class="sd">            contain the key &#39;time&#39;, which should have</span>
<span class="sd">            astropy units of time associated with it.</span>
<span class="sd">        fluxlike : dict, optional</span>
<span class="sd">            A dictionary containing 2D arrays with the shape</span>
<span class="sd">            of (nwave, ntime), like flux. It must at least</span>
<span class="sd">            contain the key &#39;flux&#39;.</span>
<span class="sd">        metadata : dict, optional</span>
<span class="sd">            A dictionary containing all other metadata</span>
<span class="sd">            associated with the dataset, generally lots of</span>
<span class="sd">            individual parameters or comments.</span>
<span class="sd">        **kw : dict, optional</span>
<span class="sd">            Additional keywords will be passed along to</span>
<span class="sd">            the function that initializes the rainbow.</span>
<span class="sd">            If initializing from arrays (`time=`, `wavelength=`,</span>
<span class="sd">            ...), these keywords will be interpreted as</span>
<span class="sd">            additional arrays that should be sorted by their</span>
<span class="sd">            shape into the appropriate dictionary. If</span>
<span class="sd">            initializing from files, the keywords will</span>
<span class="sd">            be passed on to the reader.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        Initialize from a file. While this works, a more robust</span>
<span class="sd">        solution is probably to use `read_rainbow`, which will</span>
<span class="sd">        automatically choose the best of `Rainbow` and `RainbowWithModel`</span>
<span class="sd">        ```</span>
<span class="sd">        r1 = Rainbow(&#39;my-neat-file.abc&#39;, format=&#39;abcdefgh&#39;)</span>
<span class="sd">        ```</span>

<span class="sd">        Initalize from arrays. The wavelength and time must have</span>
<span class="sd">        appropriate units, and the shape of the flux array must</span>
<span class="sd">        match the size of the wavelength and time arrays. Other</span>
<span class="sd">        arrays that match the shape of any of these quantities</span>
<span class="sd">        will be stored in the appropriate location. Other inputs</span>
<span class="sd">        not matching any of these will be stored as `metadata.`</span>
<span class="sd">        ```</span>
<span class="sd">        r2 = Rainbow(</span>
<span class="sd">                wavelength=np.linspace(1, 5, 50)*u.micron,</span>
<span class="sd">                time=np.linspace(-0.5, 0.5, 100)*u.day,</span>
<span class="sd">                flux=np.random.normal(0, 1, (50, 100)),</span>
<span class="sd">                some_other_array=np.ones((50,100)),</span>
<span class="sd">                some_metadata=&#39;wow!&#39;</span>
<span class="sd">        )</span>
<span class="sd">        ```</span>
<span class="sd">        Initialize from dictionaries. The dictionaries must contain</span>
<span class="sd">        at least `wavelike[&#39;wavelength&#39;]`, `timelike[&#39;time&#39;]`, and</span>
<span class="sd">        `fluxlike[&#39;flux&#39;]`, but any other additional inputs can be</span>
<span class="sd">        provided.</span>
<span class="sd">        ```</span>
<span class="sd">        r3 = Rainbow(</span>
<span class="sd">                wavelike=dict(wavelength=np.linspace(1, 5, 50)*u.micron),</span>
<span class="sd">                timelike=dict(time=np.linspace(-0.5, 0.5, 100)*u.day),</span>
<span class="sd">                fluxlike=dict(flux=np.random.normal(0, 1, (50, 100)))</span>
<span class="sd">        )</span>
<span class="sd">        ```</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># create a history entry for this action (before other variables are defined)</span>
        <span class="n">h</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_history_entry</span><span class="p">(</span><span class="s2">&quot;Rainbow&quot;</span><span class="p">,</span> <span class="nb">locals</span><span class="p">())</span>

        <span class="c1"># metadata are arbitrary types of information we need</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">name</span><span class="p">}</span>

        <span class="c1"># wavelike quanities are 1D arrays with nwave elements</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wavelike</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># timelike quantities are 1D arrays with ntime elements</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timelike</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># fluxlike quantities are 2D arrays with nwave x time elements</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fluxlike</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># try to intialize from the exact dictionaries needed</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">wavelike</span><span class="p">)</span> <span class="o">==</span> <span class="nb">dict</span><span class="p">)</span>
            <span class="ow">and</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">timelike</span><span class="p">)</span> <span class="o">==</span> <span class="nb">dict</span><span class="p">)</span>
            <span class="ow">and</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">fluxlike</span><span class="p">)</span> <span class="o">==</span> <span class="nb">dict</span><span class="p">)</span>
        <span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_initialize_from_dictionaries</span><span class="p">(</span>
                <span class="n">wavelike</span><span class="o">=</span><span class="n">wavelike</span><span class="p">,</span>
                <span class="n">timelike</span><span class="o">=</span><span class="n">timelike</span><span class="p">,</span>
                <span class="n">fluxlike</span><span class="o">=</span><span class="n">fluxlike</span><span class="p">,</span>
                <span class="n">metadata</span><span class="o">=</span><span class="n">metadata</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="c1"># then try to initialize from arrays</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">wavelength</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">time</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">flux</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_initialize_from_arrays</span><span class="p">(</span>
                <span class="n">wavelength</span><span class="o">=</span><span class="n">wavelength</span><span class="p">,</span>
                <span class="n">time</span><span class="o">=</span><span class="n">time</span><span class="p">,</span>
                <span class="n">flux</span><span class="o">=</span><span class="n">flux</span><span class="p">,</span>
                <span class="n">uncertainty</span><span class="o">=</span><span class="n">uncertainty</span><span class="p">,</span>
                <span class="o">**</span><span class="n">kw</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">metadata</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="n">metadata</span><span class="p">)</span>
        <span class="c1"># then try to initialize from a file</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="n">Column</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_initialize_from_file</span><span class="p">(</span><span class="n">filepath</span><span class="o">=</span><span class="n">filepath</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="nb">format</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>

        <span class="c1"># finally, tidy up by guessing the scales</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_guess_wscale</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_guess_tscale</span><span class="p">()</span>

        <span class="c1"># append the history entry to this Rainbow</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_setup_history</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_record_history_entry</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_sort</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sort the wavelengths and times, from lowest to highest.</span>
<span class="sd">        Attach the unsorted indices to be able to work backwards.</span>
<span class="sd">        This sorts the object in-place (not returning a new Rainbow.)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        sorted : Rainbow</span>
<span class="sd">            The sorted Rainbow.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># figure out the indices to sort from low to high</span>
        <span class="n">i_wavelength</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wavelength</span><span class="p">)</span>
        <span class="n">i_time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="p">)</span> <span class="o">!=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">i_wavelength</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">i_time</span><span class="p">)):</span>
            <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            Wavelength, time, and flux arrays don&#39;t match;</span>
<span class="s2">            the `._sort()` step is being skipped.</span>
<span class="s2">            &quot;&quot;&quot;</span>
            <span class="n">cheerfully_suggest</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">i_wavelength</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">):</span>
            <span class="n">message</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            The </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">nwave</span><span class="si">}</span><span class="s2"> input wavelengths were not monotonically increasing.</span>
<span class="s2">            </span><span class="si">{</span><span class="bp">self</span><span class="si">}</span><span class="s2"> has been sorted from lowest to highest wavelength.</span>
<span class="s2">            If you want to recover the original wavelength order, the original</span>
<span class="s2">            wavelength indices are available in `rainbow.original_wave_index`.</span>
<span class="s2">            &quot;&quot;&quot;</span>
            <span class="n">cheerfully_suggest</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">i_time</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">):</span>
            <span class="n">message</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            The </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ntime</span><span class="si">}</span><span class="s2"> input times were not monotonically increasing.</span>
<span class="s2">            </span><span class="si">{</span><span class="bp">self</span><span class="si">}</span><span class="s2"> has been sorted from lowest to highest time.</span>
<span class="s2">            If you want to recover the original time order, the original</span>
<span class="s2">            time indices are available in `rainbow.original_time_index`.</span>
<span class="s2">            &quot;&quot;&quot;</span>
            <span class="n">cheerfully_suggest</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>

        <span class="c1"># attach unsorted indices to this array, if the don&#39;t exist</span>
        <span class="k">if</span> <span class="s2">&quot;original_wave_index&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">wavelike</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wavelike</span><span class="p">[</span><span class="s2">&quot;original_wave_index&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nwave</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;original_time_index&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">timelike</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">timelike</span><span class="p">[</span><span class="s2">&quot;original_time_index&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ntime</span><span class="p">)</span>

        <span class="c1"># sort that copy by wavelength and time</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">wavelike</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">wavelike</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">wavelike</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wavelike</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">i_wavelength</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">timelike</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">timelike</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">timelike</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timelike</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">i_time</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fluxlike</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fluxlike</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">wave_sorted</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fluxlike</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">i_wavelength</span><span class="p">,</span> <span class="p">:]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fluxlike</span><span class="p">[</span><span class="n">k</span><span class="p">][:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">wave_sorted</span><span class="p">[:,</span> <span class="n">i_time</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_validate_uncertainties</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Do some checks on the uncertainty values.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">uncertainty</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fluxlike</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">message</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            Hmmm...it&#39;s not clear which column corresponds to the</span>
<span class="s2">            flux uncertainties for this Rainbow object. The</span>
<span class="s2">            available `fluxlike` columns are:</span>
<span class="s2">                </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">fluxlike</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span><span class="si">}</span>
<span class="s2">            A long-term solution might be to fix the `from_?!?!?!?`</span>
<span class="s2">            reader, but a short-term solution would be to pick one</span>
<span class="s2">            of the columns listed above and say something like</span>

<span class="s2">            x.fluxlike[&#39;uncertainty&#39;] = x.fluxlike[&#39;some-other-relevant-error-column&#39;]</span>

<span class="s2">            where `x` is the Rainbow you just created.</span>
<span class="s2">            &quot;&quot;&quot;</span>
            <span class="n">cheerfully_suggest</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="c1"># kludge to replace zero uncertainties</span>
        <span class="c1"># if np.all(self.uncertainty == 0):</span>
        <span class="c1">#    cheerfully_suggest(&quot;\nUncertainties were all 0, replacing them with 1!&quot;)</span>
        <span class="c1">#        self.fluxlike[&quot;uncertainty&quot;] = np.ones_like(self.flux)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_initialize_from_dictionaries</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">wavelike</span><span class="o">=</span><span class="p">{},</span> <span class="n">timelike</span><span class="o">=</span><span class="p">{},</span> <span class="n">fluxlike</span><span class="o">=</span><span class="p">{},</span> <span class="n">metadata</span><span class="o">=</span><span class="p">{}</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Populate from dictionaries in the correct format.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        wavelike : dict</span>
<span class="sd">            A dictionary containing 1D arrays with the same</span>
<span class="sd">            shape as the wavelength axis. It must at least</span>
<span class="sd">            contain the key &#39;wavelength&#39;, which should have</span>
<span class="sd">            astropy units of wavelength associated with it.</span>
<span class="sd">        timelike : dict</span>
<span class="sd">            A dictionary containing 1D arrays with the same</span>
<span class="sd">            shape as the time axis. It must at least</span>
<span class="sd">            contain the key &#39;time&#39;, which should have</span>
<span class="sd">            astropy units of time associated with it.</span>
<span class="sd">        fluxlike : dict</span>
<span class="sd">            A dictionary containing 2D arrays with the shape</span>
<span class="sd">            of (nwave, ntime), like flux. It must at least</span>
<span class="sd">            contain the key &#39;flux&#39;.</span>
<span class="sd">        metadata : dict</span>
<span class="sd">            A dictionary containing all other metadata</span>
<span class="sd">            associated with the dataset, generally lots of</span>
<span class="sd">            individual parameters or comments.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># update the three core dictionaries of arrays</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">wavelike</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wavelike</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">wavelike</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="mi">1</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">timelike</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">timelike</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">timelike</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="mi">1</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">fluxlike</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fluxlike</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">fluxlike</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="mi">1</span>
        <span class="c1"># multiplying by 1 is a kludge to prevent accidental links</span>

        <span class="c1"># update the metadata</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="n">metadata</span><span class="p">)</span>

        <span class="c1"># validate that something reasonable got populated</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_core_dictionaries</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_get_core_dictionaries</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the core dictionaries of this Rainbow.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        core : dict</span>
<span class="sd">            Dictionary containing the keys</span>
<span class="sd">            [&#39;wavelike&#39;, &#39;timelike&#39;, &#39;fluxlike&#39;, &#39;metadata&#39;]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="p">)[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_core_dictionaries</span><span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_initialize_from_arrays</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">wavelength</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">flux</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">uncertainty</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Populate from arrays.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        wavelength : Quantity, optional</span>
<span class="sd">            A 1D array of wavelengths, in any unit.</span>
<span class="sd">        time : Quantity, Time, optional</span>
<span class="sd">            A 1D array of times, in any unit.</span>
<span class="sd">        flux : array, optional</span>
<span class="sd">            A 2D array of flux values.</span>
<span class="sd">        uncertainty : array, optional</span>
<span class="sd">            A 2D array of uncertainties, associated with the flux.</span>
<span class="sd">        **kw : dict, optional</span>
<span class="sd">            Additional keywords will be interpreted as arrays</span>
<span class="sd">            that should be sorted into the appropriate location</span>
<span class="sd">            based on their size.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># store the wavelength</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wavelike</span><span class="p">[</span><span class="s2">&quot;wavelength&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">wavelength</span> <span class="o">*</span> <span class="mi">1</span>

        <span class="c1"># store the time</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timelike</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">time</span> <span class="o">*</span> <span class="mi">1</span>

        <span class="c1"># store the flux and uncertainty</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fluxlike</span><span class="p">[</span><span class="s2">&quot;flux&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">flux</span> <span class="o">*</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">uncertainty</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fluxlike</span><span class="p">[</span><span class="s2">&quot;uncertainty&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">flux</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fluxlike</span><span class="p">[</span><span class="s2">&quot;uncertainty&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">uncertainty</span> <span class="o">*</span> <span class="mi">1</span>

        <span class="c1"># sort other arrays by shape</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">kw</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_put_array_in_right_dictionary</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>

        <span class="c1"># validate that something reasonable got populated</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_core_dictionaries</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_put_array_in_right_dictionary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sort an input into the right core dictionary</span>
<span class="sd">        (timelike, wavelike, fluxlike) based on its shape.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        k : str</span>
<span class="sd">            The key for the (appropriate) dictionary.</span>
<span class="sd">        v : array</span>
<span class="sd">            The quantity to sort.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fluxlike</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span> <span class="o">*</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nwave</span><span class="p">,):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wavelike</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span> <span class="o">*</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ntime</span><span class="p">,):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">timelike</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span> <span class="o">*</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">&#39; doesn&#39;t fit anywhere!&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_initialize_from_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filepath</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Populate from a filename or group of files.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filepath : str</span>
<span class="sd">            The filepath pointing to the file or group of files</span>
<span class="sd">            that should be read.</span>
<span class="sd">        format : str, function, (optional)</span>
<span class="sd">            The file format of the file to be read.</span>
<span class="sd">            If None, guess format from filepath.</span>
<span class="sd">            If str, pull reader from dictionary of readers.</span>
<span class="sd">            If function, treat as a `from_???` reader function.</span>
<span class="sd">        **kw : dict,  (optional)</span>
<span class="sd">            Additional keywords will be passed on to the reader.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># make sure we&#39;re dealing with a real filename</span>
        <span class="k">assert</span> <span class="n">filepath</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>

        <span class="c1"># pick the appropriate reader</span>
        <span class="n">reader</span> <span class="o">=</span> <span class="n">guess_reader</span><span class="p">(</span><span class="n">filepath</span><span class="o">=</span><span class="n">filepath</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="nb">format</span><span class="p">)</span>
        <span class="n">reader</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filepath</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>

        <span class="c1"># validate that something reasonable got populated</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_core_dictionaries</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_uncertainties</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_guess_wscale</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_guess_tscale</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_create_copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a copy of self, with the core dictionaries copied.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">new</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)()</span>
        <span class="n">new</span><span class="o">.</span><span class="n">_initialize_from_dictionaries</span><span class="p">(</span>
            <span class="o">**</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_core_dictionaries</span><span class="p">())</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">new</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_guess_wscale</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">relative_tolerance</span><span class="o">=</span><span class="mf">0.05</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Try to guess the wscale from the wavelengths.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        relative_tolerance : float</span>
<span class="sd">            The fractional difference to which the differences</span>
<span class="sd">            between wavelengths should match in order for a</span>
<span class="sd">            linear or logarithmic wavelength scale to be</span>
<span class="sd">            assigned. For example, the default value of 0.01</span>
<span class="sd">            means that the differences between all wavelength</span>
<span class="sd">            must be within 1% of each other for the wavelength</span>
<span class="sd">            scale to be called linear.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>

            <span class="c1"># give up if there&#39;s no wavelength array</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">wavelength</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="s2">&quot;?&quot;</span>

            <span class="c1"># calculate difference arrays</span>
            <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wavelength</span><span class="o">.</span><span class="n">value</span>
            <span class="n">dw</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>
            <span class="n">dlogw</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">w</span><span class="p">))</span>

            <span class="c1"># test the three options</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">dw</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">dw</span><span class="p">),</span> <span class="n">rtol</span><span class="o">=</span><span class="n">relative_tolerance</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;wscale&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;linear&quot;</span>
            <span class="k">elif</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">dlogw</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">dlogw</span><span class="p">),</span> <span class="n">rtol</span><span class="o">=</span><span class="n">relative_tolerance</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;wscale&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;log&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;wscale&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;?&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_guess_tscale</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">relative_tolerance</span><span class="o">=</span><span class="mf">0.05</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Try to guess the tscale from the times.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        relative_tolerance : float</span>
<span class="sd">            The fractional difference to which the differences</span>
<span class="sd">            between times should match in order for us to call</span>
<span class="sd">            the times effectively uniform, or for us to treat</span>
<span class="sd">            them more carefully as an irregular or gappy grid.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>

            <span class="c1"># give up if there&#39;s no time array</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="s2">&quot;?&quot;</span>

            <span class="c1"># calculate difference arrays</span>
            <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">value</span>
            <span class="n">dt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
            <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
                <span class="c1"># (don&#39;t complain about negative time)</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>
                <span class="n">dlogt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>

            <span class="c1"># test the three options</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">dt</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">dt</span><span class="p">),</span> <span class="n">rtol</span><span class="o">=</span><span class="n">relative_tolerance</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;tscale&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;linear&quot;</span>
            <span class="c1"># elif np.allclose(dlogt, np.median(dlogt), rtol=relative_tolerance):</span>
            <span class="c1">#    self.metadata[&quot;tscale&quot;] = &quot;log&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;tscale&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;?&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The name of this `Rainbow` object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">wavelength</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The 1D array of wavelengths (with astropy units of length).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">wavelike</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;wavelength&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">time</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The 1D array of time (with astropy units of time).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">timelike</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">flux</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The 2D array of fluxes (row = wavelength, col = time).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fluxlike</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;flux&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">uncertainty</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The 2D array of uncertainties on the fluxes.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fluxlike</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;uncertainty&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">ok</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The 2D array of whether data is OK (row = wavelength, col = time).</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># assemble from three possible arrays</span>
        <span class="n">ok</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fluxlike</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;ok&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">))</span>
        <span class="n">ok</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">ok</span>
            <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">wavelike</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;ok&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nwave</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">))[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="n">ok</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">ok</span>
            <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">timelike</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;ok&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ntime</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">))[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="p">:]</span>
        <span class="p">)</span>

        <span class="c1"># make sure flux is finite</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">flux</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ok</span> <span class="o">=</span> <span class="n">ok</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="p">)</span>

        <span class="c1"># weird kludge to deal with rounding errors (particularly in two-step .bin)</span>
        <span class="k">if</span> <span class="n">ok</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="nb">bool</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ok</span>
        <span class="k">elif</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">((</span><span class="n">ok</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">ok</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)):</span>
            <span class="k">return</span> <span class="n">ok</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">ok</span><span class="p">,</span> <span class="n">decimals</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_time_label</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;time_label&quot;</span><span class="p">,</span> <span class="s2">&quot;Time&quot;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_wave_label</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;wave_label&quot;</span><span class="p">,</span> <span class="s2">&quot;Wavelength&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        If an attribute/method isn&#39;t explicitly defined,</span>
<span class="sd">        try to pull it from one of the core dictionaries.</span>

<span class="sd">        Let&#39;s say you want to get the 2D uncertainty array</span>
<span class="sd">        but don&#39;t want to type `self.fluxlike[&#39;uncertainty&#39;]`.</span>
<span class="sd">        You could instead type `self.uncertainty`, and this</span>
<span class="sd">        would try to search through the four standard</span>
<span class="sd">        dictionaries to pull out the first `uncertainty`</span>
<span class="sd">        it finds.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        key : str</span>
<span class="sd">            The attribute we&#39;re trying to get.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_core_dictionaries</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">dictionary_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_core_dictionaries</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">dictionary_name</span><span class="p">][</span><span class="n">key</span><span class="p">]</span>
                <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                    <span class="k">pass</span>
        <span class="n">message</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;🌈.</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2"> does not exist for this Rainbow&quot;</span>
        <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        When setting a new attribute, try to sort it into the</span>
<span class="sd">        appropriate core directory based on its size.</span>

<span class="sd">        Let&#39;s say you have some quantity that has the same</span>
<span class="sd">        shape as the wavelength array and you&#39;d like to attach</span>
<span class="sd">        it to this Rainbow object. This will try to save it</span>
<span class="sd">        in the most relevant core dictionary (of the choices</span>
<span class="sd">        timelike, wavelike, fluxlike).</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        key : str</span>
<span class="sd">            The attribute we&#39;re trying to get.</span>
<span class="sd">        value : array</span>
<span class="sd">            The quantity we&#39;re trying to attach to that name.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_core_dictionaries</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Trying to set a core dictionary.&quot;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;wavelength&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">wavelike</span><span class="p">[</span><span class="s2">&quot;wavelength&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span> <span class="o">*</span> <span class="mi">1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_validate_core_dictionaries</span><span class="p">()</span>
            <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;time&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">timelike</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span> <span class="o">*</span> <span class="mi">1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_validate_core_dictionaries</span><span class="p">()</span>
            <span class="k">elif</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;flux&quot;</span><span class="p">,</span> <span class="s2">&quot;uncertainty&quot;</span><span class="p">,</span> <span class="s2">&quot;ok&quot;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fluxlike</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span> <span class="o">*</span> <span class="mi">1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_validate_core_dictionaries</span><span class="p">()</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_put_array_in_right_dictionary</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">AttributeError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_nametag</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This short phrase will preface everything</span>
<span class="sd">        said with `self.speak()`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;🌈(</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">nwave</span><span class="si">}</span><span class="s2">w, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ntime</span><span class="si">}</span><span class="s2">t)&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">shape</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The shape of the flux array (nwave, ntime).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nwave</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ntime</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">nwave</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The number of wavelengths.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">wavelength</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wavelength</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">ntime</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The number of times.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">dt</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The typical timestep.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmedian</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">minute</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">nflux</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The total number of fluxes.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_validate_core_dictionaries</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Do some simple checks to make sure this Rainbow</span>
<span class="sd">        is populated with the minimal data needed to do anything.</span>
<span class="sd">        It shouldn&#39;t be run before the Rainbow is fully</span>
<span class="sd">        initialized; otherwise, it might complain about</span>
<span class="sd">        a half-populated object.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># make sure there are some times + wavelengths defined</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ntime</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">cheerfully_suggest</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            No times are defined for this Rainbow.</span>
<span class="s2">            &quot;&quot;&quot;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nwave</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">cheerfully_suggest</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            No wavelengths are defined for this Rainbow.</span>
<span class="s2">            &quot;&quot;&quot;</span>
            <span class="p">)</span>

        <span class="c1"># warn if the times and wavelengths are the same size</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nwave</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">ntime</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ntime</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ntime</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">cheerfully_suggest</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            The number of wavelengths (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">nwave</span><span class="si">}</span><span class="s2">) is the same as the</span>
<span class="s2">            number of times (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ntime</span><span class="si">}</span><span class="s2">). This is fine, we suppose</span>
<span class="s2">            (&lt;mock exasperated sigh&gt;), but here are few reasons you might</span>
<span class="s2">            want to reconsider letting them have the same size:</span>
<span class="s2">                (1) Mathemetical operations and variabile assignment</span>
<span class="s2">                    inside this Rainbow make guesses about whether a quantity</span>
<span class="s2">                    is wavelike or timelike based on its shape; these features</span>
<span class="s2">                    will fail (or even worse do something mysterious) if</span>
<span class="s2">                    there are the same numbers of wavelengths and times.</span>
<span class="s2">                (2) For your own darn sake, if your fluxlike arrays are</span>
<span class="s2">                    all square, it&#39;s going to be very easy for you to accidentally</span>
<span class="s2">                    transpose them and not realize it.</span>
<span class="s2">                (3) It&#39;s very unlikely that your real data had exactly the same</span>
<span class="s2">                    number of times and wavelengths, so we&#39;re guessing that you</span>
<span class="s2">                    probably just created these arrays from scratch, which</span>
<span class="s2">                    hopefully means it&#39;s not too annoying to just make them</span>
<span class="s2">                    have different numbers of wavelengths and times.</span>
<span class="s2">            Thanks!</span>
<span class="s2">            &quot;&quot;&quot;</span>
            <span class="p">)</span>

        <span class="c1"># does the flux have the right shape?</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="p">):</span>
            <span class="n">message</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            Something doesn&#39;t line up!</span>
<span class="s2">            The flux array has a shape of </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="p">)</span><span class="si">}</span><span class="s2">.</span>
<span class="s2">            The wavelength array has </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">nwave</span><span class="si">}</span><span class="s2"> wavelengths.</span>
<span class="s2">            The time array has </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ntime</span><span class="si">}</span><span class="s2"> times.</span>
<span class="s2">            &quot;&quot;&quot;</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">cheerfully_suggest</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span><span class="si">{</span><span class="n">message</span><span class="si">}</span>
<span class="s2">                    Any chance your flux array is transposed?</span>
<span class="s2">                    &quot;&quot;&quot;</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cheerfully_suggest</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;uncertainty&quot;</span><span class="p">,</span> <span class="s2">&quot;ok&quot;</span><span class="p">]:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="p">):</span>
                    <span class="n">message</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                    Watch out! The &#39;</span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">&#39; array has</span>
<span class="s2">                    a shape of </span><span class="si">{</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">, which doesn&#39;t match the</span>
<span class="s2">                    flux array&#39;s shape of </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="p">)</span><span class="si">}</span><span class="s2">.</span>
<span class="s2">                    &quot;&quot;&quot;</span>
                    <span class="n">cheerfully_suggest</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>

        <span class="c1"># make sure 2D arrays are uniquely named from 1D</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fluxlike</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">wavelike</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">timelike</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fluxlike</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">_2d&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fluxlike</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>

        <span class="k">if</span> <span class="s2">&quot;ok&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fluxlike</span><span class="p">:</span>
            <span class="n">is_nan</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fluxlike</span><span class="p">[</span><span class="s2">&quot;flux&quot;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fluxlike</span><span class="p">[</span><span class="s2">&quot;ok&quot;</span><span class="p">][</span><span class="n">is_nan</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># make sure no arrays are accidentally pointed to each other</span>
        <span class="c1"># (if they are, sorting will get really messed up!)</span>
        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;fluxlike&quot;</span><span class="p">,</span> <span class="s2">&quot;wavelike&quot;</span><span class="p">,</span> <span class="s2">&quot;timelike&quot;</span><span class="p">]:</span>
            <span class="n">core_dictionary</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">k1</span><span class="p">,</span> <span class="n">v1</span> <span class="ow">in</span> <span class="n">core_dictionary</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">for</span> <span class="n">k2</span><span class="p">,</span> <span class="n">v2</span> <span class="ow">in</span> <span class="n">core_dictionary</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">k1</span> <span class="o">!=</span> <span class="n">k2</span><span class="p">:</span>
                        <span class="k">assert</span> <span class="n">v1</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">v2</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_sort</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_make_sure_wavelength_edges_are_defined</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Make sure there are some wavelength edges defined.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nwave</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="p">(</span><span class="s2">&quot;wavelength_lower&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">wavelike</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span>
            <span class="s2">&quot;wavelength_upper&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">wavelike</span>
        <span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;wscale&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;log&quot;</span><span class="p">:</span>
                <span class="n">l</span><span class="p">,</span> <span class="n">u</span> <span class="o">=</span> <span class="n">calculate_bin_leftright</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wavelength</span><span class="o">.</span><span class="n">value</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">wavelike</span><span class="p">[</span><span class="s2">&quot;wavelength_lower&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">wavelength</span><span class="o">.</span><span class="n">unit</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">wavelike</span><span class="p">[</span><span class="s2">&quot;wavelength_upper&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">u</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">wavelength</span><span class="o">.</span><span class="n">unit</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;wscale&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;linear&quot;</span><span class="p">:</span>
                <span class="n">l</span><span class="p">,</span> <span class="n">u</span> <span class="o">=</span> <span class="n">calculate_bin_leftright</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wavelength</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">wavelike</span><span class="p">[</span><span class="s2">&quot;wavelength_lower&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">l</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">wavelike</span><span class="p">[</span><span class="s2">&quot;wavelength_upper&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">u</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">l</span><span class="p">,</span> <span class="n">u</span> <span class="o">=</span> <span class="n">calculate_bin_leftright</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wavelength</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">wavelike</span><span class="p">[</span><span class="s2">&quot;wavelength_lower&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">l</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">wavelike</span><span class="p">[</span><span class="s2">&quot;wavelength_upper&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">u</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_make_sure_time_edges_are_defined</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">redo</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Make sure there are some time edges defined.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ntime</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="p">(</span><span class="s2">&quot;time_lower&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">timelike</span><span class="p">)</span>
            <span class="ow">or</span> <span class="p">(</span><span class="s2">&quot;time_upper&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">timelike</span><span class="p">)</span>
            <span class="ow">or</span> <span class="n">redo</span>
        <span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;tscale&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;log&quot;</span><span class="p">:</span>
                <span class="n">lower</span><span class="p">,</span> <span class="n">upper</span> <span class="o">=</span> <span class="n">calculate_bin_leftright</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">value</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">timelike</span><span class="p">[</span><span class="s2">&quot;time_lower&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">lower</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">unit</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">timelike</span><span class="p">[</span><span class="s2">&quot;time_upper&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">upper</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">unit</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">lower</span><span class="p">,</span> <span class="n">upper</span> <span class="o">=</span> <span class="n">calculate_bin_leftright</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">timelike</span><span class="p">[</span><span class="s2">&quot;time_lower&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">lower</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">timelike</span><span class="p">[</span><span class="s2">&quot;time_upper&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">upper</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Trim a rainbow by indexing, slicing, or masking.</span>
<span class="sd">        Two indices must be provided (`[:,:]`).</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        ```</span>
<span class="sd">        r[:,:]</span>
<span class="sd">        r[10:20, :]</span>
<span class="sd">        r[np.arange(10,20), :]</span>
<span class="sd">        r[r.wavelength &gt; 1*u.micron, :]</span>
<span class="sd">        r[:, np.abs(r.time) &lt; 1*u.hour]</span>
<span class="sd">        r[r.wavelength &gt; 1*u.micron, np.abs(r.time) &lt; 1*u.hour]</span>
<span class="sd">        ```</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        key : tuple</span>
<span class="sd">            The (wavelength, time) slices, indices, or masks.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">i_wavelength</span><span class="p">,</span> <span class="n">i_time</span> <span class="o">=</span> <span class="n">key</span>
        <span class="c1"># create a history entry for this action (before other variables are defined)</span>
        <span class="n">h</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_history_entry</span><span class="p">(</span><span class="s2">&quot;__getitem__&quot;</span><span class="p">,</span> <span class="nb">locals</span><span class="p">())</span>

        <span class="c1"># create a copy</span>
        <span class="n">new</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_copy</span><span class="p">()</span>

        <span class="c1"># make sure we don&#39;t drop down to 1D arrays</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">i_wavelength</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">i_wavelength</span> <span class="o">=</span> <span class="p">[</span><span class="n">i_wavelength</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">i_time</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">i_time</span> <span class="o">=</span> <span class="p">[</span><span class="n">i_time</span><span class="p">]</span>

        <span class="c1"># do indexing of wavelike</span>
        <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">wavelike</span><span class="p">:</span>
            <span class="n">new</span><span class="o">.</span><span class="n">wavelike</span><span class="p">[</span><span class="n">w</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wavelike</span><span class="p">[</span><span class="n">w</span><span class="p">][</span><span class="n">i_wavelength</span><span class="p">]</span>

        <span class="c1"># do indexing of timelike</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">timelike</span><span class="p">:</span>
            <span class="n">new</span><span class="o">.</span><span class="n">timelike</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timelike</span><span class="p">[</span><span class="n">t</span><span class="p">][</span><span class="n">i_time</span><span class="p">]</span>

        <span class="c1"># do indexing of fluxlike</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fluxlike</span><span class="p">:</span>
            <span class="c1"># (indexing step by step seems more stable)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fluxlike</span><span class="p">[</span><span class="n">f</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">temporary</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fluxlike</span><span class="p">[</span><span class="n">f</span><span class="p">][</span><span class="n">i_wavelength</span><span class="p">,</span> <span class="p">:]</span>
            <span class="n">new</span><span class="o">.</span><span class="n">fluxlike</span><span class="p">[</span><span class="n">f</span><span class="p">]</span> <span class="o">=</span> <span class="n">temporary</span><span class="p">[:,</span> <span class="n">i_time</span><span class="p">]</span>

        <span class="c1"># finalize the new rainbow</span>
        <span class="n">new</span><span class="o">.</span><span class="n">_validate_core_dictionaries</span><span class="p">()</span>
        <span class="n">new</span><span class="o">.</span><span class="n">_guess_wscale</span><span class="p">()</span>
        <span class="n">new</span><span class="o">.</span><span class="n">_guess_tscale</span><span class="p">()</span>

        <span class="c1"># append the history entry to the new Rainbow</span>
        <span class="n">new</span><span class="o">.</span><span class="n">_record_history_entry</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">new</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        How should this object be represented as a string?</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;Rainbow&quot;</span><span class="p">,</span> <span class="s2">&quot;🌈&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">n</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;&lt;</span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">(</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">nwave</span><span class="si">}</span><span class="s2">w, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ntime</span><span class="si">}</span><span class="s2">t)&gt;&quot;</span>

    <span class="c1"># import the basic operations for Rainbows</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">.actions.operations</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
        <span class="n">_apply_operation</span><span class="p">,</span>
        <span class="n">_broadcast_to_fluxlike</span><span class="p">,</span>
        <span class="n">_raise_ambiguous_shape_error</span><span class="p">,</span>
        <span class="fm">__add__</span><span class="p">,</span>
        <span class="fm">__sub__</span><span class="p">,</span>
        <span class="fm">__mul__</span><span class="p">,</span>
        <span class="fm">__truediv__</span><span class="p">,</span>
        <span class="fm">__eq__</span><span class="p">,</span>
        <span class="n">diff</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># import other actions that return other Rainbows</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">.actions</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
        <span class="n">normalize</span><span class="p">,</span>
        <span class="n">_is_probably_normalized</span><span class="p">,</span>
        <span class="nb">bin</span><span class="p">,</span>
        <span class="n">bin_in_time</span><span class="p">,</span>
        <span class="n">bin_in_wavelength</span><span class="p">,</span>
        <span class="n">trim</span><span class="p">,</span>
        <span class="n">trim_times</span><span class="p">,</span>
        <span class="n">trim_wavelengths</span><span class="p">,</span>
        <span class="n">shift</span><span class="p">,</span>
        <span class="n">_create_shared_wavelength_axis</span><span class="p">,</span>
        <span class="n">align_wavelengths</span><span class="p">,</span>
        <span class="n">inject_transit</span><span class="p">,</span>
        <span class="n">inject_systematics</span><span class="p">,</span>
        <span class="n">inject_noise</span><span class="p">,</span>
        <span class="n">inject_spectrum</span><span class="p">,</span>
        <span class="n">inject_outliers</span><span class="p">,</span>
        <span class="n">flag_outliers</span><span class="p">,</span>
        <span class="n">fold</span><span class="p">,</span>
        <span class="n">mask_transit</span><span class="p">,</span>
        <span class="n">compare</span><span class="p">,</span>
        <span class="n">get_average_lightcurve_as_rainbow</span><span class="p">,</span>
        <span class="n">get_average_spectrum_as_rainbow</span><span class="p">,</span>
        <span class="n">_create_fake_wavelike_quantity</span><span class="p">,</span>
        <span class="n">_create_fake_timelike_quantity</span><span class="p">,</span>
        <span class="n">_create_fake_fluxlike_quantity</span><span class="p">,</span>
        <span class="n">remove_trends</span><span class="p">,</span>
        <span class="n">attach_model</span><span class="p">,</span>
        <span class="n">inflate_uncertainty</span><span class="p">,</span>
        <span class="n">concatenate_in_time</span><span class="p">,</span>
        <span class="n">concatenate_in_wavelength</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># import summary statistics for each wavelength</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">.get.wavelike</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
        <span class="n">get_average_spectrum</span><span class="p">,</span>
        <span class="n">get_median_spectrum</span><span class="p">,</span>
        <span class="n">get_spectral_resolution</span><span class="p">,</span>
        <span class="n">get_expected_uncertainty</span><span class="p">,</span>
        <span class="n">get_measured_scatter</span><span class="p">,</span>
        <span class="n">get_measured_scatter_in_bins</span><span class="p">,</span>
        <span class="n">get_for_wavelength</span><span class="p">,</span>
        <span class="n">get_ok_data_for_wavelength</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># import summary statistics for each time</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">.get.timelike</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
        <span class="n">get_average_lightcurve</span><span class="p">,</span>
        <span class="n">get_median_lightcurve</span><span class="p">,</span>
        <span class="n">get_for_time</span><span class="p">,</span>
        <span class="n">get_ok_data_for_time</span><span class="p">,</span>
        <span class="n">get_times_as_astropy</span><span class="p">,</span>
        <span class="n">set_times_from_astropy</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># import summary statistics for each time</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">.get.fluxlike</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
        <span class="n">get_ok_data</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># import visualizations that can act on Rainbows</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">.visualizations</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
        <span class="n">paint</span><span class="p">,</span>
        <span class="n">imshow</span><span class="p">,</span>
        <span class="n">pcolormesh</span><span class="p">,</span>
        <span class="n">scatter</span><span class="p">,</span>
        <span class="n">plot_lightcurves</span><span class="p">,</span>
        <span class="n">_setup_animate_lightcurves</span><span class="p">,</span>
        <span class="n">animate_lightcurves</span><span class="p">,</span>
        <span class="n">_setup_animate_spectra</span><span class="p">,</span>
        <span class="n">animate_spectra</span><span class="p">,</span>
        <span class="n">_setup_animated_scatter</span><span class="p">,</span>
        <span class="n">setup_wavelength_colors</span><span class="p">,</span>
        <span class="n">_make_sure_cmap_is_defined</span><span class="p">,</span>
        <span class="n">get_wavelength_color</span><span class="p">,</span>
        <span class="n">paint_quantities</span><span class="p">,</span>
        <span class="n">plot_quantities</span><span class="p">,</span>
        <span class="n">imshow_interact</span><span class="p">,</span>
        <span class="n">plot_spectra</span><span class="p">,</span>
        <span class="n">plot</span><span class="p">,</span>
        <span class="n">plot_histogram</span><span class="p">,</span>
        <span class="n">_scatter_timelike_or_wavelike</span><span class="p">,</span>
        <span class="n">_get_plot_directory</span><span class="p">,</span>
        <span class="n">_label_plot_file</span><span class="p">,</span>
        <span class="n">savefig</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="kn">from</span><span class="w"> </span><span class="nn">.visualizations.wavelike</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
        <span class="n">plot_spectral_resolution</span><span class="p">,</span>
        <span class="n">plot_noise_comparison</span><span class="p">,</span>
        <span class="n">plot_noise_comparison_in_bins</span><span class="p">,</span>
        <span class="n">plot_average_spectrum</span><span class="p">,</span>
        <span class="n">plot_median_spectrum</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="kn">from</span><span class="w"> </span><span class="nn">.visualizations.timelike</span><span class="w"> </span><span class="kn">import</span> <span class="n">plot_average_lightcurve</span><span class="p">,</span> <span class="n">plot_median_lightcurve</span>

    <span class="kn">from</span><span class="w"> </span><span class="nn">.converters</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
        <span class="n">to_nparray</span><span class="p">,</span>
        <span class="n">to_df</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="kn">from</span><span class="w"> </span><span class="nn">.helpers</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
        <span class="n">_setup_history</span><span class="p">,</span>
        <span class="n">_record_history_entry</span><span class="p">,</span>
        <span class="n">_remove_last_history_entry</span><span class="p">,</span>
        <span class="n">_create_history_entry</span><span class="p">,</span>
        <span class="n">history</span><span class="p">,</span>
        <span class="n">help</span><span class="p">,</span>
        <span class="n">save</span><span class="p">,</span>
        <span class="n">get</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h2 id="chromatic.rainbows.rainbow.Rainbow.dt" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">dt</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#chromatic.rainbows.rainbow.Rainbow.dt" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>The typical timestep.</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h2 id="chromatic.rainbows.rainbow.Rainbow.flux" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">flux</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#chromatic.rainbows.rainbow.Rainbow.flux" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>The 2D array of fluxes (row = wavelength, col = time).</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h2 id="chromatic.rainbows.rainbow.Rainbow.name" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">name</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#chromatic.rainbows.rainbow.Rainbow.name" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>The name of this <code>Rainbow</code> object.</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h2 id="chromatic.rainbows.rainbow.Rainbow.nflux" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">nflux</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#chromatic.rainbows.rainbow.Rainbow.nflux" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>The total number of fluxes.</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h2 id="chromatic.rainbows.rainbow.Rainbow.ntime" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">ntime</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#chromatic.rainbows.rainbow.Rainbow.ntime" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>The number of times.</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h2 id="chromatic.rainbows.rainbow.Rainbow.nwave" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">nwave</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#chromatic.rainbows.rainbow.Rainbow.nwave" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>The number of wavelengths.</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h2 id="chromatic.rainbows.rainbow.Rainbow.ok" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">ok</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#chromatic.rainbows.rainbow.Rainbow.ok" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>The 2D array of whether data is OK (row = wavelength, col = time).</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h2 id="chromatic.rainbows.rainbow.Rainbow.shape" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">shape</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#chromatic.rainbows.rainbow.Rainbow.shape" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>The shape of the flux array (nwave, ntime).</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h2 id="chromatic.rainbows.rainbow.Rainbow.time" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">time</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#chromatic.rainbows.rainbow.Rainbow.time" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>The 1D array of time (with astropy units of time).</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h2 id="chromatic.rainbows.rainbow.Rainbow.uncertainty" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">uncertainty</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#chromatic.rainbows.rainbow.Rainbow.uncertainty" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>The 2D array of uncertainties on the fluxes.</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h2 id="chromatic.rainbows.rainbow.Rainbow.wavelength" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">wavelength</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#chromatic.rainbows.rainbow.Rainbow.wavelength" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>The 1D array of wavelengths (with astropy units of length).</p>

    </div>

</div>



<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.rainbow.Rainbow.__getattr__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__getattr__</span><span class="p">(</span><span class="n">key</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.rainbow.Rainbow.__getattr__" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>If an attribute/method isn't explicitly defined,
try to pull it from one of the core dictionaries.</p>
<p>Let's say you want to get the 2D uncertainty array
but don't want to type <code>self.fluxlike['uncertainty']</code>.
You could instead type <code>self.uncertainty</code>, and this
would try to search through the four standard
dictionaries to pull out the first <code>uncertainty</code>
it finds.</p>
<h4 id="chromatic.rainbows.rainbow.Rainbow.__getattr__--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.rainbow.Rainbow.__getattr__--parameters" title="Permanent link">#</a></h4>
<p>key : str
    The attribute we're trying to get.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/rainbows/rainbow.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    If an attribute/method isn&#39;t explicitly defined,</span>
<span class="sd">    try to pull it from one of the core dictionaries.</span>

<span class="sd">    Let&#39;s say you want to get the 2D uncertainty array</span>
<span class="sd">    but don&#39;t want to type `self.fluxlike[&#39;uncertainty&#39;]`.</span>
<span class="sd">    You could instead type `self.uncertainty`, and this</span>
<span class="sd">    would try to search through the four standard</span>
<span class="sd">    dictionaries to pull out the first `uncertainty`</span>
<span class="sd">    it finds.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    key : str</span>
<span class="sd">        The attribute we&#39;re trying to get.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_core_dictionaries</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">dictionary_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_core_dictionaries</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">dictionary_name</span><span class="p">][</span><span class="n">key</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">pass</span>
    <span class="n">message</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;🌈.</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2"> does not exist for this Rainbow&quot;</span>
    <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.rainbow.Rainbow.__getitem__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__getitem__</span><span class="p">(</span><span class="n">key</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.rainbow.Rainbow.__getitem__" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Trim a rainbow by indexing, slicing, or masking.
Two indices must be provided (<code>[:,:]</code>).</p>
<h4 id="chromatic.rainbows.rainbow.Rainbow.__getitem__--examples">Examples<a class="headerlink" href="#chromatic.rainbows.rainbow.Rainbow.__getitem__--examples" title="Permanent link">#</a></h4>
<pre><code>r[:,:]
r[10:20, :]
r[np.arange(10,20), :]
r[r.wavelength &gt; 1*u.micron, :]
r[:, np.abs(r.time) &lt; 1*u.hour]
r[r.wavelength &gt; 1*u.micron, np.abs(r.time) &lt; 1*u.hour]
</code></pre>
<h4 id="chromatic.rainbows.rainbow.Rainbow.__getitem__--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.rainbow.Rainbow.__getitem__--parameters" title="Permanent link">#</a></h4>
<p>key : tuple
    The (wavelength, time) slices, indices, or masks.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/rainbows/rainbow.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">881</span>
<span class="normal">882</span>
<span class="normal">883</span>
<span class="normal">884</span>
<span class="normal">885</span>
<span class="normal">886</span>
<span class="normal">887</span>
<span class="normal">888</span>
<span class="normal">889</span>
<span class="normal">890</span>
<span class="normal">891</span>
<span class="normal">892</span>
<span class="normal">893</span>
<span class="normal">894</span>
<span class="normal">895</span>
<span class="normal">896</span>
<span class="normal">897</span>
<span class="normal">898</span>
<span class="normal">899</span>
<span class="normal">900</span>
<span class="normal">901</span>
<span class="normal">902</span>
<span class="normal">903</span>
<span class="normal">904</span>
<span class="normal">905</span>
<span class="normal">906</span>
<span class="normal">907</span>
<span class="normal">908</span>
<span class="normal">909</span>
<span class="normal">910</span>
<span class="normal">911</span>
<span class="normal">912</span>
<span class="normal">913</span>
<span class="normal">914</span>
<span class="normal">915</span>
<span class="normal">916</span>
<span class="normal">917</span>
<span class="normal">918</span>
<span class="normal">919</span>
<span class="normal">920</span>
<span class="normal">921</span>
<span class="normal">922</span>
<span class="normal">923</span>
<span class="normal">924</span>
<span class="normal">925</span>
<span class="normal">926</span>
<span class="normal">927</span>
<span class="normal">928</span>
<span class="normal">929</span>
<span class="normal">930</span>
<span class="normal">931</span>
<span class="normal">932</span>
<span class="normal">933</span>
<span class="normal">934</span>
<span class="normal">935</span>
<span class="normal">936</span>
<span class="normal">937</span>
<span class="normal">938</span>
<span class="normal">939</span>
<span class="normal">940</span>
<span class="normal">941</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Trim a rainbow by indexing, slicing, or masking.</span>
<span class="sd">    Two indices must be provided (`[:,:]`).</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    ```</span>
<span class="sd">    r[:,:]</span>
<span class="sd">    r[10:20, :]</span>
<span class="sd">    r[np.arange(10,20), :]</span>
<span class="sd">    r[r.wavelength &gt; 1*u.micron, :]</span>
<span class="sd">    r[:, np.abs(r.time) &lt; 1*u.hour]</span>
<span class="sd">    r[r.wavelength &gt; 1*u.micron, np.abs(r.time) &lt; 1*u.hour]</span>
<span class="sd">    ```</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    key : tuple</span>
<span class="sd">        The (wavelength, time) slices, indices, or masks.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">i_wavelength</span><span class="p">,</span> <span class="n">i_time</span> <span class="o">=</span> <span class="n">key</span>
    <span class="c1"># create a history entry for this action (before other variables are defined)</span>
    <span class="n">h</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_history_entry</span><span class="p">(</span><span class="s2">&quot;__getitem__&quot;</span><span class="p">,</span> <span class="nb">locals</span><span class="p">())</span>

    <span class="c1"># create a copy</span>
    <span class="n">new</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_copy</span><span class="p">()</span>

    <span class="c1"># make sure we don&#39;t drop down to 1D arrays</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">i_wavelength</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
        <span class="n">i_wavelength</span> <span class="o">=</span> <span class="p">[</span><span class="n">i_wavelength</span><span class="p">]</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">i_time</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
        <span class="n">i_time</span> <span class="o">=</span> <span class="p">[</span><span class="n">i_time</span><span class="p">]</span>

    <span class="c1"># do indexing of wavelike</span>
    <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">wavelike</span><span class="p">:</span>
        <span class="n">new</span><span class="o">.</span><span class="n">wavelike</span><span class="p">[</span><span class="n">w</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wavelike</span><span class="p">[</span><span class="n">w</span><span class="p">][</span><span class="n">i_wavelength</span><span class="p">]</span>

    <span class="c1"># do indexing of timelike</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">timelike</span><span class="p">:</span>
        <span class="n">new</span><span class="o">.</span><span class="n">timelike</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timelike</span><span class="p">[</span><span class="n">t</span><span class="p">][</span><span class="n">i_time</span><span class="p">]</span>

    <span class="c1"># do indexing of fluxlike</span>
    <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fluxlike</span><span class="p">:</span>
        <span class="c1"># (indexing step by step seems more stable)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fluxlike</span><span class="p">[</span><span class="n">f</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="n">temporary</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fluxlike</span><span class="p">[</span><span class="n">f</span><span class="p">][</span><span class="n">i_wavelength</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">new</span><span class="o">.</span><span class="n">fluxlike</span><span class="p">[</span><span class="n">f</span><span class="p">]</span> <span class="o">=</span> <span class="n">temporary</span><span class="p">[:,</span> <span class="n">i_time</span><span class="p">]</span>

    <span class="c1"># finalize the new rainbow</span>
    <span class="n">new</span><span class="o">.</span><span class="n">_validate_core_dictionaries</span><span class="p">()</span>
    <span class="n">new</span><span class="o">.</span><span class="n">_guess_wscale</span><span class="p">()</span>
    <span class="n">new</span><span class="o">.</span><span class="n">_guess_tscale</span><span class="p">()</span>

    <span class="c1"># append the history entry to the new Rainbow</span>
    <span class="n">new</span><span class="o">.</span><span class="n">_record_history_entry</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">new</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.rainbow.Rainbow.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">filepath</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">wavelength</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">flux</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">uncertainty</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">wavelike</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">timelike</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fluxlike</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.rainbow.Rainbow.__init__" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Initialize a <code>Rainbow</code> object.</p>
<p>The <code>__init__</code> function is called when a new <code>Rainbow</code> is
instantiated as <code>r = Rainbow(some, kinds, of=inputs)</code>.</p>
<p>The options for inputs are flexible, including the possibility
to initialize from a file, from arrays with appropriate units,
from dictionaries with appropriate ingredients, or simply as
an empty object if no arguments are given.</p>
<h4 id="chromatic.rainbows.rainbow.Rainbow.__init__--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.rainbow.Rainbow.__init__--parameters" title="Permanent link">#</a></h4>
<p>filepath : str, optional
    The filepath pointing to the file or group of files
    that should be read.
format : str, optional
    The file format of the file to be read. If None,
    the format will be guessed automatically from the
    filepath.
wavelength : Quantity, optional
    A 1D array of wavelengths, in any unit.
time : Quantity, Time, optional
    A 1D array of times, in any unit.
flux : array, optional
    A 2D array of flux values.
uncertainty : array, optional
    A 2D array of uncertainties, associated with the flux.
wavelike : dict, optional
    A dictionary containing 1D arrays with the same
    shape as the wavelength axis. It must at least
    contain the key 'wavelength', which should have
    astropy units of wavelength associated with it.
timelike : dict, optional
    A dictionary containing 1D arrays with the same
    shape as the time axis. It must at least
    contain the key 'time', which should have
    astropy units of time associated with it.
fluxlike : dict, optional
    A dictionary containing 2D arrays with the shape
    of (nwave, ntime), like flux. It must at least
    contain the key 'flux'.
metadata : dict, optional
    A dictionary containing all other metadata
    associated with the dataset, generally lots of
    individual parameters or comments.
**kw : dict, optional
    Additional keywords will be passed along to
    the function that initializes the rainbow.
    If initializing from arrays (<code>time=</code>, <code>wavelength=</code>,
    ...), these keywords will be interpreted as
    additional arrays that should be sorted by their
    shape into the appropriate dictionary. If
    initializing from files, the keywords will
    be passed on to the reader.</p>
<h4 id="chromatic.rainbows.rainbow.Rainbow.__init__--examples">Examples<a class="headerlink" href="#chromatic.rainbows.rainbow.Rainbow.__init__--examples" title="Permanent link">#</a></h4>
<p>Initialize from a file. While this works, a more robust
solution is probably to use <code>read_rainbow</code>, which will
automatically choose the best of <code>Rainbow</code> and <code>RainbowWithModel</code></p>
<pre><code>r1 = Rainbow('my-neat-file.abc', format='abcdefgh')
</code></pre>
<p>Initalize from arrays. The wavelength and time must have
appropriate units, and the shape of the flux array must
match the size of the wavelength and time arrays. Other
arrays that match the shape of any of these quantities
will be stored in the appropriate location. Other inputs
not matching any of these will be stored as <code>metadata.</code></p>
<pre><code>r2 = Rainbow(
        wavelength=np.linspace(1, 5, 50)*u.micron,
        time=np.linspace(-0.5, 0.5, 100)*u.day,
        flux=np.random.normal(0, 1, (50, 100)),
        some_other_array=np.ones((50,100)),
        some_metadata='wow!'
)
</code></pre>
<p>Initialize from dictionaries. The dictionaries must contain
at least <code>wavelike['wavelength']</code>, <code>timelike['time']</code>, and
<code>fluxlike['flux']</code>, but any other additional inputs can be
provided.</p>
<pre><code>r3 = Rainbow(
        wavelike=dict(wavelength=np.linspace(1, 5, 50)*u.micron),
        timelike=dict(time=np.linspace(-0.5, 0.5, 100)*u.day),
        fluxlike=dict(flux=np.random.normal(0, 1, (50, 100)))
)
</code></pre>


            <details class="quote">
              <summary>Source code in <code>chromatic/rainbows/rainbow.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">filepath</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="nb">format</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">wavelength</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">time</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">flux</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">uncertainty</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">wavelike</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">timelike</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">fluxlike</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">metadata</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kw</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Initialize a `Rainbow` object.</span>

<span class="sd">    The `__init__` function is called when a new `Rainbow` is</span>
<span class="sd">    instantiated as `r = Rainbow(some, kinds, of=inputs)`.</span>

<span class="sd">    The options for inputs are flexible, including the possibility</span>
<span class="sd">    to initialize from a file, from arrays with appropriate units,</span>
<span class="sd">    from dictionaries with appropriate ingredients, or simply as</span>
<span class="sd">    an empty object if no arguments are given.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    filepath : str, optional</span>
<span class="sd">        The filepath pointing to the file or group of files</span>
<span class="sd">        that should be read.</span>
<span class="sd">    format : str, optional</span>
<span class="sd">        The file format of the file to be read. If None,</span>
<span class="sd">        the format will be guessed automatically from the</span>
<span class="sd">        filepath.</span>
<span class="sd">    wavelength : Quantity, optional</span>
<span class="sd">        A 1D array of wavelengths, in any unit.</span>
<span class="sd">    time : Quantity, Time, optional</span>
<span class="sd">        A 1D array of times, in any unit.</span>
<span class="sd">    flux : array, optional</span>
<span class="sd">        A 2D array of flux values.</span>
<span class="sd">    uncertainty : array, optional</span>
<span class="sd">        A 2D array of uncertainties, associated with the flux.</span>
<span class="sd">    wavelike : dict, optional</span>
<span class="sd">        A dictionary containing 1D arrays with the same</span>
<span class="sd">        shape as the wavelength axis. It must at least</span>
<span class="sd">        contain the key &#39;wavelength&#39;, which should have</span>
<span class="sd">        astropy units of wavelength associated with it.</span>
<span class="sd">    timelike : dict, optional</span>
<span class="sd">        A dictionary containing 1D arrays with the same</span>
<span class="sd">        shape as the time axis. It must at least</span>
<span class="sd">        contain the key &#39;time&#39;, which should have</span>
<span class="sd">        astropy units of time associated with it.</span>
<span class="sd">    fluxlike : dict, optional</span>
<span class="sd">        A dictionary containing 2D arrays with the shape</span>
<span class="sd">        of (nwave, ntime), like flux. It must at least</span>
<span class="sd">        contain the key &#39;flux&#39;.</span>
<span class="sd">    metadata : dict, optional</span>
<span class="sd">        A dictionary containing all other metadata</span>
<span class="sd">        associated with the dataset, generally lots of</span>
<span class="sd">        individual parameters or comments.</span>
<span class="sd">    **kw : dict, optional</span>
<span class="sd">        Additional keywords will be passed along to</span>
<span class="sd">        the function that initializes the rainbow.</span>
<span class="sd">        If initializing from arrays (`time=`, `wavelength=`,</span>
<span class="sd">        ...), these keywords will be interpreted as</span>
<span class="sd">        additional arrays that should be sorted by their</span>
<span class="sd">        shape into the appropriate dictionary. If</span>
<span class="sd">        initializing from files, the keywords will</span>
<span class="sd">        be passed on to the reader.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    Initialize from a file. While this works, a more robust</span>
<span class="sd">    solution is probably to use `read_rainbow`, which will</span>
<span class="sd">    automatically choose the best of `Rainbow` and `RainbowWithModel`</span>
<span class="sd">    ```</span>
<span class="sd">    r1 = Rainbow(&#39;my-neat-file.abc&#39;, format=&#39;abcdefgh&#39;)</span>
<span class="sd">    ```</span>

<span class="sd">    Initalize from arrays. The wavelength and time must have</span>
<span class="sd">    appropriate units, and the shape of the flux array must</span>
<span class="sd">    match the size of the wavelength and time arrays. Other</span>
<span class="sd">    arrays that match the shape of any of these quantities</span>
<span class="sd">    will be stored in the appropriate location. Other inputs</span>
<span class="sd">    not matching any of these will be stored as `metadata.`</span>
<span class="sd">    ```</span>
<span class="sd">    r2 = Rainbow(</span>
<span class="sd">            wavelength=np.linspace(1, 5, 50)*u.micron,</span>
<span class="sd">            time=np.linspace(-0.5, 0.5, 100)*u.day,</span>
<span class="sd">            flux=np.random.normal(0, 1, (50, 100)),</span>
<span class="sd">            some_other_array=np.ones((50,100)),</span>
<span class="sd">            some_metadata=&#39;wow!&#39;</span>
<span class="sd">    )</span>
<span class="sd">    ```</span>
<span class="sd">    Initialize from dictionaries. The dictionaries must contain</span>
<span class="sd">    at least `wavelike[&#39;wavelength&#39;]`, `timelike[&#39;time&#39;]`, and</span>
<span class="sd">    `fluxlike[&#39;flux&#39;]`, but any other additional inputs can be</span>
<span class="sd">    provided.</span>
<span class="sd">    ```</span>
<span class="sd">    r3 = Rainbow(</span>
<span class="sd">            wavelike=dict(wavelength=np.linspace(1, 5, 50)*u.micron),</span>
<span class="sd">            timelike=dict(time=np.linspace(-0.5, 0.5, 100)*u.day),</span>
<span class="sd">            fluxlike=dict(flux=np.random.normal(0, 1, (50, 100)))</span>
<span class="sd">    )</span>
<span class="sd">    ```</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># create a history entry for this action (before other variables are defined)</span>
    <span class="n">h</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_history_entry</span><span class="p">(</span><span class="s2">&quot;Rainbow&quot;</span><span class="p">,</span> <span class="nb">locals</span><span class="p">())</span>

    <span class="c1"># metadata are arbitrary types of information we need</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">name</span><span class="p">}</span>

    <span class="c1"># wavelike quanities are 1D arrays with nwave elements</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">wavelike</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># timelike quantities are 1D arrays with ntime elements</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">timelike</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># fluxlike quantities are 2D arrays with nwave x time elements</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">fluxlike</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># try to intialize from the exact dictionaries needed</span>
    <span class="k">if</span> <span class="p">(</span>
        <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">wavelike</span><span class="p">)</span> <span class="o">==</span> <span class="nb">dict</span><span class="p">)</span>
        <span class="ow">and</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">timelike</span><span class="p">)</span> <span class="o">==</span> <span class="nb">dict</span><span class="p">)</span>
        <span class="ow">and</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">fluxlike</span><span class="p">)</span> <span class="o">==</span> <span class="nb">dict</span><span class="p">)</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_initialize_from_dictionaries</span><span class="p">(</span>
            <span class="n">wavelike</span><span class="o">=</span><span class="n">wavelike</span><span class="p">,</span>
            <span class="n">timelike</span><span class="o">=</span><span class="n">timelike</span><span class="p">,</span>
            <span class="n">fluxlike</span><span class="o">=</span><span class="n">fluxlike</span><span class="p">,</span>
            <span class="n">metadata</span><span class="o">=</span><span class="n">metadata</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="c1"># then try to initialize from arrays</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">wavelength</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">time</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">flux</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_initialize_from_arrays</span><span class="p">(</span>
            <span class="n">wavelength</span><span class="o">=</span><span class="n">wavelength</span><span class="p">,</span>
            <span class="n">time</span><span class="o">=</span><span class="n">time</span><span class="p">,</span>
            <span class="n">flux</span><span class="o">=</span><span class="n">flux</span><span class="p">,</span>
            <span class="n">uncertainty</span><span class="o">=</span><span class="n">uncertainty</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kw</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">metadata</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="n">metadata</span><span class="p">)</span>
    <span class="c1"># then try to initialize from a file</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="n">Column</span><span class="p">)):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_initialize_from_file</span><span class="p">(</span><span class="n">filepath</span><span class="o">=</span><span class="n">filepath</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="nb">format</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>

    <span class="c1"># finally, tidy up by guessing the scales</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_guess_wscale</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_guess_tscale</span><span class="p">()</span>

    <span class="c1"># append the history entry to this Rainbow</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_setup_history</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_record_history_entry</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.rainbow.Rainbow.__repr__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__repr__</span><span class="p">()</span></code>

<a href="#chromatic.rainbows.rainbow.Rainbow.__repr__" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>How should this object be represented as a string?</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/rainbows/rainbow.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">943</span>
<span class="normal">944</span>
<span class="normal">945</span>
<span class="normal">946</span>
<span class="normal">947</span>
<span class="normal">948</span>
<span class="normal">949</span>
<span class="normal">950</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    How should this object be represented as a string?</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;Rainbow&quot;</span><span class="p">,</span> <span class="s2">&quot;🌈&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">n</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;&lt;</span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">(</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">nwave</span><span class="si">}</span><span class="s2">w, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ntime</span><span class="si">}</span><span class="s2">t)&gt;&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.rainbow.Rainbow.__setattr__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__setattr__</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.rainbow.Rainbow.__setattr__" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>When setting a new attribute, try to sort it into the
appropriate core directory based on its size.</p>
<p>Let's say you have some quantity that has the same
shape as the wavelength array and you'd like to attach
it to this Rainbow object. This will try to save it
in the most relevant core dictionary (of the choices
timelike, wavelike, fluxlike).</p>
<h4 id="chromatic.rainbows.rainbow.Rainbow.__setattr__--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.rainbow.Rainbow.__setattr__--parameters" title="Permanent link">#</a></h4>
<p>key : str
    The attribute we're trying to get.
value : array
    The quantity we're trying to attach to that name.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/rainbows/rainbow.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    When setting a new attribute, try to sort it into the</span>
<span class="sd">    appropriate core directory based on its size.</span>

<span class="sd">    Let&#39;s say you have some quantity that has the same</span>
<span class="sd">    shape as the wavelength array and you&#39;d like to attach</span>
<span class="sd">    it to this Rainbow object. This will try to save it</span>
<span class="sd">    in the most relevant core dictionary (of the choices</span>
<span class="sd">    timelike, wavelike, fluxlike).</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    key : str</span>
<span class="sd">        The attribute we&#39;re trying to get.</span>
<span class="sd">    value : array</span>
<span class="sd">        The quantity we&#39;re trying to attach to that name.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_core_dictionaries</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Trying to set a core dictionary.&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;wavelength&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wavelike</span><span class="p">[</span><span class="s2">&quot;wavelength&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span> <span class="o">*</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_validate_core_dictionaries</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;time&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">timelike</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span> <span class="o">*</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_validate_core_dictionaries</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;flux&quot;</span><span class="p">,</span> <span class="s2">&quot;uncertainty&quot;</span><span class="p">,</span> <span class="s2">&quot;ok&quot;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fluxlike</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span> <span class="o">*</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_validate_core_dictionaries</span><span class="p">()</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_put_array_in_right_dictionary</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">AttributeError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<a id="chromatic.rainbows.withmodel.RainbowWithModel"></a>
    <div class="doc doc-contents first">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="chromatic.rainbows.rainbow.Rainbow" href="#chromatic.rainbows.rainbow.Rainbow">Rainbow</a></code></p>


        <p><code>RainbowWithModel</code> objects have a fluxlike <code>model</code>
attached to them, meaning that they can</p>
<p>This class definition inherits from <code>Rainbow</code>.</p>







              <details class="quote">
                <summary>Source code in <code>chromatic/rainbows/withmodel.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">  4</span>
<span class="normal">  5</span>
<span class="normal">  6</span>
<span class="normal">  7</span>
<span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">RainbowWithModel</span><span class="p">(</span><span class="n">Rainbow</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    `RainbowWithModel` objects have a fluxlike `model`</span>
<span class="sd">    attached to them, meaning that they can</span>

<span class="sd">    This class definition inherits from `Rainbow`.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># which fluxlike keys will respond to math between objects</span>
    <span class="n">_keys_that_respond_to_math</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;flux&quot;</span><span class="p">,</span> <span class="s2">&quot;model&quot;</span><span class="p">]</span>

    <span class="c1"># which keys get uncertainty weighting during binning</span>
    <span class="n">_keys_that_get_uncertainty_weighting</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;flux&quot;</span><span class="p">,</span> <span class="s2">&quot;model&quot;</span><span class="p">,</span> <span class="s2">&quot;uncertainty&quot;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">residuals</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate the residuals on the fly,</span>
<span class="sd">        to make sure they&#39;re always up to date.</span>

<span class="sd">        The residuals are calculated simply</span>
<span class="sd">        as the `.flux` - `.model`, so they are</span>
<span class="sd">        in whatever units those arrays have.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        residuals : array, Quantity</span>
<span class="sd">            The 2D array of residuals (nwave, ntime).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">flux</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">chi_squared</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate chi-squared.</span>

<span class="sd">        This calculates the sum of the squares of</span>
<span class="sd">        the uncertainty-normalized residuals,</span>
<span class="sd">        sum(((flux - model)/uncertainty)**2)</span>

<span class="sd">        Data points marked as not OK are ignored.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        chi_squared : float</span>
<span class="sd">            The chi-squared value.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">r</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flux</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">uncertainty</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ok</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">residuals_plus_one</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A tiny wrapper to get the residuals + 1.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        residuals_plus_one : array, Quantity</span>
<span class="sd">            The 2D array of residuals + 1 (nwave, ntime).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">flux</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">+</span> <span class="mi">1</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">ones</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate an array of ones that looks like the flux.</span>
<span class="sd">        (A tiny wrapper needed for `plot_with_model`)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ones : array, Quantity</span>
<span class="sd">            The 2D array ones (nwave, ntime).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_validate_core_dictionaries</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_validate_core_dictionaries</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;model&quot;</span><span class="p">)</span>
            <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">model</span><span class="p">)</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="p">)</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">AttributeError</span><span class="p">,</span> <span class="ne">AssertionError</span><span class="p">):</span>
            <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            No fluxlike &#39;model&#39; was found attached to this</span>
<span class="s2">            `RainbowWithModel` object. The poor thing,</span>
<span class="s2">            its name is a lie! Please connect a model.</span>
<span class="s2">            The simplest way to do so might look like...</span>
<span class="s2">            `rainbow.model = np.ones(rainbow.shape)`</span>
<span class="s2">            ...or similarly with a more interesting array.</span>
<span class="s2">            &quot;&quot;&quot;</span>
            <span class="n">cheerfully_suggest</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>

    <span class="kn">from</span><span class="w"> </span><span class="nn">.visualizations</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
        <span class="n">plot_with_model</span><span class="p">,</span>
        <span class="n">plot_with_model_and_residuals</span><span class="p">,</span>
        <span class="n">paint_with_models</span><span class="p">,</span>
        <span class="n">plot_one_wavelength_with_models</span><span class="p">,</span>
        <span class="n">animate_with_models</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h2 id="chromatic.rainbows.withmodel.RainbowWithModel.chi_squared" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">chi_squared</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#chromatic.rainbows.withmodel.RainbowWithModel.chi_squared" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Calculate chi-squared.</p>
<p>This calculates the sum of the squares of
the uncertainty-normalized residuals,
sum(((flux - model)/uncertainty)**2)</p>
<p>Data points marked as not OK are ignored.</p>
<h4 id="chromatic.rainbows.withmodel.RainbowWithModel.chi_squared--returns">Returns<a class="headerlink" href="#chromatic.rainbows.withmodel.RainbowWithModel.chi_squared--returns" title="Permanent link">#</a></h4>
<p>chi_squared : float
    The chi-squared value.</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h2 id="chromatic.rainbows.withmodel.RainbowWithModel.ones" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">ones</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#chromatic.rainbows.withmodel.RainbowWithModel.ones" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Generate an array of ones that looks like the flux.
(A tiny wrapper needed for <code>plot_with_model</code>)</p>
<h4 id="chromatic.rainbows.withmodel.RainbowWithModel.ones--returns">Returns<a class="headerlink" href="#chromatic.rainbows.withmodel.RainbowWithModel.ones--returns" title="Permanent link">#</a></h4>
<p>ones : array, Quantity
    The 2D array ones (nwave, ntime).</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h2 id="chromatic.rainbows.withmodel.RainbowWithModel.residuals" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">residuals</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#chromatic.rainbows.withmodel.RainbowWithModel.residuals" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Calculate the residuals on the fly,
to make sure they're always up to date.</p>
<p>The residuals are calculated simply
as the <code>.flux</code> - <code>.model</code>, so they are
in whatever units those arrays have.</p>
<h4 id="chromatic.rainbows.withmodel.RainbowWithModel.residuals--returns">Returns<a class="headerlink" href="#chromatic.rainbows.withmodel.RainbowWithModel.residuals--returns" title="Permanent link">#</a></h4>
<p>residuals : array, Quantity
    The 2D array of residuals (nwave, ntime).</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h2 id="chromatic.rainbows.withmodel.RainbowWithModel.residuals_plus_one" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">residuals_plus_one</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#chromatic.rainbows.withmodel.RainbowWithModel.residuals_plus_one" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>A tiny wrapper to get the residuals + 1.</p>
<h4 id="chromatic.rainbows.withmodel.RainbowWithModel.residuals_plus_one--returns">Returns<a class="headerlink" href="#chromatic.rainbows.withmodel.RainbowWithModel.residuals_plus_one--returns" title="Permanent link">#</a></h4>
<p>residuals_plus_one : array, Quantity
    The 2D array of residuals + 1 (nwave, ntime).</p>

    </div>

</div>





  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<a id="chromatic.rainbows.simulated.SimulatedRainbow"></a>
    <div class="doc doc-contents first">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="chromatic.rainbows.withmodel.RainbowWithModel" href="#chromatic.rainbows.withmodel.RainbowWithModel">RainbowWithModel</a></code></p>


        <p><code>SimulatedRainbow</code> objects are created from scratch
within <code>chromatic</code>, with options for various different
wavelength grids, time grids, noise sources, and injected
models. They can be useful for generating quick simulated
dataset for testing analysis and visualization tools.</p>
<p>This class definition inherits from <code>RainbowWithModel</code>,
which itself inherits from <code>Rainbow</code>.</p>







              <details class="quote">
                <summary>Source code in <code>chromatic/rainbows/simulated.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">  4</span>
<span class="normal">  5</span>
<span class="normal">  6</span>
<span class="normal">  7</span>
<span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">SimulatedRainbow</span><span class="p">(</span><span class="n">RainbowWithModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    `SimulatedRainbow` objects are created from scratch</span>
<span class="sd">    within `chromatic`, with options for various different</span>
<span class="sd">    wavelength grids, time grids, noise sources, and injected</span>
<span class="sd">    models. They can be useful for generating quick simulated</span>
<span class="sd">    dataset for testing analysis and visualization tools.</span>

<span class="sd">    This class definition inherits from `RainbowWithModel`,</span>
<span class="sd">    which itself inherits from `Rainbow`.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">tlim</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mf">2.5</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">]</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">hour</span><span class="p">,</span>
        <span class="n">dt</span><span class="o">=</span><span class="mi">2</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">minute</span><span class="p">,</span>
        <span class="n">time</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">wlim</span><span class="o">=</span><span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">micron</span><span class="p">,</span>
        <span class="n">R</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
        <span class="n">dw</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">wavelength</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">star_flux</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">signal_to_noise</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize a `SimulatedRainbow` object from some parameters.</span>

<span class="sd">        This sets up an effectively empty `Rainbow` with defined</span>
<span class="sd">        wavelengths and times. For making more interesting</span>
<span class="sd">        simulated datasets, this will often be paired with</span>
<span class="sd">        some combination of the `.inject...` actions that inject</span>
<span class="sd">        various astrophysical, instrumental, or noise signatures</span>
<span class="sd">        into the dataset.</span>

<span class="sd">        The time-setting order of precendence is:</span>
<span class="sd">            1) time</span>
<span class="sd">            2) tlim + dt</span>

<span class="sd">        The wavelength-setting order of precendence is:</span>
<span class="sd">            1) wavelength</span>
<span class="sd">            2) wlim + dw</span>
<span class="sd">            3) wlim + R</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        tlim : list or Quantity</span>
<span class="sd">            The pip install -e &#39;.[develop]&#39;[min, max] times for creating the time grid.</span>
<span class="sd">            These should have astropy units of time.</span>
<span class="sd">        dt : Quantity</span>
<span class="sd">            The d(time) bin size for creating a grid</span>
<span class="sd">            that is uniform in linear space.</span>
<span class="sd">        time : Quantity</span>
<span class="sd">            An array of times, if you just want to give</span>
<span class="sd">            it an entirely custom array.</span>
<span class="sd">        wlim : list or Quantity</span>
<span class="sd">            The [min, max] wavelengths for creating the grid.</span>
<span class="sd">            These should have astropy units of wavelength.</span>
<span class="sd">        R : float</span>
<span class="sd">            The spectral resolution for creating a grid</span>
<span class="sd">            that is uniform in logarithmic space.</span>
<span class="sd">        dw : Quantity</span>
<span class="sd">            The d(wavelength) bin size for creating a grid</span>
<span class="sd">            that is uniform in linear space.</span>
<span class="sd">        wavelength : Quantity</span>
<span class="sd">            An array of wavelengths, if you just want to give</span>
<span class="sd">            it an entirely custom array.</span>
<span class="sd">        star_flux : numpy 1D array</span>
<span class="sd">            An array of fluxes corresponding to the supplied wavelengths.</span>
<span class="sd">            If left blank, the code assumes a normalized flux of</span>
<span class="sd">            flux(wavelength) = 1 for all wavelengths.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Rainbow</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="c1"># (remove the history entry from creating the Rainbow)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_remove_last_history_entry</span><span class="p">()</span>

        <span class="c1"># create a history entry for this action (before other variables are defined)</span>
        <span class="n">h</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_history_entry</span><span class="p">(</span><span class="s2">&quot;SimulatedRainbow&quot;</span><span class="p">,</span> <span class="nb">locals</span><span class="p">())</span>

        <span class="c1"># set up the wavelength grid</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_setup_fake_wavelength_grid</span><span class="p">(</span><span class="n">wlim</span><span class="o">=</span><span class="n">wlim</span><span class="p">,</span> <span class="n">R</span><span class="o">=</span><span class="n">R</span><span class="p">,</span> <span class="n">dw</span><span class="o">=</span><span class="n">dw</span><span class="p">,</span> <span class="n">wavelength</span><span class="o">=</span><span class="n">wavelength</span><span class="p">)</span>

        <span class="c1"># set up the time grid</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_setup_fake_time_grid</span><span class="p">(</span><span class="n">tlim</span><span class="o">=</span><span class="n">tlim</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="n">time</span><span class="p">)</span>

        <span class="c1"># save the basic inputs that aren&#39;t stored elsewhere</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">name</span>

        <span class="c1"># If the flux of the star is not given,</span>
        <span class="c1"># assume a continuum-normlized flux where fx=1 at all wavelengths.</span>
        <span class="k">if</span> <span class="n">star_flux</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">model</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

        <span class="c1"># If the flux vs wavelength of the star is supplied,</span>
        <span class="c1"># include it in the model.</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Check to make sure the flux and wavelengths</span>
            <span class="c1"># have the same shape.</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">star_flux</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wavelike</span><span class="p">[</span><span class="s2">&quot;wavelength&quot;</span><span class="p">]):</span>
                <span class="n">model</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">([</span><span class="n">star_flux</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">star_flux</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">model</span> <span class="o">=</span> <span class="n">star_flux</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

        <span class="c1"># Set uncertainty.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fluxlike</span><span class="p">[</span><span class="s2">&quot;flux&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span> <span class="o">*</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fluxlike</span><span class="p">[</span><span class="s2">&quot;model&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span> <span class="o">*</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fluxlike</span><span class="p">[</span><span class="s2">&quot;uncertainty&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

        <span class="c1"># make sure everything is defined and sorted</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_core_dictionaries</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">signal_to_noise</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">message</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            You tried to specify the noise level with</span>
<span class="s2">            `SimulatedRainbow(signal_to_noise=</span><span class="si">{</span><span class="n">signal_to_noise</span><span class="si">}</span><span class="s2">)`,</span>
<span class="s2">            but that functionality is going away soon.</span>
<span class="s2">            Please replace it right now with</span>
<span class="s2">            `SimulatedRainbow().inject_noise(signal_to_noise=</span><span class="si">{</span><span class="n">signal_to_noise</span><span class="si">}</span><span class="s2">)`</span>
<span class="s2">            so that your code will continue to work.</span>
<span class="s2">            You&#39;re getting away with it this time,</span>
<span class="s2">            but it won&#39;t work for much longer!</span>
<span class="s2">            &quot;&quot;&quot;</span>
            <span class="n">cheerfully_suggest</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
            <span class="n">new</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inject_noise</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;flux&quot;</span><span class="p">,</span> <span class="s2">&quot;uncertainty&quot;</span><span class="p">,</span> <span class="s2">&quot;model&quot;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fluxlike</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">new</span><span class="o">.</span><span class="n">fluxlike</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>

        <span class="c1"># append the history entry to the new Rainbow</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_record_history_entry</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_setup_fake_time_grid</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">tlim</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mf">2.5</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">hour</span><span class="p">,</span> <span class="mf">2.5</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">hour</span><span class="p">],</span> <span class="n">dt</span><span class="o">=</span><span class="mi">1</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">minute</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a fake time grid.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        tlim : list or Quantity</span>
<span class="sd">            The [min, max] times for creating the time grid.</span>
<span class="sd">            These should have astropy units of time.</span>
<span class="sd">        dt : Quantity</span>
<span class="sd">            The d(time) bin size for creating a grid</span>
<span class="sd">            that is uniform in linear space.</span>
<span class="sd">        time : Quantity</span>
<span class="sd">            An array of times, if you just want to give</span>
<span class="sd">            it an entirely custom array.</span>

<span class="sd">        The time-setting order of precendence is:</span>
<span class="sd">            1) time</span>
<span class="sd">            2) tlim + dt</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># check we&#39;re trying to do exactly one thing</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">tlim</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">time</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Please specify either `tlim` or `time`.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">time</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">t_unit</span> <span class="o">=</span> <span class="n">tlim</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">unit</span>
            <span class="n">t_unit</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s2">&quot;s&quot;</span><span class="p">)</span>
            <span class="n">time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">tlim</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">t_unit</span><span class="p">,</span> <span class="n">tlim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">t_unit</span><span class="p">,</span> <span class="n">dt</span> <span class="o">/</span> <span class="n">t_unit</span><span class="p">)</span> <span class="o">*</span> <span class="n">t_unit</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">t_unit</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">unit</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">timelike</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">time</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">day</span><span class="p">)</span>
        <span class="c1"># TODO, make this match up better with astropy time</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_guess_tscale</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_setup_fake_wavelength_grid</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">wlim</span><span class="o">=</span><span class="p">[</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">micron</span><span class="p">,</span> <span class="mi">5</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">micron</span><span class="p">],</span> <span class="n">R</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">dw</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">wavelength</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a fake wavelength grid.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        wlim : list or Quantity</span>
<span class="sd">            The [min, max] wavelengths for creating the grid.</span>
<span class="sd">            These should have astropy units of wavelength.</span>
<span class="sd">        R : float</span>
<span class="sd">            The spectral resolution for creating a grid</span>
<span class="sd">            that is uniform in logarithmic space.</span>
<span class="sd">        dw : Quantity</span>
<span class="sd">            The d(wavelength) bin size for creating a grid</span>
<span class="sd">            that is uniform in linear space.</span>
<span class="sd">        wavelength : Quantity</span>
<span class="sd">            An array of wavelengths, if you just want to give</span>
<span class="sd">            it an entirely custom array.</span>

<span class="sd">        The wavelength-setting order of precendence is:</span>
<span class="sd">            1) wavelength</span>
<span class="sd">            2) wlim + dw</span>
<span class="sd">            3) wlim + R</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># check we&#39;re trying to do exactly one thing</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">wlim</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">wavelength</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Please specify either `wlim` or `wavelength`.&quot;</span><span class="p">)</span>

        <span class="c1"># create a linear or logarithmic grid</span>
        <span class="k">if</span> <span class="n">wavelength</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># check that we&#39;re</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">R</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">dw</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Please specify either `R` or `dw`.&quot;</span><span class="p">)</span>

            <span class="n">w_unit</span> <span class="o">=</span> <span class="n">wlim</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">unit</span>
            <span class="k">if</span> <span class="n">dw</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;R&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">R</span>
                <span class="c1"># self.metadata[&quot;wscale&quot;] = &quot;log&quot;</span>

                <span class="n">logw_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">wlim</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">w_unit</span><span class="p">)</span>
                <span class="n">logw_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">wlim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">w_unit</span><span class="p">)</span>
                <span class="n">logw</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">logw_min</span><span class="p">,</span> <span class="n">logw_max</span><span class="p">,</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">R</span><span class="p">)</span>
                <span class="n">wavelength</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">logw</span><span class="p">)</span> <span class="o">*</span> <span class="n">w_unit</span>

            <span class="k">elif</span> <span class="n">dw</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;dw&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dw</span>
                <span class="c1"># self.metadata[&quot;wscale&quot;] = &quot;linear&quot;</span>
                <span class="n">wavelength</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">wlim</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">w_unit</span><span class="p">,</span> <span class="n">wlim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">w_unit</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dw</span> <span class="o">/</span> <span class="n">w_unit</span><span class="p">)</span>
                    <span class="o">*</span> <span class="n">w_unit</span>
                <span class="p">)</span>

        <span class="c1"># or just make sure the wavelength grid has units</span>
        <span class="k">elif</span> <span class="n">wavelength</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">w_unit</span> <span class="o">=</span> <span class="n">wavelength</span><span class="o">.</span><span class="n">unit</span>

        <span class="c1"># make sure the wavelength array has units</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wavelike</span><span class="p">[</span><span class="s2">&quot;wavelength&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">wavelength</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">micron</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_guess_wscale</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.simulated.SimulatedRainbow.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">tlim</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mf">2.5</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">]</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">hour</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="mi">2</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">minute</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">wlim</span><span class="o">=</span><span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">micron</span><span class="p">,</span> <span class="n">R</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">dw</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">wavelength</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">star_flux</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">signal_to_noise</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.simulated.SimulatedRainbow.__init__" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Initialize a <code>SimulatedRainbow</code> object from some parameters.</p>
<p>This sets up an effectively empty <code>Rainbow</code> with defined
wavelengths and times. For making more interesting
simulated datasets, this will often be paired with
some combination of the <code>.inject...</code> actions that inject
various astrophysical, instrumental, or noise signatures
into the dataset.</p>


<details class="the-time-setting-order-of-precendence-is" open>
  <summary>The time-setting order of precendence is</summary>
  <p>1) time
2) tlim + dt</p>
</details>

<details class="the-wavelength-setting-order-of-precendence-is" open>
  <summary>The wavelength-setting order of precendence is</summary>
  <p>1) wavelength
2) wlim + dw
3) wlim + R</p>
</details>        <h4 id="chromatic.rainbows.simulated.SimulatedRainbow.__init__--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.simulated.SimulatedRainbow.__init__--parameters" title="Permanent link">#</a></h4>
<p>tlim : list or Quantity
    The pip install -e '.[develop]'[min, max] times for creating the time grid.
    These should have astropy units of time.
dt : Quantity
    The d(time) bin size for creating a grid
    that is uniform in linear space.
time : Quantity
    An array of times, if you just want to give
    it an entirely custom array.
wlim : list or Quantity
    The [min, max] wavelengths for creating the grid.
    These should have astropy units of wavelength.
R : float
    The spectral resolution for creating a grid
    that is uniform in logarithmic space.
dw : Quantity
    The d(wavelength) bin size for creating a grid
    that is uniform in linear space.
wavelength : Quantity
    An array of wavelengths, if you just want to give
    it an entirely custom array.
star_flux : numpy 1D array
    An array of fluxes corresponding to the supplied wavelengths.
    If left blank, the code assumes a normalized flux of
    flux(wavelength) = 1 for all wavelengths.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/rainbows/simulated.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">tlim</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mf">2.5</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">]</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">hour</span><span class="p">,</span>
    <span class="n">dt</span><span class="o">=</span><span class="mi">2</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">minute</span><span class="p">,</span>
    <span class="n">time</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">wlim</span><span class="o">=</span><span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">micron</span><span class="p">,</span>
    <span class="n">R</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
    <span class="n">dw</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">wavelength</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">star_flux</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">signal_to_noise</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Initialize a `SimulatedRainbow` object from some parameters.</span>

<span class="sd">    This sets up an effectively empty `Rainbow` with defined</span>
<span class="sd">    wavelengths and times. For making more interesting</span>
<span class="sd">    simulated datasets, this will often be paired with</span>
<span class="sd">    some combination of the `.inject...` actions that inject</span>
<span class="sd">    various astrophysical, instrumental, or noise signatures</span>
<span class="sd">    into the dataset.</span>

<span class="sd">    The time-setting order of precendence is:</span>
<span class="sd">        1) time</span>
<span class="sd">        2) tlim + dt</span>

<span class="sd">    The wavelength-setting order of precendence is:</span>
<span class="sd">        1) wavelength</span>
<span class="sd">        2) wlim + dw</span>
<span class="sd">        3) wlim + R</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    tlim : list or Quantity</span>
<span class="sd">        The pip install -e &#39;.[develop]&#39;[min, max] times for creating the time grid.</span>
<span class="sd">        These should have astropy units of time.</span>
<span class="sd">    dt : Quantity</span>
<span class="sd">        The d(time) bin size for creating a grid</span>
<span class="sd">        that is uniform in linear space.</span>
<span class="sd">    time : Quantity</span>
<span class="sd">        An array of times, if you just want to give</span>
<span class="sd">        it an entirely custom array.</span>
<span class="sd">    wlim : list or Quantity</span>
<span class="sd">        The [min, max] wavelengths for creating the grid.</span>
<span class="sd">        These should have astropy units of wavelength.</span>
<span class="sd">    R : float</span>
<span class="sd">        The spectral resolution for creating a grid</span>
<span class="sd">        that is uniform in logarithmic space.</span>
<span class="sd">    dw : Quantity</span>
<span class="sd">        The d(wavelength) bin size for creating a grid</span>
<span class="sd">        that is uniform in linear space.</span>
<span class="sd">    wavelength : Quantity</span>
<span class="sd">        An array of wavelengths, if you just want to give</span>
<span class="sd">        it an entirely custom array.</span>
<span class="sd">    star_flux : numpy 1D array</span>
<span class="sd">        An array of fluxes corresponding to the supplied wavelengths.</span>
<span class="sd">        If left blank, the code assumes a normalized flux of</span>
<span class="sd">        flux(wavelength) = 1 for all wavelengths.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">Rainbow</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="c1"># (remove the history entry from creating the Rainbow)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_remove_last_history_entry</span><span class="p">()</span>

    <span class="c1"># create a history entry for this action (before other variables are defined)</span>
    <span class="n">h</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_history_entry</span><span class="p">(</span><span class="s2">&quot;SimulatedRainbow&quot;</span><span class="p">,</span> <span class="nb">locals</span><span class="p">())</span>

    <span class="c1"># set up the wavelength grid</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_setup_fake_wavelength_grid</span><span class="p">(</span><span class="n">wlim</span><span class="o">=</span><span class="n">wlim</span><span class="p">,</span> <span class="n">R</span><span class="o">=</span><span class="n">R</span><span class="p">,</span> <span class="n">dw</span><span class="o">=</span><span class="n">dw</span><span class="p">,</span> <span class="n">wavelength</span><span class="o">=</span><span class="n">wavelength</span><span class="p">)</span>

    <span class="c1"># set up the time grid</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_setup_fake_time_grid</span><span class="p">(</span><span class="n">tlim</span><span class="o">=</span><span class="n">tlim</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="n">time</span><span class="p">)</span>

    <span class="c1"># save the basic inputs that aren&#39;t stored elsewhere</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">name</span>

    <span class="c1"># If the flux of the star is not given,</span>
    <span class="c1"># assume a continuum-normlized flux where fx=1 at all wavelengths.</span>
    <span class="k">if</span> <span class="n">star_flux</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

    <span class="c1"># If the flux vs wavelength of the star is supplied,</span>
    <span class="c1"># include it in the model.</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Check to make sure the flux and wavelengths</span>
        <span class="c1"># have the same shape.</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">star_flux</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wavelike</span><span class="p">[</span><span class="s2">&quot;wavelength&quot;</span><span class="p">]):</span>
            <span class="n">model</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">([</span><span class="n">star_flux</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">star_flux</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">model</span> <span class="o">=</span> <span class="n">star_flux</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

    <span class="c1"># Set uncertainty.</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">fluxlike</span><span class="p">[</span><span class="s2">&quot;flux&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span> <span class="o">*</span> <span class="mi">1</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">fluxlike</span><span class="p">[</span><span class="s2">&quot;model&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span> <span class="o">*</span> <span class="mi">1</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">fluxlike</span><span class="p">[</span><span class="s2">&quot;uncertainty&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

    <span class="c1"># make sure everything is defined and sorted</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_validate_core_dictionaries</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">signal_to_noise</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">message</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        You tried to specify the noise level with</span>
<span class="s2">        `SimulatedRainbow(signal_to_noise=</span><span class="si">{</span><span class="n">signal_to_noise</span><span class="si">}</span><span class="s2">)`,</span>
<span class="s2">        but that functionality is going away soon.</span>
<span class="s2">        Please replace it right now with</span>
<span class="s2">        `SimulatedRainbow().inject_noise(signal_to_noise=</span><span class="si">{</span><span class="n">signal_to_noise</span><span class="si">}</span><span class="s2">)`</span>
<span class="s2">        so that your code will continue to work.</span>
<span class="s2">        You&#39;re getting away with it this time,</span>
<span class="s2">        but it won&#39;t work for much longer!</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="n">cheerfully_suggest</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
        <span class="n">new</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inject_noise</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;flux&quot;</span><span class="p">,</span> <span class="s2">&quot;uncertainty&quot;</span><span class="p">,</span> <span class="s2">&quot;model&quot;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fluxlike</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">new</span><span class="o">.</span><span class="n">fluxlike</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>

    <span class="c1"># append the history entry to the new Rainbow</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_record_history_entry</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><h2 id="helpers">🌈 Helpers<a class="headerlink" href="#helpers" title="Permanent link">#</a></h2>


<div class="doc doc-object doc-function">



<a id="chromatic.rainbows.helpers.get"></a>
    <div class="doc doc-contents first">

        <p>Retrieve an attribute by its string name.
(This is a friendlier wrapper for <code>getattr()</code>).</p>
<p><code>r.get('flux')</code> is identical to <code>r.flux</code></p>
<p>This is different from indexing directly into
a core dictionary (for example, <code>r.fluxlike['flux']</code>),
because it can also be used to get the results of
properties that do calculations on the fly (for example,
<code>r.residuals</code> in the <code>RainbowWithModel</code> class).</p>
<h3 id="chromatic.rainbows.helpers.get--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.helpers.get--parameters" title="Permanent link">#</a></h3>
<p>key : str
    The name of the attribute, property, or core dictionary item to get.
default : any, optional
    What to return if the attribute can't be found.</p>
<h3 id="chromatic.rainbows.helpers.get--returns">Returns<a class="headerlink" href="#chromatic.rainbows.helpers.get--returns" title="Permanent link">#</a></h3>
<p>thing : any
    The thing you were trying to get. If unavailable,
    return the <code>default</code> (which by default is <code>None</code>)</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/rainbows/helpers/get.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Retrieve an attribute by its string name.</span>
<span class="sd">    (This is a friendlier wrapper for `getattr()`).</span>

<span class="sd">    `r.get(&#39;flux&#39;)` is identical to `r.flux`</span>

<span class="sd">    This is different from indexing directly into</span>
<span class="sd">    a core dictionary (for example, `r.fluxlike[&#39;flux&#39;]`),</span>
<span class="sd">    because it can also be used to get the results of</span>
<span class="sd">    properties that do calculations on the fly (for example,</span>
<span class="sd">    `r.residuals` in the `RainbowWithModel` class).</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    key : str</span>
<span class="sd">        The name of the attribute, property, or core dictionary item to get.</span>
<span class="sd">    default : any, optional</span>
<span class="sd">        What to return if the attribute can&#39;t be found.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    thing : any</span>
<span class="sd">        The thing you were trying to get. If unavailable,</span>
<span class="sd">        return the `default` (which by default is `None`)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">default</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">



<a id="chromatic.rainbows.helpers.help"></a>
    <div class="doc doc-contents first">

        <p>Print a quick reference of key actions available for this <code>Rainbow</code>.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/rainbows/helpers/help.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">help</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Print a quick reference of key actions available for this `Rainbow`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span>
        <span class="n">textwrap</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Hooray for you! You asked for help on what you can do</span>
<span class="sd">    with this 🌈 object. Here&#39;s a quick reference of a few</span>
<span class="sd">    available options for things to try.&quot;&quot;&quot;</span>
        <span class="p">)</span>
    <span class="p">)</span>

    <span class="n">base_directory</span> <span class="o">=</span> <span class="n">pkg_resources</span><span class="o">.</span><span class="n">resource_filename</span><span class="p">(</span><span class="s2">&quot;chromatic&quot;</span><span class="p">,</span> <span class="s2">&quot;rainbows&quot;</span><span class="p">)</span>
    <span class="n">descriptions_files</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">level</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="s2">&quot;*/*&quot;</span><span class="p">]:</span>
        <span class="n">descriptions_files</span> <span class="o">+=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">base_directory</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="s2">&quot;descriptions.txt&quot;</span><span class="p">)</span>
        <span class="p">)</span>
    <span class="n">categories</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">d</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">base_directory</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;/descriptions.txt&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">descriptions_files</span>
    <span class="p">]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">categories</span><span class="p">):</span>
        <span class="n">c</span><span class="p">,</span> <span class="n">d</span> <span class="o">=</span> <span class="n">categories</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">descriptions_files</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">header</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">+</span> <span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;| </span><span class="si">{</span><span class="n">c</span><span class="si">}</span><span class="s2"> |</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">+</span> <span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="p">)</span>

        <span class="n">table</span> <span class="o">=</span> <span class="n">ascii</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
        <span class="n">items</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">table</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">name</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;+-*/&quot;</span><span class="p">,</span> <span class="s2">&quot;[:,:]&quot;</span><span class="p">]):</span>
                <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="s2">&quot;+-*/&quot;</span><span class="p">:</span>
                    <span class="n">function_call</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">function_call</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;.</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">()&quot;</span>

                <span class="n">item</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;cartoon&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> | </span><span class="si">{</span><span class="n">function_call</span><span class="si">:</span><span class="s2">&lt;28</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">   </span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
                <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">items</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">header</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">items</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">



<a id="chromatic.rainbows.helpers.history"></a>
    <div class="doc doc-contents first">

        <p>Return a summary of the history of actions that have gone into this <code>Rainbow</code>.</p>
<h3 id="chromatic.rainbows.helpers.history--returns">Returns<a class="headerlink" href="#chromatic.rainbows.helpers.history--returns" title="Permanent link">#</a></h3>
<p>history : str
    A string that does its best to try to summarize
    all the actions that have been applied to this
    <code>Rainbow</code> object from the moment it was created.
    In some (but not all) cases, it may be possible
    to copy, paste, and rerun this code to recreate
    the <code>Rainbow</code>.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/rainbows/helpers/history.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">history</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return a summary of the history of actions that have gone into this `Rainbow`.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    history : str</span>
<span class="sd">        A string that does its best to try to summarize</span>
<span class="sd">        all the actions that have been applied to this</span>
<span class="sd">        `Rainbow` object from the moment it was created.</span>
<span class="sd">        In some (but not all) cases, it may be possible</span>
<span class="sd">        to copy, paste, and rerun this code to recreate</span>
<span class="sd">        the `Rainbow`.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">calls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;history&quot;</span><span class="p">]</span>
    <span class="k">return</span> <span class="s2">&quot;(</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">calls</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">)&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">



<a id="chromatic.rainbows.helpers.save"></a>
    <div class="doc doc-contents first">

        <p>Save this <code>Rainbow</code> out to a file.</p>
<h3 id="chromatic.rainbows.helpers.save--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.helpers.save--parameters" title="Permanent link">#</a></h3>
<p>filepath : str
    The filepath pointing to the file to be written.
    (For now, it needs a <code>.rainbow.npy</code> extension.)
format : str, optional
    The file format of the file to be written. If <code>None</code>,
    the format will be guessed automatically from the
    filepath.
**kw : dict, optional
    All other keywords will be passed to the writer.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/rainbows/helpers/save.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filepath</span><span class="o">=</span><span class="s2">&quot;test.rainbow.npy&quot;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Save this `Rainbow` out to a file.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    filepath : str</span>
<span class="sd">        The filepath pointing to the file to be written.</span>
<span class="sd">        (For now, it needs a `.rainbow.npy` extension.)</span>
<span class="sd">    format : str, optional</span>
<span class="sd">        The file format of the file to be written. If `None`,</span>
<span class="sd">        the format will be guessed automatically from the</span>
<span class="sd">        filepath.</span>
<span class="sd">    **kw : dict, optional</span>
<span class="sd">        All other keywords will be passed to the writer.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># figure out the best writer</span>
    <span class="n">writer</span> <span class="o">=</span> <span class="n">guess_writer</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="nb">format</span><span class="p">)</span>

    <span class="c1"># use that writer to save the file</span>
    <span class="n">writer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filepath</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div><h2 id="actions">🌈 Actions<a class="headerlink" href="#actions" title="Permanent link">#</a></h2>


<div class="doc doc-object doc-function">



<a id="chromatic.rainbows.actions.align_wavelengths"></a>
    <div class="doc doc-contents first">

        <p>Use 2D wavelength information to align onto a single 1D wavelength array.</p>
<p>This relies on the existence of a <code>.fluxlike['wavelength_2d']</code> array,
expressing the wavelength associated with each flux element.
Those wavelengths will be used to (a) establish a new compromise
wavelength grid and (b) bin the individual timepoints onto that
new grid, effectively shifting the wavelengths to align.</p>
<h3 id="chromatic.rainbows.actions.align_wavelengths--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.actions.align_wavelengths--parameters" title="Permanent link">#</a></h3>
<p>minimum_acceptable_ok : float, optional
    The numbers in the <code>.ok</code> attribute express "how OK?" each
    data point is, ranging from 0 (not OK) to 1 (super OK).
    In most cases, <code>.ok</code> will be binary, but there may be times
    where it's intermediate (for example, if a bin was created
    from some data that were not OK and some that were).
    The <code>minimum_acceptable_ok</code> parameter allows you to specify what
    level of OK-ness for a point to go into the binning.
    Reasonable options may include:
        minimum_acceptable_ok = 1
              Only data points that are perfectly OK
              will go into the binning. All other points
              will effectively be interpolated over. Flux
              uncertainties <em>should</em> be inflated appropriately,
              but it's very possible to create correlated
              bins next to each other if many of your ingoing
              data points are not perfectly OK.
        minimum_acceptable_ok = 1
              All data points that aren't definitely not OK
              will go into the binning. The OK-ness of points
              will propagate onward for future binning.
        minimum_acceptable_ok &lt; 0
              All data points will be included in the bin.
              The OK-ness will propagate onward.
wscale : str, optional
    What kind of a new wavelength axis should be created?
    Options include:
        'linear' = constant d[wavelength] between grid points
        'log' = constant d[wavelength]/[wavelength] between grid points
        'nonlinear' = the median wavelength grid for all time points
supersampling : float, optional
    By how many times should we increase or decrease the wavelength sampling?
    In general, values &gt;1 will split each input wavelength grid point into
    multiple supersampled wavelength grid points, values close to 1 will
    produce approximately one output wavelength for each input wavelength,
    and values &lt;1 will average multiple input wavelengths into a single output
    wavelength bin.
    Unless this is significantly less than 1, there's a good chance your output
    array may have strong correlations between one or more adjacent wavelengths.
    Be careful when trying to use the resulting uncertainties!
visualize : bool
    Should we make some plots showing how the shared wavelength
    axis compares to the original input wavelength axes?</p>
<h3 id="chromatic.rainbows.actions.align_wavelengths--returns">Returns<a class="headerlink" href="#chromatic.rainbows.actions.align_wavelengths--returns" title="Permanent link">#</a></h3>
<p>rainbow : RainbowWithModel
    A new <code>RainbowWithModel</code> object, with the model attached.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/rainbows/actions/align_wavelengths.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">align_wavelengths</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">minimum_acceptable_ok</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">minimum_points_per_bin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">wscale</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span>
    <span class="n">supersampling</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">visualize</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Use 2D wavelength information to align onto a single 1D wavelength array.</span>

<span class="sd">    This relies on the existence of a `.fluxlike[&#39;wavelength_2d&#39;]` array,</span>
<span class="sd">    expressing the wavelength associated with each flux element.</span>
<span class="sd">    Those wavelengths will be used to (a) establish a new compromise</span>
<span class="sd">    wavelength grid and (b) bin the individual timepoints onto that</span>
<span class="sd">    new grid, effectively shifting the wavelengths to align.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    minimum_acceptable_ok : float, optional</span>
<span class="sd">        The numbers in the `.ok` attribute express &quot;how OK?&quot; each</span>
<span class="sd">        data point is, ranging from 0 (not OK) to 1 (super OK).</span>
<span class="sd">        In most cases, `.ok` will be binary, but there may be times</span>
<span class="sd">        where it&#39;s intermediate (for example, if a bin was created</span>
<span class="sd">        from some data that were not OK and some that were).</span>
<span class="sd">        The `minimum_acceptable_ok` parameter allows you to specify what</span>
<span class="sd">        level of OK-ness for a point to go into the binning.</span>
<span class="sd">        Reasonable options may include:</span>
<span class="sd">            minimum_acceptable_ok = 1</span>
<span class="sd">                  Only data points that are perfectly OK</span>
<span class="sd">                  will go into the binning. All other points</span>
<span class="sd">                  will effectively be interpolated over. Flux</span>
<span class="sd">                  uncertainties *should* be inflated appropriately,</span>
<span class="sd">                  but it&#39;s very possible to create correlated</span>
<span class="sd">                  bins next to each other if many of your ingoing</span>
<span class="sd">                  data points are not perfectly OK.</span>
<span class="sd">            minimum_acceptable_ok = 1</span>
<span class="sd">                  All data points that aren&#39;t definitely not OK</span>
<span class="sd">                  will go into the binning. The OK-ness of points</span>
<span class="sd">                  will propagate onward for future binning.</span>
<span class="sd">            minimum_acceptable_ok &lt; 0</span>
<span class="sd">                  All data points will be included in the bin.</span>
<span class="sd">                  The OK-ness will propagate onward.</span>
<span class="sd">    wscale : str, optional</span>
<span class="sd">        What kind of a new wavelength axis should be created?</span>
<span class="sd">        Options include:</span>
<span class="sd">            &#39;linear&#39; = constant d[wavelength] between grid points</span>
<span class="sd">            &#39;log&#39; = constant d[wavelength]/[wavelength] between grid points</span>
<span class="sd">            &#39;nonlinear&#39; = the median wavelength grid for all time points</span>
<span class="sd">    supersampling : float, optional</span>
<span class="sd">        By how many times should we increase or decrease the wavelength sampling?</span>
<span class="sd">        In general, values &gt;1 will split each input wavelength grid point into</span>
<span class="sd">        multiple supersampled wavelength grid points, values close to 1 will</span>
<span class="sd">        produce approximately one output wavelength for each input wavelength,</span>
<span class="sd">        and values &lt;1 will average multiple input wavelengths into a single output</span>
<span class="sd">        wavelength bin.</span>
<span class="sd">        Unless this is significantly less than 1, there&#39;s a good chance your output</span>
<span class="sd">        array may have strong correlations between one or more adjacent wavelengths.</span>
<span class="sd">        Be careful when trying to use the resulting uncertainties!</span>
<span class="sd">    visualize : bool</span>
<span class="sd">        Should we make some plots showing how the shared wavelength</span>
<span class="sd">        axis compares to the original input wavelength axes?</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    rainbow : RainbowWithModel</span>
<span class="sd">        A new `RainbowWithModel` object, with the model attached.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># create a history entry for this action (before other variables are defined)</span>
    <span class="n">h</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_history_entry</span><span class="p">(</span><span class="s2">&quot;align_wavelengths&quot;</span><span class="p">,</span> <span class="nb">locals</span><span class="p">())</span>

    <span class="k">if</span> <span class="s2">&quot;wavelength_2d&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fluxlike</span><span class="p">:</span>
        <span class="n">cheerfully_suggest</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        No 2D wavelength information was found, so</span>
<span class="s2">        it&#39;s assumed wavelengths don&#39;t need to be aligned.</span>
<span class="s2">        Wavelength alignment is being skipped!</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="p">)</span>
        <span class="n">shifted</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_copy</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># create a shared wavelength array</span>
        <span class="n">shared_wavelengths</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_shared_wavelength_axis</span><span class="p">(</span>
            <span class="n">wscale</span><span class="o">=</span><span class="n">wscale</span><span class="p">,</span> <span class="n">supersampling</span><span class="o">=</span><span class="n">supersampling</span><span class="p">,</span> <span class="n">visualize</span><span class="o">=</span><span class="n">visualize</span>
        <span class="p">)</span>

        <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>

            <span class="c1"># bin the rainbow onto that new grid, starting from 2D wavelengths</span>
            <span class="n">shifted</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bin_in_wavelength</span><span class="p">(</span>
                <span class="n">wavelength</span><span class="o">=</span><span class="n">shared_wavelengths</span><span class="p">,</span>
                <span class="n">minimum_acceptable_ok</span><span class="o">=</span><span class="n">minimum_acceptable_ok</span><span class="p">,</span>
                <span class="n">starting_wavelengths</span><span class="o">=</span><span class="s2">&quot;2D&quot;</span><span class="p">,</span>
                <span class="n">minimum_points_per_bin</span><span class="o">=</span><span class="n">minimum_points_per_bin</span><span class="p">,</span>
            <span class="p">)</span>

    <span class="c1"># append the history entry to the new Rainbow</span>
    <span class="n">shifted</span><span class="o">.</span><span class="n">_record_history_entry</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>

    <span class="c1"># return the new Rainbow</span>
    <span class="k">return</span> <span class="n">shifted</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">



<a id="chromatic.rainbows.actions.attach_model"></a>
    <div class="doc doc-contents first">

        <p>Attach a <code>fluxlike</code> model, thus making a new <code>RainbowWithModel.</code></p>
<p>Having a model attached makes it possible to make calculations
(residuals, chi^2) and visualizations comparing data to model.</p>
<p>The <code>model</code> array will be stored in <code>.fluxlike['model']</code>.
After running this to make a <code>RainbowWithModel</code> it's OK
(and faster) to simply update <code>.fluxlike['model']</code> or <code>.model</code>.</p>
<h3 id="chromatic.rainbows.actions.attach_model--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.actions.attach_model--parameters" title="Permanent link">#</a></h3>
<p>model : array, Quantity
    An array of model values, with the same shape as 'flux'
**kw : dict, optional
    All other keywords will be interpreted as items
    that can be added to a <code>Rainbow</code>. You might use this
    to attach intermediate model steps or quantities.
    Variable names ending with <code>_model</code> can be particularly
    easily incorporated into multi-part model visualizations
    (for example, <code>'planet_model'</code> or <code>'systematics_model'</code>).</p>
<h3 id="chromatic.rainbows.actions.attach_model--returns">Returns<a class="headerlink" href="#chromatic.rainbows.actions.attach_model--returns" title="Permanent link">#</a></h3>
<p>rainbow : RainbowWithModel
    A new <code>RainbowWithModel</code> object, with the model attached.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/rainbows/actions/attach_model.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">attach_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Attach a `fluxlike` model, thus making a new `RainbowWithModel.`</span>

<span class="sd">    Having a model attached makes it possible to make calculations</span>
<span class="sd">    (residuals, chi^2) and visualizations comparing data to model.</span>

<span class="sd">    The `model` array will be stored in `.fluxlike[&#39;model&#39;]`.</span>
<span class="sd">    After running this to make a `RainbowWithModel` it&#39;s OK</span>
<span class="sd">    (and faster) to simply update `.fluxlike[&#39;model&#39;]` or `.model`.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    model : array, Quantity</span>
<span class="sd">        An array of model values, with the same shape as &#39;flux&#39;</span>
<span class="sd">    **kw : dict, optional</span>
<span class="sd">        All other keywords will be interpreted as items</span>
<span class="sd">        that can be added to a `Rainbow`. You might use this</span>
<span class="sd">        to attach intermediate model steps or quantities.</span>
<span class="sd">        Variable names ending with `_model` can be particularly</span>
<span class="sd">        easily incorporated into multi-part model visualizations</span>
<span class="sd">        (for example, `&#39;planet_model&#39;` or `&#39;systematics_model&#39;`).</span>


<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    rainbow : RainbowWithModel</span>
<span class="sd">        A new `RainbowWithModel` object, with the model attached.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># create a history entry for this action (before other variables are defined)</span>
    <span class="n">h</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_history_entry</span><span class="p">(</span><span class="s2">&quot;attach_model&quot;</span><span class="p">,</span> <span class="nb">locals</span><span class="p">())</span>

    <span class="c1"># make sure the shape is reasonable</span>
    <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">model</span><span class="p">)</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="p">)</span>

    <span class="c1"># add the model to the fluxlike array</span>
    <span class="n">inputs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_copy</span><span class="p">()</span><span class="o">.</span><span class="n">_get_core_dictionaries</span><span class="p">()</span>
    <span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;fluxlike&quot;</span><span class="p">][</span><span class="s2">&quot;model&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span>

    <span class="c1"># import here (rather than globally) to avoid recursion?</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">..withmodel</span><span class="w"> </span><span class="kn">import</span> <span class="n">RainbowWithModel</span>

    <span class="c1"># create new object</span>
    <span class="n">new</span> <span class="o">=</span> <span class="n">RainbowWithModel</span><span class="p">(</span><span class="o">**</span><span class="n">inputs</span><span class="p">)</span>

    <span class="c1"># add other inputs to the model</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">kw</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">new</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>

    <span class="c1"># append the history entry to the new Rainbow</span>
    <span class="n">new</span><span class="o">.</span><span class="n">_record_history_entry</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>

    <span class="c1"># return the RainboWithModel</span>
    <span class="k">return</span> <span class="n">new</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-module">



<a id="chromatic.rainbows.actions.binning"></a>
    <div class="doc doc-contents first">









  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.actions.binning.bin" class="doc doc-heading">
            <code class="highlight language-python"><span class="nb">bin</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">time_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ntimes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">R</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dw</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">wavelength</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">wavelength_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">nwavelengths</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">minimum_acceptable_ok</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">minimum_points_per_bin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">trim</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.actions.binning.bin" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Bin in wavelength and/or time.</p>
<p>Average together some number of adjacent data points,
in wavelength and/or time. For well-behaved data where
data points are independent from each other, binning down
by N data points should decrease the noise per bin by
approximately 1/sqrt(N), making it easier to see subtle
signals. To bin data points together, data are combined
using inverse-variance weighting through interpolation
of cumulative distributions, in an attempt to make sure
that flux integrals between limits are maintained.</p>
<p>Currently, the inverse-variance weighting is most reliable
only for datasets that have been normalized to be close
to 1. We still need to do a little work to make sure
it works well on unnormalized datasets with dramatically
non-uniform uncertainties.</p>
<p>By default, time binning happens before wavelength binning.
To control the order, use separate calls to <code>.bin()</code>.</p>
<p>The time-setting order of precendence is
[<code>time_edges</code>, <code>time</code>, <code>dt</code>, <code>ntimes</code>]
The first will be used, and others will be ignored.</p>
<p>The wavelength-setting order of precendence is
[<code>wavelength_edges</code>, <code>wavelength</code>, <code>dw</code>, <code>R</code>, <code>nwavelengths</code>]
The first will be used, and others will be ignored.</p>
<h4 id="chromatic.rainbows.actions.binning.bin--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.actions.binning.bin--parameters" title="Permanent link">#</a></h4>
<p>dt : Quantity
    The d(time) bin size for creating a grid
    that is uniform in linear space.
time : Quantity
    An array of times, if you just want to give
    it an entirely custom array.
    The widths of the bins will be guessed from the centers
    (well, if the spacing is uniform constant; pretty well
    but not perfectly otherwise).
time_edges : Quantity
    An array of times for the edges of bins,
    if you just want to give an entirely custom array.
    The bins will span <code>time_edges[:-1]</code> to
    <code>time_edges[1:]</code>, so the resulting binned
    Rainbow will have <code>len(time_edges) - 1</code>
    time bins associated with it.
ntimes : int
    A fixed number of time to bin together.
    Binning will start from the 0th element of the
    starting times; if you want to start from
    a different index, trim before binning.
R : float
    The spectral resolution for creating a grid
    that is uniform in logarithmic space.
dw : Quantity
    The d(wavelength) bin size for creating a grid
    that is uniform in linear space.
wavelength : Quantity
    An array of wavelengths for the centers of bins,
    if you just want to give an entirely custom array.
    The widths of the bins will be guessed from the centers
    (well, if the spacing is uniform constant; pretty well
    but not perfectly otherwise).
wavelength_edges : Quantity
    An array of wavelengths for the edges of bins,
    if you just want to give an entirely custom array.
    The bins will span <code>wavelength_edges[:-1]</code> to
    <code>wavelength_edges[1:]</code>, so the resulting binned
    Rainbow will have <code>len(wavelength_edges) - 1</code>
    wavelength bins associated with it.
nwavelengths : int
    A fixed number of wavelengths to bin together.
    Binning will start from the 0th element of the
    starting wavelengths; if you want to start from
    a different index, trim before binning.
minimum_acceptable_ok : float
    The numbers in the <code>.ok</code> attribute express "how OK?" each
    data point is, ranging from 0 (not OK) to 1 (super OK).
    In most cases, <code>.ok</code> will be binary, but there may be times
    where it's intermediate (for example, if a bin was created
    from some data that were not OK and some that were).
    The <code>minimum_acceptable_ok</code> parameter allows you to specify what
    level of OK-ness for a point to go into the binning.
    Reasonable options may include:
        minimum_acceptable_ok = 1
              Only data points that are perfectly OK
              will go into the binning.
        minimum_acceptable_ok = 1e-10
              All data points that aren't definitely not OK
              will go into the binning.
        minimum_acceptable_ok = 0
              All data points will be included in the bin.
minimum_points_per_bin : float
    If you're creating bins that are smaller than those in
    the original dataset, it's possible to end up with bins
    that effectively contain fewer than one original datapoint
    (in the sense that the contribution of one original datapoint
    might be split across multiple new bins). By default,
    we allow this behavior with <code>minimum_points_per_bin=0</code>, but you can
    limit your result to only bins that contain one or more
    original datapoints with <code>minimum_points_per_bin=1</code>.
trim : bool
    Should any wavelengths or columns that end up
    as entirely nan be trimmed out of the result?
    (default = True)</p>
<h4 id="chromatic.rainbows.actions.binning.bin--returns">Returns<a class="headerlink" href="#chromatic.rainbows.actions.binning.bin--returns" title="Permanent link">#</a></h4>
<p>binned : Rainbow
    The binned <code>Rainbow</code>.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/rainbows/actions/binning.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">bin</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">dt</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">time</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">time_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">ntimes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">R</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">dw</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">wavelength</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">wavelength_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">nwavelengths</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">minimum_acceptable_ok</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">minimum_points_per_bin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">trim</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Bin in wavelength and/or time.</span>

<span class="sd">    Average together some number of adjacent data points,</span>
<span class="sd">    in wavelength and/or time. For well-behaved data where</span>
<span class="sd">    data points are independent from each other, binning down</span>
<span class="sd">    by N data points should decrease the noise per bin by</span>
<span class="sd">    approximately 1/sqrt(N), making it easier to see subtle</span>
<span class="sd">    signals. To bin data points together, data are combined</span>
<span class="sd">    using inverse-variance weighting through interpolation</span>
<span class="sd">    of cumulative distributions, in an attempt to make sure</span>
<span class="sd">    that flux integrals between limits are maintained.</span>

<span class="sd">    Currently, the inverse-variance weighting is most reliable</span>
<span class="sd">    only for datasets that have been normalized to be close</span>
<span class="sd">    to 1. We still need to do a little work to make sure</span>
<span class="sd">    it works well on unnormalized datasets with dramatically</span>
<span class="sd">    non-uniform uncertainties.</span>

<span class="sd">    By default, time binning happens before wavelength binning.</span>
<span class="sd">    To control the order, use separate calls to `.bin()`.</span>

<span class="sd">    The time-setting order of precendence is</span>
<span class="sd">    [`time_edges`, `time`, `dt`, `ntimes`]</span>
<span class="sd">    The first will be used, and others will be ignored.</span>

<span class="sd">    The wavelength-setting order of precendence is</span>
<span class="sd">    [`wavelength_edges`, `wavelength`, `dw`, `R`, `nwavelengths`]</span>
<span class="sd">    The first will be used, and others will be ignored.</span>


<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    dt : Quantity</span>
<span class="sd">        The d(time) bin size for creating a grid</span>
<span class="sd">        that is uniform in linear space.</span>
<span class="sd">    time : Quantity</span>
<span class="sd">        An array of times, if you just want to give</span>
<span class="sd">        it an entirely custom array.</span>
<span class="sd">        The widths of the bins will be guessed from the centers</span>
<span class="sd">        (well, if the spacing is uniform constant; pretty well</span>
<span class="sd">        but not perfectly otherwise).</span>
<span class="sd">    time_edges : Quantity</span>
<span class="sd">        An array of times for the edges of bins,</span>
<span class="sd">        if you just want to give an entirely custom array.</span>
<span class="sd">        The bins will span `time_edges[:-1]` to</span>
<span class="sd">        `time_edges[1:]`, so the resulting binned</span>
<span class="sd">        Rainbow will have `len(time_edges) - 1`</span>
<span class="sd">        time bins associated with it.</span>
<span class="sd">    ntimes : int</span>
<span class="sd">        A fixed number of time to bin together.</span>
<span class="sd">        Binning will start from the 0th element of the</span>
<span class="sd">        starting times; if you want to start from</span>
<span class="sd">        a different index, trim before binning.</span>
<span class="sd">    R : float</span>
<span class="sd">        The spectral resolution for creating a grid</span>
<span class="sd">        that is uniform in logarithmic space.</span>
<span class="sd">    dw : Quantity</span>
<span class="sd">        The d(wavelength) bin size for creating a grid</span>
<span class="sd">        that is uniform in linear space.</span>
<span class="sd">    wavelength : Quantity</span>
<span class="sd">        An array of wavelengths for the centers of bins,</span>
<span class="sd">        if you just want to give an entirely custom array.</span>
<span class="sd">        The widths of the bins will be guessed from the centers</span>
<span class="sd">        (well, if the spacing is uniform constant; pretty well</span>
<span class="sd">        but not perfectly otherwise).</span>
<span class="sd">    wavelength_edges : Quantity</span>
<span class="sd">        An array of wavelengths for the edges of bins,</span>
<span class="sd">        if you just want to give an entirely custom array.</span>
<span class="sd">        The bins will span `wavelength_edges[:-1]` to</span>
<span class="sd">        `wavelength_edges[1:]`, so the resulting binned</span>
<span class="sd">        Rainbow will have `len(wavelength_edges) - 1`</span>
<span class="sd">        wavelength bins associated with it.</span>
<span class="sd">    nwavelengths : int</span>
<span class="sd">        A fixed number of wavelengths to bin together.</span>
<span class="sd">        Binning will start from the 0th element of the</span>
<span class="sd">        starting wavelengths; if you want to start from</span>
<span class="sd">        a different index, trim before binning.</span>
<span class="sd">    minimum_acceptable_ok : float</span>
<span class="sd">        The numbers in the `.ok` attribute express &quot;how OK?&quot; each</span>
<span class="sd">        data point is, ranging from 0 (not OK) to 1 (super OK).</span>
<span class="sd">        In most cases, `.ok` will be binary, but there may be times</span>
<span class="sd">        where it&#39;s intermediate (for example, if a bin was created</span>
<span class="sd">        from some data that were not OK and some that were).</span>
<span class="sd">        The `minimum_acceptable_ok` parameter allows you to specify what</span>
<span class="sd">        level of OK-ness for a point to go into the binning.</span>
<span class="sd">        Reasonable options may include:</span>
<span class="sd">            minimum_acceptable_ok = 1</span>
<span class="sd">                  Only data points that are perfectly OK</span>
<span class="sd">                  will go into the binning.</span>
<span class="sd">            minimum_acceptable_ok = 1e-10</span>
<span class="sd">                  All data points that aren&#39;t definitely not OK</span>
<span class="sd">                  will go into the binning.</span>
<span class="sd">            minimum_acceptable_ok = 0</span>
<span class="sd">                  All data points will be included in the bin.</span>
<span class="sd">    minimum_points_per_bin : float</span>
<span class="sd">        If you&#39;re creating bins that are smaller than those in</span>
<span class="sd">        the original dataset, it&#39;s possible to end up with bins</span>
<span class="sd">        that effectively contain fewer than one original datapoint</span>
<span class="sd">        (in the sense that the contribution of one original datapoint</span>
<span class="sd">        might be split across multiple new bins). By default,</span>
<span class="sd">        we allow this behavior with `minimum_points_per_bin=0`, but you can</span>
<span class="sd">        limit your result to only bins that contain one or more</span>
<span class="sd">        original datapoints with `minimum_points_per_bin=1`.</span>
<span class="sd">    trim : bool</span>
<span class="sd">        Should any wavelengths or columns that end up</span>
<span class="sd">        as entirely nan be trimmed out of the result?</span>
<span class="sd">        (default = True)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    binned : Rainbow</span>
<span class="sd">        The binned `Rainbow`.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># bin first in time</span>
    <span class="n">binned_in_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bin_in_time</span><span class="p">(</span>
        <span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">,</span>
        <span class="n">time</span><span class="o">=</span><span class="n">time</span><span class="p">,</span>
        <span class="n">time_edges</span><span class="o">=</span><span class="n">time_edges</span><span class="p">,</span>
        <span class="n">ntimes</span><span class="o">=</span><span class="n">ntimes</span><span class="p">,</span>
        <span class="n">minimum_acceptable_ok</span><span class="o">=</span><span class="n">minimum_acceptable_ok</span><span class="p">,</span>
        <span class="n">minimum_points_per_bin</span><span class="o">=</span><span class="n">minimum_points_per_bin</span><span class="p">,</span>
        <span class="n">trim</span><span class="o">=</span><span class="n">trim</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># then bin in wavelength</span>
    <span class="n">binned</span> <span class="o">=</span> <span class="n">binned_in_time</span><span class="o">.</span><span class="n">bin_in_wavelength</span><span class="p">(</span>
        <span class="n">R</span><span class="o">=</span><span class="n">R</span><span class="p">,</span>
        <span class="n">dw</span><span class="o">=</span><span class="n">dw</span><span class="p">,</span>
        <span class="n">wavelength</span><span class="o">=</span><span class="n">wavelength</span><span class="p">,</span>
        <span class="n">wavelength_edges</span><span class="o">=</span><span class="n">wavelength_edges</span><span class="p">,</span>
        <span class="n">nwavelengths</span><span class="o">=</span><span class="n">nwavelengths</span><span class="p">,</span>
        <span class="n">minimum_acceptable_ok</span><span class="o">=</span><span class="n">minimum_acceptable_ok</span><span class="p">,</span>
        <span class="n">minimum_points_per_bin</span><span class="o">=</span><span class="n">minimum_points_per_bin</span><span class="p">,</span>
        <span class="n">trim</span><span class="o">=</span><span class="n">trim</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># return the binned object</span>
    <span class="k">return</span> <span class="n">binned</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.actions.binning.bin_in_time" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">bin_in_time</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">time_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ntimes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">minimum_acceptable_ok</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">minimum_points_per_bin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">trim</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.actions.binning.bin_in_time" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Bin in time.</p>
<p>The time-setting order of precendence is
[<code>time_edges</code>, <code>time</code>, <code>dt</code>, <code>ntimes</code>]
The first will be used, and others will be ignored.</p>
<h4 id="chromatic.rainbows.actions.binning.bin_in_time--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.actions.binning.bin_in_time--parameters" title="Permanent link">#</a></h4>
<p>dt : Quantity
    The d(time) bin size for creating a grid
    that is uniform in linear space.
time : Quantity
    An array of times, if you just want to give
    it an entirely custom array.
    The widths of the bins will be guessed from the centers
    (well, if the spacing is uniform constant; pretty well
    but not perfectly otherwise).
time_edges : Quantity
    An array of times for the edges of bins,
    if you just want to give an entirely custom array.
    The bins will span <code>time_edges[:-1]</code> to
    <code>time_edges[1:]</code>, so the resulting binned
    <code>Rainbow</code> will have <code>len(time_edges) - 1</code>
    time bins associated with it.
ntimes : int
    A fixed number of time to bin together.
    Binning will start from the 0th element of the
    starting times; if you want to start from
    a different index, trim before binning.
minimum_acceptable_ok : float
    The numbers in the <code>.ok</code> attribute express "how OK?" each
    data point is, ranging from 0 (not OK) to 1 (super OK).
    In most cases, <code>.ok</code> will be binary, but there may be times
    where it's intermediate (for example, if a bin was created
    from some data that were not OK and some that were).
    The <code>minimum_acceptable_ok</code> parameter allows you to specify what
    level of OK-ness for a point to go into the binning.
    Reasonable options may include:
        minimum_acceptable_ok = 1
              Only data points that are perfectly OK
              will go into the binning.
        minimum_acceptable_ok = 1e-10
              All data points that aren't definitely not OK
              will go into the binning.
        minimum_acceptable_ok = 0
              All data points will be included in the bin.
minimum_points_per_bin : float
    If you're creating bins that are smaller than those in
    the original dataset, it's possible to end up with bins
    that effectively contain fewer than one original datapoint
    (in the sense that the contribution of one original datapoint
    might be split across multiple new bins). By default,
    we allow this behavior with <code>minimum_points_per_bin=0</code>, but you can
    limit your result to only bins that contain one or more
    original datapoints with <code>minimum_points_per_bin=1</code>.
trim : bool
    Should any wavelengths or columns that end up
    as entirely nan be trimmed out of the result?
    (default = True)</p>
<h4 id="chromatic.rainbows.actions.binning.bin_in_time--returns">Returns<a class="headerlink" href="#chromatic.rainbows.actions.binning.bin_in_time--returns" title="Permanent link">#</a></h4>
<p>binned : Rainbow
    The binned <code>Rainbow</code>.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/rainbows/actions/binning.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">bin_in_time</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">dt</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">time</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">time_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">ntimes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">minimum_acceptable_ok</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">minimum_points_per_bin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">trim</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Bin in time.</span>

<span class="sd">    The time-setting order of precendence is</span>
<span class="sd">    [`time_edges`, `time`, `dt`, `ntimes`]</span>
<span class="sd">    The first will be used, and others will be ignored.</span>


<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    dt : Quantity</span>
<span class="sd">        The d(time) bin size for creating a grid</span>
<span class="sd">        that is uniform in linear space.</span>
<span class="sd">    time : Quantity</span>
<span class="sd">        An array of times, if you just want to give</span>
<span class="sd">        it an entirely custom array.</span>
<span class="sd">        The widths of the bins will be guessed from the centers</span>
<span class="sd">        (well, if the spacing is uniform constant; pretty well</span>
<span class="sd">        but not perfectly otherwise).</span>
<span class="sd">    time_edges : Quantity</span>
<span class="sd">        An array of times for the edges of bins,</span>
<span class="sd">        if you just want to give an entirely custom array.</span>
<span class="sd">        The bins will span `time_edges[:-1]` to</span>
<span class="sd">        `time_edges[1:]`, so the resulting binned</span>
<span class="sd">        `Rainbow` will have `len(time_edges) - 1`</span>
<span class="sd">        time bins associated with it.</span>
<span class="sd">    ntimes : int</span>
<span class="sd">        A fixed number of time to bin together.</span>
<span class="sd">        Binning will start from the 0th element of the</span>
<span class="sd">        starting times; if you want to start from</span>
<span class="sd">        a different index, trim before binning.</span>
<span class="sd">    minimum_acceptable_ok : float</span>
<span class="sd">        The numbers in the `.ok` attribute express &quot;how OK?&quot; each</span>
<span class="sd">        data point is, ranging from 0 (not OK) to 1 (super OK).</span>
<span class="sd">        In most cases, `.ok` will be binary, but there may be times</span>
<span class="sd">        where it&#39;s intermediate (for example, if a bin was created</span>
<span class="sd">        from some data that were not OK and some that were).</span>
<span class="sd">        The `minimum_acceptable_ok` parameter allows you to specify what</span>
<span class="sd">        level of OK-ness for a point to go into the binning.</span>
<span class="sd">        Reasonable options may include:</span>
<span class="sd">            minimum_acceptable_ok = 1</span>
<span class="sd">                  Only data points that are perfectly OK</span>
<span class="sd">                  will go into the binning.</span>
<span class="sd">            minimum_acceptable_ok = 1e-10</span>
<span class="sd">                  All data points that aren&#39;t definitely not OK</span>
<span class="sd">                  will go into the binning.</span>
<span class="sd">            minimum_acceptable_ok = 0</span>
<span class="sd">                  All data points will be included in the bin.</span>
<span class="sd">    minimum_points_per_bin : float</span>
<span class="sd">        If you&#39;re creating bins that are smaller than those in</span>
<span class="sd">        the original dataset, it&#39;s possible to end up with bins</span>
<span class="sd">        that effectively contain fewer than one original datapoint</span>
<span class="sd">        (in the sense that the contribution of one original datapoint</span>
<span class="sd">        might be split across multiple new bins). By default,</span>
<span class="sd">        we allow this behavior with `minimum_points_per_bin=0`, but you can</span>
<span class="sd">        limit your result to only bins that contain one or more</span>
<span class="sd">        original datapoints with `minimum_points_per_bin=1`.</span>
<span class="sd">    trim : bool</span>
<span class="sd">        Should any wavelengths or columns that end up</span>
<span class="sd">        as entirely nan be trimmed out of the result?</span>
<span class="sd">        (default = True)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    binned : Rainbow</span>
<span class="sd">        The binned `Rainbow`.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># create a history entry for this action (before other variables are defined)</span>
    <span class="n">h</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_history_entry</span><span class="p">(</span><span class="s2">&quot;bin_in_time&quot;</span><span class="p">,</span> <span class="nb">locals</span><span class="p">())</span>

    <span class="c1"># if no bin information is provided, don&#39;t bin</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">([</span><span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">[</span><span class="n">dt</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">time_edges</span><span class="p">,</span> <span class="n">ntimes</span><span class="p">]]):</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="c1"># set up binning parameters</span>
    <span class="n">binkw</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">weighting</span><span class="o">=</span><span class="s2">&quot;inversevariance&quot;</span><span class="p">,</span> <span class="n">drop_nans</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="c1"># [`time_edges`, `time`, `dt`, `ntimes`]</span>
    <span class="k">if</span> <span class="n">time_edges</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">binkw</span><span class="p">[</span><span class="s2">&quot;newx_edges&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">time_edges</span>
    <span class="k">elif</span> <span class="n">time</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">binkw</span><span class="p">[</span><span class="s2">&quot;newx&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">time</span>
    <span class="k">elif</span> <span class="n">dt</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">binkw</span><span class="p">[</span><span class="s2">&quot;dx&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dt</span>
    <span class="k">elif</span> <span class="n">ntimes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">binkw</span><span class="p">[</span><span class="s2">&quot;nx&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ntimes</span>

    <span class="c1"># create a new, empty Rainbow</span>
    <span class="n">new</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_copy</span><span class="p">()</span>

    <span class="c1"># populate the wavelength information</span>
    <span class="n">new</span><span class="o">.</span><span class="n">wavelike</span> <span class="o">=</span> <span class="p">{</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">wavelike</span><span class="p">}</span>
    <span class="n">new</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;wscale&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wscale</span>

    <span class="c1"># bin the time-like variables</span>
    <span class="c1"># Technically, we should include uncertainties here too,</span>
    <span class="c1"># so that times/wavelengths are weighted more toward</span>
    <span class="c1"># inputs with higher flux weights (e.g. smaller variance),</span>
    <span class="c1"># but that will make non-uniform grids that will be</span>
    <span class="c1"># really hard to deal with.</span>
    <span class="n">new</span><span class="o">.</span><span class="n">timelike</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">timelike</span><span class="p">:</span>
        <span class="n">binned</span> <span class="o">=</span> <span class="n">bintogrid</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">timelike</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">unc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">binkw</span><span class="p">)</span>
        <span class="n">new</span><span class="o">.</span><span class="n">timelike</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">binned</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span>
    <span class="n">new</span><span class="o">.</span><span class="n">timelike</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">binned</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">]</span>
    <span class="n">new</span><span class="o">.</span><span class="n">timelike</span><span class="p">[</span><span class="s2">&quot;time_lower&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">binned</span><span class="p">[</span><span class="s2">&quot;x_edge_lower&quot;</span><span class="p">]</span>
    <span class="n">new</span><span class="o">.</span><span class="n">timelike</span><span class="p">[</span><span class="s2">&quot;time_upper&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">binned</span><span class="p">[</span><span class="s2">&quot;x_edge_upper&quot;</span><span class="p">]</span>
    <span class="n">new</span><span class="o">.</span><span class="n">timelike</span><span class="p">[</span><span class="s2">&quot;unbinned_times_per_binned_time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">binned</span><span class="p">[</span><span class="s2">&quot;N_unbinned/N_binned&quot;</span><span class="p">]</span>

    <span class="c1"># bin the flux-like variables</span>
    <span class="c1"># TODO (add more careful treatment of uncertainty + DQ)</span>
    <span class="c1"># TODO (think about cleverer bintogrid for 2D arrays?)</span>
    <span class="n">new</span><span class="o">.</span><span class="n">fluxlike</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">ok</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ok</span>
    <span class="c1"># loop through wavelengths</span>
    <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">new</span><span class="o">.</span><span class="n">nwave</span><span class="p">),</span> <span class="n">leave</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>

<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        if k == &quot;uncertainty&quot;:</span>
<span class="sd">            cheerfully_suggest(</span>
<span class="sd">                &quot;&quot;&quot;</span>
<span class="sd">            Uncertainties and/or data quality flags might</span>
<span class="sd">            not be handled absolutely perfectly yet...</span>
<span class="sd">            &quot;&quot;&quot;</span>
<span class="sd">            )&#39;&#39;&#39;</span>

        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fluxlike</span><span class="p">:</span>
            <span class="c1"># mask out &quot;bad&quot; wavelengths</span>
            <span class="n">time_is_bad</span> <span class="o">=</span> <span class="n">ok</span><span class="p">[</span><span class="n">w</span><span class="p">,</span> <span class="p">:]</span> <span class="o">&lt;</span> <span class="n">minimum_acceptable_ok</span>
            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">uncertainty</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">uncertainty</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
                <span class="n">uncertainty_for_binning</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ntime</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_keys_that_get_uncertainty_weighting</span><span class="p">:</span>
                <span class="n">uncertainty_for_binning</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">uncertainty</span><span class="p">[</span><span class="n">w</span><span class="p">,</span> <span class="p">:]</span> <span class="o">*</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">uncertainty_for_binning</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ntime</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">k</span> <span class="o">!=</span> <span class="s2">&quot;ok&quot;</span><span class="p">:</span>
                <span class="n">uncertainty_for_binning</span><span class="p">[</span><span class="n">time_is_bad</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>

            <span class="c1"># bin the quantities for this wavelength</span>
            <span class="n">binned</span> <span class="o">=</span> <span class="n">bintogrid</span><span class="p">(</span>
                <span class="n">x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">[:],</span>
                <span class="n">y</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fluxlike</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">w</span><span class="p">,</span> <span class="p">:],</span>
                <span class="n">unc</span><span class="o">=</span><span class="n">uncertainty_for_binning</span><span class="p">,</span>
                <span class="o">**</span><span class="n">binkw</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="c1"># if necessary, create a new fluxlike array</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">new</span><span class="o">.</span><span class="n">fluxlike</span><span class="p">:</span>
                <span class="n">new_shape</span> <span class="o">=</span> <span class="p">(</span><span class="n">new</span><span class="o">.</span><span class="n">nwave</span><span class="p">,</span> <span class="n">new</span><span class="o">.</span><span class="n">ntime</span><span class="p">)</span>
                <span class="n">new</span><span class="o">.</span><span class="n">fluxlike</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">new_shape</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fluxlike</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">):</span>
                    <span class="n">new</span><span class="o">.</span><span class="n">fluxlike</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fluxlike</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">unit</span>

            <span class="c1"># store the binned array in the appropriate place</span>
            <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="s2">&quot;uncertainty&quot;</span><span class="p">:</span>
                <span class="c1"># uncertainties are usually standard error on the mean</span>
                <span class="n">new</span><span class="o">.</span><span class="n">fluxlike</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">w</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">binned</span><span class="p">[</span><span class="s2">&quot;uncertainty&quot;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># note: all quantities are weighted the same as flux (probably inversevariance)</span>
                <span class="n">new</span><span class="o">.</span><span class="n">fluxlike</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">w</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">binned</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">new</span><span class="o">.</span><span class="n">nwave</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">new</span><span class="o">.</span><span class="n">ntime</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
        <span class="n">message</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        You tried to bin </span><span class="si">{</span><span class="bp">self</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">new</span><span class="si">}</span><span class="s2">.</span>

<span class="s2">        After accounting for `minimum_acceptable_ok &gt; </span><span class="si">{</span><span class="n">minimum_acceptable_ok</span><span class="si">}</span><span class="s2">`,</span>
<span class="s2">        all new bins would end up with no usable data points.</span>
<span class="s2">        Please (a) make sure your input `Rainbow` has at least</span>
<span class="s2">        one wavelength and time, (b) check `.ok` accurately expresses</span>
<span class="s2">        which data you think are usable, (c) change the `minimum_acceptable_ok`</span>
<span class="s2">        keyword for `.bin` to a smaller value, and/or (d) try larger bins.</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="n">cheerfully_suggest</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;No good data to bin! (see above)&quot;</span><span class="p">)</span>

    <span class="c1"># make sure dictionaries are on the up and up</span>
    <span class="n">new</span><span class="o">.</span><span class="n">_validate_core_dictionaries</span><span class="p">()</span>

    <span class="c1"># figure out the scales, after binning</span>
    <span class="n">new</span><span class="o">.</span><span class="n">_guess_wscale</span><span class="p">()</span>
    <span class="n">new</span><span class="o">.</span><span class="n">_guess_tscale</span><span class="p">()</span>

    <span class="c1"># append the history entry to the new Rainbow</span>
    <span class="n">new</span><span class="o">.</span><span class="n">_record_history_entry</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>

    <span class="c1"># deal with bins that are smaller than original</span>
    <span class="n">N</span> <span class="o">=</span> <span class="n">new</span><span class="o">.</span><span class="n">timelike</span><span class="p">[</span><span class="s2">&quot;unbinned_times_per_binned_time&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">minimum_points_per_bin</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">_warn_about_weird_binning</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="s2">&quot;time&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ok</span> <span class="o">=</span> <span class="n">new</span><span class="o">.</span><span class="n">timelike</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;ok&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">new</span><span class="o">.</span><span class="n">ntime</span><span class="p">,</span> <span class="nb">bool</span><span class="p">))</span>
        <span class="n">new</span><span class="o">.</span><span class="n">timelike</span><span class="p">[</span><span class="s2">&quot;ok&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ok</span> <span class="o">*</span> <span class="p">(</span><span class="n">N</span> <span class="o">&gt;=</span> <span class="n">minimum_points_per_bin</span><span class="p">)</span>

    <span class="c1"># return the new Rainbow (with trimming if necessary)</span>
    <span class="k">if</span> <span class="n">trim</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">new</span><span class="o">.</span><span class="n">trim_times</span><span class="p">(</span><span class="n">minimum_acceptable_ok</span><span class="o">=</span><span class="n">minimum_acceptable_ok</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">new</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.actions.binning.bin_in_wavelength" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">bin_in_wavelength</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">R</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dw</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">wavelength</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">wavelength_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">nwavelengths</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">minimum_acceptable_ok</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">minimum_points_per_bin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">trim</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">starting_wavelengths</span><span class="o">=</span><span class="s1">&#39;1D&#39;</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.actions.binning.bin_in_wavelength" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Bin in wavelength.</p>
<p>The wavelength-setting order of precendence is
[<code>wavelength_edges</code>, <code>wavelength</code>, <code>dw</code>, <code>R</code>, <code>nwavelengths</code>]
The first will be used, and others will be ignored.</p>
<h4 id="chromatic.rainbows.actions.binning.bin_in_wavelength--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.actions.binning.bin_in_wavelength--parameters" title="Permanent link">#</a></h4>
<p>R : float
    The spectral resolution for creating a grid
    that is uniform in logarithmic space.
dw : Quantity
    The d(wavelength) bin size for creating a grid
    that is uniform in linear space.
wavelength : Quantity
    An array of wavelength centers, if you just want to give
    it an entirely custom array. The widths of the bins
    will be guessed from the centers. It will do a good
    job if the widths are constant, but don't 100% trust
    it otherwise.
wavelength_edges : Quantity
    An array of wavelengths for the edges of bins,
    if you just want to give an entirely custom array.
    The bins will span <code>wavelength_edges[:-1]</code> to
    <code>wavelength_edges[1:]</code>, so the resulting binned
    <code>Rainbow</code> will have <code>len(wavelength_edges) - 1</code>
    wavelength bins associated with it.
nwavelengths : int
    A fixed number of wavelengths to bin together.
    Binning will start from the 0th element of the
    starting wavelengths; if you want to start from
    a different index, trim before binning.
minimum_acceptable_ok : float
    The numbers in the <code>.ok</code> attribute express "how OK?" each
    data point is, ranging from 0 (not OK) to 1 (super OK).
    In most cases, <code>.ok</code> will be binary, but there may be times
    where it's intermediate (for example, if a bin was created
    from some data that were not OK and some that were).
    The <code>minimum_acceptable_ok</code> parameter allows you to specify what
    level of OK-ness for a point to go into the binning.
    Reasonable options may include:
        minimum_acceptable_ok = 1
              Only data points that are perfectly OK
              will go into the binning.
        minimum_acceptable_ok = 1e-10
              All data points that aren't definitely not OK
              will go into the binning.
        minimum_acceptable_ok = 0
              All data points will be included in the bin.
minimum_points_per_bin : float
    If you're creating bins that are smaller than those in
    the original dataset, it's possible to end up with bins
    that effectively contain fewer than one original datapoint
    (in the sense that the contribution of one original datapoint
    might be split across multiple new bins). By default,
    we allow this behavior with <code>minimum_points_per_bin=0</code>, but you can
    limit your result to only bins that contain one or more
    original datapoints with <code>minimum_points_per_bin=1</code>.
trim : bool
    Should any wavelengths or columns that end up
    as entirely nan be trimmed out of the result?
    (default = True)
starting_wavelengths : str
    What wavelengths should be used as the starting
    value from which we will be binning? Options include:
    '1D' = (default) the shared 1D wavelengths for all times
           stored in <code>.wavelike['wavelength']</code>
    '2D' = (used only by <code>align_wavelengths</code>) the per-time 2D array
           stored in <code>.fluxlike['wavelength']</code>
    [Most users probably don't need to change this from default.]</p>
<h4 id="chromatic.rainbows.actions.binning.bin_in_wavelength--returns">Returns<a class="headerlink" href="#chromatic.rainbows.actions.binning.bin_in_wavelength--returns" title="Permanent link">#</a></h4>
<p>binned : Rainbow
    The binned <code>Rainbow</code>.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/rainbows/actions/binning.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">bin_in_wavelength</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">R</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">dw</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">wavelength</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">wavelength_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">nwavelengths</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">minimum_acceptable_ok</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">minimum_points_per_bin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">trim</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">starting_wavelengths</span><span class="o">=</span><span class="s2">&quot;1D&quot;</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Bin in wavelength.</span>

<span class="sd">    The wavelength-setting order of precendence is</span>
<span class="sd">    [`wavelength_edges`, `wavelength`, `dw`, `R`, `nwavelengths`]</span>
<span class="sd">    The first will be used, and others will be ignored.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    R : float</span>
<span class="sd">        The spectral resolution for creating a grid</span>
<span class="sd">        that is uniform in logarithmic space.</span>
<span class="sd">    dw : Quantity</span>
<span class="sd">        The d(wavelength) bin size for creating a grid</span>
<span class="sd">        that is uniform in linear space.</span>
<span class="sd">    wavelength : Quantity</span>
<span class="sd">        An array of wavelength centers, if you just want to give</span>
<span class="sd">        it an entirely custom array. The widths of the bins</span>
<span class="sd">        will be guessed from the centers. It will do a good</span>
<span class="sd">        job if the widths are constant, but don&#39;t 100% trust</span>
<span class="sd">        it otherwise.</span>
<span class="sd">    wavelength_edges : Quantity</span>
<span class="sd">        An array of wavelengths for the edges of bins,</span>
<span class="sd">        if you just want to give an entirely custom array.</span>
<span class="sd">        The bins will span `wavelength_edges[:-1]` to</span>
<span class="sd">        `wavelength_edges[1:]`, so the resulting binned</span>
<span class="sd">        `Rainbow` will have `len(wavelength_edges) - 1`</span>
<span class="sd">        wavelength bins associated with it.</span>
<span class="sd">    nwavelengths : int</span>
<span class="sd">        A fixed number of wavelengths to bin together.</span>
<span class="sd">        Binning will start from the 0th element of the</span>
<span class="sd">        starting wavelengths; if you want to start from</span>
<span class="sd">        a different index, trim before binning.</span>
<span class="sd">    minimum_acceptable_ok : float</span>
<span class="sd">        The numbers in the `.ok` attribute express &quot;how OK?&quot; each</span>
<span class="sd">        data point is, ranging from 0 (not OK) to 1 (super OK).</span>
<span class="sd">        In most cases, `.ok` will be binary, but there may be times</span>
<span class="sd">        where it&#39;s intermediate (for example, if a bin was created</span>
<span class="sd">        from some data that were not OK and some that were).</span>
<span class="sd">        The `minimum_acceptable_ok` parameter allows you to specify what</span>
<span class="sd">        level of OK-ness for a point to go into the binning.</span>
<span class="sd">        Reasonable options may include:</span>
<span class="sd">            minimum_acceptable_ok = 1</span>
<span class="sd">                  Only data points that are perfectly OK</span>
<span class="sd">                  will go into the binning.</span>
<span class="sd">            minimum_acceptable_ok = 1e-10</span>
<span class="sd">                  All data points that aren&#39;t definitely not OK</span>
<span class="sd">                  will go into the binning.</span>
<span class="sd">            minimum_acceptable_ok = 0</span>
<span class="sd">                  All data points will be included in the bin.</span>
<span class="sd">    minimum_points_per_bin : float</span>
<span class="sd">        If you&#39;re creating bins that are smaller than those in</span>
<span class="sd">        the original dataset, it&#39;s possible to end up with bins</span>
<span class="sd">        that effectively contain fewer than one original datapoint</span>
<span class="sd">        (in the sense that the contribution of one original datapoint</span>
<span class="sd">        might be split across multiple new bins). By default,</span>
<span class="sd">        we allow this behavior with `minimum_points_per_bin=0`, but you can</span>
<span class="sd">        limit your result to only bins that contain one or more</span>
<span class="sd">        original datapoints with `minimum_points_per_bin=1`.</span>
<span class="sd">    trim : bool</span>
<span class="sd">        Should any wavelengths or columns that end up</span>
<span class="sd">        as entirely nan be trimmed out of the result?</span>
<span class="sd">        (default = True)</span>
<span class="sd">    starting_wavelengths : str</span>
<span class="sd">        What wavelengths should be used as the starting</span>
<span class="sd">        value from which we will be binning? Options include:</span>
<span class="sd">        &#39;1D&#39; = (default) the shared 1D wavelengths for all times</span>
<span class="sd">               stored in `.wavelike[&#39;wavelength&#39;]`</span>
<span class="sd">        &#39;2D&#39; = (used only by `align_wavelengths`) the per-time 2D array</span>
<span class="sd">               stored in `.fluxlike[&#39;wavelength&#39;]`</span>
<span class="sd">        [Most users probably don&#39;t need to change this from default.]</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    binned : Rainbow</span>
<span class="sd">        The binned `Rainbow`.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># create a history entry for this action (before other variables are defined)</span>
    <span class="n">h</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_history_entry</span><span class="p">(</span><span class="s2">&quot;bin_in_wavelength&quot;</span><span class="p">,</span> <span class="nb">locals</span><span class="p">())</span>

    <span class="c1"># if no bin information is provided, don&#39;t bin</span>
    <span class="k">if</span> <span class="p">(</span>
        <span class="p">(</span><span class="n">wavelength</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span>
        <span class="ow">and</span> <span class="p">(</span><span class="n">wavelength_edges</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span>
        <span class="ow">and</span> <span class="p">(</span><span class="n">nwavelengths</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span>
        <span class="ow">and</span> <span class="p">(</span><span class="n">dw</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span>
        <span class="ow">and</span> <span class="p">(</span><span class="n">R</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span>
    <span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">if</span> <span class="p">(</span>
        <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_is_probably_normalized</span><span class="p">()</span> <span class="o">==</span> <span class="kc">False</span><span class="p">)</span>
        <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">uncertainty</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>
        <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">uncertainty</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
    <span class="p">):</span>

        <span class="n">cheerfully_suggest</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        It looks like you&#39;re trying to bin in wavelength for a</span>
<span class="s2">        `Rainbow` object that might not be normalized. In the</span>
<span class="s2">        current version of `chromatic`, binning before normalizing</span>
<span class="s2">        might give inaccurate results if the typical uncertainty</span>
<span class="s2">        varies strongly with wavelength.</span>

<span class="s2">        Please consider normalizing first, for example with</span>
<span class="s2">        `rainbow.normalize().bin(...)`</span>
<span class="s2">        so that all uncertainties will effectively be relative,</span>
<span class="s2">        and the inverse variance weighting used for binning</span>
<span class="s2">        wavelengths together will give more reasonable answers.</span>

<span class="s2">        If you really need to bin before normalizing, please submit</span>
<span class="s2">        an Issue at github.com/zkbt/chromatic/, and we&#39;ll try to</span>
<span class="s2">        prioritize implementing a statistically sound solution as</span>
<span class="s2">        soon as possible!</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="p">)</span>

    <span class="c1"># set up binning parameters</span>
    <span class="n">binkw</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">weighting</span><span class="o">=</span><span class="s2">&quot;inversevariance&quot;</span><span class="p">,</span> <span class="n">drop_nans</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="c1"># [`wavelength_edges`, `wavelength`, `dw`, `R`, `nwavelengths`]</span>
    <span class="k">if</span> <span class="n">wavelength_edges</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">binning_function</span> <span class="o">=</span> <span class="n">bintogrid</span>
        <span class="n">binkw</span><span class="p">[</span><span class="s2">&quot;newx_edges&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">wavelength_edges</span>
    <span class="k">elif</span> <span class="n">wavelength</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">binning_function</span> <span class="o">=</span> <span class="n">bintogrid</span>
        <span class="n">binkw</span><span class="p">[</span><span class="s2">&quot;newx&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">wavelength</span>
    <span class="k">elif</span> <span class="n">dw</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">binning_function</span> <span class="o">=</span> <span class="n">bintogrid</span>
        <span class="n">binkw</span><span class="p">[</span><span class="s2">&quot;dx&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dw</span>
    <span class="k">elif</span> <span class="n">R</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">binning_function</span> <span class="o">=</span> <span class="n">bintoR</span>
        <span class="n">binkw</span><span class="p">[</span><span class="s2">&quot;R&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">R</span>
    <span class="k">elif</span> <span class="n">nwavelengths</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">binning_function</span> <span class="o">=</span> <span class="n">bintogrid</span>
        <span class="n">binkw</span><span class="p">[</span><span class="s2">&quot;nx&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nwavelengths</span>

    <span class="c1"># create a new, empty Rainbow</span>
    <span class="n">new</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_copy</span><span class="p">()</span>

    <span class="c1"># populate the time information</span>
    <span class="n">new</span><span class="o">.</span><span class="n">timelike</span> <span class="o">=</span> <span class="p">{</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">timelike</span><span class="p">}</span>

    <span class="c1"># bin the time-like variables</span>
    <span class="c1"># TODO (add more careful treatment of uncertainty + DQ)</span>
    <span class="n">new</span><span class="o">.</span><span class="n">wavelike</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">wavelike</span><span class="p">:</span>
        <span class="n">binned</span> <span class="o">=</span> <span class="n">binning_function</span><span class="p">(</span>
            <span class="n">x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">wavelike</span><span class="p">[</span><span class="s2">&quot;wavelength&quot;</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">wavelike</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">unc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">binkw</span>
        <span class="p">)</span>
        <span class="n">new</span><span class="o">.</span><span class="n">wavelike</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">binned</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span>
    <span class="n">new</span><span class="o">.</span><span class="n">wavelike</span><span class="p">[</span><span class="s2">&quot;wavelength&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">binned</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">]</span>
    <span class="n">new</span><span class="o">.</span><span class="n">wavelike</span><span class="p">[</span><span class="s2">&quot;wavelength_lower&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">binned</span><span class="p">[</span><span class="s2">&quot;x_edge_lower&quot;</span><span class="p">]</span>
    <span class="n">new</span><span class="o">.</span><span class="n">wavelike</span><span class="p">[</span><span class="s2">&quot;wavelength_upper&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">binned</span><span class="p">[</span><span class="s2">&quot;x_edge_upper&quot;</span><span class="p">]</span>
    <span class="n">new</span><span class="o">.</span><span class="n">wavelike</span><span class="p">[</span><span class="s2">&quot;unbinned_wavelengths_per_binned_wavelength&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">binned</span><span class="p">[</span>
        <span class="s2">&quot;N_unbinned/N_binned&quot;</span>
    <span class="p">]</span>
    <span class="n">uncertainty_per_wavelength</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_expected_uncertainty</span><span class="p">()</span>
    <span class="n">uncertainty_weighted_binned</span> <span class="o">=</span> <span class="n">binning_function</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">wavelike</span><span class="p">[</span><span class="s2">&quot;wavelength&quot;</span><span class="p">],</span>
        <span class="n">y</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">wavelike</span><span class="p">[</span><span class="s2">&quot;wavelength&quot;</span><span class="p">],</span>
        <span class="n">unc</span><span class="o">=</span><span class="n">uncertainty_per_wavelength</span><span class="p">,</span>
        <span class="o">**</span><span class="n">binkw</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">new</span><span class="o">.</span><span class="n">wavelike</span><span class="p">[</span><span class="s2">&quot;effective_wavelength&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">uncertainty_weighted_binned</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span>

    <span class="c1"># bin the flux-like variables</span>
    <span class="c1"># TODO (add more careful treatment of uncertainty + DQ)</span>
    <span class="c1"># TODO (think about cleverer bintogrid for 2D arrays)</span>
    <span class="n">new</span><span class="o">.</span><span class="n">fluxlike</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># get a fluxlike array of what&#39;s OK to include in the bins</span>
    <span class="n">ok</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ok</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">new</span><span class="o">.</span><span class="n">ntime</span><span class="p">),</span> <span class="n">leave</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>

        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fluxlike</span><span class="p">:</span>

            <span class="c1"># mask out &quot;bad&quot; wavelengths</span>
            <span class="n">wavelength_is_bad</span> <span class="o">=</span> <span class="n">ok</span><span class="p">[:,</span> <span class="n">t</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">minimum_acceptable_ok</span>

            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">uncertainty</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">uncertainty</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
                <span class="n">uncertainty_for_binning</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nwave</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_keys_that_get_uncertainty_weighting</span><span class="p">:</span>
                <span class="n">uncertainty_for_binning</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">uncertainty</span><span class="p">[:,</span> <span class="n">t</span><span class="p">]</span> <span class="o">*</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">uncertainty_for_binning</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nwave</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">k</span> <span class="o">!=</span> <span class="s2">&quot;ok&quot;</span><span class="p">:</span>
                <span class="n">uncertainty_for_binning</span><span class="p">[</span><span class="n">wavelength_is_bad</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>

            <span class="k">if</span> <span class="n">starting_wavelengths</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;1D&quot;</span><span class="p">:</span>
                <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wavelike</span><span class="p">[</span><span class="s2">&quot;wavelength&quot;</span><span class="p">][:]</span>
            <span class="k">elif</span> <span class="n">starting_wavelengths</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;2D&quot;</span><span class="p">:</span>
                <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fluxlike</span><span class="p">[</span><span class="s2">&quot;wavelength_2d&quot;</span><span class="p">][:,</span> <span class="n">t</span><span class="p">]</span>
            <span class="c1"># bin the quantities for this time</span>
            <span class="n">binned</span> <span class="o">=</span> <span class="n">binning_function</span><span class="p">(</span>
                <span class="n">x</span><span class="o">=</span><span class="n">w</span><span class="p">,</span>
                <span class="n">y</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fluxlike</span><span class="p">[</span><span class="n">k</span><span class="p">][:,</span> <span class="n">t</span><span class="p">]</span> <span class="o">*</span> <span class="mi">1</span><span class="p">,</span>
                <span class="n">unc</span><span class="o">=</span><span class="n">uncertainty_for_binning</span><span class="p">,</span>
                <span class="o">**</span><span class="n">binkw</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="c1"># if necessary, create a new fluxlike array</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">new</span><span class="o">.</span><span class="n">fluxlike</span><span class="p">:</span>
                <span class="n">new_shape</span> <span class="o">=</span> <span class="p">(</span><span class="n">new</span><span class="o">.</span><span class="n">nwave</span><span class="p">,</span> <span class="n">new</span><span class="o">.</span><span class="n">ntime</span><span class="p">)</span>
                <span class="n">new</span><span class="o">.</span><span class="n">fluxlike</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">new_shape</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fluxlike</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">):</span>
                    <span class="n">new</span><span class="o">.</span><span class="n">fluxlike</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fluxlike</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">unit</span>

            <span class="c1"># store the binned array in the appropriate place</span>
            <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="s2">&quot;uncertainty&quot;</span><span class="p">:</span>
                <span class="c1"># uncertainties are usually standard error on the mean</span>
                <span class="n">new</span><span class="o">.</span><span class="n">fluxlike</span><span class="p">[</span><span class="n">k</span><span class="p">][:,</span> <span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">binned</span><span class="p">[</span><span class="s2">&quot;uncertainty&quot;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># note: all quantities are weighted the same as flux (probably inversevariance)</span>
                <span class="n">new</span><span class="o">.</span><span class="n">fluxlike</span><span class="p">[</span><span class="n">k</span><span class="p">][:,</span> <span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">binned</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">new</span><span class="o">.</span><span class="n">nwave</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">new</span><span class="o">.</span><span class="n">ntime</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
        <span class="n">message</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        You tried to bin </span><span class="si">{</span><span class="bp">self</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">new</span><span class="si">}</span><span class="s2">.</span>

<span class="s2">        After accounting for `minimum_acceptable_ok &gt; </span><span class="si">{</span><span class="n">minimum_acceptable_ok</span><span class="si">}</span><span class="s2">`,</span>
<span class="s2">        all new bins would end up with no usable data points.</span>
<span class="s2">        Please (a) make sure your input `Rainbow` has at least</span>
<span class="s2">        one wavelength and time, (b) check `.ok` accurately expresses</span>
<span class="s2">        which data you think are usable, (c) change the `minimum_acceptable_ok`</span>
<span class="s2">        keyword for `.bin` to a smaller value, and/or (d) try larger bins.</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="n">cheerfully_suggest</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;No good data to bin! (see above)&quot;</span><span class="p">)</span>

    <span class="c1"># make sure dictionaries are on the up and up</span>
    <span class="n">new</span><span class="o">.</span><span class="n">_validate_core_dictionaries</span><span class="p">()</span>

    <span class="c1"># figure out the scales, after binning</span>
    <span class="n">new</span><span class="o">.</span><span class="n">_guess_wscale</span><span class="p">()</span>
    <span class="n">new</span><span class="o">.</span><span class="n">_guess_tscale</span><span class="p">()</span>

    <span class="c1"># append the history entry to the new Rainbow</span>
    <span class="n">new</span><span class="o">.</span><span class="n">_record_history_entry</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>

    <span class="c1"># deal with bins that are smaller than original</span>
    <span class="n">N</span> <span class="o">=</span> <span class="n">new</span><span class="o">.</span><span class="n">wavelike</span><span class="p">[</span><span class="s2">&quot;unbinned_wavelengths_per_binned_wavelength&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">minimum_points_per_bin</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">_warn_about_weird_binning</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="s2">&quot;wavelength&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ok</span> <span class="o">=</span> <span class="n">new</span><span class="o">.</span><span class="n">wavelike</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;ok&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">new</span><span class="o">.</span><span class="n">nwave</span><span class="p">,</span> <span class="nb">bool</span><span class="p">))</span>
        <span class="n">new</span><span class="o">.</span><span class="n">wavelike</span><span class="p">[</span><span class="s2">&quot;ok&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ok</span> <span class="o">*</span> <span class="p">(</span><span class="n">N</span> <span class="o">&gt;=</span> <span class="n">minimum_points_per_bin</span><span class="p">)</span>

    <span class="c1"># return the new Rainbow (with trimming if necessary)</span>
    <span class="k">if</span> <span class="n">trim</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">new</span><span class="o">.</span><span class="n">trim_wavelengths</span><span class="p">(</span><span class="n">minimum_acceptable_ok</span><span class="o">=</span><span class="n">minimum_acceptable_ok</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">new</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.actions.binning.bintoR" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">bintoR</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">unc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">R</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">weighting</span><span class="o">=</span><span class="s1">&#39;inversevariance&#39;</span><span class="p">,</span> <span class="n">drop_nans</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.actions.binning.bintoR" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Bin any x and y array onto a logarithmicly uniform grid.</p>
<h4 id="chromatic.rainbows.actions.binning.bintoR--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.actions.binning.bintoR--parameters" title="Permanent link">#</a></h4>
<p>x : array
    The original independent variable.
    (For a spectrum example = wavelength)
y : array
    The original dependent variable (same size as x).
    (For a spectrum example = flux)
unc : array, None, optional
    The unceratinty on the dependent variable
    (For a spectrum example = the flux uncertainty)
R : array, optional
    The spectral resolution R=x/dx for creating a new,
    logarithmically uniform grid that starts at the first
    value of x.
xlim : list, array, optional
    A two-element list indicating the min and max values of
    x for the new logarithmically spaced grid. If None,
    these limits will be created from the data themselves
weighting : str, optional
    How should we weight values when averaging
    them together into one larger bin?
    <code>weighting = 'inversevariance'</code>
        weights = 1/unc**2
     <code>weighting = {literally anything else}</code>
        uniform weights
    This will have no impact if <code>unc == None</code>, or for any
    new bins that effectively overlap less than one original
    unbinned point.
drop_nans : bool, optional
    Should we skip any bins turn out to be nans?
    This most often happens when bins are empty.</p>
<h4 id="chromatic.rainbows.actions.binning.bintoR--returns">Returns<a class="headerlink" href="#chromatic.rainbows.actions.binning.bintoR--returns" title="Permanent link">#</a></h4>
<p>result : dict
    A dictionary containing at least...
        <code>x</code> = the center of the output grid
        <code>y</code> = the resampled value on the output grid
        <code>x_edge_lower</code> = the lower edges of the output grid
        <code>x_edge_upper</code> = the upper edges of the output grid
    ...and possibly also
        <code>uncertainty</code> = the calculated uncertainty per bin</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/tools/resampling.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">bintoR</span><span class="p">(</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">unc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">R</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">weighting</span><span class="o">=</span><span class="s2">&quot;inversevariance&quot;</span><span class="p">,</span> <span class="n">drop_nans</span><span class="o">=</span><span class="kc">True</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Bin any x and y array onto a logarithmicly uniform grid.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : array</span>
<span class="sd">        The original independent variable.</span>
<span class="sd">        (For a spectrum example = wavelength)</span>
<span class="sd">    y : array</span>
<span class="sd">        The original dependent variable (same size as x).</span>
<span class="sd">        (For a spectrum example = flux)</span>
<span class="sd">    unc : array, None, optional</span>
<span class="sd">        The unceratinty on the dependent variable</span>
<span class="sd">        (For a spectrum example = the flux uncertainty)</span>
<span class="sd">    R : array, optional</span>
<span class="sd">        The spectral resolution R=x/dx for creating a new,</span>
<span class="sd">        logarithmically uniform grid that starts at the first</span>
<span class="sd">        value of x.</span>
<span class="sd">    xlim : list, array, optional</span>
<span class="sd">        A two-element list indicating the min and max values of</span>
<span class="sd">        x for the new logarithmically spaced grid. If None,</span>
<span class="sd">        these limits will be created from the data themselves</span>
<span class="sd">    weighting : str, optional</span>
<span class="sd">        How should we weight values when averaging</span>
<span class="sd">        them together into one larger bin?</span>
<span class="sd">        `weighting = &#39;inversevariance&#39;`</span>
<span class="sd">            weights = 1/unc**2</span>
<span class="sd">         `weighting = {literally anything else}`</span>
<span class="sd">            uniform weights</span>
<span class="sd">        This will have no impact if `unc == None`, or for any</span>
<span class="sd">        new bins that effectively overlap less than one original</span>
<span class="sd">        unbinned point.</span>
<span class="sd">    drop_nans : bool, optional</span>
<span class="sd">        Should we skip any bins turn out to be nans?</span>
<span class="sd">        This most often happens when bins are empty.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    result : dict</span>
<span class="sd">        A dictionary containing at least...</span>
<span class="sd">            `x` = the center of the output grid</span>
<span class="sd">            `y` = the resampled value on the output grid</span>
<span class="sd">            `x_edge_lower` = the lower edges of the output grid</span>
<span class="sd">            `x_edge_upper` = the upper edges of the output grid</span>
<span class="sd">        ...and possibly also</span>
<span class="sd">            `uncertainty` = the calculated uncertainty per bin</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">x_unit</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">unit</span>
        <span class="n">x_without_unit</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">value</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="n">x_unit</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">x_without_unit</span> <span class="o">=</span> <span class="n">x</span>

    <span class="c1"># create a new grid of x at the given resolution</span>
    <span class="n">lnx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">x_without_unit</span><span class="p">)</span>
    <span class="n">dnewlnx</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">R</span>

    <span class="c1"># set the limits of the new xgrid (in log space)</span>
    <span class="k">if</span> <span class="n">xlim</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># use the input grid to set the limits</span>
        <span class="n">lnxbottom</span><span class="p">,</span> <span class="n">lnxtop</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">lnx</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">lnx</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># use the custom xlim to set the limits</span>
        <span class="n">lnxbottom</span><span class="p">,</span> <span class="n">lnxtop</span> <span class="o">=</span> <span class="n">xlim</span>

    <span class="c1"># create a new, log-uniform grid of x values</span>
    <span class="n">newlnx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">lnxbottom</span><span class="p">,</span> <span class="n">lnxtop</span> <span class="o">+</span> <span class="n">dnewlnx</span><span class="p">,</span> <span class="n">dnewlnx</span><span class="p">)</span>

    <span class="c1"># now do the binning on a uniform grid of lnx</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">bintogrid</span><span class="p">(</span>
        <span class="n">lnx</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">unc</span><span class="p">,</span> <span class="n">newx</span><span class="o">=</span><span class="n">newlnx</span><span class="p">,</span> <span class="n">weighting</span><span class="o">=</span><span class="n">weighting</span><span class="p">,</span> <span class="n">drop_nans</span><span class="o">=</span><span class="n">drop_nans</span>
    <span class="p">)</span>

    <span class="c1"># convert back from log to real values</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;x_edge_lower&quot;</span><span class="p">,</span> <span class="s2">&quot;x_edge_upper&quot;</span><span class="p">]:</span>
        <span class="n">result</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="o">*</span> <span class="n">x_unit</span>

    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.actions.binning.bintogrid" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">bintogrid</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">unc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">newx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">newx_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">nx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">weighting</span><span class="o">=</span><span class="s1">&#39;inversevariance&#39;</span><span class="p">,</span> <span class="n">drop_nans</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">x_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">visualize</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.actions.binning.bintogrid" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Bin any x and y array onto a linearly uniform grid.</p>
<h4 id="chromatic.rainbows.actions.binning.bintogrid--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.actions.binning.bintogrid--parameters" title="Permanent link">#</a></h4>
<p>x : array
    The original independent variable.
    (For a spectrum example = wavelength)
y : array
    The original dependent variable (same size as x).
    (For a spectrum example = flux)
unc : array, None
    The unceratinty on the dependent variable
    (For a spectrum example = the flux uncertainty)
nx : array
    The number of bins from the original grid to
    bin together into the new one.
dx : array
    The fixed spacing for creating a new, linearly uniform
    grid that start at the first value of x. This will
    be ignored if <code>newx</code> != None.
newx : array
    A new custom grid onto which we should bin.
newx_edges : array
    The edges of the new grid of bins for the independent
    variable, onto which you want to resample the y
    values. The left and right edges of the bins will be,
    respectively, <code>newx_edges[:-1]</code> and <code>newx_edges[1:]</code>,
    so the size of the output array will be
    <code>len(newx_edges) - 1</code>
weighting : str
    How should we weight values when averaging
    them together into one larger bin?
    <code>weighting = 'inversevariance'</code>
        weights = 1/unc**2
     <code>weighting = {literally anything else}</code>
        uniform weights
    This will have no impact if <code>unc == None</code>, or for any
    new bins that effectively overlap less than one original
    unbinned point.
drop_nans : bool
    Should we skip any bins turn out to be nans?
    This most often happens when bins are empty.
x_edges : array
    The edges of the original independent variable bins.
    The left and right edges of the bins are interpreted
    to be <code>x_edges[:-1]</code> and <code>x_edges[1:]</code>,
    respectively, so the associated <code>y</code> should have exactly
    1 fewer element than <code>x_edges</code>. This provides finer
    control over the size of each bin in the input than
    simply supplying <code>x</code>(still a little experimental)</p>
<h4 id="chromatic.rainbows.actions.binning.bintogrid--returns">Returns<a class="headerlink" href="#chromatic.rainbows.actions.binning.bintogrid--returns" title="Permanent link">#</a></h4>
<p>result : dict
    A dictionary containing at least...
        <code>x</code> = the center of the output grid
        <code>y</code> = the resampled value on the output grid
        <code>x_edge_lower</code> = the lower edges of the output grid
        <code>x_edge_upper</code> = the upper edges of the output grid
    ...and possibly also
        <code>uncertainty</code> = the calculated uncertainty per bin</p>
<p>The order of precendence for setting the new grid is
[<code>newx_edges</code>, <code>newx</code>, <code>dx</code>, <code>nx</code>]
The first will be used, and others will be ignored.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/tools/resampling.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">bintogrid</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">unc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">newx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">newx_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">dx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">nx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">weighting</span><span class="o">=</span><span class="s2">&quot;inversevariance&quot;</span><span class="p">,</span>
    <span class="n">drop_nans</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">x_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">visualize</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Bin any x and y array onto a linearly uniform grid.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : array</span>
<span class="sd">        The original independent variable.</span>
<span class="sd">        (For a spectrum example = wavelength)</span>
<span class="sd">    y : array</span>
<span class="sd">        The original dependent variable (same size as x).</span>
<span class="sd">        (For a spectrum example = flux)</span>
<span class="sd">    unc : array, None</span>
<span class="sd">        The unceratinty on the dependent variable</span>
<span class="sd">        (For a spectrum example = the flux uncertainty)</span>
<span class="sd">    nx : array</span>
<span class="sd">        The number of bins from the original grid to</span>
<span class="sd">        bin together into the new one.</span>
<span class="sd">    dx : array</span>
<span class="sd">        The fixed spacing for creating a new, linearly uniform</span>
<span class="sd">        grid that start at the first value of x. This will</span>
<span class="sd">        be ignored if `newx` != None.</span>
<span class="sd">    newx : array</span>
<span class="sd">        A new custom grid onto which we should bin.</span>
<span class="sd">    newx_edges : array</span>
<span class="sd">        The edges of the new grid of bins for the independent</span>
<span class="sd">        variable, onto which you want to resample the y</span>
<span class="sd">        values. The left and right edges of the bins will be,</span>
<span class="sd">        respectively, `newx_edges[:-1]` and `newx_edges[1:]`,</span>
<span class="sd">        so the size of the output array will be</span>
<span class="sd">        `len(newx_edges) - 1`</span>
<span class="sd">    weighting : str</span>
<span class="sd">        How should we weight values when averaging</span>
<span class="sd">        them together into one larger bin?</span>
<span class="sd">        `weighting = &#39;inversevariance&#39;`</span>
<span class="sd">            weights = 1/unc**2</span>
<span class="sd">         `weighting = {literally anything else}`</span>
<span class="sd">            uniform weights</span>
<span class="sd">        This will have no impact if `unc == None`, or for any</span>
<span class="sd">        new bins that effectively overlap less than one original</span>
<span class="sd">        unbinned point.</span>
<span class="sd">    drop_nans : bool</span>
<span class="sd">        Should we skip any bins turn out to be nans?</span>
<span class="sd">        This most often happens when bins are empty.</span>
<span class="sd">    x_edges : array</span>
<span class="sd">        The edges of the original independent variable bins.</span>
<span class="sd">        The left and right edges of the bins are interpreted</span>
<span class="sd">        to be `x_edges[:-1]` and `x_edges[1:]`,</span>
<span class="sd">        respectively, so the associated `y` should have exactly</span>
<span class="sd">        1 fewer element than `x_edges`. This provides finer</span>
<span class="sd">        control over the size of each bin in the input than</span>
<span class="sd">        simply supplying `x`(still a little experimental)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    result : dict</span>
<span class="sd">        A dictionary containing at least...</span>
<span class="sd">            `x` = the center of the output grid</span>
<span class="sd">            `y` = the resampled value on the output grid</span>
<span class="sd">            `x_edge_lower` = the lower edges of the output grid</span>
<span class="sd">            `x_edge_upper` = the upper edges of the output grid</span>
<span class="sd">        ...and possibly also</span>
<span class="sd">            `uncertainty` = the calculated uncertainty per bin</span>


<span class="sd">    The order of precendence for setting the new grid is</span>
<span class="sd">    [`newx_edges`, `newx`, `dx`, `nx`]</span>
<span class="sd">    The first will be used, and others will be ignored.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># check that an OK set of inputs has been supplied</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">x_edges</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;🌈 Both `x` and `x_edges` were supplied to `bintogrid`. Confusing!&quot;&quot;&quot;</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">x_edges</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;🌈 At least one of `x` or `x_edges` must be supplied to `bintogrid`.&quot;&quot;&quot;</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="n">y</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;🌈 `y` must be supplied to `bintogrid`.&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="c1"># make sure the edges and the centers are set</span>
    <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">x_left</span><span class="p">,</span> <span class="n">x_right</span> <span class="o">=</span> <span class="n">edges_to_leftright</span><span class="p">(</span><span class="n">x_edges</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">left</span> <span class="o">+</span> <span class="n">right</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">x_left</span><span class="p">,</span> <span class="n">x_right</span> <span class="o">=</span> <span class="n">calculate_bin_leftright</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">x_edges</span> <span class="o">=</span> <span class="n">leftright_to_edges</span><span class="p">(</span><span class="n">x_left</span><span class="p">,</span> <span class="n">x_right</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">x_unit</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">unit</span>
        <span class="n">x_without_unit</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">value</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="n">x_unit</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">x_without_unit</span> <span class="o">=</span> <span class="n">x</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">y_unit</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">unit</span>
        <span class="n">y_without_unit</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">value</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="n">y_unit</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">y_without_unit</span> <span class="o">=</span> <span class="n">y</span>

    <span class="c1"># warn if multiple inputs are provided</span>
    <span class="n">number_of_grid_options</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span><span class="n">z</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="p">[</span><span class="n">newx_edges</span><span class="p">,</span> <span class="n">newx</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">nx</span><span class="p">]])</span>
    <span class="k">if</span> <span class="n">number_of_grid_options</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">cheerfully_suggest</span><span class="p">(</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;More than one output grid sent to `bintogrid`.</span>
<span class="sd">                         The one being used is the first to appear in</span>
<span class="sd">                         [`newx_edges`, `newx`, `dx`, `nx`]</span>
<span class="sd">                         but you might want to choose more carefully.&quot;&quot;&quot;</span>
        <span class="p">)</span>

    <span class="c1"># define inputs based on the following order</span>
    <span class="k">if</span> <span class="n">newx_edges</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># define grid by its edges (and define others from there)</span>
        <span class="n">newx_edges_without_unit</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">newx_edges</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">x_unit</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
        <span class="n">dx_without_unit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">newx_edges_without_unit</span><span class="p">)</span>
        <span class="n">newx_without_unit</span> <span class="o">=</span> <span class="n">newx_edges_without_unit</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">dx_without_unit</span>
        <span class="n">newx_left_without_unit</span> <span class="o">=</span> <span class="n">newx_edges_without_unit</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">newx_right_without_unit</span> <span class="o">=</span> <span class="n">newx_edges_without_unit</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

        <span class="c1"># make sure the final output grid is defined</span>
        <span class="n">final_newx</span><span class="p">,</span> <span class="n">final_newx_left</span><span class="p">,</span> <span class="n">final_newx_right</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">newx_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
            <span class="n">newx_left_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
            <span class="n">newx_right_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="n">newx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># define grid by its centers (and define others from there)</span>
        <span class="n">newx_without_unit</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">newx</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">x_unit</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
        <span class="n">newx_left_without_unit</span><span class="p">,</span> <span class="n">newx_right_without_unit</span> <span class="o">=</span> <span class="n">calculate_bin_leftright</span><span class="p">(</span>
            <span class="n">newx_without_unit</span>
        <span class="p">)</span>
        <span class="n">newx_edges_without_unit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span>
            <span class="p">[</span><span class="n">newx_left_without_unit</span><span class="p">,</span> <span class="n">newx_right_without_unit</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
        <span class="p">)</span>
        <span class="n">dx_without_unit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">newx_edges_without_unit</span><span class="p">)</span>

        <span class="c1"># make sure the final output grid is defined</span>
        <span class="n">final_newx</span><span class="p">,</span> <span class="n">final_newx_left</span><span class="p">,</span> <span class="n">final_newx_right</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">newx_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
            <span class="n">newx_left_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
            <span class="n">newx_right_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="n">dx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># define grid by a bin width (and define others from there)</span>
        <span class="n">dx_without_unit</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">dx</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">x_unit</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
        <span class="n">newx_without_unit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">x_without_unit</span><span class="p">),</span>
            <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">x_without_unit</span><span class="p">)</span> <span class="o">+</span> <span class="n">dx_without_unit</span><span class="p">,</span>
            <span class="n">dx_without_unit</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">newx_left_without_unit</span><span class="p">,</span> <span class="n">newx_right_without_unit</span> <span class="o">=</span> <span class="n">calculate_bin_leftright</span><span class="p">(</span>
            <span class="n">newx_without_unit</span>
        <span class="p">)</span>
        <span class="n">newx_edges_without_unit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span>
            <span class="p">[</span><span class="n">newx_left_without_unit</span><span class="p">,</span> <span class="n">newx_right_without_unit</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
        <span class="p">)</span>

        <span class="c1"># make sure the final output grid is defined</span>
        <span class="n">final_newx</span><span class="p">,</span> <span class="n">final_newx_left</span><span class="p">,</span> <span class="n">final_newx_right</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">newx_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
            <span class="n">newx_left_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
            <span class="n">newx_right_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">elif</span> <span class="n">nx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># keep track of the original input x values</span>
        <span class="n">original_x_without_unit</span> <span class="o">=</span> <span class="n">x_without_unit</span>

        <span class="c1"># redefine the input x to indices, to do interpolation in index space</span>
        <span class="n">x_without_unit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">x_without_unit</span><span class="p">))</span>

        <span class="c1"># define a grid of edges that will enclose the right number of indices</span>
        <span class="n">x_left_i</span><span class="p">,</span> <span class="n">x_right_i</span> <span class="o">=</span> <span class="n">calculate_bin_leftright</span><span class="p">(</span><span class="n">x_without_unit</span><span class="p">)</span>
        <span class="n">newx_edges_without_unit</span> <span class="o">=</span> <span class="n">leftright_to_edges</span><span class="p">(</span><span class="n">x_left_i</span><span class="p">,</span> <span class="n">x_right_i</span><span class="p">)[::</span><span class="n">nx</span><span class="p">]</span>
        <span class="n">newx_without_unit</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span>
            <span class="n">newx_edges_without_unit</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">+</span> <span class="n">newx_edges_without_unit</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="p">)</span>

        <span class="c1"># calculate the actual x values corresponding to the bins</span>
        <span class="n">original_edges</span> <span class="o">=</span> <span class="n">leftright_to_edges</span><span class="p">(</span>
            <span class="o">*</span><span class="n">calculate_bin_leftright</span><span class="p">(</span><span class="n">original_x_without_unit</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">final_edges</span> <span class="o">=</span> <span class="n">original_edges</span><span class="p">[::</span><span class="n">nx</span><span class="p">]</span> <span class="o">*</span> <span class="n">x_unit</span>
        <span class="n">final_newx_left</span><span class="p">,</span> <span class="n">final_newx_right</span> <span class="o">=</span> <span class="n">edges_to_leftright</span><span class="p">(</span><span class="n">final_edges</span><span class="p">)</span>
        <span class="n">final_newx</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">final_newx_left</span> <span class="o">+</span> <span class="n">final_newx_right</span><span class="p">)</span>
        <span class="n">dx_without_unit</span> <span class="o">=</span> <span class="p">(</span><span class="n">final_newx_right</span> <span class="o">-</span> <span class="n">final_newx_left</span><span class="p">)</span> <span class="o">/</span> <span class="n">x_unit</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;No output grid sent to `bintogrid`.</span>
<span class="sd">                              Please choose one of the following:</span>
<span class="sd">                              [`newx_edges`, `newx`, `dx`, `nx`]&quot;&quot;&quot;</span>
        <span class="p">)</span>

    <span class="c1"># don&#39;t complain about zero-divisions in here (to allow infinite uncertainties)</span>
    <span class="k">with</span> <span class="n">np</span><span class="o">.</span><span class="n">errstate</span><span class="p">(</span><span class="n">divide</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">invalid</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">):</span>

        <span class="c1"># calculate weight integrals for the bin array</span>
        <span class="n">ok</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">y_without_unit</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span>

        <span class="c1"># resample the sums onto that new grid</span>
        <span class="k">if</span> <span class="n">unc</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">x_without_unit</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">weighting</span> <span class="o">==</span> <span class="s2">&quot;inversevariance&quot;</span><span class="p">:</span>
                <span class="n">weights</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">unc</span><span class="o">**</span><span class="mi">2</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">x_without_unit</span><span class="p">)</span>

            <span class="c1"># ignore infinite weights (= 0 uncertainties)</span>
            <span class="n">ok</span> <span class="o">*=</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">ok</span><span class="p">):</span>
            <span class="n">numerator</span> <span class="o">=</span> <span class="n">resample_while_conserving_flux</span><span class="p">(</span>
                <span class="n">xin</span><span class="o">=</span><span class="n">x_without_unit</span><span class="p">[</span><span class="n">ok</span><span class="p">],</span>
                <span class="n">yin</span><span class="o">=</span><span class="p">(</span><span class="n">y_without_unit</span> <span class="o">*</span> <span class="n">weights</span><span class="p">)[</span><span class="n">ok</span><span class="p">],</span>
                <span class="n">xout_edges</span><span class="o">=</span><span class="n">newx_edges_without_unit</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">denominator</span> <span class="o">=</span> <span class="n">resample_while_conserving_flux</span><span class="p">(</span>
                <span class="n">xin</span><span class="o">=</span><span class="n">x_without_unit</span><span class="p">[</span><span class="n">ok</span><span class="p">],</span>
                <span class="n">yin</span><span class="o">=</span><span class="n">weights</span><span class="p">[</span><span class="n">ok</span><span class="p">],</span>
                <span class="n">xout_edges</span><span class="o">=</span><span class="n">newx_edges_without_unit</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="c1"># the binned weighted means on the new grid</span>
            <span class="n">newy</span> <span class="o">=</span> <span class="n">numerator</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">denominator</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span>

            <span class="c1"># the standard error on the means, for those bins</span>
            <span class="n">newunc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">denominator</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">])</span>

            <span class="c1"># keep track of the number of original bins going into each new bin</span>
            <span class="n">number_of_original_bins_per_new_bin</span> <span class="o">=</span> <span class="n">resample_while_conserving_flux</span><span class="p">(</span>
                <span class="n">xin</span><span class="o">=</span><span class="n">x_without_unit</span><span class="p">[</span><span class="n">ok</span><span class="p">],</span>
                <span class="n">yin</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">y_without_unit</span><span class="p">)[</span><span class="n">ok</span><span class="p">],</span>
                <span class="n">xout_edges</span><span class="o">=</span><span class="n">newx_edges_without_unit</span><span class="p">,</span>
            <span class="p">)[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">newy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="o">*</span> <span class="n">newx_without_unit</span>
            <span class="n">newunc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="o">*</span> <span class="n">newx_without_unit</span>
            <span class="n">number_of_original_bins_per_new_bin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">newx_without_unit</span><span class="p">)</span>

    <span class="c1"># remove any empty bins</span>
    <span class="k">if</span> <span class="n">drop_nans</span><span class="p">:</span>
        <span class="n">ok</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">newy</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ok</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">newx_without_unit</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>

    <span class="c1"># if no uncertainties were given, don&#39;t return uncertainties</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># populate the new grid centers + edges + values</span>
    <span class="n">result</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">final_newx</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span>
    <span class="n">result</span><span class="p">[</span><span class="s2">&quot;x_edge_lower&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">final_newx_left</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span>
    <span class="n">result</span><span class="p">[</span><span class="s2">&quot;x_edge_upper&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">final_newx_right</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span>

    <span class="c1"># populate the new grid values</span>
    <span class="n">result</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">newy</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span> <span class="o">*</span> <span class="n">y_unit</span>

    <span class="c1"># populate the new grid value uncertainties</span>
    <span class="k">if</span> <span class="n">unc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">result</span><span class="p">[</span><span class="s2">&quot;uncertainty&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">newunc</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span> <span class="o">*</span> <span class="n">y_unit</span>

    <span class="c1"># store how many of the original pixels made it into this new one</span>
    <span class="n">result</span><span class="p">[</span><span class="s2">&quot;N_unbinned/N_binned&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">number_of_original_bins_per_new_bin</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">visualize</span><span class="p">:</span>
        <span class="n">fi</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span>
            <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">gridspec_kw</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">height_ratios</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">])</span>
        <span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">plot_as_boxes</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">xleft</span><span class="o">=</span><span class="n">x_left</span><span class="p">,</span> <span class="n">xright</span><span class="o">=</span><span class="n">x_right</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;silver&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">ekw</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">elinewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">unc</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;silver&quot;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">ekw</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">],</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">],</span>
            <span class="n">yerr</span><span class="o">=</span><span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;uncertainty&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
            <span class="n">xerr</span><span class="o">=</span><span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s2">&quot;x_edge_upper&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;x_edge_lower&quot;</span><span class="p">])</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
            <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
            <span class="n">zorder</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
            <span class="o">**</span><span class="n">ekw</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">plot_as_boxes</span><span class="p">(</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">],</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;N_unbinned/N_binned&quot;</span><span class="p">],</span>
            <span class="n">xleft</span><span class="o">=</span><span class="n">result</span><span class="p">[</span><span class="s2">&quot;x_edge_lower&quot;</span><span class="p">],</span>
            <span class="n">xright</span><span class="o">=</span><span class="n">result</span><span class="p">[</span><span class="s2">&quot;x_edge_upper&quot;</span><span class="p">],</span>
        <span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;$N_</span><span class="si">{unbinned}</span><span class="s2">/N_</span><span class="si">{binned}</span><span class="s2">$&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.actions.binning.calculate_bin_leftright" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">calculate_bin_leftright</span><span class="p">(</span><span class="n">x</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.actions.binning.calculate_bin_leftright" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>If x is an array of bin centers, calculate the bin edges.
(assumes outermost bins are same size as their neighbors)</p>
<h4 id="chromatic.rainbows.actions.binning.calculate_bin_leftright--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.actions.binning.calculate_bin_leftright--parameters" title="Permanent link">#</a></h4>
<p>x : array
    The array of bin centers.</p>
<h4 id="chromatic.rainbows.actions.binning.calculate_bin_leftright--returns">Returns<a class="headerlink" href="#chromatic.rainbows.actions.binning.calculate_bin_leftright--returns" title="Permanent link">#</a></h4>
<p>l : array
    The left edges of the bins.
r : array
    The right edges of the bins.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/tools/resampling.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">calculate_bin_leftright</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    If x is an array of bin centers, calculate the bin edges.</span>
<span class="sd">    (assumes outermost bins are same size as their neighbors)</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : array</span>
<span class="sd">        The array of bin centers.</span>

<span class="sd">    Returns</span>
<span class="sd">    ----------</span>
<span class="sd">    l : array</span>
<span class="sd">        The left edges of the bins.</span>
<span class="sd">    r : array</span>
<span class="sd">        The right edges of the bins.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># what are bin edges (making a guess for those on the ends)</span>
    <span class="c1"># xbinsize = calculate_bin_widths(x)</span>
    <span class="c1"># left = x - xbinsize / 2.0</span>
    <span class="c1"># right = x + xbinsize / 2.0</span>

    <span class="c1"># weird corner case!</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">left</span><span class="p">,</span> <span class="n">right</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">left</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">right</span><span class="p">])</span>

    <span class="n">inner_edges</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="n">x</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">first_edge</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="n">inner_edges</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">last_edge</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">inner_edges</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

    <span class="n">left</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">first_edge</span><span class="p">,</span> <span class="n">inner_edges</span><span class="p">])</span>
    <span class="n">right</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">inner_edges</span><span class="p">,</span> <span class="n">last_edge</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.actions.binning.edges_to_leftright" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">edges_to_leftright</span><span class="p">(</span><span class="n">edges</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.actions.binning.edges_to_leftright" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Convert N+1 contiguous edges to two arrays of N left/right edges.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/tools/resampling.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">edges_to_leftright</span><span class="p">(</span><span class="n">edges</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert N+1 contiguous edges to two arrays of N left/right edges.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">left</span><span class="p">,</span> <span class="n">right</span> <span class="o">=</span> <span class="n">edges</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">edges</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="k">return</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.actions.binning.expand_filenames" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">expand_filenames</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.actions.binning.expand_filenames" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>A wrapper to expand a string or list into a list of filenames.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/imports.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">expand_filenames</span><span class="p">(</span><span class="n">filepath</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A wrapper to expand a string or list into a list of filenames.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
        <span class="n">filenames</span> <span class="o">=</span> <span class="n">filepath</span>
    <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span> <span class="o">==</span> <span class="n">Column</span><span class="p">:</span>
        <span class="n">filenames</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>
    <span class="k">elif</span> <span class="s2">&quot;*&quot;</span> <span class="ow">in</span> <span class="n">filepath</span><span class="p">:</span>
        <span class="n">filenames</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">filepath</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">filenames</span> <span class="o">=</span> <span class="p">[</span><span class="n">filepath</span><span class="p">]</span>
    <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">filenames</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.actions.binning.get_average_lightcurve_as_rainbow" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_average_lightcurve_as_rainbow</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.actions.binning.get_average_lightcurve_as_rainbow" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Produce a wavelength-integrated light curve.</p>
<p>The average across wavelengths is uncertainty-weighted.</p>
<p>This uses <code>bin</code>, which is a horribly slow way of doing what is
fundamentally a very simply array calculation, because we
don't need to deal with partial pixels.</p>
<h4 id="chromatic.rainbows.actions.binning.get_average_lightcurve_as_rainbow--returns">Returns<a class="headerlink" href="#chromatic.rainbows.actions.binning.get_average_lightcurve_as_rainbow--returns" title="Permanent link">#</a></h4>
<p>lc : Rainbow
    A <code>Rainbow</code> object with just one wavelength.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/rainbows/actions/binning.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_average_lightcurve_as_rainbow</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Produce a wavelength-integrated light curve.</span>

<span class="sd">    The average across wavelengths is uncertainty-weighted.</span>

<span class="sd">    This uses `bin`, which is a horribly slow way of doing what is</span>
<span class="sd">    fundamentally a very simply array calculation, because we</span>
<span class="sd">    don&#39;t need to deal with partial pixels.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    lc : Rainbow</span>
<span class="sd">        A `Rainbow` object with just one wavelength.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">h</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_history_entry</span><span class="p">(</span><span class="s2">&quot;get_average_spectrum_as_rainbow&quot;</span><span class="p">,</span> <span class="nb">locals</span><span class="p">())</span>

    <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>
        <span class="n">new</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bin</span><span class="p">(</span><span class="n">nwavelengths</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nwave</span><span class="p">,</span> <span class="n">trim</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">new</span><span class="o">.</span><span class="n">_record_history_entry</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">new</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.actions.binning.get_average_spectrum_as_rainbow" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_average_spectrum_as_rainbow</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.actions.binning.get_average_spectrum_as_rainbow" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Produce a time-integrated spectrum.</p>
<p>The average across times is uncertainty-weighted.</p>
<p>This uses <code>bin</code>, which is a horribly slow way of doing what is
fundamentally a very simply array calculation, because we
don't need to deal with partial pixels.</p>
<h4 id="chromatic.rainbows.actions.binning.get_average_spectrum_as_rainbow--returns">Returns<a class="headerlink" href="#chromatic.rainbows.actions.binning.get_average_spectrum_as_rainbow--returns" title="Permanent link">#</a></h4>
<p>lc : Rainbow
    A <code>Rainbow</code> object with just one time.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/rainbows/actions/binning.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_average_spectrum_as_rainbow</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Produce a time-integrated spectrum.</span>

<span class="sd">    The average across times is uncertainty-weighted.</span>

<span class="sd">    This uses `bin`, which is a horribly slow way of doing what is</span>
<span class="sd">    fundamentally a very simply array calculation, because we</span>
<span class="sd">    don&#39;t need to deal with partial pixels.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    lc : Rainbow</span>
<span class="sd">        A `Rainbow` object with just one time.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">h</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_history_entry</span><span class="p">(</span><span class="s2">&quot;get_average_spectrum_as_rainbow&quot;</span><span class="p">,</span> <span class="nb">locals</span><span class="p">())</span>

    <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>
        <span class="n">new</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bin</span><span class="p">(</span><span class="n">ntimes</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ntime</span><span class="p">,</span> <span class="n">trim</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">new</span><span class="o">.</span><span class="n">_record_history_entry</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">new</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.actions.binning.leftright_to_edges" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">leftright_to_edges</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.actions.binning.leftright_to_edges" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Convert two arrays of N left/right edges to N+1 continugous edges.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/tools/resampling.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">leftright_to_edges</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert two arrays of N left/right edges to N+1 continugous edges.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">edges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>
    <span class="k">return</span> <span class="n">edges</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.actions.binning.name2color" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">name2color</span><span class="p">(</span><span class="n">name</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.actions.binning.name2color" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Return the 3-element RGB array of a given color name.</p>
<h4 id="chromatic.rainbows.actions.binning.name2color--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.actions.binning.name2color--parameters" title="Permanent link">#</a></h4>
<p>name : str
    The name of a color</p>
<h4 id="chromatic.rainbows.actions.binning.name2color--returns">Returns<a class="headerlink" href="#chromatic.rainbows.actions.binning.name2color--returns" title="Permanent link">#</a></h4>
<p>rgb : tuple
    3-element RGB color, with numbers from 0.0 to 1.0</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/imports.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">name2color</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return the 3-element RGB array of a given color name.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    name : str</span>
<span class="sd">        The name of a color</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    rgb : tuple</span>
<span class="sd">        3-element RGB color, with numbers from 0.0 to 1.0</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># give a friendly warning if the color name can&#39;t be found</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">color_hex</span> <span class="o">=</span> <span class="n">col</span><span class="o">.</span><span class="n">cnames</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">col</span><span class="o">.</span><span class="n">hex2color</span><span class="p">(</span><span class="n">color_hex</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="n">cheerfully_suggest</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The color </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> can&#39;t be found. (Returning black.)&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.actions.binning.one2another" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">one2another</span><span class="p">(</span><span class="n">bottom</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">alpha_bottom</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">alpha_top</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">256</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.actions.binning.one2another" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Create a cmap that goes smoothly (linearly in RGBA) from "bottom" to "top".</p>
<h4 id="chromatic.rainbows.actions.binning.one2another--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.actions.binning.one2another--parameters" title="Permanent link">#</a></h4>
<p>bottom : str
    Name of a color for the bottom of cmap (0.0)
top : str
    Name of a color for the top of the cmap (1.0)
alpha_bottom : float
    Opacity at the bottom of the cmap
alpha_top : float
    Opacitiy at the top of the cmap
N : int
    The number of levels in the listed color map</p>
<h4 id="chromatic.rainbows.actions.binning.one2another--returns">Returns<a class="headerlink" href="#chromatic.rainbows.actions.binning.one2another--returns" title="Permanent link">#</a></h4>
<p>cmap : Colormap
    A color map that goes linearly from the
    bottom to top color (and alpha).</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/imports.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">one2another</span><span class="p">(</span><span class="n">bottom</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">alpha_bottom</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">alpha_top</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">256</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a cmap that goes smoothly (linearly in RGBA) from &quot;bottom&quot; to &quot;top&quot;.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    bottom : str</span>
<span class="sd">        Name of a color for the bottom of cmap (0.0)</span>
<span class="sd">    top : str</span>
<span class="sd">        Name of a color for the top of the cmap (1.0)</span>
<span class="sd">    alpha_bottom : float</span>
<span class="sd">        Opacity at the bottom of the cmap</span>
<span class="sd">    alpha_top : float</span>
<span class="sd">        Opacitiy at the top of the cmap</span>
<span class="sd">    N : int</span>
<span class="sd">        The number of levels in the listed color map</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    cmap : Colormap</span>
<span class="sd">        A color map that goes linearly from the</span>
<span class="sd">        bottom to top color (and alpha).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># get the RGB values of the bottom and top of the cmap</span>
    <span class="n">rgb_bottom</span><span class="p">,</span> <span class="n">rgb_top</span> <span class="o">=</span> <span class="n">name2color</span><span class="p">(</span><span class="n">bottom</span><span class="p">),</span> <span class="n">name2color</span><span class="p">(</span><span class="n">top</span><span class="p">)</span>

    <span class="c1"># create linear gradients for all four RGBA channels</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">rgb_bottom</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">rgb_top</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">N</span><span class="p">)</span>
    <span class="n">g</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">rgb_bottom</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">rgb_top</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">N</span><span class="p">)</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">rgb_bottom</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">rgb_top</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">N</span><span class="p">)</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">alpha_bottom</span><span class="p">,</span> <span class="n">alpha_top</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>

    <span class="c1"># create (N,4) array + populate a listed colormap</span>
    <span class="n">colors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">]))</span>
    <span class="n">cmap</span> <span class="o">=</span> <span class="n">col</span><span class="o">.</span><span class="n">ListedColormap</span><span class="p">(</span><span class="n">colors</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{bottom}</span><span class="s2">2</span><span class="si">{top}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="nb">locals</span><span class="p">()))</span>

    <span class="c1"># return the colormap</span>
    <span class="k">return</span> <span class="n">cmap</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.actions.binning.remove_unit" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">remove_unit</span><span class="p">(</span><span class="n">x</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.actions.binning.remove_unit" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Quick wrapper to remove the unit from a quantity,
but not complain if it doesn't have one.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/imports.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">remove_unit</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Quick wrapper to remove the unit from a quantity,</span>
<span class="sd">    but not complain if it doesn&#39;t have one.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">x</span><span class="o">.</span><span class="n">value</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">x</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.actions.binning.resample_while_conserving_flux" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">resample_while_conserving_flux</span><span class="p">(</span><span class="n">xin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">yin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xout</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xin_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xout_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">replace_nans</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">visualize</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">pause</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.actions.binning.resample_while_conserving_flux" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Starting from some initial x and y, resample onto a
different grid (either higher or lower resolution),
while conserving total flux.</p>
<p>When including the entire range of <code>xin</code>,
<code>sum(yout) == sum(yin)</code> should be true.</p>
<p>When including only part of the range of <code>xin</code>,
the integral between any two points should be conserved.</p>
<h4 id="chromatic.rainbows.actions.binning.resample_while_conserving_flux--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.actions.binning.resample_while_conserving_flux--parameters" title="Permanent link">#</a></h4>
<p>xin : array
    The original independent variable.
yin : array
    The original dependent variable (same size as x).
xout : array
    The new grid of independent variables onto which
    you want to resample the y values. Refers to the
    center of each bin (use <code>xout_edges</code> for finer
    control over the exact edges of the bins)
xin_edges : array
    The edges of the original independent variable bins.
    The left and right edges of the bins are interpreted
    to be <code>xin_edges[:-1]</code> and <code>xin_edges[1:]</code>,
    respectively, so the associated <code>yin</code> should have exactly
    1 fewer element than <code>xin_edges</code>. This provides finer
    control over the size of each bin in the input than
    simply supplying <code>xin</code>(still a little experimental)
    They should probably be sorted?
xout_edges : array
    The edges of the new grid of bins for the independent
    variable, onto which you want to resample the y
    values. The left and right edges of the bins will be,
    respectively, <code>xout_edges[:-1]</code> and <code>xout_edges[1:]</code>,
    so the size of the output array will be
    <code>len(xout_edges) - 1</code>
replace_nans : float, str
    Replace nan values with this value.
    <code>replace_nans = 0</code>
        will add no flux where nans are
    <code>replace_nans = nan</code>
        will ensure you get nans returned everywhere
        if you try to resample over any nan
    <code>replace_nans = 'interpolate'</code>
        will try to replace nans by linearly interpolating
        from nearby values (not yet implemented)
visualize : bool
    Should we make a plot showing whether it worked?
pause : bool
    Should we pause to wait for a key press?</p>
<h4 id="chromatic.rainbows.actions.binning.resample_while_conserving_flux--returns">Returns<a class="headerlink" href="#chromatic.rainbows.actions.binning.resample_while_conserving_flux--returns" title="Permanent link">#</a></h4>
<p>result : dict
    A dictionary containing...
        <code>x</code> = the center of the output grid
        <code>y</code> = the resampled value on the output grid
        <code>edges</code> = the edges of the output grid, which will
            have one more element than x or y</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/tools/resampling.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">resample_while_conserving_flux</span><span class="p">(</span>
    <span class="n">xin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">yin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">xout</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">xin_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">xout_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">replace_nans</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
    <span class="n">visualize</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">pause</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Starting from some initial x and y, resample onto a</span>
<span class="sd">    different grid (either higher or lower resolution),</span>
<span class="sd">    while conserving total flux.</span>

<span class="sd">    When including the entire range of `xin`,</span>
<span class="sd">    `sum(yout) == sum(yin)` should be true.</span>

<span class="sd">    When including only part of the range of `xin`,</span>
<span class="sd">    the integral between any two points should be conserved.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    xin : array</span>
<span class="sd">        The original independent variable.</span>
<span class="sd">    yin : array</span>
<span class="sd">        The original dependent variable (same size as x).</span>
<span class="sd">    xout : array</span>
<span class="sd">        The new grid of independent variables onto which</span>
<span class="sd">        you want to resample the y values. Refers to the</span>
<span class="sd">        center of each bin (use `xout_edges` for finer</span>
<span class="sd">        control over the exact edges of the bins)</span>
<span class="sd">    xin_edges : array</span>
<span class="sd">        The edges of the original independent variable bins.</span>
<span class="sd">        The left and right edges of the bins are interpreted</span>
<span class="sd">        to be `xin_edges[:-1]` and `xin_edges[1:]`,</span>
<span class="sd">        respectively, so the associated `yin` should have exactly</span>
<span class="sd">        1 fewer element than `xin_edges`. This provides finer</span>
<span class="sd">        control over the size of each bin in the input than</span>
<span class="sd">        simply supplying `xin`(still a little experimental)</span>
<span class="sd">        They should probably be sorted?</span>
<span class="sd">    xout_edges : array</span>
<span class="sd">        The edges of the new grid of bins for the independent</span>
<span class="sd">        variable, onto which you want to resample the y</span>
<span class="sd">        values. The left and right edges of the bins will be,</span>
<span class="sd">        respectively, `xout_edges[:-1]` and `xout_edges[1:]`,</span>
<span class="sd">        so the size of the output array will be</span>
<span class="sd">        `len(xout_edges) - 1`</span>
<span class="sd">    replace_nans : float, str</span>
<span class="sd">        Replace nan values with this value.</span>
<span class="sd">        `replace_nans = 0`</span>
<span class="sd">            will add no flux where nans are</span>
<span class="sd">        `replace_nans = nan`</span>
<span class="sd">            will ensure you get nans returned everywhere</span>
<span class="sd">            if you try to resample over any nan</span>
<span class="sd">        `replace_nans = &#39;interpolate&#39;`</span>
<span class="sd">            will try to replace nans by linearly interpolating</span>
<span class="sd">            from nearby values (not yet implemented)</span>
<span class="sd">    visualize : bool</span>
<span class="sd">        Should we make a plot showing whether it worked?</span>
<span class="sd">    pause : bool</span>
<span class="sd">        Should we pause to wait for a key press?</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    result : dict</span>
<span class="sd">        A dictionary containing...</span>
<span class="sd">            `x` = the center of the output grid</span>
<span class="sd">            `y` = the resampled value on the output grid</span>
<span class="sd">            `edges` = the edges of the output grid, which will</span>
<span class="sd">                have one more element than x or y</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># make sure there are some reasonable input options</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">xin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">xin_edges</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">yin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">xout</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">xout_edges</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>

    <span class="c1"># set up the bins, to calculate cumulative distribution of y</span>
    <span class="k">if</span> <span class="n">xin_edges</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># make sure the sizes match up</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">xin</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">yin</span><span class="p">)</span>
        <span class="c1"># sort to make sure x is strictly increasing</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">xin</span><span class="p">)</span>
        <span class="n">xin_sorted</span> <span class="o">=</span> <span class="n">xin</span><span class="p">[</span><span class="n">s</span><span class="p">]</span>
        <span class="n">yin_sorted</span> <span class="o">=</span> <span class="n">yin</span><span class="p">[</span><span class="n">s</span><span class="p">]</span>
        <span class="c1"># estimate some bin edges (might fail for non-uniform grids)</span>
        <span class="n">xin_left</span><span class="p">,</span> <span class="n">xin_right</span> <span class="o">=</span> <span class="n">calculate_bin_leftright</span><span class="p">(</span><span class="n">xin_sorted</span><span class="p">)</span>
        <span class="c1"># define an array of edges</span>
        <span class="n">xin_edges</span> <span class="o">=</span> <span class="n">leftright_to_edges</span><span class="p">(</span><span class="n">xin_left</span><span class="p">,</span> <span class="n">xin_right</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># make sure the sizes match up</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">xin_edges</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">yin</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="c1"># sort to make sure x is strictly increasing</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">xin_edges</span><span class="p">)</span>
        <span class="n">xin_left</span><span class="p">,</span> <span class="n">xin_right</span> <span class="o">=</span> <span class="n">edges_to_leftright</span><span class="p">(</span><span class="n">xin_edges</span><span class="p">[</span><span class="n">s</span><span class="p">])</span>
        <span class="n">xin_sorted</span> <span class="o">=</span> <span class="p">(</span><span class="n">xin_left</span> <span class="o">+</span> <span class="n">xin_right</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">yin_sorted</span> <span class="o">=</span> <span class="n">yin</span><span class="p">[</span><span class="n">s</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>

    <span class="c1"># the first element should be the left edge of the first pixel</span>
    <span class="c1"># last element will be right edge of last pixel</span>
    <span class="n">xin_for_cdf</span> <span class="o">=</span> <span class="n">xin_edges</span>

    <span class="c1"># to the left of the first pixel, assume flux is zero</span>
    <span class="n">yin_for_cdf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">yin_sorted</span><span class="p">])</span>

    <span class="c1"># correct for any non-finite values</span>
    <span class="n">bad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">yin_for_cdf</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">replace_nans</span> <span class="o">==</span> <span class="s2">&quot;interpolate&quot;</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
            <span class="s2">&quot;The `replace_nans=&#39;interpolate&#39;`` option doens&#39;t exist yet!&quot;</span>
        <span class="p">)</span>
    <span class="n">yin_for_cdf</span><span class="p">[</span><span class="n">bad</span><span class="p">]</span> <span class="o">=</span> <span class="n">replace_nans</span>

    <span class="c1"># calculate the CDF of the flux (at pixel edge locations)</span>
    <span class="n">cdfin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">yin_for_cdf</span><span class="p">)</span>

    <span class="c1"># create an interpolator for that CDF</span>
    <span class="n">cdfinterpolator</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span>
        <span class="n">xin_for_cdf</span><span class="p">,</span>
        <span class="n">cdfin</span><span class="p">,</span>
        <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span>
        <span class="n">bounds_error</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">fill_value</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">yin</span><span class="p">)),</span>
    <span class="p">)</span>

    <span class="c1"># calculate bin edges (of size len(xout)+1)</span>
    <span class="k">if</span> <span class="n">xout_edges</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">xout_left</span><span class="p">,</span> <span class="n">xout_right</span> <span class="o">=</span> <span class="n">calculate_bin_leftright</span><span class="p">(</span><span class="n">xout</span><span class="p">)</span>
        <span class="n">xout_edges</span> <span class="o">=</span> <span class="n">leftright_to_edges</span><span class="p">(</span><span class="n">xout_left</span><span class="p">,</span> <span class="n">xout_right</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">xout_left</span><span class="p">,</span> <span class="n">xout_right</span> <span class="o">=</span> <span class="n">edges_to_leftright</span><span class="p">(</span><span class="n">xout_edges</span><span class="p">)</span>
        <span class="n">xout</span> <span class="o">=</span> <span class="p">(</span><span class="n">xout_left</span> <span class="o">+</span> <span class="n">xout_right</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>

    <span class="n">xout_for_cdf</span> <span class="o">=</span> <span class="n">leftright_to_edges</span><span class="p">(</span><span class="n">xout_left</span><span class="p">,</span> <span class="n">xout_right</span><span class="p">)</span>

    <span class="c1"># interpolate the CDF onto those bin edges</span>
    <span class="n">cdfout</span> <span class="o">=</span> <span class="n">cdfinterpolator</span><span class="p">(</span><span class="n">xout_for_cdf</span><span class="p">)</span>

    <span class="c1"># take  derivative of the CDF to get flux per resampled bin</span>
    <span class="c1"># (xout is bin center, and yout is the flux in that bin)</span>
    <span class="n">yout</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">cdfout</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">visualize</span><span class="p">:</span>
        <span class="n">fi</span><span class="p">,</span> <span class="p">(</span><span class="n">ax_cdf</span><span class="p">,</span> <span class="n">ax_pdf</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
        <span class="n">inkw</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
            <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span>
            <span class="n">markeredgecolor</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">outkw</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;darkorange&quot;</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span>
            <span class="n">markersize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
            <span class="n">markeredgecolor</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">legkw</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper left&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">xinbinsize</span> <span class="o">=</span> <span class="n">xin_right</span> <span class="o">-</span> <span class="n">xin_left</span>
        <span class="n">xoutbinsize</span> <span class="o">=</span> <span class="n">xout_right</span> <span class="o">-</span> <span class="n">xout_left</span>
        <span class="c1"># plot the PDFs</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="n">ax_pdf</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Flux per (Original) Pixel&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Pixel&quot;</span><span class="p">)</span>
        <span class="c1"># plot the original pixels (in df/dpixel to compare with resampled)</span>
        <span class="n">plot_as_boxes</span><span class="p">(</span>
            <span class="n">xin_sorted</span><span class="p">,</span> <span class="n">yin_sorted</span> <span class="o">/</span> <span class="n">xinbinsize</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Original Pixels&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">inkw</span>
        <span class="p">)</span>

        <span class="c1"># what would a bad interpolation look like?</span>
        <span class="n">interpolate_badly</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span>
            <span class="n">xin_sorted</span><span class="p">,</span>
            <span class="n">yin_sorted</span> <span class="o">/</span> <span class="n">xinbinsize</span><span class="p">,</span>
            <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span>
            <span class="n">bounds_error</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">fill_value</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
            <span class="n">xout</span><span class="p">,</span>
            <span class="n">interpolate_badly</span><span class="p">(</span><span class="n">xout</span><span class="p">),</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;cornflowerblue&quot;</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span>
            <span class="n">markersize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
            <span class="n">markeredgecolor</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Silly Simple Interpolation&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># plot the flux-conserving resampled data (again, in df/d&quot;pixel&quot;)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
            <span class="n">xout</span><span class="p">,</span> <span class="n">yout</span> <span class="o">/</span> <span class="n">xoutbinsize</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Flux-Conserving Interpolation&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">outkw</span>
        <span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="o">**</span><span class="n">legkw</span><span class="p">)</span>

        <span class="c1"># plot the CDFs</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="n">ax_cdf</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Cumulative Flux (from left)&quot;</span><span class="p">)</span>

        <span class="c1"># plot the original CDF</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xin_for_cdf</span><span class="p">,</span> <span class="n">cdfin</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Original Pixels&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">inkw</span><span class="p">)</span>

        <span class="c1"># plot the interpolated CDF</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xout_for_cdf</span><span class="p">,</span> <span class="n">cdfout</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Flux-Conserved Resample&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">outkw</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">pause</span><span class="p">:</span>
            <span class="n">a</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span>
                <span class="s2">&quot;Pausing a moment to check on interpolation; press return to continue.&quot;</span>
            <span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{:&gt;6}</span><span class="s2"> = </span><span class="si">{:.5f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;Actual&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">yin</span><span class="p">)))</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="s2">&quot;</span><span class="si">{:&gt;6}</span><span class="s2"> = </span><span class="si">{:.5f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="s2">&quot;Silly&quot;</span><span class="p">,</span>
                <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">interpolate_badly</span><span class="p">(</span><span class="n">xout</span><span class="p">)</span> <span class="o">*</span> <span class="n">xoutbinsize</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{:&gt;6}</span><span class="s2"> = </span><span class="si">{:.5f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;CDF&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">yout</span><span class="p">)))</span>

    <span class="c1"># return the resampled y-values</span>
    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="n">xout</span><span class="p">,</span> <span class="s2">&quot;x_edge_lower&quot;</span><span class="p">:</span> <span class="n">xout_left</span><span class="p">,</span> <span class="s2">&quot;x_edge_upper&quot;</span><span class="p">:</span> <span class="n">xout_right</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="n">yout</span><span class="p">}</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-function">



<a id="chromatic.rainbows.actions.compare"></a>
    <div class="doc doc-contents first">

        <p>Compare this <code>Rainbow</code> to others.</p>
<p>(still in development) This connects the current <code>Rainbow</code>
to a collection of other <code>Rainbow</code> objects, which can then
be visualized side-by-side in a uniform way.</p>
<h3 id="chromatic.rainbows.actions.compare--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.actions.compare--parameters" title="Permanent link">#</a></h3>
<p>rainbows : list
    A list containing one or more other <code>Rainbow</code> objects.
    If you only want to compare with one other <code>Rainbow</code>,
    supply it in a 1-element list like <code>.compare([other])</code></p>
<h3 id="chromatic.rainbows.actions.compare--returns">Returns<a class="headerlink" href="#chromatic.rainbows.actions.compare--returns" title="Permanent link">#</a></h3>
<p>rainbow : MultiRainbow
    A <code>MultiRainbow</code> comparison object including all input <code>Rainbow</code>s</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/rainbows/actions/compare.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">compare</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rainbows</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compare this `Rainbow` to others.</span>

<span class="sd">    (still in development) This connects the current `Rainbow`</span>
<span class="sd">    to a collection of other `Rainbow` objects, which can then</span>
<span class="sd">    be visualized side-by-side in a uniform way.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    rainbows : list</span>
<span class="sd">        A list containing one or more other `Rainbow` objects.</span>
<span class="sd">        If you only want to compare with one other `Rainbow`,</span>
<span class="sd">        supply it in a 1-element list like `.compare([other])`</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    rainbow : MultiRainbow</span>
<span class="sd">        A `MultiRainbow` comparison object including all input `Rainbow`s</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">rainbows</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">IndexError</span><span class="p">):</span>
        <span class="k">pass</span>
    <span class="k">return</span> <span class="n">compare_rainbows</span><span class="p">([</span><span class="bp">self</span><span class="p">]</span> <span class="o">+</span> <span class="n">rainbows</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">



<a id="chromatic.rainbows.actions.flag_outliers"></a>
    <div class="doc doc-contents first">

        <p>Flag outliers as not <code>ok</code>.</p>
<p>This examines the flux array, identifies significant outliers,
and marks them 0 in the <code>ok</code> array. The default procedure is to use
a median filter to remove temporal trends (<code>remove_trends</code>),
inflate the uncertainties based on the median-absolute-deviation
scatter (<code>inflate_uncertainty</code>), and call points outliers if they
deviate by more than a certain number of sigma (<code>how_many_sigma</code>)
from the median-filtered level.</p>
<p>The returned <code>Rainbow</code> object should be identical to the input
one, except for the possibility that some elements in <code>ok</code> array
will have been marked as zero. (The filtering or inflation are
not applied to the returned object.)</p>
<h3 id="chromatic.rainbows.actions.flag_outliers--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.actions.flag_outliers--parameters" title="Permanent link">#</a></h3>
<p>how_many_sigma : float, optional
    Standard deviations (sigmas) allowed for individual data
    points before they are flagged as outliers.
remove_trends : bool, optional
    Should we remove trends from the flux data before
    trying to look for outliers?
inflate_uncertainty : bool, optional
    Should uncertainties per wavelength be inflated to
    match the (MAD-based) standard deviation of the data?</p>
<h3 id="chromatic.rainbows.actions.flag_outliers--returns">Returns<a class="headerlink" href="#chromatic.rainbows.actions.flag_outliers--returns" title="Permanent link">#</a></h3>
<p>rainbow : Rainbow
    A new Rainbow object with the outliers flagged as 0 in <code>.ok</code></p>


            <details class="quote">
              <summary>Source code in <code>chromatic/rainbows/actions/flag_outliers.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">flag_outliers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">how_many_sigma</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">remove_trends</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inflate_uncertainty</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Flag outliers as not `ok`.</span>

<span class="sd">    This examines the flux array, identifies significant outliers,</span>
<span class="sd">    and marks them 0 in the `ok` array. The default procedure is to use</span>
<span class="sd">    a median filter to remove temporal trends (`remove_trends`),</span>
<span class="sd">    inflate the uncertainties based on the median-absolute-deviation</span>
<span class="sd">    scatter (`inflate_uncertainty`), and call points outliers if they</span>
<span class="sd">    deviate by more than a certain number of sigma (`how_many_sigma`)</span>
<span class="sd">    from the median-filtered level.</span>

<span class="sd">    The returned `Rainbow` object should be identical to the input</span>
<span class="sd">    one, except for the possibility that some elements in `ok` array</span>
<span class="sd">    will have been marked as zero. (The filtering or inflation are</span>
<span class="sd">    not applied to the returned object.)</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    how_many_sigma : float, optional</span>
<span class="sd">        Standard deviations (sigmas) allowed for individual data</span>
<span class="sd">        points before they are flagged as outliers.</span>
<span class="sd">    remove_trends : bool, optional</span>
<span class="sd">        Should we remove trends from the flux data before</span>
<span class="sd">        trying to look for outliers?</span>
<span class="sd">    inflate_uncertainty : bool, optional</span>
<span class="sd">        Should uncertainties per wavelength be inflated to</span>
<span class="sd">        match the (MAD-based) standard deviation of the data?</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    rainbow : Rainbow</span>
<span class="sd">        A new Rainbow object with the outliers flagged as 0 in `.ok`</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># create a history entry for this action (before other variables are defined)</span>
    <span class="n">h</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_history_entry</span><span class="p">(</span><span class="s2">&quot;flag_outliers&quot;</span><span class="p">,</span> <span class="nb">locals</span><span class="p">())</span>

    <span class="c1"># create a copy of the existing rainbow</span>
    <span class="n">new</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_copy</span><span class="p">()</span>

    <span class="c1"># how many outliers are expected from noise alone</span>
    <span class="n">outliers_expected_from_normal_distribution</span> <span class="o">=</span> <span class="n">erfc</span><span class="p">(</span><span class="n">how_many_sigma</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">nflux</span> <span class="o">*</span> <span class="mi">2</span>
    <span class="k">if</span> <span class="n">outliers_expected_from_normal_distribution</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">cheerfully_suggest</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        When drawing from a normal distribution, an expected </span><span class="si">{</span><span class="n">outliers_expected_from_normal_distribution</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2"> out of</span>
<span class="s2">        the total </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">nflux</span><span class="si">}</span><span class="s2"> datapoints in </span><span class="si">{</span><span class="bp">self</span><span class="si">}</span><span class="s2"> would be marked</span>
<span class="s2">        as a &gt;</span><span class="si">{</span><span class="n">how_many_sigma</span><span class="si">}</span><span class="s2"> sigma outlier.</span>

<span class="s2">        If you don&#39;t want to accidentally clip legitimate data points that</span>
<span class="s2">        might have arisen merely by chance, please consider setting the</span>
<span class="s2">        outlier flagging threshold (`sigma=`) to a larger value.</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="p">)</span>

    <span class="c1"># create a trend-filtered object</span>
    <span class="k">if</span> <span class="n">remove_trends</span><span class="p">:</span>
        <span class="n">filtered</span> <span class="o">=</span> <span class="n">new</span><span class="o">.</span><span class="n">remove_trends</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s2">&quot;median_filter&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">filtered</span> <span class="o">=</span> <span class="n">new</span><span class="o">.</span><span class="n">_create_copy</span><span class="p">()</span>

    <span class="c1"># update the uncertainties, if need be</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">filtered</span><span class="o">.</span><span class="n">uncertainty</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
        <span class="n">filtered</span><span class="o">.</span><span class="n">uncertainty</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">filtered</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
            <span class="o">*</span> <span class="n">filtered</span><span class="o">.</span><span class="n">get_measured_scatter</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s2">&quot;MAD&quot;</span><span class="p">)[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="n">inflate_uncertainty</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="c1"># inflate the per-wavelength uncertainties, as needed</span>
    <span class="k">if</span> <span class="n">inflate_uncertainty</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>
            <span class="n">inflated</span> <span class="o">=</span> <span class="n">filtered</span><span class="o">.</span><span class="n">inflate_uncertainty</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s2">&quot;MAD&quot;</span><span class="p">,</span> <span class="n">remove_trends</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">inflated</span> <span class="o">=</span> <span class="n">filtered</span>

    <span class="c1"># decide which points are outliers</span>
    <span class="n">is_outlier</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">inflated</span><span class="o">.</span><span class="n">flux</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">how_many_sigma</span> <span class="o">*</span> <span class="n">inflated</span><span class="o">.</span><span class="n">uncertainty</span>

    <span class="c1"># update the output object</span>
    <span class="n">new</span><span class="o">.</span><span class="n">fluxlike</span><span class="p">[</span><span class="s2">&quot;flagged_as_outlier&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">is_outlier</span>
    <span class="n">new</span><span class="o">.</span><span class="n">ok</span> <span class="o">=</span> <span class="n">new</span><span class="o">.</span><span class="n">ok</span> <span class="o">*</span> <span class="p">(</span><span class="n">is_outlier</span> <span class="o">==</span> <span class="kc">False</span><span class="p">)</span>

    <span class="c1"># append the history entry to the new Rainbow</span>
    <span class="n">new</span><span class="o">.</span><span class="n">_record_history_entry</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">new</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">



<a id="chromatic.rainbows.actions.fold"></a>
    <div class="doc doc-contents first">

        <p>Fold this <code>Rainbow</code> to a period and reference epoch.</p>
<p>This changes the times from some original time into
a phased time, for example the time within an orbital
period, relative to the time of mid-transit. This
is mostly a convenience function for plotting data
relative to mid-transit and/or trimming data based
on orbital phase.</p>
<h3 id="chromatic.rainbows.actions.fold--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.actions.fold--parameters" title="Permanent link">#</a></h3>
<p>period : Quantity
    The orbital period of the planet (with astropy units of time).
t0 : Quantity
    Any mid-transit epoch (with astropy units of time).
event : str
    A description of the event that happens periodically.
    For example, you might want to switch this to
    'Mid-Eclipse' (as well as offsetting the <code>t0</code> by the
    appropriate amount relative to transit). This description
    may be used in plot labels.</p>
<h3 id="chromatic.rainbows.actions.fold--returns">Returns<a class="headerlink" href="#chromatic.rainbows.actions.fold--returns" title="Permanent link">#</a></h3>
<p>folded : Rainbow
    The folded <code>Rainbow</code>.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/rainbows/actions/fold.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">fold</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">period</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">t0</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">event</span><span class="o">=</span><span class="s2">&quot;Mid-Transit&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Fold this `Rainbow` to a period and reference epoch.</span>

<span class="sd">    This changes the times from some original time into</span>
<span class="sd">    a phased time, for example the time within an orbital</span>
<span class="sd">    period, relative to the time of mid-transit. This</span>
<span class="sd">    is mostly a convenience function for plotting data</span>
<span class="sd">    relative to mid-transit and/or trimming data based</span>
<span class="sd">    on orbital phase.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    period : Quantity</span>
<span class="sd">        The orbital period of the planet (with astropy units of time).</span>
<span class="sd">    t0 : Quantity</span>
<span class="sd">        Any mid-transit epoch (with astropy units of time).</span>
<span class="sd">    event : str</span>
<span class="sd">        A description of the event that happens periodically.</span>
<span class="sd">        For example, you might want to switch this to</span>
<span class="sd">        &#39;Mid-Eclipse&#39; (as well as offsetting the `t0` by the</span>
<span class="sd">        appropriate amount relative to transit). This description</span>
<span class="sd">        may be used in plot labels.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    folded : Rainbow</span>
<span class="sd">        The folded `Rainbow`.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># create a history entry for this action (before other variables are defined)</span>
    <span class="n">h</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_history_entry</span><span class="p">(</span><span class="s2">&quot;fold&quot;</span><span class="p">,</span> <span class="nb">locals</span><span class="p">())</span>

    <span class="c1"># warn</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">period</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">t0</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
        <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        Folding to a transit period requires both</span>
<span class="s2">        `period` and `t0` be specified. Please try again.</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="n">cheerfully_suggest</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="c1"># create a copy of the existing rainbow</span>
    <span class="n">new</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_copy</span><span class="p">()</span>

    <span class="c1"># calculate predicted time from transit</span>
    <span class="n">new</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="p">(((</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">-</span> <span class="n">t0</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">period</span><span class="p">)</span> <span class="o">%</span> <span class="n">period</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">period</span>
    <span class="c1"># (the nudge by 0.5 period is to center on -period/2 to period/2)</span>

    <span class="c1"># change the default time label</span>
    <span class="n">new</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;time_label&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Time from </span><span class="si">{</span><span class="n">event</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="c1"># append the history entry to the new Rainbow</span>
    <span class="n">new</span><span class="o">.</span><span class="n">_record_history_entry</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">new</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">



<a id="chromatic.rainbows.actions.inflate_uncertainty"></a>
    <div class="doc doc-contents first">

        <p>Inflate uncertainties to match observed scatter.</p>
<p>This is a quick and approximate tool for inflating
the flux uncertainties in a <code>Rainbow</code> to match the
observed scatter. With defaults, this will estimate
the scatter using a robust median-absolute-deviation
estimate of the standard deviation (<code>method='MAD'</code>),
applied to time-series from which temporal trends
have been removed (<code>remove_trends=True</code>), and inflate
the uncertainties on a per-wavelength basis. The trend
removal, by default by subtracting off local medians
(<code>remove_trends_method='median_filter'</code>), will squash
many types of both astrophysical and systematic trends,
so this function should be used with caution in
applicants where precise and reliable uncertainties
are needed.</p>
<h3 id="chromatic.rainbows.actions.inflate_uncertainty--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.actions.inflate_uncertainty--parameters" title="Permanent link">#</a></h3>
<p>method : string
    What method to use to obtain measured scatter.
    Current options are 'MAD', 'standard-deviation'.
remove_trends : bool
    Should we remove trends before estimating by how
    much we need to inflate the uncertainties?
remove_trends_method : str
    What method should be used to remove trends?
    See <code>.remove_trends</code> for options.
remove_trends_kw : dict
    What keyword arguments should be passed to <code>remove_trends</code>?
minimum_inflate_ratio : float, optional
    the minimum inflate_ratio that can be. We don't want people
    to deflate uncertainty unless a very specific case of unstable
    pipeline output.</p>
<h3 id="chromatic.rainbows.actions.inflate_uncertainty--returns">Returns<a class="headerlink" href="#chromatic.rainbows.actions.inflate_uncertainty--returns" title="Permanent link">#</a></h3>
<p>removed : Rainbow
    The Rainbow with estimated signals removed.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/rainbows/actions/inflate_uncertainty.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span>
<span class="normal">96</span>
<span class="normal">97</span>
<span class="normal">98</span>
<span class="normal">99</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">inflate_uncertainty</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">method</span><span class="o">=</span><span class="s2">&quot;MAD&quot;</span><span class="p">,</span>
    <span class="n">remove_trends</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">remove_trends_method</span><span class="o">=</span><span class="s2">&quot;median_filter&quot;</span><span class="p">,</span>
    <span class="n">remove_trends_kw</span><span class="o">=</span><span class="p">{},</span>
    <span class="n">minimum_inflate_ratio</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Inflate uncertainties to match observed scatter.</span>

<span class="sd">    This is a quick and approximate tool for inflating</span>
<span class="sd">    the flux uncertainties in a `Rainbow` to match the</span>
<span class="sd">    observed scatter. With defaults, this will estimate</span>
<span class="sd">    the scatter using a robust median-absolute-deviation</span>
<span class="sd">    estimate of the standard deviation (`method=&#39;MAD&#39;`),</span>
<span class="sd">    applied to time-series from which temporal trends</span>
<span class="sd">    have been removed (`remove_trends=True`), and inflate</span>
<span class="sd">    the uncertainties on a per-wavelength basis. The trend</span>
<span class="sd">    removal, by default by subtracting off local medians</span>
<span class="sd">    (`remove_trends_method=&#39;median_filter&#39;`), will squash</span>
<span class="sd">    many types of both astrophysical and systematic trends,</span>
<span class="sd">    so this function should be used with caution in</span>
<span class="sd">    applicants where precise and reliable uncertainties</span>
<span class="sd">    are needed.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    method : string</span>
<span class="sd">        What method to use to obtain measured scatter.</span>
<span class="sd">        Current options are &#39;MAD&#39;, &#39;standard-deviation&#39;.</span>
<span class="sd">    remove_trends : bool</span>
<span class="sd">        Should we remove trends before estimating by how</span>
<span class="sd">        much we need to inflate the uncertainties?</span>
<span class="sd">    remove_trends_method : str</span>
<span class="sd">        What method should be used to remove trends?</span>
<span class="sd">        See `.remove_trends` for options.</span>
<span class="sd">    remove_trends_kw : dict</span>
<span class="sd">        What keyword arguments should be passed to `remove_trends`?</span>
<span class="sd">    minimum_inflate_ratio : float, optional</span>
<span class="sd">        the minimum inflate_ratio that can be. We don&#39;t want people</span>
<span class="sd">        to deflate uncertainty unless a very specific case of unstable</span>
<span class="sd">        pipeline output.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    removed : Rainbow</span>
<span class="sd">        The Rainbow with estimated signals removed.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># create a history entry for this action (before other variables are defined)</span>
    <span class="n">h</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_history_entry</span><span class="p">(</span><span class="s2">&quot;inflate_uncertainty&quot;</span><span class="p">,</span> <span class="nb">locals</span><span class="p">())</span>

    <span class="c1"># create a new copy</span>
    <span class="n">new</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_copy</span><span class="p">()</span>

    <span class="c1"># if desired, remove trends before estimating inflation factor</span>
    <span class="k">if</span> <span class="n">remove_trends</span><span class="p">:</span>
        <span class="n">trend_removed</span> <span class="o">=</span> <span class="n">new</span><span class="o">.</span><span class="n">remove_trends</span><span class="p">(</span><span class="o">**</span><span class="n">remove_trends_kw</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">trend_removed</span> <span class="o">=</span> <span class="n">new</span>

    <span class="c1"># estimate the scatter</span>
    <span class="n">measured_scatter</span> <span class="o">=</span> <span class="n">trend_removed</span><span class="o">.</span><span class="n">get_measured_scatter</span><span class="p">(</span>
        <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span> <span class="n">minimum_acceptable_ok</span><span class="o">=</span><span class="mf">1e-10</span>
    <span class="p">)</span>

    <span class="c1"># get the expected uncertainty</span>
    <span class="n">expected_uncertainty</span> <span class="o">=</span> <span class="n">trend_removed</span><span class="o">.</span><span class="n">get_expected_uncertainty</span><span class="p">()</span>

    <span class="c1"># calculate the necessary inflation ratio</span>
    <span class="n">inflate_ratio</span> <span class="o">=</span> <span class="n">measured_scatter</span> <span class="o">/</span> <span class="n">expected_uncertainty</span>

    <span class="c1"># warn if there are some inflation ratios below minimum (usually = 1)</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">inflate_ratio</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">minimum_inflate_ratio</span><span class="p">:</span>
        <span class="n">cheerfully_suggest</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">inflate_ratio</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">minimum_inflate_ratio</span><span class="p">)</span><span class="si">}</span><span class="s2"> uncertainty inflation ratios would be below</span>
<span class="s2">        the `minimum_inflate_ratio` of </span><span class="si">{</span><span class="n">minimum_inflate_ratio</span><span class="si">}</span><span class="s2">, so they have not been changed.</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="p">)</span>
        <span class="n">inflate_ratio</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">inflate_ratio</span><span class="p">,</span> <span class="n">minimum_inflate_ratio</span><span class="p">)</span>

    <span class="c1"># store the inflation ratio</span>
    <span class="n">new</span><span class="o">.</span><span class="n">wavelike</span><span class="p">[</span><span class="s2">&quot;inflate_ratio&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">inflate_ratio</span>

    <span class="c1"># inflate the uncertainties</span>
    <span class="n">new</span><span class="o">.</span><span class="n">uncertainty</span> <span class="o">=</span> <span class="n">new</span><span class="o">.</span><span class="n">uncertainty</span> <span class="o">*</span> <span class="n">inflate_ratio</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>

    <span class="c1"># append the history entry to the new Rainbow</span>
    <span class="n">new</span><span class="o">.</span><span class="n">_record_history_entry</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>

    <span class="c1"># return the new Rainbow</span>
    <span class="k">return</span> <span class="n">new</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">



<a id="chromatic.rainbows.actions.inject_noise"></a>
    <div class="doc doc-contents first">

        <p>Inject uncorrelated random noise into the <code>.flux</code> array.</p>
<p>This injects independent noise to each data point,
drawn from either a Gaussian or Poisson distribution.
If the inputs can be scalar, or they can be arrays
that we will try to broadcast into the shape of the
<code>.flux</code> array.</p>
<h3 id="chromatic.rainbows.actions.inject_noise--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.actions.inject_noise--parameters" title="Permanent link">#</a></h3>


<details class="signal_to_noise-" open>
  <summary>float, array, optional</summary>
  <p>The signal-to-noise per wavelength per time.
For example, S/N=100 would mean that the
uncertainty on the flux for each each
wavelength-time data point will be 1%.
If it is a scalar, then even point is the same.
If it is an array with a fluxlike, wavelike,
or timelike shape it will be broadcast
appropriately.</p>
</details>        <p>number_of_photons : float, array, optional
    The number of photons expected to be recieved
    from the light source per wavelength and time.
    If it is a scalar, then even point is the same.
    If it is an array with a fluxlike, wavelike,
    or timelike shape it will be broadcast
    appropriately.
    If <code>number_of_photons</code> is set, then <code>signal_to_noise</code>
    will be ignored.</p>
<h3 id="chromatic.rainbows.actions.inject_noise--returns">Returns<a class="headerlink" href="#chromatic.rainbows.actions.inject_noise--returns" title="Permanent link">#</a></h3>
<p>rainbow : Rainbow
    A new <code>Rainbow</code> object with the noise injected.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/rainbows/actions/inject_noise.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">  6</span>
<span class="normal">  7</span>
<span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">inject_noise</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">signal_to_noise</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">number_of_photons</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Inject uncorrelated random noise into the `.flux` array.</span>

<span class="sd">    This injects independent noise to each data point,</span>
<span class="sd">    drawn from either a Gaussian or Poisson distribution.</span>
<span class="sd">    If the inputs can be scalar, or they can be arrays</span>
<span class="sd">    that we will try to broadcast into the shape of the</span>
<span class="sd">    `.flux` array.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    signal_to_noise : float, array, optional</span>
<span class="sd">        The signal-to-noise per wavelength per time.</span>
<span class="sd">        For example, S/N=100 would mean that the</span>
<span class="sd">        uncertainty on the flux for each each</span>
<span class="sd">        wavelength-time data point will be 1%.</span>
<span class="sd">        If it is a scalar, then even point is the same.</span>
<span class="sd">        If it is an array with a fluxlike, wavelike,</span>
<span class="sd">        or timelike shape it will be broadcast</span>
<span class="sd">        appropriately.</span>
<span class="sd">    number_of_photons : float, array, optional</span>
<span class="sd">        The number of photons expected to be recieved</span>
<span class="sd">        from the light source per wavelength and time.</span>
<span class="sd">        If it is a scalar, then even point is the same.</span>
<span class="sd">        If it is an array with a fluxlike, wavelike,</span>
<span class="sd">        or timelike shape it will be broadcast</span>
<span class="sd">        appropriately.</span>
<span class="sd">        If `number_of_photons` is set, then `signal_to_noise`</span>
<span class="sd">        will be ignored.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    rainbow : Rainbow</span>
<span class="sd">        A new `Rainbow` object with the noise injected.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># create a history entry for this action (before other variables are defined)</span>
    <span class="n">h</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_history_entry</span><span class="p">(</span><span class="s2">&quot;inject_noise&quot;</span><span class="p">,</span> <span class="nb">locals</span><span class="p">())</span>

    <span class="c1"># create a copy of the existing Rainbow</span>
    <span class="n">new</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_copy</span><span class="p">()</span>

    <span class="c1"># get the underlying model (or create one if needed)</span>
    <span class="k">if</span> <span class="s2">&quot;model&quot;</span> <span class="ow">in</span> <span class="n">new</span><span class="o">.</span><span class="n">fluxlike</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">new</span><span class="o">.</span><span class="n">fluxlike</span><span class="p">[</span><span class="s2">&quot;model&quot;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># kludge, do we really want to allow this?</span>
        <span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">flux</span> <span class="o">*</span> <span class="mi">1</span>
        <span class="n">new</span><span class="o">.</span><span class="n">fluxlike</span><span class="p">[</span><span class="s2">&quot;model&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span>

    <span class="c1"># setting up an if/else statement so that the user</span>
    <span class="c1"># can choose if they want to use their own</span>
    <span class="c1"># number_of_photons or the automatic signal_to_noise</span>
    <span class="c1"># noise generation</span>
    <span class="k">if</span> <span class="n">number_of_photons</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">model</span><span class="p">)</span><span class="o">.</span><span class="n">unit</span> <span class="o">!=</span> <span class="n">u</span><span class="o">.</span><span class="n">Unit</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            We haven&#39;t yet implemented `number_of_photons` noise</span>
<span class="s2">            for models that have units associated with them. Sorry!</span>
<span class="s2">            &quot;&quot;&quot;</span>
            <span class="p">)</span>

        <span class="n">mu</span> <span class="o">=</span> <span class="n">model</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_broadcast_to_fluxlike</span><span class="p">(</span><span class="n">number_of_photons</span><span class="p">)</span>

        <span class="c1"># convert the model to photons and store it</span>
        <span class="n">new</span><span class="o">.</span><span class="n">fluxlike</span><span class="p">[</span><span class="s2">&quot;model&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mu</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">photon</span>

        <span class="c1"># inject a realization of noise using number_of_photons</span>
        <span class="c1"># (yields poisson distribution)</span>
        <span class="n">new</span><span class="o">.</span><span class="n">fluxlike</span><span class="p">[</span><span class="s2">&quot;flux&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">poisson</span><span class="p">(</span><span class="n">mu</span><span class="p">)</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">photon</span>  <span class="c1"># mu is the center</span>

        <span class="c1"># store number of photons as metadata</span>
        <span class="n">new</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;number_of_photons&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">number_of_photons</span>

        <span class="c1"># calculate the uncertainty</span>
        <span class="n">uncertainty</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mu</span><span class="p">)</span>
        <span class="n">new</span><span class="o">.</span><span class="n">fluxlike</span><span class="p">[</span><span class="s2">&quot;uncertainty&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">uncertainty</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">photon</span>

        <span class="c1"># append the history entry to the new Rainbow</span>
        <span class="n">new</span><span class="o">.</span><span class="n">_record_history_entry</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># calculate the uncertainty with a fixed S/N</span>
        <span class="n">uncertainty</span> <span class="o">=</span> <span class="n">model</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_broadcast_to_fluxlike</span><span class="p">(</span><span class="n">signal_to_noise</span><span class="p">)</span>
        <span class="n">new</span><span class="o">.</span><span class="n">fluxlike</span><span class="p">[</span><span class="s2">&quot;uncertainty&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">uncertainty</span>

        <span class="c1"># inject a realization of the noise</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">):</span>
            <span class="n">unit</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">unit</span>
            <span class="n">loc</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">to_value</span><span class="p">(</span><span class="n">unit</span><span class="p">)</span>
            <span class="n">scale</span> <span class="o">=</span> <span class="n">uncertainty</span><span class="o">.</span><span class="n">to_value</span><span class="p">(</span><span class="n">unit</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">unit</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">loc</span> <span class="o">=</span> <span class="n">model</span>
            <span class="n">scale</span> <span class="o">=</span> <span class="n">uncertainty</span>
        <span class="n">new</span><span class="o">.</span><span class="n">fluxlike</span><span class="p">[</span><span class="s2">&quot;flux&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">uncertainty</span><span class="p">)</span> <span class="o">*</span> <span class="n">unit</span>

        <span class="c1"># store S/N as metadata</span>
        <span class="n">new</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;signal_to_noise&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">signal_to_noise</span>

        <span class="c1"># append the history entry to the new Rainbow</span>
        <span class="n">new</span><span class="o">.</span><span class="n">_record_history_entry</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>

    <span class="c1"># return the new object</span>
    <span class="k">return</span> <span class="n">new</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">



<a id="chromatic.rainbows.actions.inject_outliers"></a>
    <div class="doc doc-contents first">

        <p>Inject some random outliers.</p>
<p>To approximately simulate cosmic rays or other
rare weird outliers, this randomly injects
outliers into a small fraction of pixels. For
this simple method, outliers will have the same
amplitude, either as a ratio above the per-data-point
or as a fixed number (if no uncertainties exist).</p>
<h3 id="chromatic.rainbows.actions.inject_outliers--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.actions.inject_outliers--parameters" title="Permanent link">#</a></h3>
<p>fraction : float, optional
    The fraction of pixels that should get outliers.
    (default = 0.01)
amplitude : float, optional
    If uncertainty &gt; 0, how many sigma should outliers be?
    If uncertainty = 0, what number should be injected?
    (default = 10)</p>
<h3 id="chromatic.rainbows.actions.inject_outliers--returns">Returns<a class="headerlink" href="#chromatic.rainbows.actions.inject_outliers--returns" title="Permanent link">#</a></h3>
<p>rainbow : Rainbow
    A new <code>Rainbow</code> object with outliers injected.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/rainbows/actions/inject_outliers.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">inject_outliers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fraction</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">amplitude</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Inject some random outliers.</span>

<span class="sd">    To approximately simulate cosmic rays or other</span>
<span class="sd">    rare weird outliers, this randomly injects</span>
<span class="sd">    outliers into a small fraction of pixels. For</span>
<span class="sd">    this simple method, outliers will have the same</span>
<span class="sd">    amplitude, either as a ratio above the per-data-point</span>
<span class="sd">    or as a fixed number (if no uncertainties exist).</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    fraction : float, optional</span>
<span class="sd">        The fraction of pixels that should get outliers.</span>
<span class="sd">        (default = 0.01)</span>
<span class="sd">    amplitude : float, optional</span>
<span class="sd">        If uncertainty &gt; 0, how many sigma should outliers be?</span>
<span class="sd">        If uncertainty = 0, what number should be injected?</span>
<span class="sd">        (default = 10)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    rainbow : Rainbow</span>
<span class="sd">        A new `Rainbow` object with outliers injected.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># create a history entry for this action (before other variables are defined)</span>
    <span class="n">h</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_history_entry</span><span class="p">(</span><span class="s2">&quot;inject_outliers&quot;</span><span class="p">,</span> <span class="nb">locals</span><span class="p">())</span>

    <span class="c1"># create a copy of the existing Rainbow</span>
    <span class="n">new</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_copy</span><span class="p">()</span>

    <span class="c1"># pick some random pixels to inject outliers</span>
    <span class="n">outliers</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">fraction</span>

    <span class="c1"># inject outliers based on uncertainty if possible</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">uncertainty</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
        <span class="n">new</span><span class="o">.</span><span class="n">fluxlike</span><span class="p">[</span><span class="s2">&quot;injected_outliers&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">outliers</span> <span class="o">*</span> <span class="n">amplitude</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">uncertainty</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">new</span><span class="o">.</span><span class="n">fluxlike</span><span class="p">[</span><span class="s2">&quot;injected_outliers&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">outliers</span> <span class="o">*</span> <span class="n">amplitude</span>

    <span class="c1"># modify the flux</span>
    <span class="n">new</span><span class="o">.</span><span class="n">fluxlike</span><span class="p">[</span><span class="s2">&quot;flux&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">new</span><span class="o">.</span><span class="n">fluxlike</span><span class="p">[</span><span class="s2">&quot;injected_outliers&quot;</span><span class="p">]</span>

    <span class="c1"># append the history entry to the new Rainbow</span>
    <span class="n">new</span><span class="o">.</span><span class="n">_record_history_entry</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>

    <span class="c1"># return the new object</span>
    <span class="k">return</span> <span class="n">new</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">



<a id="chromatic.rainbows.actions.inject_spectrum"></a>
    <div class="doc doc-contents first">

        <p>Inject a stellar spectrum into the flux.</p>
<p>This injects a constant stellar spectrum into
all times in the <code>Rainbow</code>. Injection happens
by multiplying the <code>.model</code> flux array, so for
example a model that already has a transit in
it will be scaled up to match the stellar spectrum
in all wavelengths.</p>
<h3 id="chromatic.rainbows.actions.inject_spectrum--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.actions.inject_spectrum--parameters" title="Permanent link">#</a></h3>
<p>temperature : Quantity, optional
    Temperature, in K (with no astropy units attached).
logg : float, optional
    Surface gravity log10[g/(cm/s**2)] (with no astropy units attached).
metallicity : float, optional
    Metallicity log10[metals/solar] (with no astropy units attached).
radius : Quantity, optional
    The radius of the star.
distance : Quantity, optional
    The distance to the star.
phoenix : bool, optional
    If <code>True</code>, use PHOENIX surface flux.
    If <code>False</code>, use Planck surface flux.</p>
<h3 id="chromatic.rainbows.actions.inject_spectrum--returns">Returns<a class="headerlink" href="#chromatic.rainbows.actions.inject_spectrum--returns" title="Permanent link">#</a></h3>
<p>rainbow : Rainbow
    A new <code>Rainbow</code> object with the spectrum injected.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/rainbows/actions/inject_spectrum.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">inject_spectrum</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">temperature</span><span class="o">=</span><span class="mi">5800</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">K</span><span class="p">,</span>
    <span class="n">logg</span><span class="o">=</span><span class="mf">4.43</span><span class="p">,</span>
    <span class="n">metallicity</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
    <span class="n">radius</span><span class="o">=</span><span class="mi">1</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">Rsun</span><span class="p">,</span>
    <span class="n">distance</span><span class="o">=</span><span class="mi">10</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">pc</span><span class="p">,</span>
    <span class="n">phoenix</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Inject a stellar spectrum into the flux.</span>

<span class="sd">    This injects a constant stellar spectrum into</span>
<span class="sd">    all times in the `Rainbow`. Injection happens</span>
<span class="sd">    by multiplying the `.model` flux array, so for</span>
<span class="sd">    example a model that already has a transit in</span>
<span class="sd">    it will be scaled up to match the stellar spectrum</span>
<span class="sd">    in all wavelengths.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    temperature : Quantity, optional</span>
<span class="sd">        Temperature, in K (with no astropy units attached).</span>
<span class="sd">    logg : float, optional</span>
<span class="sd">        Surface gravity log10[g/(cm/s**2)] (with no astropy units attached).</span>
<span class="sd">    metallicity : float, optional</span>
<span class="sd">        Metallicity log10[metals/solar] (with no astropy units attached).</span>
<span class="sd">    radius : Quantity, optional</span>
<span class="sd">        The radius of the star.</span>
<span class="sd">    distance : Quantity, optional</span>
<span class="sd">        The distance to the star.</span>
<span class="sd">    phoenix : bool, optional</span>
<span class="sd">        If `True`, use PHOENIX surface flux.</span>
<span class="sd">        If `False`, use Planck surface flux.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    rainbow : Rainbow</span>
<span class="sd">        A new `Rainbow` object with the spectrum injected.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># create a history entry for this action (before other variables are defined)</span>
    <span class="n">h</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_history_entry</span><span class="p">(</span><span class="s2">&quot;inject_spectrum&quot;</span><span class="p">,</span> <span class="nb">locals</span><span class="p">())</span>

    <span class="c1"># create a copy of the existing Rainbow</span>
    <span class="n">new</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_copy</span><span class="p">()</span>

    <span class="c1"># warn if maybe we shouldn&#39;t inject anything</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="p">)</span><span class="o">.</span><span class="n">value</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">cheerfully_suggest</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        None of the pre-existing flux values were 1,</span>
<span class="s2">        which hints at the possibility that there</span>
<span class="s2">        might already be a spectrum in them. Please</span>
<span class="s2">        watch out for weird units or values!</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="n">phoenix</span><span class="p">:</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">get_phoenix_photons</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">get_planck_photons</span>

    <span class="c1"># get the spectrum from the surface</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">surface_flux</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span>
        <span class="n">temperature</span><span class="o">=</span><span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">temperature</span><span class="p">)</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
        <span class="n">logg</span><span class="o">=</span><span class="n">logg</span><span class="p">,</span>
        <span class="n">metallicity</span><span class="o">=</span><span class="n">metallicity</span><span class="p">,</span>
        <span class="n">wavelength</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">wavelength</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># get the received flux at Earth</span>
    <span class="n">received_flux</span> <span class="o">=</span> <span class="n">surface_flux</span> <span class="o">*</span> <span class="p">(</span><span class="n">radius</span> <span class="o">/</span> <span class="n">distance</span><span class="p">)</span><span class="o">.</span><span class="n">decompose</span><span class="p">()</span> <span class="o">**</span> <span class="mi">2</span>

    <span class="c1"># do math with spectrum</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;flux&quot;</span><span class="p">,</span> <span class="s2">&quot;model&quot;</span><span class="p">,</span> <span class="s2">&quot;uncertainty&quot;</span><span class="p">]:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">new</span><span class="o">.</span><span class="n">fluxlike</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_broadcast_to_fluxlike</span><span class="p">(</span><span class="n">received_flux</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">pass</span>

    <span class="c1"># append the history entry to the new Rainbow</span>
    <span class="n">new</span><span class="o">.</span><span class="n">_record_history_entry</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>

    <span class="c1"># return the new object</span>
    <span class="k">return</span> <span class="n">new</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">



<a id="chromatic.rainbows.actions.inject_systematics"></a>
    <div class="doc doc-contents first">

        <p>Inject some (very cartoony) instrumental systematics.</p>
<p>Here's the basic procedure:</p>
<p>1) Generate some fake variables that vary either just with
wavelength, just with time, or with both time and wavelength.
Store these variables for later use. For example, these might
represent an average <code>x</code> and <code>y</code> centroid of the trace on the
detector (one for each time), or the background flux associated
with each wavelength (one for each time and for each wavelength).</p>
<p>2) Generate a flux model as some function of those variables.
In reality, we probably don't know the actual relationship
between these inputs and the flux, but we can imagine one!</p>
<p>3) Inject the model flux into the <code>flux</code> of this Rainbow,
and store the combined model in <code>systematics-model</code> and
each individual component in <code>systematic-model-{...}</code>.</p>
<h3 id="chromatic.rainbows.actions.inject_systematics--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.actions.inject_systematics--parameters" title="Permanent link">#</a></h3>
<p>amplitude : float, optional
    The (standard deviation-ish) amplitude of the systematics
    in units normalized to 1. For example, an amplitude of 0.003
    will produce systematic trends that tend to range (at 1 sigma)
    from 0.997 to 1.003.
wavelike : list of strings, optional
    A list of wave-like cotrending quantities to serve as ingredients
    to a linear combination systematics model. Existing quantities
    will be pulled from the appropriate core dictionary; fake
    data will be created for quantities that don't already exist,
    from a cartoony Gaussian process model.
timelike : list of strings, optional
    A list of time-like cotrending quantities to serve as ingredients
    to a linear combination systematics model. Existing quantities
    will be pulled from the appropriate core dictionary; fake
    data will be created for quantities that don't already exist,
    from a cartoony Gaussian process model.
fluxlike : list of strings, optional
    A list of flux-like cotrending quantities to serve as ingredients
    to a linear combination systematics model. Existing quantities
    will be pulled from the appropriate core dictionary; fake
    data will be created for quantities that don't already exist,
    from a cartoony Gaussian process model.</p>
<h3 id="chromatic.rainbows.actions.inject_systematics--returns">Returns<a class="headerlink" href="#chromatic.rainbows.actions.inject_systematics--returns" title="Permanent link">#</a></h3>
<p>rainbow : Rainbow
    A new Rainbow object with the systematics injected.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/rainbows/actions/inject_systematics.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">inject_systematics</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">amplitude</span><span class="o">=</span><span class="mf">0.003</span><span class="p">,</span>
    <span class="n">wavelike</span><span class="o">=</span><span class="p">[],</span>
    <span class="n">timelike</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="s2">&quot;time&quot;</span><span class="p">],</span>
    <span class="n">fluxlike</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;background&quot;</span><span class="p">],</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Inject some (very cartoony) instrumental systematics.</span>

<span class="sd">    Here&#39;s the basic procedure:</span>

<span class="sd">    1) Generate some fake variables that vary either just with</span>
<span class="sd">    wavelength, just with time, or with both time and wavelength.</span>
<span class="sd">    Store these variables for later use. For example, these might</span>
<span class="sd">    represent an average `x` and `y` centroid of the trace on the</span>
<span class="sd">    detector (one for each time), or the background flux associated</span>
<span class="sd">    with each wavelength (one for each time and for each wavelength).</span>

<span class="sd">    2) Generate a flux model as some function of those variables.</span>
<span class="sd">    In reality, we probably don&#39;t know the actual relationship</span>
<span class="sd">    between these inputs and the flux, but we can imagine one!</span>

<span class="sd">    3) Inject the model flux into the `flux` of this Rainbow,</span>
<span class="sd">    and store the combined model in `systematics-model` and</span>
<span class="sd">    each individual component in `systematic-model-{...}`.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    amplitude : float, optional</span>
<span class="sd">        The (standard deviation-ish) amplitude of the systematics</span>
<span class="sd">        in units normalized to 1. For example, an amplitude of 0.003</span>
<span class="sd">        will produce systematic trends that tend to range (at 1 sigma)</span>
<span class="sd">        from 0.997 to 1.003.</span>
<span class="sd">    wavelike : list of strings, optional</span>
<span class="sd">        A list of wave-like cotrending quantities to serve as ingredients</span>
<span class="sd">        to a linear combination systematics model. Existing quantities</span>
<span class="sd">        will be pulled from the appropriate core dictionary; fake</span>
<span class="sd">        data will be created for quantities that don&#39;t already exist,</span>
<span class="sd">        from a cartoony Gaussian process model.</span>
<span class="sd">    timelike : list of strings, optional</span>
<span class="sd">        A list of time-like cotrending quantities to serve as ingredients</span>
<span class="sd">        to a linear combination systematics model. Existing quantities</span>
<span class="sd">        will be pulled from the appropriate core dictionary; fake</span>
<span class="sd">        data will be created for quantities that don&#39;t already exist,</span>
<span class="sd">        from a cartoony Gaussian process model.</span>
<span class="sd">    fluxlike : list of strings, optional</span>
<span class="sd">        A list of flux-like cotrending quantities to serve as ingredients</span>
<span class="sd">        to a linear combination systematics model. Existing quantities</span>
<span class="sd">        will be pulled from the appropriate core dictionary; fake</span>
<span class="sd">        data will be created for quantities that don&#39;t already exist,</span>
<span class="sd">        from a cartoony Gaussian process model.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    rainbow : Rainbow</span>
<span class="sd">        A new Rainbow object with the systematics injected.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># create a history entry for this action (before other variables are defined)</span>
    <span class="n">h</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_history_entry</span><span class="p">(</span><span class="s2">&quot;inject_systematics&quot;</span><span class="p">,</span> <span class="nb">locals</span><span class="p">())</span>

    <span class="c1"># create a copy of the existing Rainbow</span>
    <span class="n">new</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_copy</span><span class="p">()</span>
    <span class="n">new</span><span class="o">.</span><span class="n">fluxlike</span><span class="p">[</span><span class="s2">&quot;systematics_model&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">standardize</span><span class="p">(</span><span class="n">q</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A quick helper to normalize all inputs to zero mean</span>
<span class="sd">        and unit standard deviation. It</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">offset</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
        <span class="n">sigma</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanstd</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">((</span><span class="n">q</span> <span class="o">-</span> <span class="n">offset</span><span class="p">)</span> <span class="o">/</span> <span class="n">sigma</span><span class="p">)</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="n">sigma</span>

    <span class="n">components</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">wavelike</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">wavelike</span><span class="p">:</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="n">sigma</span> <span class="o">=</span> <span class="n">standardize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wavelike</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">new</span><span class="o">.</span><span class="n">_create_fake_wavelike_quantity</span><span class="p">()</span>
            <span class="n">offset</span><span class="p">,</span> <span class="n">sigma</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span>
            <span class="n">new</span><span class="o">.</span><span class="n">wavelike</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">amplitude</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">c</span> <span class="o">*</span> <span class="n">x</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="n">new</span><span class="o">.</span><span class="n">fluxlike</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;systematics_model_from_</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span>
        <span class="n">new</span><span class="o">.</span><span class="n">fluxlike</span><span class="p">[</span><span class="s2">&quot;systematics_model&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">df</span>
        <span class="n">components</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
            <span class="o">**</span><span class="p">{</span>
                <span class="sa">f</span><span class="s2">&quot;linear_</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;c_</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">*(</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2"> - offset_</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">)/sigma_</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="sa">f</span><span class="s2">&quot;c_</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">:</span> <span class="n">c</span><span class="p">,</span>
                <span class="sa">f</span><span class="s2">&quot;offset_</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">:</span> <span class="n">offset</span><span class="p">,</span>
                <span class="sa">f</span><span class="s2">&quot;sigma_</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">:</span> <span class="n">sigma</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">)</span>

    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">timelike</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">timelike</span><span class="p">:</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="n">sigma</span> <span class="o">=</span> <span class="n">standardize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timelike</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">new</span><span class="o">.</span><span class="n">_create_fake_timelike_quantity</span><span class="p">()</span>
            <span class="n">offset</span><span class="p">,</span> <span class="n">sigma</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span>
            <span class="n">new</span><span class="o">.</span><span class="n">timelike</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">amplitude</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">c</span> <span class="o">*</span> <span class="n">x</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="p">:]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="n">new</span><span class="o">.</span><span class="n">fluxlike</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;systematics_model_from_</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span>
        <span class="n">new</span><span class="o">.</span><span class="n">fluxlike</span><span class="p">[</span><span class="s2">&quot;systematics_model&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">df</span>
        <span class="n">components</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
            <span class="o">**</span><span class="p">{</span>
                <span class="sa">f</span><span class="s2">&quot;linear_</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;c_</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">*(</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2"> - offset_</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">)/sigma_</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="sa">f</span><span class="s2">&quot;c_</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">:</span> <span class="n">c</span><span class="p">,</span>
                <span class="sa">f</span><span class="s2">&quot;offset_</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">:</span> <span class="n">offset</span><span class="p">,</span>
                <span class="sa">f</span><span class="s2">&quot;sigma_</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">:</span> <span class="n">sigma</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">)</span>

    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">fluxlike</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fluxlike</span><span class="p">:</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="n">sigma</span> <span class="o">=</span> <span class="n">standardize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fluxlike</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">new</span><span class="o">.</span><span class="n">_create_fake_fluxlike_quantity</span><span class="p">()</span>
            <span class="n">offset</span><span class="p">,</span> <span class="n">sigma</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span>
            <span class="n">new</span><span class="o">.</span><span class="n">fluxlike</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">amplitude</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">c</span> <span class="o">*</span> <span class="n">x</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="n">new</span><span class="o">.</span><span class="n">fluxlike</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;systematics_model_from_</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span>
        <span class="n">new</span><span class="o">.</span><span class="n">fluxlike</span><span class="p">[</span><span class="s2">&quot;systematics_model&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">df</span>
        <span class="n">components</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
            <span class="o">**</span><span class="p">{</span>
                <span class="sa">f</span><span class="s2">&quot;linear_</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;c_</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">*(</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2"> - offset_</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">)/sigma_</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="sa">f</span><span class="s2">&quot;c_</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">:</span> <span class="n">c</span><span class="p">,</span>
                <span class="sa">f</span><span class="s2">&quot;offset_</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">:</span> <span class="n">offset</span><span class="p">,</span>
                <span class="sa">f</span><span class="s2">&quot;sigma_</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">:</span> <span class="n">sigma</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">)</span>

    <span class="n">new</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;systematics_components&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">components</span>
    <span class="n">new</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;systematics_equation&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;f = 1</span><span class="se">\n</span><span class="s2">  + &quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">  + &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
        <span class="p">[</span><span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">components</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span><span class="p">[:</span><span class="mi">7</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;linear_&quot;</span><span class="p">]</span>
    <span class="p">)</span>

    <span class="c1"># modify both the model and flux arrays</span>
    <span class="n">new</span><span class="o">.</span><span class="n">flux</span> <span class="o">*=</span> <span class="n">new</span><span class="o">.</span><span class="n">systematics_model</span>
    <span class="n">new</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">new</span><span class="o">.</span><span class="n">fluxlike</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;model&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">new</span><span class="o">.</span><span class="n">systematics_model</span>

    <span class="c1"># append the history entry to the new Rainbow</span>
    <span class="n">new</span><span class="o">.</span><span class="n">_record_history_entry</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>

    <span class="c1"># return the new object</span>
    <span class="k">return</span> <span class="n">new</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">



<a id="chromatic.rainbows.actions.inject_transit"></a>
    <div class="doc doc-contents first">

        <p>Simulate a wavelength-dependent planetary transit.</p>
<p>This uses one of a few methods to inject a transit
signal into the <code>Rainbow</code>, allowing the transit
depth to change with wavelength (for example due to a
planet's effective radius changing with wavelength due
to its atmospheric transmission spectrum). Other
parameters can also be wavlength-dependent, but
some (like period, inclination, etc...) probably
shouldn't be.</p>
<p>The current methods include:</p>
<p><code>'trapezoid'</code> to inject a cartoon transit, using nomenclature
from <a href="https://arxiv.org/abs/1001.2010">Winn (2010)</a>.
This is the default method, to avoid package dependencies
that can be finicky to compile and/or install on different
operating systems.</p>
<p><code>'exoplanet'</code> to inject a limb-darkened transit using <a href="https://github.com/exoplanet-dev/exoplanet-core">exoplanet-core</a>.
This option requires <code>exoplanet-core</code> be installed,
but it doesn't require complicated dependencies or
compiling steps, so it's already included as a dependency.</p>
<h3 id="chromatic.rainbows.actions.inject_transit--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.actions.inject_transit--parameters" title="Permanent link">#</a></h3>
<p>planet_radius : float, array, None
    The planet-to-star radius ratio = [transit depth]<strong>0.5,
    which can be either a single value for all wavelengths,
    or an array with one value for each wavelength.
method : str
    What method should be used to inject the transits? Different
    methods will produce different results and have different options.
    The currently implement options are <code>'trapezoid'</code> and <code>'exoplanet'</code>.
</strong>transit_parameters : dict
    All additional keywords will be passed to the transit model.
    The accepted keywords for the different methods are as follows.
        <code>'trapezoid'</code> accepts the following keyword arguments:
            <code>delta</code> = The depth of the transit, as a fraction of the out-of-transit flux (default 0.01)
            (If not provided, it will be set by <code>planet_radius</code>.)
            <code>P</code> = The orbital period of the planet, in days (default 3.0)
            <code>t0</code> = Mid-transit time of the transit, in days (default 0.0)
            <code>T</code> = The duration of the transit (from mid-ingress to mid-egress), in days (default 0.1)
            <code>tau</code> = The duration of ingress/egress, in days (default 0.01)
            <code>baseline</code> = The baseline, out-of-transit flux level (default 1.0)
        <code>'exoplanet'</code> accepts the following keyword arguments:
            <code>rp</code> = (planet radius)/(star radius), unitless (default 0.1)
            (If not provided, it will be set by <code>planet_radius</code>.)
            <code>t0</code> = Mid-transit time of the transit, in days (default 0.0)
            <code>per</code> = The orbital period of the planet, in days (default 3.0)
            <code>a</code> = (semi-major axis)/(star radius), unitless (default 10)
            <code>inc</code> = The orbital inclination, in degrees (default 90)
            <code>ecc</code> = The orbital eccentricity, unitless (default 0.0)
            <code>w</code> = The longitude of periastron, in degrees (default 0.0)
            <code>u</code> = The quadratic limb-darkening coefficients (default [0.2, 0.2])
                These coefficients can only be a 2D array of the form (n_wavelengths, n_coefficients) where
                each row is the set of limb-darkening coefficients corresponding
                to a single wavelength
            Note that this currently does not calculate the appropriate
            coefficient vs wavelength variations itself; there exist codes
            (such as hpparvi/PyLDTk and nespinoza/limb-darkening) which
            can be used for this.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/rainbows/actions/inject_transit.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">inject_transit</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">planet_radius</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
    <span class="n">method</span><span class="o">=</span><span class="s2">&quot;exoplanet&quot;</span><span class="p">,</span>
    <span class="o">**</span><span class="n">transit_parameters</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Simulate a wavelength-dependent planetary transit.</span>

<span class="sd">    This uses one of a few methods to inject a transit</span>
<span class="sd">    signal into the `Rainbow`, allowing the transit</span>
<span class="sd">    depth to change with wavelength (for example due to a</span>
<span class="sd">    planet&#39;s effective radius changing with wavelength due</span>
<span class="sd">    to its atmospheric transmission spectrum). Other</span>
<span class="sd">    parameters can also be wavlength-dependent, but</span>
<span class="sd">    some (like period, inclination, etc...) probably</span>
<span class="sd">    shouldn&#39;t be.</span>

<span class="sd">    The current methods include:</span>

<span class="sd">    `&#39;trapezoid&#39;` to inject a cartoon transit, using nomenclature</span>
<span class="sd">    from [Winn (2010)](https://arxiv.org/abs/1001.2010).</span>
<span class="sd">    This is the default method, to avoid package dependencies</span>
<span class="sd">    that can be finicky to compile and/or install on different</span>
<span class="sd">    operating systems.</span>

<span class="sd">    `&#39;exoplanet&#39;` to inject a limb-darkened transit using [exoplanet-core](https://github.com/exoplanet-dev/exoplanet-core).</span>
<span class="sd">    This option requires `exoplanet-core` be installed,</span>
<span class="sd">    but it doesn&#39;t require complicated dependencies or</span>
<span class="sd">    compiling steps, so it&#39;s already included as a dependency.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    planet_radius : float, array, None</span>
<span class="sd">        The planet-to-star radius ratio = [transit depth]**0.5,</span>
<span class="sd">        which can be either a single value for all wavelengths,</span>
<span class="sd">        or an array with one value for each wavelength.</span>
<span class="sd">    method : str</span>
<span class="sd">        What method should be used to inject the transits? Different</span>
<span class="sd">        methods will produce different results and have different options.</span>
<span class="sd">        The currently implement options are `&#39;trapezoid&#39;` and `&#39;exoplanet&#39;`.</span>
<span class="sd">    **transit_parameters : dict</span>
<span class="sd">        All additional keywords will be passed to the transit model.</span>
<span class="sd">        The accepted keywords for the different methods are as follows.</span>
<span class="sd">            `&#39;trapezoid&#39;` accepts the following keyword arguments:</span>
<span class="sd">                `delta` = The depth of the transit, as a fraction of the out-of-transit flux (default 0.01)</span>
<span class="sd">                (If not provided, it will be set by `planet_radius`.)</span>
<span class="sd">                `P` = The orbital period of the planet, in days (default 3.0)</span>
<span class="sd">                `t0` = Mid-transit time of the transit, in days (default 0.0)</span>
<span class="sd">                `T` = The duration of the transit (from mid-ingress to mid-egress), in days (default 0.1)</span>
<span class="sd">                `tau` = The duration of ingress/egress, in days (default 0.01)</span>
<span class="sd">                `baseline` = The baseline, out-of-transit flux level (default 1.0)</span>
<span class="sd">            `&#39;exoplanet&#39;` accepts the following keyword arguments:</span>
<span class="sd">                `rp` = (planet radius)/(star radius), unitless (default 0.1)</span>
<span class="sd">                (If not provided, it will be set by `planet_radius`.)</span>
<span class="sd">                `t0` = Mid-transit time of the transit, in days (default 0.0)</span>
<span class="sd">                `per` = The orbital period of the planet, in days (default 3.0)</span>
<span class="sd">                `a` = (semi-major axis)/(star radius), unitless (default 10)</span>
<span class="sd">                `inc` = The orbital inclination, in degrees (default 90)</span>
<span class="sd">                `ecc` = The orbital eccentricity, unitless (default 0.0)</span>
<span class="sd">                `w` = The longitude of periastron, in degrees (default 0.0)</span>
<span class="sd">                `u` = The quadratic limb-darkening coefficients (default [0.2, 0.2])</span>
<span class="sd">                    These coefficients can only be a 2D array of the form (n_wavelengths, n_coefficients) where</span>
<span class="sd">                    each row is the set of limb-darkening coefficients corresponding</span>
<span class="sd">                    to a single wavelength</span>
<span class="sd">                Note that this currently does not calculate the appropriate</span>
<span class="sd">                coefficient vs wavelength variations itself; there exist codes</span>
<span class="sd">                (such as hpparvi/PyLDTk and nespinoza/limb-darkening) which</span>
<span class="sd">                can be used for this.</span>


<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># create a history entry for this action (before other variables are defined)</span>
    <span class="n">h</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_history_entry</span><span class="p">(</span><span class="s2">&quot;inject_transit&quot;</span><span class="p">,</span> <span class="nb">locals</span><span class="p">())</span>
    <span class="n">h</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;transit_parameters={&quot;</span><span class="p">,</span> <span class="s2">&quot;**{&quot;</span><span class="p">)</span>

    <span class="c1"># create a copy of the existing Rainbow</span>
    <span class="n">new</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_copy</span><span class="p">()</span>

    <span class="c1"># make sure the depth is set, with some flexibility</span>
    <span class="c1"># to allow for different names. parameter names that</span>
    <span class="c1"># belong directly to the transit model [delta, rp]</span>
    <span class="c1"># will take precendence first, then [depth], then</span>
    <span class="c1"># [planet_radius = the default]</span>

    <span class="c1"># set defaults for planet simulation</span>
    <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;trapezoid&quot;</span><span class="p">:</span>
        <span class="n">parameters_to_use</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;delta&quot;</span><span class="p">:</span> <span class="n">planet_radius</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">planet_radius</span><span class="p">),</span>
            <span class="s2">&quot;P&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>
            <span class="s2">&quot;t0&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
            <span class="s2">&quot;T&quot;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span>
            <span class="s2">&quot;tau&quot;</span><span class="p">:</span> <span class="mf">0.01</span><span class="p">,</span>
            <span class="s2">&quot;baseline&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;exoplanet&quot;</span><span class="p">:</span>
        <span class="n">parameters_to_use</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;rp&quot;</span><span class="p">:</span> <span class="n">planet_radius</span><span class="p">,</span>
            <span class="s2">&quot;t0&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
            <span class="s2">&quot;per&quot;</span><span class="p">:</span> <span class="mf">3.0</span><span class="p">,</span>
            <span class="s2">&quot;a&quot;</span><span class="p">:</span> <span class="mf">10.0</span><span class="p">,</span>
            <span class="s2">&quot;inc&quot;</span><span class="p">:</span> <span class="mf">90.0</span><span class="p">,</span>
            <span class="s2">&quot;ecc&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
            <span class="s2">&quot;w&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
            <span class="s2">&quot;u&quot;</span><span class="p">:</span> <span class="p">[[</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">]],</span>
        <span class="p">}</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        &#39;method&#39; must be one of [&#39;exoplanet&#39;, &#39;trapezoid&#39;]</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="p">)</span>

    <span class="c1"># update based on explicit keyword arguments</span>
    <span class="n">parameters_to_use</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="n">transit_parameters</span><span class="p">)</span>

    <span class="c1"># check the parameter shapes are legitimate</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">parameters_to_use</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">s</span> <span class="o">!=</span> <span class="p">())</span> <span class="ow">and</span> <span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">new</span><span class="o">.</span><span class="n">nwave</span><span class="p">]):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            The parameter </span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">v</span><span class="si">}</span>
<span class="s2">            has a shape of </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="si">}</span><span class="s2">, which we don&#39;t know</span>
<span class="s2">            how to interpret. It should be a single value,</span>
<span class="s2">            or have a first dimension of either 1 or nwave=</span><span class="si">{</span><span class="n">new</span><span class="o">.</span><span class="n">nwave</span><span class="si">}</span><span class="s2">.</span>
<span class="s2">            &quot;&quot;&quot;</span>
            <span class="p">)</span>

    <span class="c1"># call the model for each wavelength</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">new</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">to_value</span><span class="p">(</span><span class="s2">&quot;day&quot;</span><span class="p">)</span>
    <span class="n">planet_flux</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">new</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nwave</span><span class="p">):</span>
        <span class="n">parameters_for_this_wavelength</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">k</span><span class="p">:</span> <span class="n">get_for_wavelength</span><span class="p">(</span><span class="n">parameters_to_use</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">parameters_to_use</span>
        <span class="p">}</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">transit_model_functions</span><span class="p">[</span><span class="n">method</span><span class="p">]</span>
        <span class="n">monochromatic_flux</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="o">**</span><span class="n">parameters_for_this_wavelength</span><span class="p">)</span>
        <span class="n">planet_flux</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">monochromatic_flux</span>

    <span class="c1"># store the model in the new Rainbow object</span>
    <span class="n">new</span><span class="o">.</span><span class="n">planet_model</span> <span class="o">=</span> <span class="n">planet_flux</span>
    <span class="n">new</span><span class="o">.</span><span class="n">flux</span> <span class="o">*=</span> <span class="n">new</span><span class="o">.</span><span class="n">planet_model</span>
    <span class="n">new</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">new</span><span class="o">.</span><span class="n">fluxlike</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;model&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">new</span><span class="o">.</span><span class="n">planet_model</span>

    <span class="c1"># store the injected parameters as metadata or wavelike</span>
    <span class="n">new</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;injected_transit_method&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">method</span>
    <span class="n">new</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;injected_transit_parameters&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">parameters_to_use</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">parameters_to_use</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">label</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;injected_transit_</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">s</span> <span class="o">==</span> <span class="p">():</span>
            <span class="k">continue</span>
        <span class="k">elif</span> <span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">new</span><span class="o">.</span><span class="n">nwave</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">new</span><span class="o">.</span><span class="n">wavelike</span><span class="p">[</span><span class="n">label</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                    <span class="n">new</span><span class="o">.</span><span class="n">wavelike</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">label</span><span class="si">}{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span>

    <span class="c1"># append the history entry to the new Rainbow</span>
    <span class="n">new</span><span class="o">.</span><span class="n">_record_history_entry</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>

    <span class="c1"># return the new object</span>
    <span class="k">return</span> <span class="n">new</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-module">



<a id="chromatic.rainbows.actions.normalization"></a>
    <div class="doc doc-contents first">









  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.actions.normalization.bintoR" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">bintoR</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">unc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">R</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">weighting</span><span class="o">=</span><span class="s1">&#39;inversevariance&#39;</span><span class="p">,</span> <span class="n">drop_nans</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.actions.normalization.bintoR" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Bin any x and y array onto a logarithmicly uniform grid.</p>
<h4 id="chromatic.rainbows.actions.normalization.bintoR--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.actions.normalization.bintoR--parameters" title="Permanent link">#</a></h4>
<p>x : array
    The original independent variable.
    (For a spectrum example = wavelength)
y : array
    The original dependent variable (same size as x).
    (For a spectrum example = flux)
unc : array, None, optional
    The unceratinty on the dependent variable
    (For a spectrum example = the flux uncertainty)
R : array, optional
    The spectral resolution R=x/dx for creating a new,
    logarithmically uniform grid that starts at the first
    value of x.
xlim : list, array, optional
    A two-element list indicating the min and max values of
    x for the new logarithmically spaced grid. If None,
    these limits will be created from the data themselves
weighting : str, optional
    How should we weight values when averaging
    them together into one larger bin?
    <code>weighting = 'inversevariance'</code>
        weights = 1/unc**2
     <code>weighting = {literally anything else}</code>
        uniform weights
    This will have no impact if <code>unc == None</code>, or for any
    new bins that effectively overlap less than one original
    unbinned point.
drop_nans : bool, optional
    Should we skip any bins turn out to be nans?
    This most often happens when bins are empty.</p>
<h4 id="chromatic.rainbows.actions.normalization.bintoR--returns">Returns<a class="headerlink" href="#chromatic.rainbows.actions.normalization.bintoR--returns" title="Permanent link">#</a></h4>
<p>result : dict
    A dictionary containing at least...
        <code>x</code> = the center of the output grid
        <code>y</code> = the resampled value on the output grid
        <code>x_edge_lower</code> = the lower edges of the output grid
        <code>x_edge_upper</code> = the upper edges of the output grid
    ...and possibly also
        <code>uncertainty</code> = the calculated uncertainty per bin</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/tools/resampling.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">bintoR</span><span class="p">(</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">unc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">R</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">weighting</span><span class="o">=</span><span class="s2">&quot;inversevariance&quot;</span><span class="p">,</span> <span class="n">drop_nans</span><span class="o">=</span><span class="kc">True</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Bin any x and y array onto a logarithmicly uniform grid.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : array</span>
<span class="sd">        The original independent variable.</span>
<span class="sd">        (For a spectrum example = wavelength)</span>
<span class="sd">    y : array</span>
<span class="sd">        The original dependent variable (same size as x).</span>
<span class="sd">        (For a spectrum example = flux)</span>
<span class="sd">    unc : array, None, optional</span>
<span class="sd">        The unceratinty on the dependent variable</span>
<span class="sd">        (For a spectrum example = the flux uncertainty)</span>
<span class="sd">    R : array, optional</span>
<span class="sd">        The spectral resolution R=x/dx for creating a new,</span>
<span class="sd">        logarithmically uniform grid that starts at the first</span>
<span class="sd">        value of x.</span>
<span class="sd">    xlim : list, array, optional</span>
<span class="sd">        A two-element list indicating the min and max values of</span>
<span class="sd">        x for the new logarithmically spaced grid. If None,</span>
<span class="sd">        these limits will be created from the data themselves</span>
<span class="sd">    weighting : str, optional</span>
<span class="sd">        How should we weight values when averaging</span>
<span class="sd">        them together into one larger bin?</span>
<span class="sd">        `weighting = &#39;inversevariance&#39;`</span>
<span class="sd">            weights = 1/unc**2</span>
<span class="sd">         `weighting = {literally anything else}`</span>
<span class="sd">            uniform weights</span>
<span class="sd">        This will have no impact if `unc == None`, or for any</span>
<span class="sd">        new bins that effectively overlap less than one original</span>
<span class="sd">        unbinned point.</span>
<span class="sd">    drop_nans : bool, optional</span>
<span class="sd">        Should we skip any bins turn out to be nans?</span>
<span class="sd">        This most often happens when bins are empty.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    result : dict</span>
<span class="sd">        A dictionary containing at least...</span>
<span class="sd">            `x` = the center of the output grid</span>
<span class="sd">            `y` = the resampled value on the output grid</span>
<span class="sd">            `x_edge_lower` = the lower edges of the output grid</span>
<span class="sd">            `x_edge_upper` = the upper edges of the output grid</span>
<span class="sd">        ...and possibly also</span>
<span class="sd">            `uncertainty` = the calculated uncertainty per bin</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">x_unit</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">unit</span>
        <span class="n">x_without_unit</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">value</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="n">x_unit</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">x_without_unit</span> <span class="o">=</span> <span class="n">x</span>

    <span class="c1"># create a new grid of x at the given resolution</span>
    <span class="n">lnx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">x_without_unit</span><span class="p">)</span>
    <span class="n">dnewlnx</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">R</span>

    <span class="c1"># set the limits of the new xgrid (in log space)</span>
    <span class="k">if</span> <span class="n">xlim</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># use the input grid to set the limits</span>
        <span class="n">lnxbottom</span><span class="p">,</span> <span class="n">lnxtop</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">lnx</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">lnx</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># use the custom xlim to set the limits</span>
        <span class="n">lnxbottom</span><span class="p">,</span> <span class="n">lnxtop</span> <span class="o">=</span> <span class="n">xlim</span>

    <span class="c1"># create a new, log-uniform grid of x values</span>
    <span class="n">newlnx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">lnxbottom</span><span class="p">,</span> <span class="n">lnxtop</span> <span class="o">+</span> <span class="n">dnewlnx</span><span class="p">,</span> <span class="n">dnewlnx</span><span class="p">)</span>

    <span class="c1"># now do the binning on a uniform grid of lnx</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">bintogrid</span><span class="p">(</span>
        <span class="n">lnx</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">unc</span><span class="p">,</span> <span class="n">newx</span><span class="o">=</span><span class="n">newlnx</span><span class="p">,</span> <span class="n">weighting</span><span class="o">=</span><span class="n">weighting</span><span class="p">,</span> <span class="n">drop_nans</span><span class="o">=</span><span class="n">drop_nans</span>
    <span class="p">)</span>

    <span class="c1"># convert back from log to real values</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;x_edge_lower&quot;</span><span class="p">,</span> <span class="s2">&quot;x_edge_upper&quot;</span><span class="p">]:</span>
        <span class="n">result</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="o">*</span> <span class="n">x_unit</span>

    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.actions.normalization.bintogrid" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">bintogrid</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">unc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">newx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">newx_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">nx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">weighting</span><span class="o">=</span><span class="s1">&#39;inversevariance&#39;</span><span class="p">,</span> <span class="n">drop_nans</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">x_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">visualize</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.actions.normalization.bintogrid" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Bin any x and y array onto a linearly uniform grid.</p>
<h4 id="chromatic.rainbows.actions.normalization.bintogrid--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.actions.normalization.bintogrid--parameters" title="Permanent link">#</a></h4>
<p>x : array
    The original independent variable.
    (For a spectrum example = wavelength)
y : array
    The original dependent variable (same size as x).
    (For a spectrum example = flux)
unc : array, None
    The unceratinty on the dependent variable
    (For a spectrum example = the flux uncertainty)
nx : array
    The number of bins from the original grid to
    bin together into the new one.
dx : array
    The fixed spacing for creating a new, linearly uniform
    grid that start at the first value of x. This will
    be ignored if <code>newx</code> != None.
newx : array
    A new custom grid onto which we should bin.
newx_edges : array
    The edges of the new grid of bins for the independent
    variable, onto which you want to resample the y
    values. The left and right edges of the bins will be,
    respectively, <code>newx_edges[:-1]</code> and <code>newx_edges[1:]</code>,
    so the size of the output array will be
    <code>len(newx_edges) - 1</code>
weighting : str
    How should we weight values when averaging
    them together into one larger bin?
    <code>weighting = 'inversevariance'</code>
        weights = 1/unc**2
     <code>weighting = {literally anything else}</code>
        uniform weights
    This will have no impact if <code>unc == None</code>, or for any
    new bins that effectively overlap less than one original
    unbinned point.
drop_nans : bool
    Should we skip any bins turn out to be nans?
    This most often happens when bins are empty.
x_edges : array
    The edges of the original independent variable bins.
    The left and right edges of the bins are interpreted
    to be <code>x_edges[:-1]</code> and <code>x_edges[1:]</code>,
    respectively, so the associated <code>y</code> should have exactly
    1 fewer element than <code>x_edges</code>. This provides finer
    control over the size of each bin in the input than
    simply supplying <code>x</code>(still a little experimental)</p>
<h4 id="chromatic.rainbows.actions.normalization.bintogrid--returns">Returns<a class="headerlink" href="#chromatic.rainbows.actions.normalization.bintogrid--returns" title="Permanent link">#</a></h4>
<p>result : dict
    A dictionary containing at least...
        <code>x</code> = the center of the output grid
        <code>y</code> = the resampled value on the output grid
        <code>x_edge_lower</code> = the lower edges of the output grid
        <code>x_edge_upper</code> = the upper edges of the output grid
    ...and possibly also
        <code>uncertainty</code> = the calculated uncertainty per bin</p>
<p>The order of precendence for setting the new grid is
[<code>newx_edges</code>, <code>newx</code>, <code>dx</code>, <code>nx</code>]
The first will be used, and others will be ignored.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/tools/resampling.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">bintogrid</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">unc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">newx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">newx_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">dx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">nx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">weighting</span><span class="o">=</span><span class="s2">&quot;inversevariance&quot;</span><span class="p">,</span>
    <span class="n">drop_nans</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">x_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">visualize</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Bin any x and y array onto a linearly uniform grid.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : array</span>
<span class="sd">        The original independent variable.</span>
<span class="sd">        (For a spectrum example = wavelength)</span>
<span class="sd">    y : array</span>
<span class="sd">        The original dependent variable (same size as x).</span>
<span class="sd">        (For a spectrum example = flux)</span>
<span class="sd">    unc : array, None</span>
<span class="sd">        The unceratinty on the dependent variable</span>
<span class="sd">        (For a spectrum example = the flux uncertainty)</span>
<span class="sd">    nx : array</span>
<span class="sd">        The number of bins from the original grid to</span>
<span class="sd">        bin together into the new one.</span>
<span class="sd">    dx : array</span>
<span class="sd">        The fixed spacing for creating a new, linearly uniform</span>
<span class="sd">        grid that start at the first value of x. This will</span>
<span class="sd">        be ignored if `newx` != None.</span>
<span class="sd">    newx : array</span>
<span class="sd">        A new custom grid onto which we should bin.</span>
<span class="sd">    newx_edges : array</span>
<span class="sd">        The edges of the new grid of bins for the independent</span>
<span class="sd">        variable, onto which you want to resample the y</span>
<span class="sd">        values. The left and right edges of the bins will be,</span>
<span class="sd">        respectively, `newx_edges[:-1]` and `newx_edges[1:]`,</span>
<span class="sd">        so the size of the output array will be</span>
<span class="sd">        `len(newx_edges) - 1`</span>
<span class="sd">    weighting : str</span>
<span class="sd">        How should we weight values when averaging</span>
<span class="sd">        them together into one larger bin?</span>
<span class="sd">        `weighting = &#39;inversevariance&#39;`</span>
<span class="sd">            weights = 1/unc**2</span>
<span class="sd">         `weighting = {literally anything else}`</span>
<span class="sd">            uniform weights</span>
<span class="sd">        This will have no impact if `unc == None`, or for any</span>
<span class="sd">        new bins that effectively overlap less than one original</span>
<span class="sd">        unbinned point.</span>
<span class="sd">    drop_nans : bool</span>
<span class="sd">        Should we skip any bins turn out to be nans?</span>
<span class="sd">        This most often happens when bins are empty.</span>
<span class="sd">    x_edges : array</span>
<span class="sd">        The edges of the original independent variable bins.</span>
<span class="sd">        The left and right edges of the bins are interpreted</span>
<span class="sd">        to be `x_edges[:-1]` and `x_edges[1:]`,</span>
<span class="sd">        respectively, so the associated `y` should have exactly</span>
<span class="sd">        1 fewer element than `x_edges`. This provides finer</span>
<span class="sd">        control over the size of each bin in the input than</span>
<span class="sd">        simply supplying `x`(still a little experimental)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    result : dict</span>
<span class="sd">        A dictionary containing at least...</span>
<span class="sd">            `x` = the center of the output grid</span>
<span class="sd">            `y` = the resampled value on the output grid</span>
<span class="sd">            `x_edge_lower` = the lower edges of the output grid</span>
<span class="sd">            `x_edge_upper` = the upper edges of the output grid</span>
<span class="sd">        ...and possibly also</span>
<span class="sd">            `uncertainty` = the calculated uncertainty per bin</span>


<span class="sd">    The order of precendence for setting the new grid is</span>
<span class="sd">    [`newx_edges`, `newx`, `dx`, `nx`]</span>
<span class="sd">    The first will be used, and others will be ignored.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># check that an OK set of inputs has been supplied</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">x_edges</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;🌈 Both `x` and `x_edges` were supplied to `bintogrid`. Confusing!&quot;&quot;&quot;</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">x_edges</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;🌈 At least one of `x` or `x_edges` must be supplied to `bintogrid`.&quot;&quot;&quot;</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="n">y</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;🌈 `y` must be supplied to `bintogrid`.&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="c1"># make sure the edges and the centers are set</span>
    <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">x_left</span><span class="p">,</span> <span class="n">x_right</span> <span class="o">=</span> <span class="n">edges_to_leftright</span><span class="p">(</span><span class="n">x_edges</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">left</span> <span class="o">+</span> <span class="n">right</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">x_left</span><span class="p">,</span> <span class="n">x_right</span> <span class="o">=</span> <span class="n">calculate_bin_leftright</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">x_edges</span> <span class="o">=</span> <span class="n">leftright_to_edges</span><span class="p">(</span><span class="n">x_left</span><span class="p">,</span> <span class="n">x_right</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">x_unit</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">unit</span>
        <span class="n">x_without_unit</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">value</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="n">x_unit</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">x_without_unit</span> <span class="o">=</span> <span class="n">x</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">y_unit</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">unit</span>
        <span class="n">y_without_unit</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">value</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="n">y_unit</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">y_without_unit</span> <span class="o">=</span> <span class="n">y</span>

    <span class="c1"># warn if multiple inputs are provided</span>
    <span class="n">number_of_grid_options</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span><span class="n">z</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="p">[</span><span class="n">newx_edges</span><span class="p">,</span> <span class="n">newx</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">nx</span><span class="p">]])</span>
    <span class="k">if</span> <span class="n">number_of_grid_options</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">cheerfully_suggest</span><span class="p">(</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;More than one output grid sent to `bintogrid`.</span>
<span class="sd">                         The one being used is the first to appear in</span>
<span class="sd">                         [`newx_edges`, `newx`, `dx`, `nx`]</span>
<span class="sd">                         but you might want to choose more carefully.&quot;&quot;&quot;</span>
        <span class="p">)</span>

    <span class="c1"># define inputs based on the following order</span>
    <span class="k">if</span> <span class="n">newx_edges</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># define grid by its edges (and define others from there)</span>
        <span class="n">newx_edges_without_unit</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">newx_edges</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">x_unit</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
        <span class="n">dx_without_unit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">newx_edges_without_unit</span><span class="p">)</span>
        <span class="n">newx_without_unit</span> <span class="o">=</span> <span class="n">newx_edges_without_unit</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">dx_without_unit</span>
        <span class="n">newx_left_without_unit</span> <span class="o">=</span> <span class="n">newx_edges_without_unit</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">newx_right_without_unit</span> <span class="o">=</span> <span class="n">newx_edges_without_unit</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

        <span class="c1"># make sure the final output grid is defined</span>
        <span class="n">final_newx</span><span class="p">,</span> <span class="n">final_newx_left</span><span class="p">,</span> <span class="n">final_newx_right</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">newx_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
            <span class="n">newx_left_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
            <span class="n">newx_right_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="n">newx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># define grid by its centers (and define others from there)</span>
        <span class="n">newx_without_unit</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">newx</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">x_unit</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
        <span class="n">newx_left_without_unit</span><span class="p">,</span> <span class="n">newx_right_without_unit</span> <span class="o">=</span> <span class="n">calculate_bin_leftright</span><span class="p">(</span>
            <span class="n">newx_without_unit</span>
        <span class="p">)</span>
        <span class="n">newx_edges_without_unit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span>
            <span class="p">[</span><span class="n">newx_left_without_unit</span><span class="p">,</span> <span class="n">newx_right_without_unit</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
        <span class="p">)</span>
        <span class="n">dx_without_unit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">newx_edges_without_unit</span><span class="p">)</span>

        <span class="c1"># make sure the final output grid is defined</span>
        <span class="n">final_newx</span><span class="p">,</span> <span class="n">final_newx_left</span><span class="p">,</span> <span class="n">final_newx_right</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">newx_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
            <span class="n">newx_left_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
            <span class="n">newx_right_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="n">dx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># define grid by a bin width (and define others from there)</span>
        <span class="n">dx_without_unit</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">dx</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">x_unit</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
        <span class="n">newx_without_unit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">x_without_unit</span><span class="p">),</span>
            <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">x_without_unit</span><span class="p">)</span> <span class="o">+</span> <span class="n">dx_without_unit</span><span class="p">,</span>
            <span class="n">dx_without_unit</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">newx_left_without_unit</span><span class="p">,</span> <span class="n">newx_right_without_unit</span> <span class="o">=</span> <span class="n">calculate_bin_leftright</span><span class="p">(</span>
            <span class="n">newx_without_unit</span>
        <span class="p">)</span>
        <span class="n">newx_edges_without_unit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span>
            <span class="p">[</span><span class="n">newx_left_without_unit</span><span class="p">,</span> <span class="n">newx_right_without_unit</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
        <span class="p">)</span>

        <span class="c1"># make sure the final output grid is defined</span>
        <span class="n">final_newx</span><span class="p">,</span> <span class="n">final_newx_left</span><span class="p">,</span> <span class="n">final_newx_right</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">newx_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
            <span class="n">newx_left_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
            <span class="n">newx_right_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">elif</span> <span class="n">nx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># keep track of the original input x values</span>
        <span class="n">original_x_without_unit</span> <span class="o">=</span> <span class="n">x_without_unit</span>

        <span class="c1"># redefine the input x to indices, to do interpolation in index space</span>
        <span class="n">x_without_unit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">x_without_unit</span><span class="p">))</span>

        <span class="c1"># define a grid of edges that will enclose the right number of indices</span>
        <span class="n">x_left_i</span><span class="p">,</span> <span class="n">x_right_i</span> <span class="o">=</span> <span class="n">calculate_bin_leftright</span><span class="p">(</span><span class="n">x_without_unit</span><span class="p">)</span>
        <span class="n">newx_edges_without_unit</span> <span class="o">=</span> <span class="n">leftright_to_edges</span><span class="p">(</span><span class="n">x_left_i</span><span class="p">,</span> <span class="n">x_right_i</span><span class="p">)[::</span><span class="n">nx</span><span class="p">]</span>
        <span class="n">newx_without_unit</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span>
            <span class="n">newx_edges_without_unit</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">+</span> <span class="n">newx_edges_without_unit</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="p">)</span>

        <span class="c1"># calculate the actual x values corresponding to the bins</span>
        <span class="n">original_edges</span> <span class="o">=</span> <span class="n">leftright_to_edges</span><span class="p">(</span>
            <span class="o">*</span><span class="n">calculate_bin_leftright</span><span class="p">(</span><span class="n">original_x_without_unit</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">final_edges</span> <span class="o">=</span> <span class="n">original_edges</span><span class="p">[::</span><span class="n">nx</span><span class="p">]</span> <span class="o">*</span> <span class="n">x_unit</span>
        <span class="n">final_newx_left</span><span class="p">,</span> <span class="n">final_newx_right</span> <span class="o">=</span> <span class="n">edges_to_leftright</span><span class="p">(</span><span class="n">final_edges</span><span class="p">)</span>
        <span class="n">final_newx</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">final_newx_left</span> <span class="o">+</span> <span class="n">final_newx_right</span><span class="p">)</span>
        <span class="n">dx_without_unit</span> <span class="o">=</span> <span class="p">(</span><span class="n">final_newx_right</span> <span class="o">-</span> <span class="n">final_newx_left</span><span class="p">)</span> <span class="o">/</span> <span class="n">x_unit</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;No output grid sent to `bintogrid`.</span>
<span class="sd">                              Please choose one of the following:</span>
<span class="sd">                              [`newx_edges`, `newx`, `dx`, `nx`]&quot;&quot;&quot;</span>
        <span class="p">)</span>

    <span class="c1"># don&#39;t complain about zero-divisions in here (to allow infinite uncertainties)</span>
    <span class="k">with</span> <span class="n">np</span><span class="o">.</span><span class="n">errstate</span><span class="p">(</span><span class="n">divide</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">invalid</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">):</span>

        <span class="c1"># calculate weight integrals for the bin array</span>
        <span class="n">ok</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">y_without_unit</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span>

        <span class="c1"># resample the sums onto that new grid</span>
        <span class="k">if</span> <span class="n">unc</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">x_without_unit</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">weighting</span> <span class="o">==</span> <span class="s2">&quot;inversevariance&quot;</span><span class="p">:</span>
                <span class="n">weights</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">unc</span><span class="o">**</span><span class="mi">2</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">x_without_unit</span><span class="p">)</span>

            <span class="c1"># ignore infinite weights (= 0 uncertainties)</span>
            <span class="n">ok</span> <span class="o">*=</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">ok</span><span class="p">):</span>
            <span class="n">numerator</span> <span class="o">=</span> <span class="n">resample_while_conserving_flux</span><span class="p">(</span>
                <span class="n">xin</span><span class="o">=</span><span class="n">x_without_unit</span><span class="p">[</span><span class="n">ok</span><span class="p">],</span>
                <span class="n">yin</span><span class="o">=</span><span class="p">(</span><span class="n">y_without_unit</span> <span class="o">*</span> <span class="n">weights</span><span class="p">)[</span><span class="n">ok</span><span class="p">],</span>
                <span class="n">xout_edges</span><span class="o">=</span><span class="n">newx_edges_without_unit</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">denominator</span> <span class="o">=</span> <span class="n">resample_while_conserving_flux</span><span class="p">(</span>
                <span class="n">xin</span><span class="o">=</span><span class="n">x_without_unit</span><span class="p">[</span><span class="n">ok</span><span class="p">],</span>
                <span class="n">yin</span><span class="o">=</span><span class="n">weights</span><span class="p">[</span><span class="n">ok</span><span class="p">],</span>
                <span class="n">xout_edges</span><span class="o">=</span><span class="n">newx_edges_without_unit</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="c1"># the binned weighted means on the new grid</span>
            <span class="n">newy</span> <span class="o">=</span> <span class="n">numerator</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">denominator</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span>

            <span class="c1"># the standard error on the means, for those bins</span>
            <span class="n">newunc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">denominator</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">])</span>

            <span class="c1"># keep track of the number of original bins going into each new bin</span>
            <span class="n">number_of_original_bins_per_new_bin</span> <span class="o">=</span> <span class="n">resample_while_conserving_flux</span><span class="p">(</span>
                <span class="n">xin</span><span class="o">=</span><span class="n">x_without_unit</span><span class="p">[</span><span class="n">ok</span><span class="p">],</span>
                <span class="n">yin</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">y_without_unit</span><span class="p">)[</span><span class="n">ok</span><span class="p">],</span>
                <span class="n">xout_edges</span><span class="o">=</span><span class="n">newx_edges_without_unit</span><span class="p">,</span>
            <span class="p">)[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">newy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="o">*</span> <span class="n">newx_without_unit</span>
            <span class="n">newunc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="o">*</span> <span class="n">newx_without_unit</span>
            <span class="n">number_of_original_bins_per_new_bin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">newx_without_unit</span><span class="p">)</span>

    <span class="c1"># remove any empty bins</span>
    <span class="k">if</span> <span class="n">drop_nans</span><span class="p">:</span>
        <span class="n">ok</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">newy</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ok</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">newx_without_unit</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>

    <span class="c1"># if no uncertainties were given, don&#39;t return uncertainties</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># populate the new grid centers + edges + values</span>
    <span class="n">result</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">final_newx</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span>
    <span class="n">result</span><span class="p">[</span><span class="s2">&quot;x_edge_lower&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">final_newx_left</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span>
    <span class="n">result</span><span class="p">[</span><span class="s2">&quot;x_edge_upper&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">final_newx_right</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span>

    <span class="c1"># populate the new grid values</span>
    <span class="n">result</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">newy</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span> <span class="o">*</span> <span class="n">y_unit</span>

    <span class="c1"># populate the new grid value uncertainties</span>
    <span class="k">if</span> <span class="n">unc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">result</span><span class="p">[</span><span class="s2">&quot;uncertainty&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">newunc</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span> <span class="o">*</span> <span class="n">y_unit</span>

    <span class="c1"># store how many of the original pixels made it into this new one</span>
    <span class="n">result</span><span class="p">[</span><span class="s2">&quot;N_unbinned/N_binned&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">number_of_original_bins_per_new_bin</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">visualize</span><span class="p">:</span>
        <span class="n">fi</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span>
            <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">gridspec_kw</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">height_ratios</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">])</span>
        <span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">plot_as_boxes</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">xleft</span><span class="o">=</span><span class="n">x_left</span><span class="p">,</span> <span class="n">xright</span><span class="o">=</span><span class="n">x_right</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;silver&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">ekw</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">elinewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">unc</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;silver&quot;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">ekw</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">],</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">],</span>
            <span class="n">yerr</span><span class="o">=</span><span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;uncertainty&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
            <span class="n">xerr</span><span class="o">=</span><span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s2">&quot;x_edge_upper&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;x_edge_lower&quot;</span><span class="p">])</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
            <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
            <span class="n">zorder</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
            <span class="o">**</span><span class="n">ekw</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">plot_as_boxes</span><span class="p">(</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">],</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;N_unbinned/N_binned&quot;</span><span class="p">],</span>
            <span class="n">xleft</span><span class="o">=</span><span class="n">result</span><span class="p">[</span><span class="s2">&quot;x_edge_lower&quot;</span><span class="p">],</span>
            <span class="n">xright</span><span class="o">=</span><span class="n">result</span><span class="p">[</span><span class="s2">&quot;x_edge_upper&quot;</span><span class="p">],</span>
        <span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;$N_</span><span class="si">{unbinned}</span><span class="s2">/N_</span><span class="si">{binned}</span><span class="s2">$&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.actions.normalization.calculate_bin_leftright" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">calculate_bin_leftright</span><span class="p">(</span><span class="n">x</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.actions.normalization.calculate_bin_leftright" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>If x is an array of bin centers, calculate the bin edges.
(assumes outermost bins are same size as their neighbors)</p>
<h4 id="chromatic.rainbows.actions.normalization.calculate_bin_leftright--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.actions.normalization.calculate_bin_leftright--parameters" title="Permanent link">#</a></h4>
<p>x : array
    The array of bin centers.</p>
<h4 id="chromatic.rainbows.actions.normalization.calculate_bin_leftright--returns">Returns<a class="headerlink" href="#chromatic.rainbows.actions.normalization.calculate_bin_leftright--returns" title="Permanent link">#</a></h4>
<p>l : array
    The left edges of the bins.
r : array
    The right edges of the bins.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/tools/resampling.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">calculate_bin_leftright</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    If x is an array of bin centers, calculate the bin edges.</span>
<span class="sd">    (assumes outermost bins are same size as their neighbors)</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : array</span>
<span class="sd">        The array of bin centers.</span>

<span class="sd">    Returns</span>
<span class="sd">    ----------</span>
<span class="sd">    l : array</span>
<span class="sd">        The left edges of the bins.</span>
<span class="sd">    r : array</span>
<span class="sd">        The right edges of the bins.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># what are bin edges (making a guess for those on the ends)</span>
    <span class="c1"># xbinsize = calculate_bin_widths(x)</span>
    <span class="c1"># left = x - xbinsize / 2.0</span>
    <span class="c1"># right = x + xbinsize / 2.0</span>

    <span class="c1"># weird corner case!</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">left</span><span class="p">,</span> <span class="n">right</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">left</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">right</span><span class="p">])</span>

    <span class="n">inner_edges</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="n">x</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">first_edge</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="n">inner_edges</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">last_edge</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">inner_edges</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

    <span class="n">left</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">first_edge</span><span class="p">,</span> <span class="n">inner_edges</span><span class="p">])</span>
    <span class="n">right</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">inner_edges</span><span class="p">,</span> <span class="n">last_edge</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.actions.normalization.edges_to_leftright" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">edges_to_leftright</span><span class="p">(</span><span class="n">edges</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.actions.normalization.edges_to_leftright" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Convert N+1 contiguous edges to two arrays of N left/right edges.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/tools/resampling.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">edges_to_leftright</span><span class="p">(</span><span class="n">edges</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert N+1 contiguous edges to two arrays of N left/right edges.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">left</span><span class="p">,</span> <span class="n">right</span> <span class="o">=</span> <span class="n">edges</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">edges</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="k">return</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.actions.normalization.expand_filenames" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">expand_filenames</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.actions.normalization.expand_filenames" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>A wrapper to expand a string or list into a list of filenames.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/imports.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">expand_filenames</span><span class="p">(</span><span class="n">filepath</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A wrapper to expand a string or list into a list of filenames.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
        <span class="n">filenames</span> <span class="o">=</span> <span class="n">filepath</span>
    <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span> <span class="o">==</span> <span class="n">Column</span><span class="p">:</span>
        <span class="n">filenames</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>
    <span class="k">elif</span> <span class="s2">&quot;*&quot;</span> <span class="ow">in</span> <span class="n">filepath</span><span class="p">:</span>
        <span class="n">filenames</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">filepath</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">filenames</span> <span class="o">=</span> <span class="p">[</span><span class="n">filepath</span><span class="p">]</span>
    <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">filenames</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.actions.normalization.leftright_to_edges" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">leftright_to_edges</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.actions.normalization.leftright_to_edges" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Convert two arrays of N left/right edges to N+1 continugous edges.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/tools/resampling.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">leftright_to_edges</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert two arrays of N left/right edges to N+1 continugous edges.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">edges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>
    <span class="k">return</span> <span class="n">edges</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.actions.normalization.name2color" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">name2color</span><span class="p">(</span><span class="n">name</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.actions.normalization.name2color" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Return the 3-element RGB array of a given color name.</p>
<h4 id="chromatic.rainbows.actions.normalization.name2color--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.actions.normalization.name2color--parameters" title="Permanent link">#</a></h4>
<p>name : str
    The name of a color</p>
<h4 id="chromatic.rainbows.actions.normalization.name2color--returns">Returns<a class="headerlink" href="#chromatic.rainbows.actions.normalization.name2color--returns" title="Permanent link">#</a></h4>
<p>rgb : tuple
    3-element RGB color, with numbers from 0.0 to 1.0</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/imports.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">name2color</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return the 3-element RGB array of a given color name.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    name : str</span>
<span class="sd">        The name of a color</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    rgb : tuple</span>
<span class="sd">        3-element RGB color, with numbers from 0.0 to 1.0</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># give a friendly warning if the color name can&#39;t be found</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">color_hex</span> <span class="o">=</span> <span class="n">col</span><span class="o">.</span><span class="n">cnames</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">col</span><span class="o">.</span><span class="n">hex2color</span><span class="p">(</span><span class="n">color_hex</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="n">cheerfully_suggest</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The color </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> can&#39;t be found. (Returning black.)&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.actions.normalization.normalize" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">normalize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s1">&#39;wavelength&#39;</span><span class="p">,</span> <span class="n">percentile</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.actions.normalization.normalize" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Normalize by dividing through by the median spectrum and/or lightcurve.</p>
<p>This normalizes a <code>Rainbow</code> by estimating dividing
through by a wavelength-dependent normalization. With
default inputs, this would normalize each wavelength
to have flux values near 1, to make it easier to see
differences across time (such as a transit or eclipse).
This function could also be used to divide through by
a median light curve, to make it easier to see variations
across wavelength.</p>
<h4 id="chromatic.rainbows.actions.normalization.normalize--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.actions.normalization.normalize--parameters" title="Permanent link">#</a></h4>
<p>axis : str
    The axis that should be normalized out.
    <code>w</code> or <code>wave</code> or <code>wavelength</code> will divide out the typical spectrum.
    <code>t</code> or <code>time</code> will divide out the typical light curve</p>


<details class="percentile-" open>
  <summary>float</summary>
  <p>A number between 0 and 100, specifying the percentile
of the data along an axis to use as the reference.
The default of <code>percentile=50</code> corresponds to the median.
If you want to normalize to out-of-transit, maybe you
want a higher percentile. If you want to normalize to
the baseline below a flare, maybe you want a lower
percentage.</p>
</details>        <h4 id="chromatic.rainbows.actions.normalization.normalize--returns">Returns<a class="headerlink" href="#chromatic.rainbows.actions.normalization.normalize--returns" title="Permanent link">#</a></h4>
<p>normalized : Rainbow
    The normalized Rainbow.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/rainbows/actions/normalization.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">  6</span>
<span class="normal">  7</span>
<span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">normalize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s2">&quot;wavelength&quot;</span><span class="p">,</span> <span class="n">percentile</span><span class="o">=</span><span class="mi">50</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Normalize by dividing through by the median spectrum and/or lightcurve.</span>

<span class="sd">    This normalizes a `Rainbow` by estimating dividing</span>
<span class="sd">    through by a wavelength-dependent normalization. With</span>
<span class="sd">    default inputs, this would normalize each wavelength</span>
<span class="sd">    to have flux values near 1, to make it easier to see</span>
<span class="sd">    differences across time (such as a transit or eclipse).</span>
<span class="sd">    This function could also be used to divide through by</span>
<span class="sd">    a median light curve, to make it easier to see variations</span>
<span class="sd">    across wavelength.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    axis : str</span>
<span class="sd">        The axis that should be normalized out.</span>
<span class="sd">        `w` or `wave` or `wavelength` will divide out the typical spectrum.</span>
<span class="sd">        `t` or `time` will divide out the typical light curve</span>

<span class="sd">    percentile : float</span>
<span class="sd">        A number between 0 and 100, specifying the percentile</span>
<span class="sd">        of the data along an axis to use as the reference.</span>
<span class="sd">        The default of `percentile=50` corresponds to the median.</span>
<span class="sd">        If you want to normalize to out-of-transit, maybe you</span>
<span class="sd">        want a higher percentile. If you want to normalize to</span>
<span class="sd">        the baseline below a flare, maybe you want a lower</span>
<span class="sd">        percentage.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    normalized : Rainbow</span>
<span class="sd">        The normalized Rainbow.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># create a history entry for this action (before other variables are defined)</span>
    <span class="n">h</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_history_entry</span><span class="p">(</span><span class="s2">&quot;normalize&quot;</span><span class="p">,</span> <span class="nb">locals</span><span class="p">())</span>

    <span class="c1"># create an empty copy</span>
    <span class="n">new</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_copy</span><span class="p">()</span>

    <span class="c1"># shortcut for the first letter of the axis</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">axis</span><span class="o">.</span><span class="n">lower</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># (ignore nan warnings)</span>
    <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>

        <span class="c1"># get fluxes, with not-OK replaced with nans</span>
        <span class="n">flux_for_normalizing</span> <span class="o">=</span> <span class="n">new</span><span class="o">.</span><span class="n">get_ok_data</span><span class="p">()</span>
        <span class="n">negative_normalization_message</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="n">a</span> <span class="o">==</span> <span class="s2">&quot;w&quot;</span><span class="p">:</span>
            <span class="n">normalization</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanpercentile</span><span class="p">(</span>
                <span class="n">flux_for_normalizing</span><span class="p">,</span> <span class="n">percentile</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">timeaxis</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_keys_that_respond_to_math</span><span class="p">:</span>
                <span class="n">new</span><span class="o">.</span><span class="n">fluxlike</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">new</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">/</span> <span class="n">normalization</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">new</span><span class="o">.</span><span class="n">fluxlike</span><span class="p">[</span><span class="s2">&quot;uncertainty&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">uncertainty</span> <span class="o">/</span> <span class="n">normalization</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
                <span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">pass</span>

        <span class="k">elif</span> <span class="n">a</span> <span class="o">==</span> <span class="s2">&quot;t&quot;</span><span class="p">:</span>
            <span class="n">normalization</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanpercentile</span><span class="p">(</span>
                <span class="n">flux_for_normalizing</span><span class="p">,</span> <span class="n">percentile</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">waveaxis</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_keys_that_respond_to_math</span><span class="p">:</span>
                <span class="n">new</span><span class="o">.</span><span class="n">fluxlike</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">new</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">/</span> <span class="n">normalization</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="p">:]</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">new</span><span class="o">.</span><span class="n">fluxlike</span><span class="p">[</span><span class="s2">&quot;uncertainty&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">uncertainty</span> <span class="o">/</span> <span class="n">normalization</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="p">:]</span>
                <span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">pass</span>

    <span class="k">if</span> <span class="n">a</span> <span class="ow">in</span> <span class="s2">&quot;wt&quot;</span><span class="p">:</span>
        <span class="n">thing</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;w&quot;</span><span class="p">:</span> <span class="s2">&quot;wavelengths&quot;</span><span class="p">,</span> <span class="s2">&quot;t&quot;</span><span class="p">:</span> <span class="s2">&quot;times&quot;</span><span class="p">}[</span><span class="n">a</span><span class="p">]</span>
        <span class="n">fix</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;w&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                ok = rainbow.get_median_spectrum() &gt; 0</span>
<span class="s2">                rainbow[ok, :].normalize()</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;t&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                ok = rainbow.get_median_lightcurve() &gt; 0</span>
<span class="s2">                rainbow[:, ok].normalize()</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">,</span>
        <span class="p">}[</span><span class="n">a</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">normalization</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">):</span>
            <span class="n">cheerfully_suggest</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            There are </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">normalization</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="si">}</span><span class="s2"> negative </span><span class="si">{</span><span class="n">thing</span><span class="si">}</span><span class="s2"> that</span>
<span class="s2">            are going into the normalization of this Rainbow. If you&#39;re</span>
<span class="s2">            not expecting negative fluxes, it may be useful to trim them</span>
<span class="s2">            away with something like:</span>

<span class="s2">            </span><span class="si">{</span><span class="n">fix</span><span class="si">}</span>

<span class="s2">            Otherwise, watch out that your fluxes and uncertainties may</span>
<span class="s2">            potentially have flipped sign!</span>
<span class="s2">            &quot;&quot;&quot;</span>
            <span class="p">)</span>

    <span class="c1"># append the history entry to the new Rainbow</span>
    <span class="n">new</span><span class="o">.</span><span class="n">_record_history_entry</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>

    <span class="c1"># return the new Rainbow</span>
    <span class="k">return</span> <span class="n">new</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.actions.normalization.one2another" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">one2another</span><span class="p">(</span><span class="n">bottom</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">alpha_bottom</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">alpha_top</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">256</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.actions.normalization.one2another" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Create a cmap that goes smoothly (linearly in RGBA) from "bottom" to "top".</p>
<h4 id="chromatic.rainbows.actions.normalization.one2another--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.actions.normalization.one2another--parameters" title="Permanent link">#</a></h4>
<p>bottom : str
    Name of a color for the bottom of cmap (0.0)
top : str
    Name of a color for the top of the cmap (1.0)
alpha_bottom : float
    Opacity at the bottom of the cmap
alpha_top : float
    Opacitiy at the top of the cmap
N : int
    The number of levels in the listed color map</p>
<h4 id="chromatic.rainbows.actions.normalization.one2another--returns">Returns<a class="headerlink" href="#chromatic.rainbows.actions.normalization.one2another--returns" title="Permanent link">#</a></h4>
<p>cmap : Colormap
    A color map that goes linearly from the
    bottom to top color (and alpha).</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/imports.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">one2another</span><span class="p">(</span><span class="n">bottom</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">alpha_bottom</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">alpha_top</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">256</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a cmap that goes smoothly (linearly in RGBA) from &quot;bottom&quot; to &quot;top&quot;.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    bottom : str</span>
<span class="sd">        Name of a color for the bottom of cmap (0.0)</span>
<span class="sd">    top : str</span>
<span class="sd">        Name of a color for the top of the cmap (1.0)</span>
<span class="sd">    alpha_bottom : float</span>
<span class="sd">        Opacity at the bottom of the cmap</span>
<span class="sd">    alpha_top : float</span>
<span class="sd">        Opacitiy at the top of the cmap</span>
<span class="sd">    N : int</span>
<span class="sd">        The number of levels in the listed color map</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    cmap : Colormap</span>
<span class="sd">        A color map that goes linearly from the</span>
<span class="sd">        bottom to top color (and alpha).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># get the RGB values of the bottom and top of the cmap</span>
    <span class="n">rgb_bottom</span><span class="p">,</span> <span class="n">rgb_top</span> <span class="o">=</span> <span class="n">name2color</span><span class="p">(</span><span class="n">bottom</span><span class="p">),</span> <span class="n">name2color</span><span class="p">(</span><span class="n">top</span><span class="p">)</span>

    <span class="c1"># create linear gradients for all four RGBA channels</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">rgb_bottom</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">rgb_top</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">N</span><span class="p">)</span>
    <span class="n">g</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">rgb_bottom</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">rgb_top</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">N</span><span class="p">)</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">rgb_bottom</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">rgb_top</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">N</span><span class="p">)</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">alpha_bottom</span><span class="p">,</span> <span class="n">alpha_top</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>

    <span class="c1"># create (N,4) array + populate a listed colormap</span>
    <span class="n">colors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">]))</span>
    <span class="n">cmap</span> <span class="o">=</span> <span class="n">col</span><span class="o">.</span><span class="n">ListedColormap</span><span class="p">(</span><span class="n">colors</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{bottom}</span><span class="s2">2</span><span class="si">{top}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="nb">locals</span><span class="p">()))</span>

    <span class="c1"># return the colormap</span>
    <span class="k">return</span> <span class="n">cmap</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.actions.normalization.remove_unit" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">remove_unit</span><span class="p">(</span><span class="n">x</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.actions.normalization.remove_unit" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Quick wrapper to remove the unit from a quantity,
but not complain if it doesn't have one.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/imports.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">remove_unit</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Quick wrapper to remove the unit from a quantity,</span>
<span class="sd">    but not complain if it doesn&#39;t have one.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">x</span><span class="o">.</span><span class="n">value</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">x</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.actions.normalization.resample_while_conserving_flux" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">resample_while_conserving_flux</span><span class="p">(</span><span class="n">xin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">yin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xout</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xin_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xout_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">replace_nans</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">visualize</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">pause</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.actions.normalization.resample_while_conserving_flux" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Starting from some initial x and y, resample onto a
different grid (either higher or lower resolution),
while conserving total flux.</p>
<p>When including the entire range of <code>xin</code>,
<code>sum(yout) == sum(yin)</code> should be true.</p>
<p>When including only part of the range of <code>xin</code>,
the integral between any two points should be conserved.</p>
<h4 id="chromatic.rainbows.actions.normalization.resample_while_conserving_flux--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.actions.normalization.resample_while_conserving_flux--parameters" title="Permanent link">#</a></h4>
<p>xin : array
    The original independent variable.
yin : array
    The original dependent variable (same size as x).
xout : array
    The new grid of independent variables onto which
    you want to resample the y values. Refers to the
    center of each bin (use <code>xout_edges</code> for finer
    control over the exact edges of the bins)
xin_edges : array
    The edges of the original independent variable bins.
    The left and right edges of the bins are interpreted
    to be <code>xin_edges[:-1]</code> and <code>xin_edges[1:]</code>,
    respectively, so the associated <code>yin</code> should have exactly
    1 fewer element than <code>xin_edges</code>. This provides finer
    control over the size of each bin in the input than
    simply supplying <code>xin</code>(still a little experimental)
    They should probably be sorted?
xout_edges : array
    The edges of the new grid of bins for the independent
    variable, onto which you want to resample the y
    values. The left and right edges of the bins will be,
    respectively, <code>xout_edges[:-1]</code> and <code>xout_edges[1:]</code>,
    so the size of the output array will be
    <code>len(xout_edges) - 1</code>
replace_nans : float, str
    Replace nan values with this value.
    <code>replace_nans = 0</code>
        will add no flux where nans are
    <code>replace_nans = nan</code>
        will ensure you get nans returned everywhere
        if you try to resample over any nan
    <code>replace_nans = 'interpolate'</code>
        will try to replace nans by linearly interpolating
        from nearby values (not yet implemented)
visualize : bool
    Should we make a plot showing whether it worked?
pause : bool
    Should we pause to wait for a key press?</p>
<h4 id="chromatic.rainbows.actions.normalization.resample_while_conserving_flux--returns">Returns<a class="headerlink" href="#chromatic.rainbows.actions.normalization.resample_while_conserving_flux--returns" title="Permanent link">#</a></h4>
<p>result : dict
    A dictionary containing...
        <code>x</code> = the center of the output grid
        <code>y</code> = the resampled value on the output grid
        <code>edges</code> = the edges of the output grid, which will
            have one more element than x or y</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/tools/resampling.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">resample_while_conserving_flux</span><span class="p">(</span>
    <span class="n">xin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">yin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">xout</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">xin_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">xout_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">replace_nans</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
    <span class="n">visualize</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">pause</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Starting from some initial x and y, resample onto a</span>
<span class="sd">    different grid (either higher or lower resolution),</span>
<span class="sd">    while conserving total flux.</span>

<span class="sd">    When including the entire range of `xin`,</span>
<span class="sd">    `sum(yout) == sum(yin)` should be true.</span>

<span class="sd">    When including only part of the range of `xin`,</span>
<span class="sd">    the integral between any two points should be conserved.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    xin : array</span>
<span class="sd">        The original independent variable.</span>
<span class="sd">    yin : array</span>
<span class="sd">        The original dependent variable (same size as x).</span>
<span class="sd">    xout : array</span>
<span class="sd">        The new grid of independent variables onto which</span>
<span class="sd">        you want to resample the y values. Refers to the</span>
<span class="sd">        center of each bin (use `xout_edges` for finer</span>
<span class="sd">        control over the exact edges of the bins)</span>
<span class="sd">    xin_edges : array</span>
<span class="sd">        The edges of the original independent variable bins.</span>
<span class="sd">        The left and right edges of the bins are interpreted</span>
<span class="sd">        to be `xin_edges[:-1]` and `xin_edges[1:]`,</span>
<span class="sd">        respectively, so the associated `yin` should have exactly</span>
<span class="sd">        1 fewer element than `xin_edges`. This provides finer</span>
<span class="sd">        control over the size of each bin in the input than</span>
<span class="sd">        simply supplying `xin`(still a little experimental)</span>
<span class="sd">        They should probably be sorted?</span>
<span class="sd">    xout_edges : array</span>
<span class="sd">        The edges of the new grid of bins for the independent</span>
<span class="sd">        variable, onto which you want to resample the y</span>
<span class="sd">        values. The left and right edges of the bins will be,</span>
<span class="sd">        respectively, `xout_edges[:-1]` and `xout_edges[1:]`,</span>
<span class="sd">        so the size of the output array will be</span>
<span class="sd">        `len(xout_edges) - 1`</span>
<span class="sd">    replace_nans : float, str</span>
<span class="sd">        Replace nan values with this value.</span>
<span class="sd">        `replace_nans = 0`</span>
<span class="sd">            will add no flux where nans are</span>
<span class="sd">        `replace_nans = nan`</span>
<span class="sd">            will ensure you get nans returned everywhere</span>
<span class="sd">            if you try to resample over any nan</span>
<span class="sd">        `replace_nans = &#39;interpolate&#39;`</span>
<span class="sd">            will try to replace nans by linearly interpolating</span>
<span class="sd">            from nearby values (not yet implemented)</span>
<span class="sd">    visualize : bool</span>
<span class="sd">        Should we make a plot showing whether it worked?</span>
<span class="sd">    pause : bool</span>
<span class="sd">        Should we pause to wait for a key press?</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    result : dict</span>
<span class="sd">        A dictionary containing...</span>
<span class="sd">            `x` = the center of the output grid</span>
<span class="sd">            `y` = the resampled value on the output grid</span>
<span class="sd">            `edges` = the edges of the output grid, which will</span>
<span class="sd">                have one more element than x or y</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># make sure there are some reasonable input options</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">xin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">xin_edges</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">yin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">xout</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">xout_edges</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>

    <span class="c1"># set up the bins, to calculate cumulative distribution of y</span>
    <span class="k">if</span> <span class="n">xin_edges</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># make sure the sizes match up</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">xin</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">yin</span><span class="p">)</span>
        <span class="c1"># sort to make sure x is strictly increasing</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">xin</span><span class="p">)</span>
        <span class="n">xin_sorted</span> <span class="o">=</span> <span class="n">xin</span><span class="p">[</span><span class="n">s</span><span class="p">]</span>
        <span class="n">yin_sorted</span> <span class="o">=</span> <span class="n">yin</span><span class="p">[</span><span class="n">s</span><span class="p">]</span>
        <span class="c1"># estimate some bin edges (might fail for non-uniform grids)</span>
        <span class="n">xin_left</span><span class="p">,</span> <span class="n">xin_right</span> <span class="o">=</span> <span class="n">calculate_bin_leftright</span><span class="p">(</span><span class="n">xin_sorted</span><span class="p">)</span>
        <span class="c1"># define an array of edges</span>
        <span class="n">xin_edges</span> <span class="o">=</span> <span class="n">leftright_to_edges</span><span class="p">(</span><span class="n">xin_left</span><span class="p">,</span> <span class="n">xin_right</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># make sure the sizes match up</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">xin_edges</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">yin</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="c1"># sort to make sure x is strictly increasing</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">xin_edges</span><span class="p">)</span>
        <span class="n">xin_left</span><span class="p">,</span> <span class="n">xin_right</span> <span class="o">=</span> <span class="n">edges_to_leftright</span><span class="p">(</span><span class="n">xin_edges</span><span class="p">[</span><span class="n">s</span><span class="p">])</span>
        <span class="n">xin_sorted</span> <span class="o">=</span> <span class="p">(</span><span class="n">xin_left</span> <span class="o">+</span> <span class="n">xin_right</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">yin_sorted</span> <span class="o">=</span> <span class="n">yin</span><span class="p">[</span><span class="n">s</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>

    <span class="c1"># the first element should be the left edge of the first pixel</span>
    <span class="c1"># last element will be right edge of last pixel</span>
    <span class="n">xin_for_cdf</span> <span class="o">=</span> <span class="n">xin_edges</span>

    <span class="c1"># to the left of the first pixel, assume flux is zero</span>
    <span class="n">yin_for_cdf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">yin_sorted</span><span class="p">])</span>

    <span class="c1"># correct for any non-finite values</span>
    <span class="n">bad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">yin_for_cdf</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">replace_nans</span> <span class="o">==</span> <span class="s2">&quot;interpolate&quot;</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
            <span class="s2">&quot;The `replace_nans=&#39;interpolate&#39;`` option doens&#39;t exist yet!&quot;</span>
        <span class="p">)</span>
    <span class="n">yin_for_cdf</span><span class="p">[</span><span class="n">bad</span><span class="p">]</span> <span class="o">=</span> <span class="n">replace_nans</span>

    <span class="c1"># calculate the CDF of the flux (at pixel edge locations)</span>
    <span class="n">cdfin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">yin_for_cdf</span><span class="p">)</span>

    <span class="c1"># create an interpolator for that CDF</span>
    <span class="n">cdfinterpolator</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span>
        <span class="n">xin_for_cdf</span><span class="p">,</span>
        <span class="n">cdfin</span><span class="p">,</span>
        <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span>
        <span class="n">bounds_error</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">fill_value</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">yin</span><span class="p">)),</span>
    <span class="p">)</span>

    <span class="c1"># calculate bin edges (of size len(xout)+1)</span>
    <span class="k">if</span> <span class="n">xout_edges</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">xout_left</span><span class="p">,</span> <span class="n">xout_right</span> <span class="o">=</span> <span class="n">calculate_bin_leftright</span><span class="p">(</span><span class="n">xout</span><span class="p">)</span>
        <span class="n">xout_edges</span> <span class="o">=</span> <span class="n">leftright_to_edges</span><span class="p">(</span><span class="n">xout_left</span><span class="p">,</span> <span class="n">xout_right</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">xout_left</span><span class="p">,</span> <span class="n">xout_right</span> <span class="o">=</span> <span class="n">edges_to_leftright</span><span class="p">(</span><span class="n">xout_edges</span><span class="p">)</span>
        <span class="n">xout</span> <span class="o">=</span> <span class="p">(</span><span class="n">xout_left</span> <span class="o">+</span> <span class="n">xout_right</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>

    <span class="n">xout_for_cdf</span> <span class="o">=</span> <span class="n">leftright_to_edges</span><span class="p">(</span><span class="n">xout_left</span><span class="p">,</span> <span class="n">xout_right</span><span class="p">)</span>

    <span class="c1"># interpolate the CDF onto those bin edges</span>
    <span class="n">cdfout</span> <span class="o">=</span> <span class="n">cdfinterpolator</span><span class="p">(</span><span class="n">xout_for_cdf</span><span class="p">)</span>

    <span class="c1"># take  derivative of the CDF to get flux per resampled bin</span>
    <span class="c1"># (xout is bin center, and yout is the flux in that bin)</span>
    <span class="n">yout</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">cdfout</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">visualize</span><span class="p">:</span>
        <span class="n">fi</span><span class="p">,</span> <span class="p">(</span><span class="n">ax_cdf</span><span class="p">,</span> <span class="n">ax_pdf</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
        <span class="n">inkw</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
            <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span>
            <span class="n">markeredgecolor</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">outkw</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;darkorange&quot;</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span>
            <span class="n">markersize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
            <span class="n">markeredgecolor</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">legkw</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper left&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">xinbinsize</span> <span class="o">=</span> <span class="n">xin_right</span> <span class="o">-</span> <span class="n">xin_left</span>
        <span class="n">xoutbinsize</span> <span class="o">=</span> <span class="n">xout_right</span> <span class="o">-</span> <span class="n">xout_left</span>
        <span class="c1"># plot the PDFs</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="n">ax_pdf</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Flux per (Original) Pixel&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Pixel&quot;</span><span class="p">)</span>
        <span class="c1"># plot the original pixels (in df/dpixel to compare with resampled)</span>
        <span class="n">plot_as_boxes</span><span class="p">(</span>
            <span class="n">xin_sorted</span><span class="p">,</span> <span class="n">yin_sorted</span> <span class="o">/</span> <span class="n">xinbinsize</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Original Pixels&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">inkw</span>
        <span class="p">)</span>

        <span class="c1"># what would a bad interpolation look like?</span>
        <span class="n">interpolate_badly</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span>
            <span class="n">xin_sorted</span><span class="p">,</span>
            <span class="n">yin_sorted</span> <span class="o">/</span> <span class="n">xinbinsize</span><span class="p">,</span>
            <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span>
            <span class="n">bounds_error</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">fill_value</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
            <span class="n">xout</span><span class="p">,</span>
            <span class="n">interpolate_badly</span><span class="p">(</span><span class="n">xout</span><span class="p">),</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;cornflowerblue&quot;</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span>
            <span class="n">markersize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
            <span class="n">markeredgecolor</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Silly Simple Interpolation&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># plot the flux-conserving resampled data (again, in df/d&quot;pixel&quot;)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
            <span class="n">xout</span><span class="p">,</span> <span class="n">yout</span> <span class="o">/</span> <span class="n">xoutbinsize</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Flux-Conserving Interpolation&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">outkw</span>
        <span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="o">**</span><span class="n">legkw</span><span class="p">)</span>

        <span class="c1"># plot the CDFs</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="n">ax_cdf</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Cumulative Flux (from left)&quot;</span><span class="p">)</span>

        <span class="c1"># plot the original CDF</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xin_for_cdf</span><span class="p">,</span> <span class="n">cdfin</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Original Pixels&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">inkw</span><span class="p">)</span>

        <span class="c1"># plot the interpolated CDF</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xout_for_cdf</span><span class="p">,</span> <span class="n">cdfout</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Flux-Conserved Resample&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">outkw</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">pause</span><span class="p">:</span>
            <span class="n">a</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span>
                <span class="s2">&quot;Pausing a moment to check on interpolation; press return to continue.&quot;</span>
            <span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{:&gt;6}</span><span class="s2"> = </span><span class="si">{:.5f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;Actual&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">yin</span><span class="p">)))</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="s2">&quot;</span><span class="si">{:&gt;6}</span><span class="s2"> = </span><span class="si">{:.5f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="s2">&quot;Silly&quot;</span><span class="p">,</span>
                <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">interpolate_badly</span><span class="p">(</span><span class="n">xout</span><span class="p">)</span> <span class="o">*</span> <span class="n">xoutbinsize</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{:&gt;6}</span><span class="s2"> = </span><span class="si">{:.5f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;CDF&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">yout</span><span class="p">)))</span>

    <span class="c1"># return the resampled y-values</span>
    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="n">xout</span><span class="p">,</span> <span class="s2">&quot;x_edge_lower&quot;</span><span class="p">:</span> <span class="n">xout_left</span><span class="p">,</span> <span class="s2">&quot;x_edge_upper&quot;</span><span class="p">:</span> <span class="n">xout_right</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="n">yout</span><span class="p">}</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="chromatic.rainbows.actions.operations"></a>
    <div class="doc doc-contents first">









  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.actions.operations.__add__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.actions.operations.__add__" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Add the flux of a rainbow and an input array (or another rainbow)
and output in a new rainbow other.</p>
<h4 id="chromatic.rainbows.actions.operations.__add__--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.actions.operations.__add__--parameters" title="Permanent link">#</a></h4>
<p>other : Array or float.
    Multiple options:
    1) float
    2) 1D array with same length as wavelength axis
    3) 1D array with same length as time axis
    4) 2D array with same shape as rainbow flux
    5) Rainbow other with same dimensions as self.</p>
<h4 id="chromatic.rainbows.actions.operations.__add__--returns">Returns<a class="headerlink" href="#chromatic.rainbows.actions.operations.__add__--returns" title="Permanent link">#</a></h4>
<p>rainbow : Rainbow
    A new <code>Rainbow</code> with the mathematical operation applied.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/rainbows/actions/operations.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Add the flux of a rainbow and an input array (or another rainbow)</span>
<span class="sd">    and output in a new rainbow other.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    other : Array or float.</span>
<span class="sd">        Multiple options:</span>
<span class="sd">        1) float</span>
<span class="sd">        2) 1D array with same length as wavelength axis</span>
<span class="sd">        3) 1D array with same length as time axis</span>
<span class="sd">        4) 2D array with same shape as rainbow flux</span>
<span class="sd">        5) Rainbow other with same dimensions as self.</span>

<span class="sd">    Returns</span>
<span class="sd">    ----------</span>
<span class="sd">    rainbow : Rainbow</span>
<span class="sd">        A new `Rainbow` with the mathematical operation applied.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># create the history entry</span>
    <span class="n">h</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_history_entry</span><span class="p">(</span><span class="s2">&quot;+&quot;</span><span class="p">,</span> <span class="nb">locals</span><span class="p">())</span>

    <span class="c1"># calculate a new Rainbow using the operation and error propagation</span>
    <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_apply_operation</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">operation</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">add</span><span class="p">,</span> <span class="n">dzdx</span><span class="o">=</span><span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="n">dzdy</span><span class="o">=</span><span class="s2">&quot;1&quot;</span><span class="p">)</span>

    <span class="c1"># append the history entry to the new Rainbow</span>
    <span class="n">result</span><span class="o">.</span><span class="n">_record_history_entry</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.actions.operations.__eq__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.actions.operations.__eq__" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Test whether <code>self == other</code>.</p>
<p>This compares the wavelike, timelike, and fluxlike arrays
for exact matches. It skips entirely over the metadata.</p>
<h4 id="chromatic.rainbows.actions.operations.__eq__--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.actions.operations.__eq__--parameters" title="Permanent link">#</a></h4>
<p>other : Rainbow
    Another <code>Rainbow</code> to compare to.</p>
<h4 id="chromatic.rainbows.actions.operations.__eq__--returns">Returns<a class="headerlink" href="#chromatic.rainbows.actions.operations.__eq__--returns" title="Permanent link">#</a></h4>
<p>equal : bool
    Are they (effectively) equivalent?</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/rainbows/actions/operations.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Test whether `self == other`.</span>

<span class="sd">    This compares the wavelike, timelike, and fluxlike arrays</span>
<span class="sd">    for exact matches. It skips entirely over the metadata.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    other : Rainbow</span>
<span class="sd">        Another `Rainbow` to compare to.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    equal : bool</span>
<span class="sd">        Are they (effectively) equivalent?</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># start by assuming the Rainbows are identical</span>
    <span class="n">same</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">([</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">],</span> <span class="p">[</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="p">]):</span>

        <span class="c1"># loop through the core dictionaries</span>
        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">a</span><span class="o">.</span><span class="n">_core_dictionaries</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">d</span> <span class="o">==</span> <span class="s2">&quot;metadata&quot;</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="c1"># pull out each core dictionary from both</span>
            <span class="n">d1</span><span class="p">,</span> <span class="n">d2</span> <span class="o">=</span> <span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="p">)[</span><span class="n">d</span><span class="p">],</span> <span class="nb">vars</span><span class="p">(</span><span class="n">b</span><span class="p">)[</span><span class="n">d</span><span class="p">]</span>
            <span class="n">same</span> <span class="o">*=</span> <span class="nb">set</span><span class="p">(</span><span class="n">d1</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">==</span> <span class="nb">set</span><span class="p">(</span><span class="n">d2</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

            <span class="c1"># loop through elements of each dictionary</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">d1</span><span class="p">:</span>

                <span class="c1"># ignore different histories (e.g. new vs loaded)</span>
                <span class="k">if</span> <span class="n">k</span> <span class="o">!=</span> <span class="s2">&quot;history&quot;</span><span class="p">:</span>

                    <span class="c1"># test that all elements match for both</span>
                    <span class="k">if</span> <span class="n">d</span> <span class="o">==</span> <span class="s2">&quot;fluxlike&quot;</span><span class="p">:</span>
                        <span class="n">same</span> <span class="o">*=</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span>
                            <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span>
                                <span class="n">a</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">)[</span><span class="n">a</span><span class="o">.</span><span class="n">ok</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">)],</span> <span class="n">b</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">)[</span><span class="n">a</span><span class="o">.</span><span class="n">ok</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">)]</span>
                            <span class="p">)</span>
                        <span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">same</span> <span class="o">*=</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="n">b</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">)))</span>

    <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="n">same</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.actions.operations.__mul__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.actions.operations.__mul__" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Multiply the flux of a rainbow and an input array (or another rainbow)
and output in a new rainbow other.</p>
<h4 id="chromatic.rainbows.actions.operations.__mul__--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.actions.operations.__mul__--parameters" title="Permanent link">#</a></h4>
<p>other : Array or float.
    Multiple options:
    1) float
    2) 1D array with same length as wavelength axis
    3) 1D array with same length as time axis
    4) 2D array with same shape as rainbow flux
    5) Rainbow other with same dimensions as self.</p>
<h4 id="chromatic.rainbows.actions.operations.__mul__--returns">Returns<a class="headerlink" href="#chromatic.rainbows.actions.operations.__mul__--returns" title="Permanent link">#</a></h4>
<p>rainbow : Rainbow
    A new <code>Rainbow</code> with the mathematical operation applied.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/rainbows/actions/operations.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Multiply the flux of a rainbow and an input array (or another rainbow)</span>
<span class="sd">    and output in a new rainbow other.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    other : Array or float.</span>
<span class="sd">        Multiple options:</span>
<span class="sd">        1) float</span>
<span class="sd">        2) 1D array with same length as wavelength axis</span>
<span class="sd">        3) 1D array with same length as time axis</span>
<span class="sd">        4) 2D array with same shape as rainbow flux</span>
<span class="sd">        5) Rainbow other with same dimensions as self.</span>

<span class="sd">    Returns</span>
<span class="sd">    ----------</span>
<span class="sd">    rainbow : Rainbow</span>
<span class="sd">        A new `Rainbow` with the mathematical operation applied.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># create the history entry</span>
    <span class="n">h</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_history_entry</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="nb">locals</span><span class="p">())</span>

    <span class="c1"># calculate a new Rainbow using the operation and error propagation</span>
    <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_apply_operation</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">operation</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">,</span> <span class="n">dzdx</span><span class="o">=</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">dzdy</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">)</span>

    <span class="c1"># append the history entry to the new Rainbow</span>
    <span class="n">result</span><span class="o">.</span><span class="n">_record_history_entry</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.actions.operations.__sub__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.actions.operations.__sub__" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Subtract the flux of a rainbow from an input array (or another rainbow)
and output in a new rainbow other.</p>
<h4 id="chromatic.rainbows.actions.operations.__sub__--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.actions.operations.__sub__--parameters" title="Permanent link">#</a></h4>
<p>other : Array or float.
    Multiple options:
    1) float
    2) 1D array with same length as wavelength axis
    3) 1D array with same length as time axis
    4) 2D array with same shape as rainbow flux
    5) Rainbow other with same dimensions as self.</p>
<h4 id="chromatic.rainbows.actions.operations.__sub__--returns">Returns<a class="headerlink" href="#chromatic.rainbows.actions.operations.__sub__--returns" title="Permanent link">#</a></h4>
<p>rainbow : Rainbow
    A new <code>Rainbow</code> with the mathematical operation applied.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/rainbows/actions/operations.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Subtract the flux of a rainbow from an input array (or another rainbow)</span>
<span class="sd">    and output in a new rainbow other.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    other : Array or float.</span>
<span class="sd">        Multiple options:</span>
<span class="sd">        1) float</span>
<span class="sd">        2) 1D array with same length as wavelength axis</span>
<span class="sd">        3) 1D array with same length as time axis</span>
<span class="sd">        4) 2D array with same shape as rainbow flux</span>
<span class="sd">        5) Rainbow other with same dimensions as self.</span>

<span class="sd">    Returns</span>
<span class="sd">    ----------</span>
<span class="sd">    rainbow : Rainbow</span>
<span class="sd">        A new `Rainbow` with the mathematical operation applied.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># create the history entry</span>
    <span class="n">h</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_history_entry</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="nb">locals</span><span class="p">())</span>

    <span class="c1"># calculate a new Rainbow using the operation and error propagation</span>
    <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_apply_operation</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">operation</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">subtract</span><span class="p">,</span> <span class="n">dzdx</span><span class="o">=</span><span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="n">dzdy</span><span class="o">=</span><span class="s2">&quot;1&quot;</span><span class="p">)</span>

    <span class="c1"># append the history entry to the new Rainbow</span>
    <span class="n">result</span><span class="o">.</span><span class="n">_record_history_entry</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.actions.operations.__truediv__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__truediv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.actions.operations.__truediv__" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Divide the flux of a rainbow and an input array (or another rainbow)
and output in a new rainbow other.</p>
<h4 id="chromatic.rainbows.actions.operations.__truediv__--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.actions.operations.__truediv__--parameters" title="Permanent link">#</a></h4>
<p>other : Array or float.
    Multiple options:
    1) float
    2) 1D array with same length as wavelength axis
    3) 1D array with same length as time axis
    4) 2D array with same shape as rainbow flux
    5) Rainbow other with same dimensions as self.</p>
<h4 id="chromatic.rainbows.actions.operations.__truediv__--returns">Returns<a class="headerlink" href="#chromatic.rainbows.actions.operations.__truediv__--returns" title="Permanent link">#</a></h4>
<p>rainbow : Rainbow
    A new <code>Rainbow</code> with the mathematical operation applied.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/rainbows/actions/operations.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__truediv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Divide the flux of a rainbow and an input array (or another rainbow)</span>
<span class="sd">    and output in a new rainbow other.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    other : Array or float.</span>
<span class="sd">        Multiple options:</span>
<span class="sd">        1) float</span>
<span class="sd">        2) 1D array with same length as wavelength axis</span>
<span class="sd">        3) 1D array with same length as time axis</span>
<span class="sd">        4) 2D array with same shape as rainbow flux</span>
<span class="sd">        5) Rainbow other with same dimensions as self.</span>

<span class="sd">    Returns</span>
<span class="sd">    ----------</span>
<span class="sd">    rainbow : Rainbow</span>
<span class="sd">        A new `Rainbow` with the mathematical operation applied.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># create the history entry</span>
    <span class="n">h</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_history_entry</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="nb">locals</span><span class="p">())</span>

    <span class="c1"># calculate a new Rainbow using the operation and error propagation</span>
    <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_apply_operation</span><span class="p">(</span>
        <span class="n">other</span><span class="p">,</span> <span class="n">operation</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">true_divide</span><span class="p">,</span> <span class="n">dzdx</span><span class="o">=</span><span class="s2">&quot;1/y&quot;</span><span class="p">,</span> <span class="n">dzdy</span><span class="o">=</span><span class="s2">&quot;-x/y**2&quot;</span>
    <span class="p">)</span>

    <span class="c1"># append the history entry to the new Rainbow</span>
    <span class="n">result</span><span class="o">.</span><span class="n">_record_history_entry</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.actions.operations.bintoR" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">bintoR</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">unc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">R</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">weighting</span><span class="o">=</span><span class="s1">&#39;inversevariance&#39;</span><span class="p">,</span> <span class="n">drop_nans</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.actions.operations.bintoR" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Bin any x and y array onto a logarithmicly uniform grid.</p>
<h4 id="chromatic.rainbows.actions.operations.bintoR--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.actions.operations.bintoR--parameters" title="Permanent link">#</a></h4>
<p>x : array
    The original independent variable.
    (For a spectrum example = wavelength)
y : array
    The original dependent variable (same size as x).
    (For a spectrum example = flux)
unc : array, None, optional
    The unceratinty on the dependent variable
    (For a spectrum example = the flux uncertainty)
R : array, optional
    The spectral resolution R=x/dx for creating a new,
    logarithmically uniform grid that starts at the first
    value of x.
xlim : list, array, optional
    A two-element list indicating the min and max values of
    x for the new logarithmically spaced grid. If None,
    these limits will be created from the data themselves
weighting : str, optional
    How should we weight values when averaging
    them together into one larger bin?
    <code>weighting = 'inversevariance'</code>
        weights = 1/unc**2
     <code>weighting = {literally anything else}</code>
        uniform weights
    This will have no impact if <code>unc == None</code>, or for any
    new bins that effectively overlap less than one original
    unbinned point.
drop_nans : bool, optional
    Should we skip any bins turn out to be nans?
    This most often happens when bins are empty.</p>
<h4 id="chromatic.rainbows.actions.operations.bintoR--returns">Returns<a class="headerlink" href="#chromatic.rainbows.actions.operations.bintoR--returns" title="Permanent link">#</a></h4>
<p>result : dict
    A dictionary containing at least...
        <code>x</code> = the center of the output grid
        <code>y</code> = the resampled value on the output grid
        <code>x_edge_lower</code> = the lower edges of the output grid
        <code>x_edge_upper</code> = the upper edges of the output grid
    ...and possibly also
        <code>uncertainty</code> = the calculated uncertainty per bin</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/tools/resampling.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">bintoR</span><span class="p">(</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">unc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">R</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">weighting</span><span class="o">=</span><span class="s2">&quot;inversevariance&quot;</span><span class="p">,</span> <span class="n">drop_nans</span><span class="o">=</span><span class="kc">True</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Bin any x and y array onto a logarithmicly uniform grid.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : array</span>
<span class="sd">        The original independent variable.</span>
<span class="sd">        (For a spectrum example = wavelength)</span>
<span class="sd">    y : array</span>
<span class="sd">        The original dependent variable (same size as x).</span>
<span class="sd">        (For a spectrum example = flux)</span>
<span class="sd">    unc : array, None, optional</span>
<span class="sd">        The unceratinty on the dependent variable</span>
<span class="sd">        (For a spectrum example = the flux uncertainty)</span>
<span class="sd">    R : array, optional</span>
<span class="sd">        The spectral resolution R=x/dx for creating a new,</span>
<span class="sd">        logarithmically uniform grid that starts at the first</span>
<span class="sd">        value of x.</span>
<span class="sd">    xlim : list, array, optional</span>
<span class="sd">        A two-element list indicating the min and max values of</span>
<span class="sd">        x for the new logarithmically spaced grid. If None,</span>
<span class="sd">        these limits will be created from the data themselves</span>
<span class="sd">    weighting : str, optional</span>
<span class="sd">        How should we weight values when averaging</span>
<span class="sd">        them together into one larger bin?</span>
<span class="sd">        `weighting = &#39;inversevariance&#39;`</span>
<span class="sd">            weights = 1/unc**2</span>
<span class="sd">         `weighting = {literally anything else}`</span>
<span class="sd">            uniform weights</span>
<span class="sd">        This will have no impact if `unc == None`, or for any</span>
<span class="sd">        new bins that effectively overlap less than one original</span>
<span class="sd">        unbinned point.</span>
<span class="sd">    drop_nans : bool, optional</span>
<span class="sd">        Should we skip any bins turn out to be nans?</span>
<span class="sd">        This most often happens when bins are empty.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    result : dict</span>
<span class="sd">        A dictionary containing at least...</span>
<span class="sd">            `x` = the center of the output grid</span>
<span class="sd">            `y` = the resampled value on the output grid</span>
<span class="sd">            `x_edge_lower` = the lower edges of the output grid</span>
<span class="sd">            `x_edge_upper` = the upper edges of the output grid</span>
<span class="sd">        ...and possibly also</span>
<span class="sd">            `uncertainty` = the calculated uncertainty per bin</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">x_unit</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">unit</span>
        <span class="n">x_without_unit</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">value</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="n">x_unit</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">x_without_unit</span> <span class="o">=</span> <span class="n">x</span>

    <span class="c1"># create a new grid of x at the given resolution</span>
    <span class="n">lnx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">x_without_unit</span><span class="p">)</span>
    <span class="n">dnewlnx</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">R</span>

    <span class="c1"># set the limits of the new xgrid (in log space)</span>
    <span class="k">if</span> <span class="n">xlim</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># use the input grid to set the limits</span>
        <span class="n">lnxbottom</span><span class="p">,</span> <span class="n">lnxtop</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">lnx</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">lnx</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># use the custom xlim to set the limits</span>
        <span class="n">lnxbottom</span><span class="p">,</span> <span class="n">lnxtop</span> <span class="o">=</span> <span class="n">xlim</span>

    <span class="c1"># create a new, log-uniform grid of x values</span>
    <span class="n">newlnx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">lnxbottom</span><span class="p">,</span> <span class="n">lnxtop</span> <span class="o">+</span> <span class="n">dnewlnx</span><span class="p">,</span> <span class="n">dnewlnx</span><span class="p">)</span>

    <span class="c1"># now do the binning on a uniform grid of lnx</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">bintogrid</span><span class="p">(</span>
        <span class="n">lnx</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">unc</span><span class="p">,</span> <span class="n">newx</span><span class="o">=</span><span class="n">newlnx</span><span class="p">,</span> <span class="n">weighting</span><span class="o">=</span><span class="n">weighting</span><span class="p">,</span> <span class="n">drop_nans</span><span class="o">=</span><span class="n">drop_nans</span>
    <span class="p">)</span>

    <span class="c1"># convert back from log to real values</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;x_edge_lower&quot;</span><span class="p">,</span> <span class="s2">&quot;x_edge_upper&quot;</span><span class="p">]:</span>
        <span class="n">result</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="o">*</span> <span class="n">x_unit</span>

    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.actions.operations.bintogrid" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">bintogrid</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">unc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">newx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">newx_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">nx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">weighting</span><span class="o">=</span><span class="s1">&#39;inversevariance&#39;</span><span class="p">,</span> <span class="n">drop_nans</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">x_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">visualize</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.actions.operations.bintogrid" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Bin any x and y array onto a linearly uniform grid.</p>
<h4 id="chromatic.rainbows.actions.operations.bintogrid--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.actions.operations.bintogrid--parameters" title="Permanent link">#</a></h4>
<p>x : array
    The original independent variable.
    (For a spectrum example = wavelength)
y : array
    The original dependent variable (same size as x).
    (For a spectrum example = flux)
unc : array, None
    The unceratinty on the dependent variable
    (For a spectrum example = the flux uncertainty)
nx : array
    The number of bins from the original grid to
    bin together into the new one.
dx : array
    The fixed spacing for creating a new, linearly uniform
    grid that start at the first value of x. This will
    be ignored if <code>newx</code> != None.
newx : array
    A new custom grid onto which we should bin.
newx_edges : array
    The edges of the new grid of bins for the independent
    variable, onto which you want to resample the y
    values. The left and right edges of the bins will be,
    respectively, <code>newx_edges[:-1]</code> and <code>newx_edges[1:]</code>,
    so the size of the output array will be
    <code>len(newx_edges) - 1</code>
weighting : str
    How should we weight values when averaging
    them together into one larger bin?
    <code>weighting = 'inversevariance'</code>
        weights = 1/unc**2
     <code>weighting = {literally anything else}</code>
        uniform weights
    This will have no impact if <code>unc == None</code>, or for any
    new bins that effectively overlap less than one original
    unbinned point.
drop_nans : bool
    Should we skip any bins turn out to be nans?
    This most often happens when bins are empty.
x_edges : array
    The edges of the original independent variable bins.
    The left and right edges of the bins are interpreted
    to be <code>x_edges[:-1]</code> and <code>x_edges[1:]</code>,
    respectively, so the associated <code>y</code> should have exactly
    1 fewer element than <code>x_edges</code>. This provides finer
    control over the size of each bin in the input than
    simply supplying <code>x</code>(still a little experimental)</p>
<h4 id="chromatic.rainbows.actions.operations.bintogrid--returns">Returns<a class="headerlink" href="#chromatic.rainbows.actions.operations.bintogrid--returns" title="Permanent link">#</a></h4>
<p>result : dict
    A dictionary containing at least...
        <code>x</code> = the center of the output grid
        <code>y</code> = the resampled value on the output grid
        <code>x_edge_lower</code> = the lower edges of the output grid
        <code>x_edge_upper</code> = the upper edges of the output grid
    ...and possibly also
        <code>uncertainty</code> = the calculated uncertainty per bin</p>
<p>The order of precendence for setting the new grid is
[<code>newx_edges</code>, <code>newx</code>, <code>dx</code>, <code>nx</code>]
The first will be used, and others will be ignored.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/tools/resampling.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">bintogrid</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">unc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">newx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">newx_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">dx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">nx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">weighting</span><span class="o">=</span><span class="s2">&quot;inversevariance&quot;</span><span class="p">,</span>
    <span class="n">drop_nans</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">x_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">visualize</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Bin any x and y array onto a linearly uniform grid.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : array</span>
<span class="sd">        The original independent variable.</span>
<span class="sd">        (For a spectrum example = wavelength)</span>
<span class="sd">    y : array</span>
<span class="sd">        The original dependent variable (same size as x).</span>
<span class="sd">        (For a spectrum example = flux)</span>
<span class="sd">    unc : array, None</span>
<span class="sd">        The unceratinty on the dependent variable</span>
<span class="sd">        (For a spectrum example = the flux uncertainty)</span>
<span class="sd">    nx : array</span>
<span class="sd">        The number of bins from the original grid to</span>
<span class="sd">        bin together into the new one.</span>
<span class="sd">    dx : array</span>
<span class="sd">        The fixed spacing for creating a new, linearly uniform</span>
<span class="sd">        grid that start at the first value of x. This will</span>
<span class="sd">        be ignored if `newx` != None.</span>
<span class="sd">    newx : array</span>
<span class="sd">        A new custom grid onto which we should bin.</span>
<span class="sd">    newx_edges : array</span>
<span class="sd">        The edges of the new grid of bins for the independent</span>
<span class="sd">        variable, onto which you want to resample the y</span>
<span class="sd">        values. The left and right edges of the bins will be,</span>
<span class="sd">        respectively, `newx_edges[:-1]` and `newx_edges[1:]`,</span>
<span class="sd">        so the size of the output array will be</span>
<span class="sd">        `len(newx_edges) - 1`</span>
<span class="sd">    weighting : str</span>
<span class="sd">        How should we weight values when averaging</span>
<span class="sd">        them together into one larger bin?</span>
<span class="sd">        `weighting = &#39;inversevariance&#39;`</span>
<span class="sd">            weights = 1/unc**2</span>
<span class="sd">         `weighting = {literally anything else}`</span>
<span class="sd">            uniform weights</span>
<span class="sd">        This will have no impact if `unc == None`, or for any</span>
<span class="sd">        new bins that effectively overlap less than one original</span>
<span class="sd">        unbinned point.</span>
<span class="sd">    drop_nans : bool</span>
<span class="sd">        Should we skip any bins turn out to be nans?</span>
<span class="sd">        This most often happens when bins are empty.</span>
<span class="sd">    x_edges : array</span>
<span class="sd">        The edges of the original independent variable bins.</span>
<span class="sd">        The left and right edges of the bins are interpreted</span>
<span class="sd">        to be `x_edges[:-1]` and `x_edges[1:]`,</span>
<span class="sd">        respectively, so the associated `y` should have exactly</span>
<span class="sd">        1 fewer element than `x_edges`. This provides finer</span>
<span class="sd">        control over the size of each bin in the input than</span>
<span class="sd">        simply supplying `x`(still a little experimental)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    result : dict</span>
<span class="sd">        A dictionary containing at least...</span>
<span class="sd">            `x` = the center of the output grid</span>
<span class="sd">            `y` = the resampled value on the output grid</span>
<span class="sd">            `x_edge_lower` = the lower edges of the output grid</span>
<span class="sd">            `x_edge_upper` = the upper edges of the output grid</span>
<span class="sd">        ...and possibly also</span>
<span class="sd">            `uncertainty` = the calculated uncertainty per bin</span>


<span class="sd">    The order of precendence for setting the new grid is</span>
<span class="sd">    [`newx_edges`, `newx`, `dx`, `nx`]</span>
<span class="sd">    The first will be used, and others will be ignored.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># check that an OK set of inputs has been supplied</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">x_edges</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;🌈 Both `x` and `x_edges` were supplied to `bintogrid`. Confusing!&quot;&quot;&quot;</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">x_edges</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;🌈 At least one of `x` or `x_edges` must be supplied to `bintogrid`.&quot;&quot;&quot;</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="n">y</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;🌈 `y` must be supplied to `bintogrid`.&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="c1"># make sure the edges and the centers are set</span>
    <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">x_left</span><span class="p">,</span> <span class="n">x_right</span> <span class="o">=</span> <span class="n">edges_to_leftright</span><span class="p">(</span><span class="n">x_edges</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">left</span> <span class="o">+</span> <span class="n">right</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">x_left</span><span class="p">,</span> <span class="n">x_right</span> <span class="o">=</span> <span class="n">calculate_bin_leftright</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">x_edges</span> <span class="o">=</span> <span class="n">leftright_to_edges</span><span class="p">(</span><span class="n">x_left</span><span class="p">,</span> <span class="n">x_right</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">x_unit</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">unit</span>
        <span class="n">x_without_unit</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">value</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="n">x_unit</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">x_without_unit</span> <span class="o">=</span> <span class="n">x</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">y_unit</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">unit</span>
        <span class="n">y_without_unit</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">value</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="n">y_unit</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">y_without_unit</span> <span class="o">=</span> <span class="n">y</span>

    <span class="c1"># warn if multiple inputs are provided</span>
    <span class="n">number_of_grid_options</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span><span class="n">z</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="p">[</span><span class="n">newx_edges</span><span class="p">,</span> <span class="n">newx</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">nx</span><span class="p">]])</span>
    <span class="k">if</span> <span class="n">number_of_grid_options</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">cheerfully_suggest</span><span class="p">(</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;More than one output grid sent to `bintogrid`.</span>
<span class="sd">                         The one being used is the first to appear in</span>
<span class="sd">                         [`newx_edges`, `newx`, `dx`, `nx`]</span>
<span class="sd">                         but you might want to choose more carefully.&quot;&quot;&quot;</span>
        <span class="p">)</span>

    <span class="c1"># define inputs based on the following order</span>
    <span class="k">if</span> <span class="n">newx_edges</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># define grid by its edges (and define others from there)</span>
        <span class="n">newx_edges_without_unit</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">newx_edges</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">x_unit</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
        <span class="n">dx_without_unit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">newx_edges_without_unit</span><span class="p">)</span>
        <span class="n">newx_without_unit</span> <span class="o">=</span> <span class="n">newx_edges_without_unit</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">dx_without_unit</span>
        <span class="n">newx_left_without_unit</span> <span class="o">=</span> <span class="n">newx_edges_without_unit</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">newx_right_without_unit</span> <span class="o">=</span> <span class="n">newx_edges_without_unit</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

        <span class="c1"># make sure the final output grid is defined</span>
        <span class="n">final_newx</span><span class="p">,</span> <span class="n">final_newx_left</span><span class="p">,</span> <span class="n">final_newx_right</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">newx_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
            <span class="n">newx_left_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
            <span class="n">newx_right_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="n">newx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># define grid by its centers (and define others from there)</span>
        <span class="n">newx_without_unit</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">newx</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">x_unit</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
        <span class="n">newx_left_without_unit</span><span class="p">,</span> <span class="n">newx_right_without_unit</span> <span class="o">=</span> <span class="n">calculate_bin_leftright</span><span class="p">(</span>
            <span class="n">newx_without_unit</span>
        <span class="p">)</span>
        <span class="n">newx_edges_without_unit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span>
            <span class="p">[</span><span class="n">newx_left_without_unit</span><span class="p">,</span> <span class="n">newx_right_without_unit</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
        <span class="p">)</span>
        <span class="n">dx_without_unit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">newx_edges_without_unit</span><span class="p">)</span>

        <span class="c1"># make sure the final output grid is defined</span>
        <span class="n">final_newx</span><span class="p">,</span> <span class="n">final_newx_left</span><span class="p">,</span> <span class="n">final_newx_right</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">newx_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
            <span class="n">newx_left_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
            <span class="n">newx_right_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="n">dx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># define grid by a bin width (and define others from there)</span>
        <span class="n">dx_without_unit</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">dx</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">x_unit</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
        <span class="n">newx_without_unit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">x_without_unit</span><span class="p">),</span>
            <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">x_without_unit</span><span class="p">)</span> <span class="o">+</span> <span class="n">dx_without_unit</span><span class="p">,</span>
            <span class="n">dx_without_unit</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">newx_left_without_unit</span><span class="p">,</span> <span class="n">newx_right_without_unit</span> <span class="o">=</span> <span class="n">calculate_bin_leftright</span><span class="p">(</span>
            <span class="n">newx_without_unit</span>
        <span class="p">)</span>
        <span class="n">newx_edges_without_unit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span>
            <span class="p">[</span><span class="n">newx_left_without_unit</span><span class="p">,</span> <span class="n">newx_right_without_unit</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
        <span class="p">)</span>

        <span class="c1"># make sure the final output grid is defined</span>
        <span class="n">final_newx</span><span class="p">,</span> <span class="n">final_newx_left</span><span class="p">,</span> <span class="n">final_newx_right</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">newx_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
            <span class="n">newx_left_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
            <span class="n">newx_right_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">elif</span> <span class="n">nx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># keep track of the original input x values</span>
        <span class="n">original_x_without_unit</span> <span class="o">=</span> <span class="n">x_without_unit</span>

        <span class="c1"># redefine the input x to indices, to do interpolation in index space</span>
        <span class="n">x_without_unit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">x_without_unit</span><span class="p">))</span>

        <span class="c1"># define a grid of edges that will enclose the right number of indices</span>
        <span class="n">x_left_i</span><span class="p">,</span> <span class="n">x_right_i</span> <span class="o">=</span> <span class="n">calculate_bin_leftright</span><span class="p">(</span><span class="n">x_without_unit</span><span class="p">)</span>
        <span class="n">newx_edges_without_unit</span> <span class="o">=</span> <span class="n">leftright_to_edges</span><span class="p">(</span><span class="n">x_left_i</span><span class="p">,</span> <span class="n">x_right_i</span><span class="p">)[::</span><span class="n">nx</span><span class="p">]</span>
        <span class="n">newx_without_unit</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span>
            <span class="n">newx_edges_without_unit</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">+</span> <span class="n">newx_edges_without_unit</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="p">)</span>

        <span class="c1"># calculate the actual x values corresponding to the bins</span>
        <span class="n">original_edges</span> <span class="o">=</span> <span class="n">leftright_to_edges</span><span class="p">(</span>
            <span class="o">*</span><span class="n">calculate_bin_leftright</span><span class="p">(</span><span class="n">original_x_without_unit</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">final_edges</span> <span class="o">=</span> <span class="n">original_edges</span><span class="p">[::</span><span class="n">nx</span><span class="p">]</span> <span class="o">*</span> <span class="n">x_unit</span>
        <span class="n">final_newx_left</span><span class="p">,</span> <span class="n">final_newx_right</span> <span class="o">=</span> <span class="n">edges_to_leftright</span><span class="p">(</span><span class="n">final_edges</span><span class="p">)</span>
        <span class="n">final_newx</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">final_newx_left</span> <span class="o">+</span> <span class="n">final_newx_right</span><span class="p">)</span>
        <span class="n">dx_without_unit</span> <span class="o">=</span> <span class="p">(</span><span class="n">final_newx_right</span> <span class="o">-</span> <span class="n">final_newx_left</span><span class="p">)</span> <span class="o">/</span> <span class="n">x_unit</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;No output grid sent to `bintogrid`.</span>
<span class="sd">                              Please choose one of the following:</span>
<span class="sd">                              [`newx_edges`, `newx`, `dx`, `nx`]&quot;&quot;&quot;</span>
        <span class="p">)</span>

    <span class="c1"># don&#39;t complain about zero-divisions in here (to allow infinite uncertainties)</span>
    <span class="k">with</span> <span class="n">np</span><span class="o">.</span><span class="n">errstate</span><span class="p">(</span><span class="n">divide</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">invalid</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">):</span>

        <span class="c1"># calculate weight integrals for the bin array</span>
        <span class="n">ok</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">y_without_unit</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span>

        <span class="c1"># resample the sums onto that new grid</span>
        <span class="k">if</span> <span class="n">unc</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">x_without_unit</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">weighting</span> <span class="o">==</span> <span class="s2">&quot;inversevariance&quot;</span><span class="p">:</span>
                <span class="n">weights</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">unc</span><span class="o">**</span><span class="mi">2</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">x_without_unit</span><span class="p">)</span>

            <span class="c1"># ignore infinite weights (= 0 uncertainties)</span>
            <span class="n">ok</span> <span class="o">*=</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">ok</span><span class="p">):</span>
            <span class="n">numerator</span> <span class="o">=</span> <span class="n">resample_while_conserving_flux</span><span class="p">(</span>
                <span class="n">xin</span><span class="o">=</span><span class="n">x_without_unit</span><span class="p">[</span><span class="n">ok</span><span class="p">],</span>
                <span class="n">yin</span><span class="o">=</span><span class="p">(</span><span class="n">y_without_unit</span> <span class="o">*</span> <span class="n">weights</span><span class="p">)[</span><span class="n">ok</span><span class="p">],</span>
                <span class="n">xout_edges</span><span class="o">=</span><span class="n">newx_edges_without_unit</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">denominator</span> <span class="o">=</span> <span class="n">resample_while_conserving_flux</span><span class="p">(</span>
                <span class="n">xin</span><span class="o">=</span><span class="n">x_without_unit</span><span class="p">[</span><span class="n">ok</span><span class="p">],</span>
                <span class="n">yin</span><span class="o">=</span><span class="n">weights</span><span class="p">[</span><span class="n">ok</span><span class="p">],</span>
                <span class="n">xout_edges</span><span class="o">=</span><span class="n">newx_edges_without_unit</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="c1"># the binned weighted means on the new grid</span>
            <span class="n">newy</span> <span class="o">=</span> <span class="n">numerator</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">denominator</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span>

            <span class="c1"># the standard error on the means, for those bins</span>
            <span class="n">newunc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">denominator</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">])</span>

            <span class="c1"># keep track of the number of original bins going into each new bin</span>
            <span class="n">number_of_original_bins_per_new_bin</span> <span class="o">=</span> <span class="n">resample_while_conserving_flux</span><span class="p">(</span>
                <span class="n">xin</span><span class="o">=</span><span class="n">x_without_unit</span><span class="p">[</span><span class="n">ok</span><span class="p">],</span>
                <span class="n">yin</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">y_without_unit</span><span class="p">)[</span><span class="n">ok</span><span class="p">],</span>
                <span class="n">xout_edges</span><span class="o">=</span><span class="n">newx_edges_without_unit</span><span class="p">,</span>
            <span class="p">)[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">newy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="o">*</span> <span class="n">newx_without_unit</span>
            <span class="n">newunc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="o">*</span> <span class="n">newx_without_unit</span>
            <span class="n">number_of_original_bins_per_new_bin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">newx_without_unit</span><span class="p">)</span>

    <span class="c1"># remove any empty bins</span>
    <span class="k">if</span> <span class="n">drop_nans</span><span class="p">:</span>
        <span class="n">ok</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">newy</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ok</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">newx_without_unit</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>

    <span class="c1"># if no uncertainties were given, don&#39;t return uncertainties</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># populate the new grid centers + edges + values</span>
    <span class="n">result</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">final_newx</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span>
    <span class="n">result</span><span class="p">[</span><span class="s2">&quot;x_edge_lower&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">final_newx_left</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span>
    <span class="n">result</span><span class="p">[</span><span class="s2">&quot;x_edge_upper&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">final_newx_right</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span>

    <span class="c1"># populate the new grid values</span>
    <span class="n">result</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">newy</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span> <span class="o">*</span> <span class="n">y_unit</span>

    <span class="c1"># populate the new grid value uncertainties</span>
    <span class="k">if</span> <span class="n">unc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">result</span><span class="p">[</span><span class="s2">&quot;uncertainty&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">newunc</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span> <span class="o">*</span> <span class="n">y_unit</span>

    <span class="c1"># store how many of the original pixels made it into this new one</span>
    <span class="n">result</span><span class="p">[</span><span class="s2">&quot;N_unbinned/N_binned&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">number_of_original_bins_per_new_bin</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">visualize</span><span class="p">:</span>
        <span class="n">fi</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span>
            <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">gridspec_kw</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">height_ratios</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">])</span>
        <span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">plot_as_boxes</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">xleft</span><span class="o">=</span><span class="n">x_left</span><span class="p">,</span> <span class="n">xright</span><span class="o">=</span><span class="n">x_right</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;silver&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">ekw</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">elinewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">unc</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;silver&quot;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">ekw</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">],</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">],</span>
            <span class="n">yerr</span><span class="o">=</span><span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;uncertainty&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
            <span class="n">xerr</span><span class="o">=</span><span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s2">&quot;x_edge_upper&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;x_edge_lower&quot;</span><span class="p">])</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
            <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
            <span class="n">zorder</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
            <span class="o">**</span><span class="n">ekw</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">plot_as_boxes</span><span class="p">(</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">],</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;N_unbinned/N_binned&quot;</span><span class="p">],</span>
            <span class="n">xleft</span><span class="o">=</span><span class="n">result</span><span class="p">[</span><span class="s2">&quot;x_edge_lower&quot;</span><span class="p">],</span>
            <span class="n">xright</span><span class="o">=</span><span class="n">result</span><span class="p">[</span><span class="s2">&quot;x_edge_upper&quot;</span><span class="p">],</span>
        <span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;$N_</span><span class="si">{unbinned}</span><span class="s2">/N_</span><span class="si">{binned}</span><span class="s2">$&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.actions.operations.calculate_bin_leftright" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">calculate_bin_leftright</span><span class="p">(</span><span class="n">x</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.actions.operations.calculate_bin_leftright" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>If x is an array of bin centers, calculate the bin edges.
(assumes outermost bins are same size as their neighbors)</p>
<h4 id="chromatic.rainbows.actions.operations.calculate_bin_leftright--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.actions.operations.calculate_bin_leftright--parameters" title="Permanent link">#</a></h4>
<p>x : array
    The array of bin centers.</p>
<h4 id="chromatic.rainbows.actions.operations.calculate_bin_leftright--returns">Returns<a class="headerlink" href="#chromatic.rainbows.actions.operations.calculate_bin_leftright--returns" title="Permanent link">#</a></h4>
<p>l : array
    The left edges of the bins.
r : array
    The right edges of the bins.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/tools/resampling.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">calculate_bin_leftright</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    If x is an array of bin centers, calculate the bin edges.</span>
<span class="sd">    (assumes outermost bins are same size as their neighbors)</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : array</span>
<span class="sd">        The array of bin centers.</span>

<span class="sd">    Returns</span>
<span class="sd">    ----------</span>
<span class="sd">    l : array</span>
<span class="sd">        The left edges of the bins.</span>
<span class="sd">    r : array</span>
<span class="sd">        The right edges of the bins.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># what are bin edges (making a guess for those on the ends)</span>
    <span class="c1"># xbinsize = calculate_bin_widths(x)</span>
    <span class="c1"># left = x - xbinsize / 2.0</span>
    <span class="c1"># right = x + xbinsize / 2.0</span>

    <span class="c1"># weird corner case!</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">left</span><span class="p">,</span> <span class="n">right</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">left</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">right</span><span class="p">])</span>

    <span class="n">inner_edges</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="n">x</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">first_edge</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="n">inner_edges</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">last_edge</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">inner_edges</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

    <span class="n">left</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">first_edge</span><span class="p">,</span> <span class="n">inner_edges</span><span class="p">])</span>
    <span class="n">right</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">inner_edges</span><span class="p">,</span> <span class="n">last_edge</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.actions.operations.diff" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">diff</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.actions.operations.diff" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Test whether <code>self == other</code>, and print the differences.</p>
<p>This compares the wavelike, timelike, and fluxlike arrays
for exact matches. It skips entirely over the metadata.
The <code>diff</code> function is the same as <code>__eq__</code>, but a little
more verbose, just to serve as a helpful debugging tool.</p>
<h4 id="chromatic.rainbows.actions.operations.diff--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.actions.operations.diff--parameters" title="Permanent link">#</a></h4>
<p>other : Rainbow
    Another <code>Rainbow</code> to compare to.</p>
<h4 id="chromatic.rainbows.actions.operations.diff--returns">Returns<a class="headerlink" href="#chromatic.rainbows.actions.operations.diff--returns" title="Permanent link">#</a></h4>
<p>equal : bool
    Are they (effectively) equivalent?</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/rainbows/actions/operations.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">diff</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Test whether `self == other`, and print the differences.</span>

<span class="sd">    This compares the wavelike, timelike, and fluxlike arrays</span>
<span class="sd">    for exact matches. It skips entirely over the metadata.</span>
<span class="sd">    The `diff` function is the same as `__eq__`, but a little</span>
<span class="sd">    more verbose, just to serve as a helpful debugging tool.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    other : Rainbow</span>
<span class="sd">        Another `Rainbow` to compare to.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    equal : bool</span>
<span class="sd">        Are they (effectively) equivalent?</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># start by assuming the Rainbows are identical</span>
    <span class="n">same</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">([</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">],</span> <span class="p">[</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="p">]):</span>

        <span class="c1"># loop through the core dictionaries</span>
        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">a</span><span class="o">.</span><span class="n">_core_dictionaries</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">d</span> <span class="o">==</span> <span class="s2">&quot;metadata&quot;</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="c1"># pull out each core dictionary from both</span>
            <span class="n">d1</span><span class="p">,</span> <span class="n">d2</span> <span class="o">=</span> <span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="p">)[</span><span class="n">d</span><span class="p">],</span> <span class="nb">vars</span><span class="p">(</span><span class="n">b</span><span class="p">)[</span><span class="n">d</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">set</span><span class="p">(</span><span class="n">d1</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">!=</span> <span class="nb">set</span><span class="p">(</span><span class="n">d2</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="n">differences</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">d1</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">d2</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">a</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">d</span><span class="si">}</span><span class="s2"> has </span><span class="si">{</span><span class="n">differences</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="n">b</span><span class="si">}</span><span class="s2"> does not&quot;</span><span class="p">)</span>

            <span class="c1"># loop through elements of each dictionary</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">d1</span><span class="p">:</span>
                <span class="c1"># ignore different histories (e.g. new vs loaded)</span>
                <span class="k">if</span> <span class="n">k</span> <span class="o">!=</span> <span class="s2">&quot;history&quot;</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="c1"># test that all elements match for both</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">==</span> <span class="n">b</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">))</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">a</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">d</span><span class="si">}</span><span class="s2">[</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">] != </span><span class="si">{</span><span class="n">b</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">d</span><span class="si">}</span><span class="s2">[</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.actions.operations.edges_to_leftright" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">edges_to_leftright</span><span class="p">(</span><span class="n">edges</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.actions.operations.edges_to_leftright" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Convert N+1 contiguous edges to two arrays of N left/right edges.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/tools/resampling.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">edges_to_leftright</span><span class="p">(</span><span class="n">edges</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert N+1 contiguous edges to two arrays of N left/right edges.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">left</span><span class="p">,</span> <span class="n">right</span> <span class="o">=</span> <span class="n">edges</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">edges</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="k">return</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.actions.operations.expand_filenames" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">expand_filenames</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.actions.operations.expand_filenames" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>A wrapper to expand a string or list into a list of filenames.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/imports.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">expand_filenames</span><span class="p">(</span><span class="n">filepath</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A wrapper to expand a string or list into a list of filenames.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
        <span class="n">filenames</span> <span class="o">=</span> <span class="n">filepath</span>
    <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span> <span class="o">==</span> <span class="n">Column</span><span class="p">:</span>
        <span class="n">filenames</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>
    <span class="k">elif</span> <span class="s2">&quot;*&quot;</span> <span class="ow">in</span> <span class="n">filepath</span><span class="p">:</span>
        <span class="n">filenames</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">filepath</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">filenames</span> <span class="o">=</span> <span class="p">[</span><span class="n">filepath</span><span class="p">]</span>
    <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">filenames</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.actions.operations.leftright_to_edges" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">leftright_to_edges</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.actions.operations.leftright_to_edges" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Convert two arrays of N left/right edges to N+1 continugous edges.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/tools/resampling.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">leftright_to_edges</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert two arrays of N left/right edges to N+1 continugous edges.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">edges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>
    <span class="k">return</span> <span class="n">edges</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.actions.operations.name2color" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">name2color</span><span class="p">(</span><span class="n">name</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.actions.operations.name2color" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Return the 3-element RGB array of a given color name.</p>
<h4 id="chromatic.rainbows.actions.operations.name2color--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.actions.operations.name2color--parameters" title="Permanent link">#</a></h4>
<p>name : str
    The name of a color</p>
<h4 id="chromatic.rainbows.actions.operations.name2color--returns">Returns<a class="headerlink" href="#chromatic.rainbows.actions.operations.name2color--returns" title="Permanent link">#</a></h4>
<p>rgb : tuple
    3-element RGB color, with numbers from 0.0 to 1.0</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/imports.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">name2color</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return the 3-element RGB array of a given color name.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    name : str</span>
<span class="sd">        The name of a color</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    rgb : tuple</span>
<span class="sd">        3-element RGB color, with numbers from 0.0 to 1.0</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># give a friendly warning if the color name can&#39;t be found</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">color_hex</span> <span class="o">=</span> <span class="n">col</span><span class="o">.</span><span class="n">cnames</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">col</span><span class="o">.</span><span class="n">hex2color</span><span class="p">(</span><span class="n">color_hex</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="n">cheerfully_suggest</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The color </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> can&#39;t be found. (Returning black.)&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.actions.operations.one2another" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">one2another</span><span class="p">(</span><span class="n">bottom</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">alpha_bottom</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">alpha_top</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">256</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.actions.operations.one2another" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Create a cmap that goes smoothly (linearly in RGBA) from "bottom" to "top".</p>
<h4 id="chromatic.rainbows.actions.operations.one2another--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.actions.operations.one2another--parameters" title="Permanent link">#</a></h4>
<p>bottom : str
    Name of a color for the bottom of cmap (0.0)
top : str
    Name of a color for the top of the cmap (1.0)
alpha_bottom : float
    Opacity at the bottom of the cmap
alpha_top : float
    Opacitiy at the top of the cmap
N : int
    The number of levels in the listed color map</p>
<h4 id="chromatic.rainbows.actions.operations.one2another--returns">Returns<a class="headerlink" href="#chromatic.rainbows.actions.operations.one2another--returns" title="Permanent link">#</a></h4>
<p>cmap : Colormap
    A color map that goes linearly from the
    bottom to top color (and alpha).</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/imports.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">one2another</span><span class="p">(</span><span class="n">bottom</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">alpha_bottom</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">alpha_top</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">256</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a cmap that goes smoothly (linearly in RGBA) from &quot;bottom&quot; to &quot;top&quot;.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    bottom : str</span>
<span class="sd">        Name of a color for the bottom of cmap (0.0)</span>
<span class="sd">    top : str</span>
<span class="sd">        Name of a color for the top of the cmap (1.0)</span>
<span class="sd">    alpha_bottom : float</span>
<span class="sd">        Opacity at the bottom of the cmap</span>
<span class="sd">    alpha_top : float</span>
<span class="sd">        Opacitiy at the top of the cmap</span>
<span class="sd">    N : int</span>
<span class="sd">        The number of levels in the listed color map</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    cmap : Colormap</span>
<span class="sd">        A color map that goes linearly from the</span>
<span class="sd">        bottom to top color (and alpha).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># get the RGB values of the bottom and top of the cmap</span>
    <span class="n">rgb_bottom</span><span class="p">,</span> <span class="n">rgb_top</span> <span class="o">=</span> <span class="n">name2color</span><span class="p">(</span><span class="n">bottom</span><span class="p">),</span> <span class="n">name2color</span><span class="p">(</span><span class="n">top</span><span class="p">)</span>

    <span class="c1"># create linear gradients for all four RGBA channels</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">rgb_bottom</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">rgb_top</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">N</span><span class="p">)</span>
    <span class="n">g</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">rgb_bottom</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">rgb_top</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">N</span><span class="p">)</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">rgb_bottom</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">rgb_top</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">N</span><span class="p">)</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">alpha_bottom</span><span class="p">,</span> <span class="n">alpha_top</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>

    <span class="c1"># create (N,4) array + populate a listed colormap</span>
    <span class="n">colors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">]))</span>
    <span class="n">cmap</span> <span class="o">=</span> <span class="n">col</span><span class="o">.</span><span class="n">ListedColormap</span><span class="p">(</span><span class="n">colors</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{bottom}</span><span class="s2">2</span><span class="si">{top}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="nb">locals</span><span class="p">()))</span>

    <span class="c1"># return the colormap</span>
    <span class="k">return</span> <span class="n">cmap</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.actions.operations.remove_unit" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">remove_unit</span><span class="p">(</span><span class="n">x</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.actions.operations.remove_unit" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Quick wrapper to remove the unit from a quantity,
but not complain if it doesn't have one.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/imports.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">remove_unit</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Quick wrapper to remove the unit from a quantity,</span>
<span class="sd">    but not complain if it doesn&#39;t have one.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">x</span><span class="o">.</span><span class="n">value</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">x</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.actions.operations.resample_while_conserving_flux" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">resample_while_conserving_flux</span><span class="p">(</span><span class="n">xin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">yin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xout</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xin_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xout_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">replace_nans</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">visualize</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">pause</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.actions.operations.resample_while_conserving_flux" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Starting from some initial x and y, resample onto a
different grid (either higher or lower resolution),
while conserving total flux.</p>
<p>When including the entire range of <code>xin</code>,
<code>sum(yout) == sum(yin)</code> should be true.</p>
<p>When including only part of the range of <code>xin</code>,
the integral between any two points should be conserved.</p>
<h4 id="chromatic.rainbows.actions.operations.resample_while_conserving_flux--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.actions.operations.resample_while_conserving_flux--parameters" title="Permanent link">#</a></h4>
<p>xin : array
    The original independent variable.
yin : array
    The original dependent variable (same size as x).
xout : array
    The new grid of independent variables onto which
    you want to resample the y values. Refers to the
    center of each bin (use <code>xout_edges</code> for finer
    control over the exact edges of the bins)
xin_edges : array
    The edges of the original independent variable bins.
    The left and right edges of the bins are interpreted
    to be <code>xin_edges[:-1]</code> and <code>xin_edges[1:]</code>,
    respectively, so the associated <code>yin</code> should have exactly
    1 fewer element than <code>xin_edges</code>. This provides finer
    control over the size of each bin in the input than
    simply supplying <code>xin</code>(still a little experimental)
    They should probably be sorted?
xout_edges : array
    The edges of the new grid of bins for the independent
    variable, onto which you want to resample the y
    values. The left and right edges of the bins will be,
    respectively, <code>xout_edges[:-1]</code> and <code>xout_edges[1:]</code>,
    so the size of the output array will be
    <code>len(xout_edges) - 1</code>
replace_nans : float, str
    Replace nan values with this value.
    <code>replace_nans = 0</code>
        will add no flux where nans are
    <code>replace_nans = nan</code>
        will ensure you get nans returned everywhere
        if you try to resample over any nan
    <code>replace_nans = 'interpolate'</code>
        will try to replace nans by linearly interpolating
        from nearby values (not yet implemented)
visualize : bool
    Should we make a plot showing whether it worked?
pause : bool
    Should we pause to wait for a key press?</p>
<h4 id="chromatic.rainbows.actions.operations.resample_while_conserving_flux--returns">Returns<a class="headerlink" href="#chromatic.rainbows.actions.operations.resample_while_conserving_flux--returns" title="Permanent link">#</a></h4>
<p>result : dict
    A dictionary containing...
        <code>x</code> = the center of the output grid
        <code>y</code> = the resampled value on the output grid
        <code>edges</code> = the edges of the output grid, which will
            have one more element than x or y</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/tools/resampling.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">resample_while_conserving_flux</span><span class="p">(</span>
    <span class="n">xin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">yin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">xout</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">xin_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">xout_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">replace_nans</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
    <span class="n">visualize</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">pause</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Starting from some initial x and y, resample onto a</span>
<span class="sd">    different grid (either higher or lower resolution),</span>
<span class="sd">    while conserving total flux.</span>

<span class="sd">    When including the entire range of `xin`,</span>
<span class="sd">    `sum(yout) == sum(yin)` should be true.</span>

<span class="sd">    When including only part of the range of `xin`,</span>
<span class="sd">    the integral between any two points should be conserved.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    xin : array</span>
<span class="sd">        The original independent variable.</span>
<span class="sd">    yin : array</span>
<span class="sd">        The original dependent variable (same size as x).</span>
<span class="sd">    xout : array</span>
<span class="sd">        The new grid of independent variables onto which</span>
<span class="sd">        you want to resample the y values. Refers to the</span>
<span class="sd">        center of each bin (use `xout_edges` for finer</span>
<span class="sd">        control over the exact edges of the bins)</span>
<span class="sd">    xin_edges : array</span>
<span class="sd">        The edges of the original independent variable bins.</span>
<span class="sd">        The left and right edges of the bins are interpreted</span>
<span class="sd">        to be `xin_edges[:-1]` and `xin_edges[1:]`,</span>
<span class="sd">        respectively, so the associated `yin` should have exactly</span>
<span class="sd">        1 fewer element than `xin_edges`. This provides finer</span>
<span class="sd">        control over the size of each bin in the input than</span>
<span class="sd">        simply supplying `xin`(still a little experimental)</span>
<span class="sd">        They should probably be sorted?</span>
<span class="sd">    xout_edges : array</span>
<span class="sd">        The edges of the new grid of bins for the independent</span>
<span class="sd">        variable, onto which you want to resample the y</span>
<span class="sd">        values. The left and right edges of the bins will be,</span>
<span class="sd">        respectively, `xout_edges[:-1]` and `xout_edges[1:]`,</span>
<span class="sd">        so the size of the output array will be</span>
<span class="sd">        `len(xout_edges) - 1`</span>
<span class="sd">    replace_nans : float, str</span>
<span class="sd">        Replace nan values with this value.</span>
<span class="sd">        `replace_nans = 0`</span>
<span class="sd">            will add no flux where nans are</span>
<span class="sd">        `replace_nans = nan`</span>
<span class="sd">            will ensure you get nans returned everywhere</span>
<span class="sd">            if you try to resample over any nan</span>
<span class="sd">        `replace_nans = &#39;interpolate&#39;`</span>
<span class="sd">            will try to replace nans by linearly interpolating</span>
<span class="sd">            from nearby values (not yet implemented)</span>
<span class="sd">    visualize : bool</span>
<span class="sd">        Should we make a plot showing whether it worked?</span>
<span class="sd">    pause : bool</span>
<span class="sd">        Should we pause to wait for a key press?</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    result : dict</span>
<span class="sd">        A dictionary containing...</span>
<span class="sd">            `x` = the center of the output grid</span>
<span class="sd">            `y` = the resampled value on the output grid</span>
<span class="sd">            `edges` = the edges of the output grid, which will</span>
<span class="sd">                have one more element than x or y</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># make sure there are some reasonable input options</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">xin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">xin_edges</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">yin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">xout</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">xout_edges</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>

    <span class="c1"># set up the bins, to calculate cumulative distribution of y</span>
    <span class="k">if</span> <span class="n">xin_edges</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># make sure the sizes match up</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">xin</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">yin</span><span class="p">)</span>
        <span class="c1"># sort to make sure x is strictly increasing</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">xin</span><span class="p">)</span>
        <span class="n">xin_sorted</span> <span class="o">=</span> <span class="n">xin</span><span class="p">[</span><span class="n">s</span><span class="p">]</span>
        <span class="n">yin_sorted</span> <span class="o">=</span> <span class="n">yin</span><span class="p">[</span><span class="n">s</span><span class="p">]</span>
        <span class="c1"># estimate some bin edges (might fail for non-uniform grids)</span>
        <span class="n">xin_left</span><span class="p">,</span> <span class="n">xin_right</span> <span class="o">=</span> <span class="n">calculate_bin_leftright</span><span class="p">(</span><span class="n">xin_sorted</span><span class="p">)</span>
        <span class="c1"># define an array of edges</span>
        <span class="n">xin_edges</span> <span class="o">=</span> <span class="n">leftright_to_edges</span><span class="p">(</span><span class="n">xin_left</span><span class="p">,</span> <span class="n">xin_right</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># make sure the sizes match up</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">xin_edges</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">yin</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="c1"># sort to make sure x is strictly increasing</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">xin_edges</span><span class="p">)</span>
        <span class="n">xin_left</span><span class="p">,</span> <span class="n">xin_right</span> <span class="o">=</span> <span class="n">edges_to_leftright</span><span class="p">(</span><span class="n">xin_edges</span><span class="p">[</span><span class="n">s</span><span class="p">])</span>
        <span class="n">xin_sorted</span> <span class="o">=</span> <span class="p">(</span><span class="n">xin_left</span> <span class="o">+</span> <span class="n">xin_right</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">yin_sorted</span> <span class="o">=</span> <span class="n">yin</span><span class="p">[</span><span class="n">s</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>

    <span class="c1"># the first element should be the left edge of the first pixel</span>
    <span class="c1"># last element will be right edge of last pixel</span>
    <span class="n">xin_for_cdf</span> <span class="o">=</span> <span class="n">xin_edges</span>

    <span class="c1"># to the left of the first pixel, assume flux is zero</span>
    <span class="n">yin_for_cdf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">yin_sorted</span><span class="p">])</span>

    <span class="c1"># correct for any non-finite values</span>
    <span class="n">bad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">yin_for_cdf</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">replace_nans</span> <span class="o">==</span> <span class="s2">&quot;interpolate&quot;</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
            <span class="s2">&quot;The `replace_nans=&#39;interpolate&#39;`` option doens&#39;t exist yet!&quot;</span>
        <span class="p">)</span>
    <span class="n">yin_for_cdf</span><span class="p">[</span><span class="n">bad</span><span class="p">]</span> <span class="o">=</span> <span class="n">replace_nans</span>

    <span class="c1"># calculate the CDF of the flux (at pixel edge locations)</span>
    <span class="n">cdfin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">yin_for_cdf</span><span class="p">)</span>

    <span class="c1"># create an interpolator for that CDF</span>
    <span class="n">cdfinterpolator</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span>
        <span class="n">xin_for_cdf</span><span class="p">,</span>
        <span class="n">cdfin</span><span class="p">,</span>
        <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span>
        <span class="n">bounds_error</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">fill_value</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">yin</span><span class="p">)),</span>
    <span class="p">)</span>

    <span class="c1"># calculate bin edges (of size len(xout)+1)</span>
    <span class="k">if</span> <span class="n">xout_edges</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">xout_left</span><span class="p">,</span> <span class="n">xout_right</span> <span class="o">=</span> <span class="n">calculate_bin_leftright</span><span class="p">(</span><span class="n">xout</span><span class="p">)</span>
        <span class="n">xout_edges</span> <span class="o">=</span> <span class="n">leftright_to_edges</span><span class="p">(</span><span class="n">xout_left</span><span class="p">,</span> <span class="n">xout_right</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">xout_left</span><span class="p">,</span> <span class="n">xout_right</span> <span class="o">=</span> <span class="n">edges_to_leftright</span><span class="p">(</span><span class="n">xout_edges</span><span class="p">)</span>
        <span class="n">xout</span> <span class="o">=</span> <span class="p">(</span><span class="n">xout_left</span> <span class="o">+</span> <span class="n">xout_right</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>

    <span class="n">xout_for_cdf</span> <span class="o">=</span> <span class="n">leftright_to_edges</span><span class="p">(</span><span class="n">xout_left</span><span class="p">,</span> <span class="n">xout_right</span><span class="p">)</span>

    <span class="c1"># interpolate the CDF onto those bin edges</span>
    <span class="n">cdfout</span> <span class="o">=</span> <span class="n">cdfinterpolator</span><span class="p">(</span><span class="n">xout_for_cdf</span><span class="p">)</span>

    <span class="c1"># take  derivative of the CDF to get flux per resampled bin</span>
    <span class="c1"># (xout is bin center, and yout is the flux in that bin)</span>
    <span class="n">yout</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">cdfout</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">visualize</span><span class="p">:</span>
        <span class="n">fi</span><span class="p">,</span> <span class="p">(</span><span class="n">ax_cdf</span><span class="p">,</span> <span class="n">ax_pdf</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
        <span class="n">inkw</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
            <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span>
            <span class="n">markeredgecolor</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">outkw</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;darkorange&quot;</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span>
            <span class="n">markersize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
            <span class="n">markeredgecolor</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">legkw</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper left&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">xinbinsize</span> <span class="o">=</span> <span class="n">xin_right</span> <span class="o">-</span> <span class="n">xin_left</span>
        <span class="n">xoutbinsize</span> <span class="o">=</span> <span class="n">xout_right</span> <span class="o">-</span> <span class="n">xout_left</span>
        <span class="c1"># plot the PDFs</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="n">ax_pdf</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Flux per (Original) Pixel&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Pixel&quot;</span><span class="p">)</span>
        <span class="c1"># plot the original pixels (in df/dpixel to compare with resampled)</span>
        <span class="n">plot_as_boxes</span><span class="p">(</span>
            <span class="n">xin_sorted</span><span class="p">,</span> <span class="n">yin_sorted</span> <span class="o">/</span> <span class="n">xinbinsize</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Original Pixels&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">inkw</span>
        <span class="p">)</span>

        <span class="c1"># what would a bad interpolation look like?</span>
        <span class="n">interpolate_badly</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span>
            <span class="n">xin_sorted</span><span class="p">,</span>
            <span class="n">yin_sorted</span> <span class="o">/</span> <span class="n">xinbinsize</span><span class="p">,</span>
            <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span>
            <span class="n">bounds_error</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">fill_value</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
            <span class="n">xout</span><span class="p">,</span>
            <span class="n">interpolate_badly</span><span class="p">(</span><span class="n">xout</span><span class="p">),</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;cornflowerblue&quot;</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span>
            <span class="n">markersize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
            <span class="n">markeredgecolor</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Silly Simple Interpolation&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># plot the flux-conserving resampled data (again, in df/d&quot;pixel&quot;)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
            <span class="n">xout</span><span class="p">,</span> <span class="n">yout</span> <span class="o">/</span> <span class="n">xoutbinsize</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Flux-Conserving Interpolation&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">outkw</span>
        <span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="o">**</span><span class="n">legkw</span><span class="p">)</span>

        <span class="c1"># plot the CDFs</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="n">ax_cdf</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Cumulative Flux (from left)&quot;</span><span class="p">)</span>

        <span class="c1"># plot the original CDF</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xin_for_cdf</span><span class="p">,</span> <span class="n">cdfin</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Original Pixels&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">inkw</span><span class="p">)</span>

        <span class="c1"># plot the interpolated CDF</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xout_for_cdf</span><span class="p">,</span> <span class="n">cdfout</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Flux-Conserved Resample&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">outkw</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">pause</span><span class="p">:</span>
            <span class="n">a</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span>
                <span class="s2">&quot;Pausing a moment to check on interpolation; press return to continue.&quot;</span>
            <span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{:&gt;6}</span><span class="s2"> = </span><span class="si">{:.5f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;Actual&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">yin</span><span class="p">)))</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="s2">&quot;</span><span class="si">{:&gt;6}</span><span class="s2"> = </span><span class="si">{:.5f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="s2">&quot;Silly&quot;</span><span class="p">,</span>
                <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">interpolate_badly</span><span class="p">(</span><span class="n">xout</span><span class="p">)</span> <span class="o">*</span> <span class="n">xoutbinsize</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{:&gt;6}</span><span class="s2"> = </span><span class="si">{:.5f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;CDF&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">yout</span><span class="p">)))</span>

    <span class="c1"># return the resampled y-values</span>
    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="n">xout</span><span class="p">,</span> <span class="s2">&quot;x_edge_lower&quot;</span><span class="p">:</span> <span class="n">xout_left</span><span class="p">,</span> <span class="s2">&quot;x_edge_upper&quot;</span><span class="p">:</span> <span class="n">xout_right</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="n">yout</span><span class="p">}</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-function">



<a id="chromatic.rainbows.actions.remove_trends"></a>
    <div class="doc doc-contents first">

        <p>A quick tool to approximately remove trends.</p>
<p>This function provides some simple tools for kludgily
removing trends from a <code>Rainbow</code>, through a variety of
filtering methods. If you just want to remove all
slow trends, whether astrophysical or instrumental,
options like the <code>median_filter</code> or <code>savgol_filter</code>
will effectively suppress all trends on timescales
longer than their filtering window. If you want a
more restricted approach to removing long trends,
the <code>polyfit</code> option allows you to fit out slow trends.</p>
<h3 id="chromatic.rainbows.actions.remove_trends--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.actions.remove_trends--parameters" title="Permanent link">#</a></h3>
<p>method : str, optional
    What method should be used to make an approximate model
    for smooth trends that will then be subtracted off?
    <code>differences</code> will do an extremely rough filtering
    of replacing the fluxes with their first differences.
    Trends that are smooth relative to the noise will
    be removed this way, but sharp features will remain.
    Required keywords:
        None.
    <code>median_filter</code> is a wrapper for scipy.signal.median_filter.
    It smoothes each data point to the median of its surrounding
    points in time and/or wavelength. Required keywords:
        <code>size</code> = centered on each point, what shape rectangle
        should be used to select surrounding points for median?
        The dimensions are (nwavelengths, ntimes), so <code>size=(3,7)</code>
        means we'll take the median across three wavelengths and
        seven times. Default is <code>(1,5)</code>.
    <code>savgol_filter</code> is a wrapper for scipy.signal.savgol_filter.
    It applies a Savitzky-Golay filter for polynomial smoothing.
    Required keywords:
        <code>window_length</code> = the length of the filter window,
        which must be a positive odd integer. Default is <code>5</code>.
        <code>polyorder</code> = the order of the polynomial to use.
        Default is <code>2</code>.
    <code>polyfit</code> is a wrapper for numpy.polyfit to use a weighted
    linear least squares polynomial fit to remove smooth trends
    in time. Required keywods:
        <code>deg</code> = the polynomial degree, which must be a positive
        integer. Default is <code>1</code>, meaning a line.
    <code>custom</code> allow users to pass any fluxlike array of model
    values for an astrophysical signal to remove it. Required
    keywords:
        <code>model</code> = the (nwavelengths, ntimes) model array
**kw : dict, optional
    Any additional keywords will be passed to the function
    that does the filtering. See <code>method</code> keyword for options.</p>
<h3 id="chromatic.rainbows.actions.remove_trends--returns">Returns<a class="headerlink" href="#chromatic.rainbows.actions.remove_trends--returns" title="Permanent link">#</a></h3>
<p>removed : Rainbow
    The Rainbow with estimated signals removed.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/rainbows/actions/remove_trends.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">  6</span>
<span class="normal">  7</span>
<span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">remove_trends</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;median_filter&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A quick tool to approximately remove trends.</span>

<span class="sd">    This function provides some simple tools for kludgily</span>
<span class="sd">    removing trends from a `Rainbow`, through a variety of</span>
<span class="sd">    filtering methods. If you just want to remove all</span>
<span class="sd">    slow trends, whether astrophysical or instrumental,</span>
<span class="sd">    options like the `median_filter` or `savgol_filter`</span>
<span class="sd">    will effectively suppress all trends on timescales</span>
<span class="sd">    longer than their filtering window. If you want a</span>
<span class="sd">    more restricted approach to removing long trends,</span>
<span class="sd">    the `polyfit` option allows you to fit out slow trends.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    method : str, optional</span>
<span class="sd">        What method should be used to make an approximate model</span>
<span class="sd">        for smooth trends that will then be subtracted off?</span>
<span class="sd">        `differences` will do an extremely rough filtering</span>
<span class="sd">        of replacing the fluxes with their first differences.</span>
<span class="sd">        Trends that are smooth relative to the noise will</span>
<span class="sd">        be removed this way, but sharp features will remain.</span>
<span class="sd">        Required keywords:</span>
<span class="sd">            None.</span>
<span class="sd">        `median_filter` is a wrapper for scipy.signal.median_filter.</span>
<span class="sd">        It smoothes each data point to the median of its surrounding</span>
<span class="sd">        points in time and/or wavelength. Required keywords:</span>
<span class="sd">            `size` = centered on each point, what shape rectangle</span>
<span class="sd">            should be used to select surrounding points for median?</span>
<span class="sd">            The dimensions are (nwavelengths, ntimes), so `size=(3,7)`</span>
<span class="sd">            means we&#39;ll take the median across three wavelengths and</span>
<span class="sd">            seven times. Default is `(1,5)`.</span>
<span class="sd">        `savgol_filter` is a wrapper for scipy.signal.savgol_filter.</span>
<span class="sd">        It applies a Savitzky-Golay filter for polynomial smoothing.</span>
<span class="sd">        Required keywords:</span>
<span class="sd">            `window_length` = the length of the filter window,</span>
<span class="sd">            which must be a positive odd integer. Default is `5`.</span>
<span class="sd">            `polyorder` = the order of the polynomial to use.</span>
<span class="sd">            Default is `2`.</span>
<span class="sd">        `polyfit` is a wrapper for numpy.polyfit to use a weighted</span>
<span class="sd">        linear least squares polynomial fit to remove smooth trends</span>
<span class="sd">        in time. Required keywods:</span>
<span class="sd">            `deg` = the polynomial degree, which must be a positive</span>
<span class="sd">            integer. Default is `1`, meaning a line.</span>
<span class="sd">        `custom` allow users to pass any fluxlike array of model</span>
<span class="sd">        values for an astrophysical signal to remove it. Required</span>
<span class="sd">        keywords:</span>
<span class="sd">            `model` = the (nwavelengths, ntimes) model array</span>
<span class="sd">    **kw : dict, optional</span>
<span class="sd">        Any additional keywords will be passed to the function</span>
<span class="sd">        that does the filtering. See `method` keyword for options.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    removed : Rainbow</span>
<span class="sd">        The Rainbow with estimated signals removed.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># create a history entry for this action (before other variables are defined)</span>
    <span class="n">h</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_history_entry</span><span class="p">(</span><span class="s2">&quot;remove_trends&quot;</span><span class="p">,</span> <span class="nb">locals</span><span class="p">())</span>

    <span class="c1"># TODO, think about more careful treatment of uncertainties + good/bad data</span>
    <span class="n">new</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_copy</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;differences&quot;</span><span class="p">:</span>
        <span class="n">new</span><span class="o">.</span><span class="n">flux</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">gradient</span><span class="p">(</span><span class="n">new</span><span class="o">.</span><span class="n">flux</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>

    <span class="c1">#    if method == &quot;butter_highpass&quot;:</span>
    <span class="c1">#        for i in range (0,new.nwave):</span>
    <span class="c1">#            nyq = 0.5 * butter_fs</span>
    <span class="c1">#            normal_cutoff = butter_cutoff/nyq</span>
    <span class="c1">#            b, a = butter(butter_order, normal_cutoff, btype = &quot;high&quot;, analog = False)</span>
    <span class="c1">#            butter_filt = filtfilt(b, a, new.flux[i,:])</span>
    <span class="c1">#            new.flux[i,:] = new.flux[i,:]/butter_filt</span>
    <span class="c1">#</span>
    <span class="c1">#    if method == &quot;convolve&quot;:</span>
    <span class="c1">#        for i in range (0,new.nwave):</span>
    <span class="c1">#            box = np.ones(win_length)/win_length</span>
    <span class="c1">#            grad = np.convolve(new.flux[i,:], box, mode = &quot;same&quot;)</span>
    <span class="c1">#            new.flux[i,:] = new.flux[i,:]/grad</span>

    <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;median_filter&quot;</span><span class="p">:</span>
        <span class="n">kw_to_use</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">11</span><span class="p">))</span>
        <span class="n">kw_to_use</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;size&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">:</span>
            <span class="n">cheerfully_suggest</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            You didn&#39;t supply all expected keywords for &#39;</span><span class="si">{</span><span class="n">method</span><span class="si">}</span><span class="s2">&#39;.</span>
<span class="s2">            Relying on defaults, the values will be:</span>
<span class="s2">            </span><span class="si">{</span><span class="n">kw_to_use</span><span class="si">}</span>
<span class="s2">            &quot;&quot;&quot;</span>
            <span class="p">)</span>
        <span class="n">medfilt</span> <span class="o">=</span> <span class="n">median_filter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="p">,</span> <span class="o">**</span><span class="n">kw_to_use</span><span class="p">)</span>
        <span class="n">new</span><span class="o">.</span><span class="n">flux</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">flux</span> <span class="o">/</span> <span class="n">medfilt</span>
        <span class="n">new</span><span class="o">.</span><span class="n">uncertainty</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">uncertainty</span> <span class="o">/</span> <span class="n">medfilt</span>

    <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;savgol_filter&quot;</span><span class="p">:</span>
        <span class="n">kw_to_use</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">window_length</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span> <span class="n">polyorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">kw_to_use</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="s2">&quot;window_length&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="s2">&quot;polyorder&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">):</span>
            <span class="n">cheerfully_suggest</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            You didn&#39;t supply all expected keywords for &#39;</span><span class="si">{</span><span class="n">method</span><span class="si">}</span><span class="s2">&#39;.</span>
<span class="s2">            Relying on defaults, the values will be:</span>
<span class="s2">            </span><span class="si">{</span><span class="n">kw_to_use</span><span class="si">}</span>
<span class="s2">            &quot;&quot;&quot;</span>
            <span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">new</span><span class="o">.</span><span class="n">nwave</span><span class="p">):</span>
            <span class="n">savgolfilter</span> <span class="o">=</span> <span class="n">savgol_filter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:],</span> <span class="o">**</span><span class="n">kw_to_use</span><span class="p">)</span>
            <span class="n">new</span><span class="o">.</span><span class="n">flux</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">/</span> <span class="n">savgolfilter</span>
            <span class="n">new</span><span class="o">.</span><span class="n">uncertainty</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">uncertainty</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">/</span> <span class="n">savgolfilter</span>

    <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;polyfit&quot;</span><span class="p">:</span>
        <span class="n">kw_to_use</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">deg</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">kw_to_use</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;deg&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">:</span>
            <span class="n">cheerfully_suggest</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            You didn&#39;t supply all expected keywords for &#39;</span><span class="si">{</span><span class="n">method</span><span class="si">}</span><span class="s2">&#39;.</span>
<span class="s2">            Relying on defaults, the values will be:</span>
<span class="s2">            </span><span class="si">{</span><span class="n">kw_to_use</span><span class="si">}</span>
<span class="s2">            &quot;&quot;&quot;</span>
            <span class="p">)</span>
        <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">new</span><span class="o">.</span><span class="n">nwave</span><span class="p">):</span>
                <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">sigma</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_ok_data_for_wavelength</span><span class="p">(</span>
                    <span class="n">i</span><span class="p">,</span> <span class="n">express_badness_with_uncertainty</span><span class="o">=</span><span class="kc">True</span>
                <span class="p">)</span>
                <span class="n">ok</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">ok</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">coefs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span>
                            <span class="n">x</span><span class="o">=</span><span class="n">remove_unit</span><span class="p">(</span><span class="n">x</span><span class="p">)[</span><span class="n">ok</span><span class="p">],</span>
                            <span class="n">y</span><span class="o">=</span><span class="n">remove_unit</span><span class="p">(</span><span class="n">y</span><span class="p">)[</span><span class="n">ok</span><span class="p">],</span>
                            <span class="n">w</span><span class="o">=</span><span class="mi">1</span> <span class="o">/</span> <span class="n">remove_unit</span><span class="p">(</span><span class="n">sigma</span><span class="p">)[</span><span class="n">ok</span><span class="p">],</span>
                            <span class="o">**</span><span class="n">kw_to_use</span><span class="p">,</span>
                        <span class="p">)</span>
                        <span class="n">poly</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyval</span><span class="p">(</span><span class="n">coefs</span><span class="p">,</span> <span class="n">remove_unit</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
                        <span class="n">new</span><span class="o">.</span><span class="n">flux</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">/</span> <span class="n">poly</span>
                        <span class="n">new</span><span class="o">.</span><span class="n">uncertainty</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">uncertainty</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">/</span> <span class="n">poly</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="k">pass</span>

    <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;custom&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="s2">&quot;model&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;You need a fluxlike `model` for this `custom` method&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">kw</span><span class="p">[</span><span class="s2">&quot;model&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="n">new</span><span class="o">.</span><span class="n">flux</span><span class="o">.</span><span class="n">shape</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Your model doesn&#39;t match flux shape&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">new</span><span class="o">.</span><span class="n">flux</span> <span class="o">=</span> <span class="n">new</span><span class="o">.</span><span class="n">flux</span> <span class="o">/</span> <span class="n">kw</span><span class="p">[</span><span class="s2">&quot;model&quot;</span><span class="p">]</span>
            <span class="n">new</span><span class="o">.</span><span class="n">uncertainty</span> <span class="o">=</span> <span class="n">new</span><span class="o">.</span><span class="n">uncertainty</span> <span class="o">/</span> <span class="n">kw</span><span class="p">[</span><span class="s2">&quot;model&quot;</span><span class="p">]</span>

    <span class="c1"># append the history entry to the new Rainbow</span>
    <span class="n">new</span><span class="o">.</span><span class="n">_record_history_entry</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>

    <span class="c1"># return the new Rainbow</span>
    <span class="k">return</span> <span class="n">new</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">



<a id="chromatic.rainbows.actions.shift"></a>
    <div class="doc doc-contents first">

        <p>Doppler shift the wavelengths of this <code>Rainbow</code>.</p>
<p>This shifts the wavelengths in a <code>Rainbow</code> by
applying a velocity shift. Positive velocities make
wavelengths longer (redshift); negative velocities make
wavelengths shorter (bluesfhit).</p>
<h3 id="chromatic.rainbows.actions.shift--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.actions.shift--parameters" title="Permanent link">#</a></h3>
<p>velocity : Quantity
    The systemic velocity by which we should shift,
    with units of velocity (for example, u.km/u.s)</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/rainbows/actions/shift.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">shift</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">velocity</span><span class="o">=</span><span class="mi">0</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">km</span> <span class="o">/</span> <span class="n">u</span><span class="o">.</span><span class="n">s</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Doppler shift the wavelengths of this `Rainbow`.</span>

<span class="sd">    This shifts the wavelengths in a `Rainbow` by</span>
<span class="sd">    applying a velocity shift. Positive velocities make</span>
<span class="sd">    wavelengths longer (redshift); negative velocities make</span>
<span class="sd">    wavelengths shorter (bluesfhit).</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    velocity : Quantity</span>
<span class="sd">        The systemic velocity by which we should shift,</span>
<span class="sd">        with units of velocity (for example, u.km/u.s)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># create a history entry for this action (before other variables are defined)</span>
    <span class="n">h</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_history_entry</span><span class="p">(</span><span class="s2">&quot;shift&quot;</span><span class="p">,</span> <span class="nb">locals</span><span class="p">())</span>

    <span class="c1"># create a new copy of this rainbow</span>
    <span class="n">new</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_copy</span><span class="p">()</span>

    <span class="c1"># get the speed of light from astropy constants</span>
    <span class="n">lightspeed</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s2">&quot;km/s&quot;</span><span class="p">)</span>  <span class="c1"># speed of light in km/s</span>

    <span class="c1"># calculate beta and make sure the units cancel</span>
    <span class="n">beta</span> <span class="o">=</span> <span class="p">(</span><span class="n">velocity</span> <span class="o">/</span> <span class="n">lightspeed</span><span class="p">)</span><span class="o">.</span><span class="n">decompose</span><span class="p">()</span>

    <span class="c1"># apply wavelength shift</span>
    <span class="n">new_wavelength</span> <span class="o">=</span> <span class="n">new</span><span class="o">.</span><span class="n">wavelength</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="n">beta</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">beta</span><span class="p">))</span>
    <span class="n">new</span><span class="o">.</span><span class="n">wavelike</span><span class="p">[</span><span class="s2">&quot;wavelength&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_wavelength</span>

    <span class="c1"># append the history entry to the new Rainbow</span>
    <span class="n">new</span><span class="o">.</span><span class="n">_record_history_entry</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>

    <span class="c1"># return the new object</span>
    <span class="k">return</span> <span class="n">new</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">



<a id="chromatic.rainbows.actions.trim"></a>
    <div class="doc doc-contents first">

        <p>Trim away bad wavelengths and/or times.</p>
<p>If entire wavelengths or times are marked as not <code>ok</code>,
we can probably remove them to simplify calculations
and visualizations. This function will trim those away,
by default only removing problem rows/columns on the ends,
to maintain a contiguous block.</p>
<h3 id="chromatic.rainbows.actions.trim--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.actions.trim--parameters" title="Permanent link">#</a></h3>
<p>t_min : u.Quantity
    The minimum time to keep.
t_max : u.Quantity
    The maximum time to keep.
w_min : u.Quantity
    The minimum wavelength to keep.
w_max : u.Quantity
    The maximum wavelength to keep.
just_edges : bool, optional
    Should we only trim the outermost bad wavelength bins?
        <code>True</code> = Just trim off the bad edges and keep
        interior bad values. Keeping interior data, even if
        they're all bad, often helps to make for more
        intuititive imshow plots.
        <code>False</code> = Trim off every bad wavelength, whether it's on
        the edge or somewhere in the middle of the dataset.
        The resulting Rainbow will be smaller, but it might
        be a little tricky to visualize with imshow.
when_to_give_up : float, optional
    The fraction of times that must be nan or not OK
    for the entire wavelength to be considered bad (default = 1).
        <code>1.0</code> = trim only if all times are bad
        <code>0.5</code> = trim if more than 50% of times are bad
        <code>0.0</code> = trim if any times are bad
minimum_acceptable_ok : float, optional
    The numbers in the <code>.ok</code> attribute express "how OK?" each
    data point is, ranging from 0 (not OK) to 1 (super OK).
    In most cases, <code>.ok</code> will be binary, but there may be times
    where it's intermediate (for example, if a bin was created
    from some data that were not OK and some that were).
    The <code>minimum_acceptable_ok</code> parameter allows you to specify what
    level of OK-ness for a point to not get trimmed.</p>
<h3 id="chromatic.rainbows.actions.trim--returns">Returns<a class="headerlink" href="#chromatic.rainbows.actions.trim--returns" title="Permanent link">#</a></h3>
<p>trimmed : Rainbow
    The trimmed <code>Rainbow</code>.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/rainbows/actions/trim.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">trim</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">t_min</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">t_max</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">w_min</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">w_max</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">just_edges</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">when_to_give_up</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">minimum_acceptable_ok</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Trim away bad wavelengths and/or times.</span>

<span class="sd">    If entire wavelengths or times are marked as not `ok`,</span>
<span class="sd">    we can probably remove them to simplify calculations</span>
<span class="sd">    and visualizations. This function will trim those away,</span>
<span class="sd">    by default only removing problem rows/columns on the ends,</span>
<span class="sd">    to maintain a contiguous block.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    t_min : u.Quantity</span>
<span class="sd">        The minimum time to keep.</span>
<span class="sd">    t_max : u.Quantity</span>
<span class="sd">        The maximum time to keep.</span>
<span class="sd">    w_min : u.Quantity</span>
<span class="sd">        The minimum wavelength to keep.</span>
<span class="sd">    w_max : u.Quantity</span>
<span class="sd">        The maximum wavelength to keep.</span>
<span class="sd">    just_edges : bool, optional</span>
<span class="sd">        Should we only trim the outermost bad wavelength bins?</span>
<span class="sd">            `True` = Just trim off the bad edges and keep</span>
<span class="sd">            interior bad values. Keeping interior data, even if</span>
<span class="sd">            they&#39;re all bad, often helps to make for more</span>
<span class="sd">            intuititive imshow plots.</span>
<span class="sd">            `False` = Trim off every bad wavelength, whether it&#39;s on</span>
<span class="sd">            the edge or somewhere in the middle of the dataset.</span>
<span class="sd">            The resulting Rainbow will be smaller, but it might</span>
<span class="sd">            be a little tricky to visualize with imshow.</span>
<span class="sd">    when_to_give_up : float, optional</span>
<span class="sd">        The fraction of times that must be nan or not OK</span>
<span class="sd">        for the entire wavelength to be considered bad (default = 1).</span>
<span class="sd">            `1.0` = trim only if all times are bad</span>
<span class="sd">            `0.5` = trim if more than 50% of times are bad</span>
<span class="sd">            `0.0` = trim if any times are bad</span>
<span class="sd">    minimum_acceptable_ok : float, optional</span>
<span class="sd">        The numbers in the `.ok` attribute express &quot;how OK?&quot; each</span>
<span class="sd">        data point is, ranging from 0 (not OK) to 1 (super OK).</span>
<span class="sd">        In most cases, `.ok` will be binary, but there may be times</span>
<span class="sd">        where it&#39;s intermediate (for example, if a bin was created</span>
<span class="sd">        from some data that were not OK and some that were).</span>
<span class="sd">        The `minimum_acceptable_ok` parameter allows you to specify what</span>
<span class="sd">        level of OK-ness for a point to not get trimmed.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    trimmed : Rainbow</span>
<span class="sd">        The trimmed `Rainbow`.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">trimmed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trim_times</span><span class="p">(</span>
        <span class="n">t_min</span><span class="o">=</span><span class="n">t_min</span><span class="p">,</span>
        <span class="n">t_max</span><span class="o">=</span><span class="n">t_max</span><span class="p">,</span>
        <span class="n">when_to_give_up</span><span class="o">=</span><span class="n">when_to_give_up</span><span class="p">,</span>
        <span class="n">just_edges</span><span class="o">=</span><span class="n">just_edges</span><span class="p">,</span>
        <span class="n">minimum_acceptable_ok</span><span class="o">=</span><span class="n">minimum_acceptable_ok</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">trimmed</span> <span class="o">=</span> <span class="n">trimmed</span><span class="o">.</span><span class="n">trim_wavelengths</span><span class="p">(</span>
        <span class="n">w_min</span><span class="o">=</span><span class="n">w_min</span><span class="p">,</span>
        <span class="n">w_max</span><span class="o">=</span><span class="n">w_max</span><span class="p">,</span>
        <span class="n">when_to_give_up</span><span class="o">=</span><span class="n">when_to_give_up</span><span class="p">,</span>
        <span class="n">just_edges</span><span class="o">=</span><span class="n">just_edges</span><span class="p">,</span>
        <span class="n">minimum_acceptable_ok</span><span class="o">=</span><span class="n">minimum_acceptable_ok</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">trimmed</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div><h2 id="gettimelike">🌈 Get/Timelike<a class="headerlink" href="#gettimelike" title="Permanent link">#</a></h2>


<div class="doc doc-object doc-module">



<a id="chromatic.rainbows.get.timelike.average_lightcurve"></a>
    <div class="doc doc-contents first">









  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.get.timelike.average_lightcurve.bintoR" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">bintoR</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">unc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">R</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">weighting</span><span class="o">=</span><span class="s1">&#39;inversevariance&#39;</span><span class="p">,</span> <span class="n">drop_nans</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.get.timelike.average_lightcurve.bintoR" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Bin any x and y array onto a logarithmicly uniform grid.</p>
<h4 id="chromatic.rainbows.get.timelike.average_lightcurve.bintoR--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.get.timelike.average_lightcurve.bintoR--parameters" title="Permanent link">#</a></h4>
<p>x : array
    The original independent variable.
    (For a spectrum example = wavelength)
y : array
    The original dependent variable (same size as x).
    (For a spectrum example = flux)
unc : array, None, optional
    The unceratinty on the dependent variable
    (For a spectrum example = the flux uncertainty)
R : array, optional
    The spectral resolution R=x/dx for creating a new,
    logarithmically uniform grid that starts at the first
    value of x.
xlim : list, array, optional
    A two-element list indicating the min and max values of
    x for the new logarithmically spaced grid. If None,
    these limits will be created from the data themselves
weighting : str, optional
    How should we weight values when averaging
    them together into one larger bin?
    <code>weighting = 'inversevariance'</code>
        weights = 1/unc**2
     <code>weighting = {literally anything else}</code>
        uniform weights
    This will have no impact if <code>unc == None</code>, or for any
    new bins that effectively overlap less than one original
    unbinned point.
drop_nans : bool, optional
    Should we skip any bins turn out to be nans?
    This most often happens when bins are empty.</p>
<h4 id="chromatic.rainbows.get.timelike.average_lightcurve.bintoR--returns">Returns<a class="headerlink" href="#chromatic.rainbows.get.timelike.average_lightcurve.bintoR--returns" title="Permanent link">#</a></h4>
<p>result : dict
    A dictionary containing at least...
        <code>x</code> = the center of the output grid
        <code>y</code> = the resampled value on the output grid
        <code>x_edge_lower</code> = the lower edges of the output grid
        <code>x_edge_upper</code> = the upper edges of the output grid
    ...and possibly also
        <code>uncertainty</code> = the calculated uncertainty per bin</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/tools/resampling.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">bintoR</span><span class="p">(</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">unc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">R</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">weighting</span><span class="o">=</span><span class="s2">&quot;inversevariance&quot;</span><span class="p">,</span> <span class="n">drop_nans</span><span class="o">=</span><span class="kc">True</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Bin any x and y array onto a logarithmicly uniform grid.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : array</span>
<span class="sd">        The original independent variable.</span>
<span class="sd">        (For a spectrum example = wavelength)</span>
<span class="sd">    y : array</span>
<span class="sd">        The original dependent variable (same size as x).</span>
<span class="sd">        (For a spectrum example = flux)</span>
<span class="sd">    unc : array, None, optional</span>
<span class="sd">        The unceratinty on the dependent variable</span>
<span class="sd">        (For a spectrum example = the flux uncertainty)</span>
<span class="sd">    R : array, optional</span>
<span class="sd">        The spectral resolution R=x/dx for creating a new,</span>
<span class="sd">        logarithmically uniform grid that starts at the first</span>
<span class="sd">        value of x.</span>
<span class="sd">    xlim : list, array, optional</span>
<span class="sd">        A two-element list indicating the min and max values of</span>
<span class="sd">        x for the new logarithmically spaced grid. If None,</span>
<span class="sd">        these limits will be created from the data themselves</span>
<span class="sd">    weighting : str, optional</span>
<span class="sd">        How should we weight values when averaging</span>
<span class="sd">        them together into one larger bin?</span>
<span class="sd">        `weighting = &#39;inversevariance&#39;`</span>
<span class="sd">            weights = 1/unc**2</span>
<span class="sd">         `weighting = {literally anything else}`</span>
<span class="sd">            uniform weights</span>
<span class="sd">        This will have no impact if `unc == None`, or for any</span>
<span class="sd">        new bins that effectively overlap less than one original</span>
<span class="sd">        unbinned point.</span>
<span class="sd">    drop_nans : bool, optional</span>
<span class="sd">        Should we skip any bins turn out to be nans?</span>
<span class="sd">        This most often happens when bins are empty.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    result : dict</span>
<span class="sd">        A dictionary containing at least...</span>
<span class="sd">            `x` = the center of the output grid</span>
<span class="sd">            `y` = the resampled value on the output grid</span>
<span class="sd">            `x_edge_lower` = the lower edges of the output grid</span>
<span class="sd">            `x_edge_upper` = the upper edges of the output grid</span>
<span class="sd">        ...and possibly also</span>
<span class="sd">            `uncertainty` = the calculated uncertainty per bin</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">x_unit</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">unit</span>
        <span class="n">x_without_unit</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">value</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="n">x_unit</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">x_without_unit</span> <span class="o">=</span> <span class="n">x</span>

    <span class="c1"># create a new grid of x at the given resolution</span>
    <span class="n">lnx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">x_without_unit</span><span class="p">)</span>
    <span class="n">dnewlnx</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">R</span>

    <span class="c1"># set the limits of the new xgrid (in log space)</span>
    <span class="k">if</span> <span class="n">xlim</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># use the input grid to set the limits</span>
        <span class="n">lnxbottom</span><span class="p">,</span> <span class="n">lnxtop</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">lnx</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">lnx</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># use the custom xlim to set the limits</span>
        <span class="n">lnxbottom</span><span class="p">,</span> <span class="n">lnxtop</span> <span class="o">=</span> <span class="n">xlim</span>

    <span class="c1"># create a new, log-uniform grid of x values</span>
    <span class="n">newlnx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">lnxbottom</span><span class="p">,</span> <span class="n">lnxtop</span> <span class="o">+</span> <span class="n">dnewlnx</span><span class="p">,</span> <span class="n">dnewlnx</span><span class="p">)</span>

    <span class="c1"># now do the binning on a uniform grid of lnx</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">bintogrid</span><span class="p">(</span>
        <span class="n">lnx</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">unc</span><span class="p">,</span> <span class="n">newx</span><span class="o">=</span><span class="n">newlnx</span><span class="p">,</span> <span class="n">weighting</span><span class="o">=</span><span class="n">weighting</span><span class="p">,</span> <span class="n">drop_nans</span><span class="o">=</span><span class="n">drop_nans</span>
    <span class="p">)</span>

    <span class="c1"># convert back from log to real values</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;x_edge_lower&quot;</span><span class="p">,</span> <span class="s2">&quot;x_edge_upper&quot;</span><span class="p">]:</span>
        <span class="n">result</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="o">*</span> <span class="n">x_unit</span>

    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.get.timelike.average_lightcurve.bintogrid" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">bintogrid</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">unc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">newx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">newx_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">nx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">weighting</span><span class="o">=</span><span class="s1">&#39;inversevariance&#39;</span><span class="p">,</span> <span class="n">drop_nans</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">x_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">visualize</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.get.timelike.average_lightcurve.bintogrid" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Bin any x and y array onto a linearly uniform grid.</p>
<h4 id="chromatic.rainbows.get.timelike.average_lightcurve.bintogrid--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.get.timelike.average_lightcurve.bintogrid--parameters" title="Permanent link">#</a></h4>
<p>x : array
    The original independent variable.
    (For a spectrum example = wavelength)
y : array
    The original dependent variable (same size as x).
    (For a spectrum example = flux)
unc : array, None
    The unceratinty on the dependent variable
    (For a spectrum example = the flux uncertainty)
nx : array
    The number of bins from the original grid to
    bin together into the new one.
dx : array
    The fixed spacing for creating a new, linearly uniform
    grid that start at the first value of x. This will
    be ignored if <code>newx</code> != None.
newx : array
    A new custom grid onto which we should bin.
newx_edges : array
    The edges of the new grid of bins for the independent
    variable, onto which you want to resample the y
    values. The left and right edges of the bins will be,
    respectively, <code>newx_edges[:-1]</code> and <code>newx_edges[1:]</code>,
    so the size of the output array will be
    <code>len(newx_edges) - 1</code>
weighting : str
    How should we weight values when averaging
    them together into one larger bin?
    <code>weighting = 'inversevariance'</code>
        weights = 1/unc**2
     <code>weighting = {literally anything else}</code>
        uniform weights
    This will have no impact if <code>unc == None</code>, or for any
    new bins that effectively overlap less than one original
    unbinned point.
drop_nans : bool
    Should we skip any bins turn out to be nans?
    This most often happens when bins are empty.
x_edges : array
    The edges of the original independent variable bins.
    The left and right edges of the bins are interpreted
    to be <code>x_edges[:-1]</code> and <code>x_edges[1:]</code>,
    respectively, so the associated <code>y</code> should have exactly
    1 fewer element than <code>x_edges</code>. This provides finer
    control over the size of each bin in the input than
    simply supplying <code>x</code>(still a little experimental)</p>
<h4 id="chromatic.rainbows.get.timelike.average_lightcurve.bintogrid--returns">Returns<a class="headerlink" href="#chromatic.rainbows.get.timelike.average_lightcurve.bintogrid--returns" title="Permanent link">#</a></h4>
<p>result : dict
    A dictionary containing at least...
        <code>x</code> = the center of the output grid
        <code>y</code> = the resampled value on the output grid
        <code>x_edge_lower</code> = the lower edges of the output grid
        <code>x_edge_upper</code> = the upper edges of the output grid
    ...and possibly also
        <code>uncertainty</code> = the calculated uncertainty per bin</p>
<p>The order of precendence for setting the new grid is
[<code>newx_edges</code>, <code>newx</code>, <code>dx</code>, <code>nx</code>]
The first will be used, and others will be ignored.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/tools/resampling.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">bintogrid</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">unc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">newx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">newx_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">dx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">nx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">weighting</span><span class="o">=</span><span class="s2">&quot;inversevariance&quot;</span><span class="p">,</span>
    <span class="n">drop_nans</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">x_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">visualize</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Bin any x and y array onto a linearly uniform grid.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : array</span>
<span class="sd">        The original independent variable.</span>
<span class="sd">        (For a spectrum example = wavelength)</span>
<span class="sd">    y : array</span>
<span class="sd">        The original dependent variable (same size as x).</span>
<span class="sd">        (For a spectrum example = flux)</span>
<span class="sd">    unc : array, None</span>
<span class="sd">        The unceratinty on the dependent variable</span>
<span class="sd">        (For a spectrum example = the flux uncertainty)</span>
<span class="sd">    nx : array</span>
<span class="sd">        The number of bins from the original grid to</span>
<span class="sd">        bin together into the new one.</span>
<span class="sd">    dx : array</span>
<span class="sd">        The fixed spacing for creating a new, linearly uniform</span>
<span class="sd">        grid that start at the first value of x. This will</span>
<span class="sd">        be ignored if `newx` != None.</span>
<span class="sd">    newx : array</span>
<span class="sd">        A new custom grid onto which we should bin.</span>
<span class="sd">    newx_edges : array</span>
<span class="sd">        The edges of the new grid of bins for the independent</span>
<span class="sd">        variable, onto which you want to resample the y</span>
<span class="sd">        values. The left and right edges of the bins will be,</span>
<span class="sd">        respectively, `newx_edges[:-1]` and `newx_edges[1:]`,</span>
<span class="sd">        so the size of the output array will be</span>
<span class="sd">        `len(newx_edges) - 1`</span>
<span class="sd">    weighting : str</span>
<span class="sd">        How should we weight values when averaging</span>
<span class="sd">        them together into one larger bin?</span>
<span class="sd">        `weighting = &#39;inversevariance&#39;`</span>
<span class="sd">            weights = 1/unc**2</span>
<span class="sd">         `weighting = {literally anything else}`</span>
<span class="sd">            uniform weights</span>
<span class="sd">        This will have no impact if `unc == None`, or for any</span>
<span class="sd">        new bins that effectively overlap less than one original</span>
<span class="sd">        unbinned point.</span>
<span class="sd">    drop_nans : bool</span>
<span class="sd">        Should we skip any bins turn out to be nans?</span>
<span class="sd">        This most often happens when bins are empty.</span>
<span class="sd">    x_edges : array</span>
<span class="sd">        The edges of the original independent variable bins.</span>
<span class="sd">        The left and right edges of the bins are interpreted</span>
<span class="sd">        to be `x_edges[:-1]` and `x_edges[1:]`,</span>
<span class="sd">        respectively, so the associated `y` should have exactly</span>
<span class="sd">        1 fewer element than `x_edges`. This provides finer</span>
<span class="sd">        control over the size of each bin in the input than</span>
<span class="sd">        simply supplying `x`(still a little experimental)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    result : dict</span>
<span class="sd">        A dictionary containing at least...</span>
<span class="sd">            `x` = the center of the output grid</span>
<span class="sd">            `y` = the resampled value on the output grid</span>
<span class="sd">            `x_edge_lower` = the lower edges of the output grid</span>
<span class="sd">            `x_edge_upper` = the upper edges of the output grid</span>
<span class="sd">        ...and possibly also</span>
<span class="sd">            `uncertainty` = the calculated uncertainty per bin</span>


<span class="sd">    The order of precendence for setting the new grid is</span>
<span class="sd">    [`newx_edges`, `newx`, `dx`, `nx`]</span>
<span class="sd">    The first will be used, and others will be ignored.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># check that an OK set of inputs has been supplied</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">x_edges</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;🌈 Both `x` and `x_edges` were supplied to `bintogrid`. Confusing!&quot;&quot;&quot;</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">x_edges</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;🌈 At least one of `x` or `x_edges` must be supplied to `bintogrid`.&quot;&quot;&quot;</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="n">y</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;🌈 `y` must be supplied to `bintogrid`.&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="c1"># make sure the edges and the centers are set</span>
    <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">x_left</span><span class="p">,</span> <span class="n">x_right</span> <span class="o">=</span> <span class="n">edges_to_leftright</span><span class="p">(</span><span class="n">x_edges</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">left</span> <span class="o">+</span> <span class="n">right</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">x_left</span><span class="p">,</span> <span class="n">x_right</span> <span class="o">=</span> <span class="n">calculate_bin_leftright</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">x_edges</span> <span class="o">=</span> <span class="n">leftright_to_edges</span><span class="p">(</span><span class="n">x_left</span><span class="p">,</span> <span class="n">x_right</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">x_unit</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">unit</span>
        <span class="n">x_without_unit</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">value</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="n">x_unit</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">x_without_unit</span> <span class="o">=</span> <span class="n">x</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">y_unit</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">unit</span>
        <span class="n">y_without_unit</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">value</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="n">y_unit</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">y_without_unit</span> <span class="o">=</span> <span class="n">y</span>

    <span class="c1"># warn if multiple inputs are provided</span>
    <span class="n">number_of_grid_options</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span><span class="n">z</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="p">[</span><span class="n">newx_edges</span><span class="p">,</span> <span class="n">newx</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">nx</span><span class="p">]])</span>
    <span class="k">if</span> <span class="n">number_of_grid_options</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">cheerfully_suggest</span><span class="p">(</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;More than one output grid sent to `bintogrid`.</span>
<span class="sd">                         The one being used is the first to appear in</span>
<span class="sd">                         [`newx_edges`, `newx`, `dx`, `nx`]</span>
<span class="sd">                         but you might want to choose more carefully.&quot;&quot;&quot;</span>
        <span class="p">)</span>

    <span class="c1"># define inputs based on the following order</span>
    <span class="k">if</span> <span class="n">newx_edges</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># define grid by its edges (and define others from there)</span>
        <span class="n">newx_edges_without_unit</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">newx_edges</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">x_unit</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
        <span class="n">dx_without_unit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">newx_edges_without_unit</span><span class="p">)</span>
        <span class="n">newx_without_unit</span> <span class="o">=</span> <span class="n">newx_edges_without_unit</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">dx_without_unit</span>
        <span class="n">newx_left_without_unit</span> <span class="o">=</span> <span class="n">newx_edges_without_unit</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">newx_right_without_unit</span> <span class="o">=</span> <span class="n">newx_edges_without_unit</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

        <span class="c1"># make sure the final output grid is defined</span>
        <span class="n">final_newx</span><span class="p">,</span> <span class="n">final_newx_left</span><span class="p">,</span> <span class="n">final_newx_right</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">newx_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
            <span class="n">newx_left_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
            <span class="n">newx_right_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="n">newx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># define grid by its centers (and define others from there)</span>
        <span class="n">newx_without_unit</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">newx</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">x_unit</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
        <span class="n">newx_left_without_unit</span><span class="p">,</span> <span class="n">newx_right_without_unit</span> <span class="o">=</span> <span class="n">calculate_bin_leftright</span><span class="p">(</span>
            <span class="n">newx_without_unit</span>
        <span class="p">)</span>
        <span class="n">newx_edges_without_unit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span>
            <span class="p">[</span><span class="n">newx_left_without_unit</span><span class="p">,</span> <span class="n">newx_right_without_unit</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
        <span class="p">)</span>
        <span class="n">dx_without_unit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">newx_edges_without_unit</span><span class="p">)</span>

        <span class="c1"># make sure the final output grid is defined</span>
        <span class="n">final_newx</span><span class="p">,</span> <span class="n">final_newx_left</span><span class="p">,</span> <span class="n">final_newx_right</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">newx_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
            <span class="n">newx_left_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
            <span class="n">newx_right_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="n">dx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># define grid by a bin width (and define others from there)</span>
        <span class="n">dx_without_unit</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">dx</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">x_unit</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
        <span class="n">newx_without_unit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">x_without_unit</span><span class="p">),</span>
            <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">x_without_unit</span><span class="p">)</span> <span class="o">+</span> <span class="n">dx_without_unit</span><span class="p">,</span>
            <span class="n">dx_without_unit</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">newx_left_without_unit</span><span class="p">,</span> <span class="n">newx_right_without_unit</span> <span class="o">=</span> <span class="n">calculate_bin_leftright</span><span class="p">(</span>
            <span class="n">newx_without_unit</span>
        <span class="p">)</span>
        <span class="n">newx_edges_without_unit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span>
            <span class="p">[</span><span class="n">newx_left_without_unit</span><span class="p">,</span> <span class="n">newx_right_without_unit</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
        <span class="p">)</span>

        <span class="c1"># make sure the final output grid is defined</span>
        <span class="n">final_newx</span><span class="p">,</span> <span class="n">final_newx_left</span><span class="p">,</span> <span class="n">final_newx_right</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">newx_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
            <span class="n">newx_left_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
            <span class="n">newx_right_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">elif</span> <span class="n">nx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># keep track of the original input x values</span>
        <span class="n">original_x_without_unit</span> <span class="o">=</span> <span class="n">x_without_unit</span>

        <span class="c1"># redefine the input x to indices, to do interpolation in index space</span>
        <span class="n">x_without_unit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">x_without_unit</span><span class="p">))</span>

        <span class="c1"># define a grid of edges that will enclose the right number of indices</span>
        <span class="n">x_left_i</span><span class="p">,</span> <span class="n">x_right_i</span> <span class="o">=</span> <span class="n">calculate_bin_leftright</span><span class="p">(</span><span class="n">x_without_unit</span><span class="p">)</span>
        <span class="n">newx_edges_without_unit</span> <span class="o">=</span> <span class="n">leftright_to_edges</span><span class="p">(</span><span class="n">x_left_i</span><span class="p">,</span> <span class="n">x_right_i</span><span class="p">)[::</span><span class="n">nx</span><span class="p">]</span>
        <span class="n">newx_without_unit</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span>
            <span class="n">newx_edges_without_unit</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">+</span> <span class="n">newx_edges_without_unit</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="p">)</span>

        <span class="c1"># calculate the actual x values corresponding to the bins</span>
        <span class="n">original_edges</span> <span class="o">=</span> <span class="n">leftright_to_edges</span><span class="p">(</span>
            <span class="o">*</span><span class="n">calculate_bin_leftright</span><span class="p">(</span><span class="n">original_x_without_unit</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">final_edges</span> <span class="o">=</span> <span class="n">original_edges</span><span class="p">[::</span><span class="n">nx</span><span class="p">]</span> <span class="o">*</span> <span class="n">x_unit</span>
        <span class="n">final_newx_left</span><span class="p">,</span> <span class="n">final_newx_right</span> <span class="o">=</span> <span class="n">edges_to_leftright</span><span class="p">(</span><span class="n">final_edges</span><span class="p">)</span>
        <span class="n">final_newx</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">final_newx_left</span> <span class="o">+</span> <span class="n">final_newx_right</span><span class="p">)</span>
        <span class="n">dx_without_unit</span> <span class="o">=</span> <span class="p">(</span><span class="n">final_newx_right</span> <span class="o">-</span> <span class="n">final_newx_left</span><span class="p">)</span> <span class="o">/</span> <span class="n">x_unit</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;No output grid sent to `bintogrid`.</span>
<span class="sd">                              Please choose one of the following:</span>
<span class="sd">                              [`newx_edges`, `newx`, `dx`, `nx`]&quot;&quot;&quot;</span>
        <span class="p">)</span>

    <span class="c1"># don&#39;t complain about zero-divisions in here (to allow infinite uncertainties)</span>
    <span class="k">with</span> <span class="n">np</span><span class="o">.</span><span class="n">errstate</span><span class="p">(</span><span class="n">divide</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">invalid</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">):</span>

        <span class="c1"># calculate weight integrals for the bin array</span>
        <span class="n">ok</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">y_without_unit</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span>

        <span class="c1"># resample the sums onto that new grid</span>
        <span class="k">if</span> <span class="n">unc</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">x_without_unit</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">weighting</span> <span class="o">==</span> <span class="s2">&quot;inversevariance&quot;</span><span class="p">:</span>
                <span class="n">weights</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">unc</span><span class="o">**</span><span class="mi">2</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">x_without_unit</span><span class="p">)</span>

            <span class="c1"># ignore infinite weights (= 0 uncertainties)</span>
            <span class="n">ok</span> <span class="o">*=</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">ok</span><span class="p">):</span>
            <span class="n">numerator</span> <span class="o">=</span> <span class="n">resample_while_conserving_flux</span><span class="p">(</span>
                <span class="n">xin</span><span class="o">=</span><span class="n">x_without_unit</span><span class="p">[</span><span class="n">ok</span><span class="p">],</span>
                <span class="n">yin</span><span class="o">=</span><span class="p">(</span><span class="n">y_without_unit</span> <span class="o">*</span> <span class="n">weights</span><span class="p">)[</span><span class="n">ok</span><span class="p">],</span>
                <span class="n">xout_edges</span><span class="o">=</span><span class="n">newx_edges_without_unit</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">denominator</span> <span class="o">=</span> <span class="n">resample_while_conserving_flux</span><span class="p">(</span>
                <span class="n">xin</span><span class="o">=</span><span class="n">x_without_unit</span><span class="p">[</span><span class="n">ok</span><span class="p">],</span>
                <span class="n">yin</span><span class="o">=</span><span class="n">weights</span><span class="p">[</span><span class="n">ok</span><span class="p">],</span>
                <span class="n">xout_edges</span><span class="o">=</span><span class="n">newx_edges_without_unit</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="c1"># the binned weighted means on the new grid</span>
            <span class="n">newy</span> <span class="o">=</span> <span class="n">numerator</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">denominator</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span>

            <span class="c1"># the standard error on the means, for those bins</span>
            <span class="n">newunc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">denominator</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">])</span>

            <span class="c1"># keep track of the number of original bins going into each new bin</span>
            <span class="n">number_of_original_bins_per_new_bin</span> <span class="o">=</span> <span class="n">resample_while_conserving_flux</span><span class="p">(</span>
                <span class="n">xin</span><span class="o">=</span><span class="n">x_without_unit</span><span class="p">[</span><span class="n">ok</span><span class="p">],</span>
                <span class="n">yin</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">y_without_unit</span><span class="p">)[</span><span class="n">ok</span><span class="p">],</span>
                <span class="n">xout_edges</span><span class="o">=</span><span class="n">newx_edges_without_unit</span><span class="p">,</span>
            <span class="p">)[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">newy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="o">*</span> <span class="n">newx_without_unit</span>
            <span class="n">newunc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="o">*</span> <span class="n">newx_without_unit</span>
            <span class="n">number_of_original_bins_per_new_bin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">newx_without_unit</span><span class="p">)</span>

    <span class="c1"># remove any empty bins</span>
    <span class="k">if</span> <span class="n">drop_nans</span><span class="p">:</span>
        <span class="n">ok</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">newy</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ok</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">newx_without_unit</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>

    <span class="c1"># if no uncertainties were given, don&#39;t return uncertainties</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># populate the new grid centers + edges + values</span>
    <span class="n">result</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">final_newx</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span>
    <span class="n">result</span><span class="p">[</span><span class="s2">&quot;x_edge_lower&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">final_newx_left</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span>
    <span class="n">result</span><span class="p">[</span><span class="s2">&quot;x_edge_upper&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">final_newx_right</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span>

    <span class="c1"># populate the new grid values</span>
    <span class="n">result</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">newy</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span> <span class="o">*</span> <span class="n">y_unit</span>

    <span class="c1"># populate the new grid value uncertainties</span>
    <span class="k">if</span> <span class="n">unc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">result</span><span class="p">[</span><span class="s2">&quot;uncertainty&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">newunc</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span> <span class="o">*</span> <span class="n">y_unit</span>

    <span class="c1"># store how many of the original pixels made it into this new one</span>
    <span class="n">result</span><span class="p">[</span><span class="s2">&quot;N_unbinned/N_binned&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">number_of_original_bins_per_new_bin</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">visualize</span><span class="p">:</span>
        <span class="n">fi</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span>
            <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">gridspec_kw</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">height_ratios</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">])</span>
        <span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">plot_as_boxes</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">xleft</span><span class="o">=</span><span class="n">x_left</span><span class="p">,</span> <span class="n">xright</span><span class="o">=</span><span class="n">x_right</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;silver&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">ekw</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">elinewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">unc</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;silver&quot;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">ekw</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">],</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">],</span>
            <span class="n">yerr</span><span class="o">=</span><span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;uncertainty&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
            <span class="n">xerr</span><span class="o">=</span><span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s2">&quot;x_edge_upper&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;x_edge_lower&quot;</span><span class="p">])</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
            <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
            <span class="n">zorder</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
            <span class="o">**</span><span class="n">ekw</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">plot_as_boxes</span><span class="p">(</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">],</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;N_unbinned/N_binned&quot;</span><span class="p">],</span>
            <span class="n">xleft</span><span class="o">=</span><span class="n">result</span><span class="p">[</span><span class="s2">&quot;x_edge_lower&quot;</span><span class="p">],</span>
            <span class="n">xright</span><span class="o">=</span><span class="n">result</span><span class="p">[</span><span class="s2">&quot;x_edge_upper&quot;</span><span class="p">],</span>
        <span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;$N_</span><span class="si">{unbinned}</span><span class="s2">/N_</span><span class="si">{binned}</span><span class="s2">$&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.get.timelike.average_lightcurve.calculate_bin_leftright" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">calculate_bin_leftright</span><span class="p">(</span><span class="n">x</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.get.timelike.average_lightcurve.calculate_bin_leftright" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>If x is an array of bin centers, calculate the bin edges.
(assumes outermost bins are same size as their neighbors)</p>
<h4 id="chromatic.rainbows.get.timelike.average_lightcurve.calculate_bin_leftright--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.get.timelike.average_lightcurve.calculate_bin_leftright--parameters" title="Permanent link">#</a></h4>
<p>x : array
    The array of bin centers.</p>
<h4 id="chromatic.rainbows.get.timelike.average_lightcurve.calculate_bin_leftright--returns">Returns<a class="headerlink" href="#chromatic.rainbows.get.timelike.average_lightcurve.calculate_bin_leftright--returns" title="Permanent link">#</a></h4>
<p>l : array
    The left edges of the bins.
r : array
    The right edges of the bins.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/tools/resampling.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">calculate_bin_leftright</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    If x is an array of bin centers, calculate the bin edges.</span>
<span class="sd">    (assumes outermost bins are same size as their neighbors)</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : array</span>
<span class="sd">        The array of bin centers.</span>

<span class="sd">    Returns</span>
<span class="sd">    ----------</span>
<span class="sd">    l : array</span>
<span class="sd">        The left edges of the bins.</span>
<span class="sd">    r : array</span>
<span class="sd">        The right edges of the bins.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># what are bin edges (making a guess for those on the ends)</span>
    <span class="c1"># xbinsize = calculate_bin_widths(x)</span>
    <span class="c1"># left = x - xbinsize / 2.0</span>
    <span class="c1"># right = x + xbinsize / 2.0</span>

    <span class="c1"># weird corner case!</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">left</span><span class="p">,</span> <span class="n">right</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">left</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">right</span><span class="p">])</span>

    <span class="n">inner_edges</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="n">x</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">first_edge</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="n">inner_edges</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">last_edge</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">inner_edges</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

    <span class="n">left</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">first_edge</span><span class="p">,</span> <span class="n">inner_edges</span><span class="p">])</span>
    <span class="n">right</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">inner_edges</span><span class="p">,</span> <span class="n">last_edge</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.get.timelike.average_lightcurve.edges_to_leftright" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">edges_to_leftright</span><span class="p">(</span><span class="n">edges</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.get.timelike.average_lightcurve.edges_to_leftright" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Convert N+1 contiguous edges to two arrays of N left/right edges.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/tools/resampling.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">edges_to_leftright</span><span class="p">(</span><span class="n">edges</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert N+1 contiguous edges to two arrays of N left/right edges.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">left</span><span class="p">,</span> <span class="n">right</span> <span class="o">=</span> <span class="n">edges</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">edges</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="k">return</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.get.timelike.average_lightcurve.expand_filenames" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">expand_filenames</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.get.timelike.average_lightcurve.expand_filenames" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>A wrapper to expand a string or list into a list of filenames.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/imports.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">expand_filenames</span><span class="p">(</span><span class="n">filepath</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A wrapper to expand a string or list into a list of filenames.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
        <span class="n">filenames</span> <span class="o">=</span> <span class="n">filepath</span>
    <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span> <span class="o">==</span> <span class="n">Column</span><span class="p">:</span>
        <span class="n">filenames</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>
    <span class="k">elif</span> <span class="s2">&quot;*&quot;</span> <span class="ow">in</span> <span class="n">filepath</span><span class="p">:</span>
        <span class="n">filenames</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">filepath</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">filenames</span> <span class="o">=</span> <span class="p">[</span><span class="n">filepath</span><span class="p">]</span>
    <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">filenames</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.get.timelike.average_lightcurve.get_average_lightcurve" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_average_lightcurve</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.get.timelike.average_lightcurve.get_average_lightcurve" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Return a lightcurve of the star, averaged over all wavelengths.</p>
<p>This uses <code>bin</code>, which is a horribly slow way of doing what is
fundamentally a very simply array calculation, because we
don't need to deal with partial pixels.</p>
<h4 id="chromatic.rainbows.get.timelike.average_lightcurve.get_average_lightcurve--returns">Returns<a class="headerlink" href="#chromatic.rainbows.get.timelike.average_lightcurve.get_average_lightcurve--returns" title="Permanent link">#</a></h4>
<p>lightcurve : array
    Timelike array of fluxes.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/rainbows/get/timelike/average_lightcurve.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_average_lightcurve</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return a lightcurve of the star, averaged over all wavelengths.</span>

<span class="sd">    This uses `bin`, which is a horribly slow way of doing what is</span>
<span class="sd">    fundamentally a very simply array calculation, because we</span>
<span class="sd">    don&#39;t need to deal with partial pixels.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    lightcurve : array</span>
<span class="sd">        Timelike array of fluxes.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_average_lightcurve_as_rainbow</span><span class="p">()</span><span class="o">.</span><span class="n">flux</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.get.timelike.average_lightcurve.leftright_to_edges" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">leftright_to_edges</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.get.timelike.average_lightcurve.leftright_to_edges" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Convert two arrays of N left/right edges to N+1 continugous edges.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/tools/resampling.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">leftright_to_edges</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert two arrays of N left/right edges to N+1 continugous edges.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">edges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>
    <span class="k">return</span> <span class="n">edges</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.get.timelike.average_lightcurve.name2color" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">name2color</span><span class="p">(</span><span class="n">name</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.get.timelike.average_lightcurve.name2color" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Return the 3-element RGB array of a given color name.</p>
<h4 id="chromatic.rainbows.get.timelike.average_lightcurve.name2color--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.get.timelike.average_lightcurve.name2color--parameters" title="Permanent link">#</a></h4>
<p>name : str
    The name of a color</p>
<h4 id="chromatic.rainbows.get.timelike.average_lightcurve.name2color--returns">Returns<a class="headerlink" href="#chromatic.rainbows.get.timelike.average_lightcurve.name2color--returns" title="Permanent link">#</a></h4>
<p>rgb : tuple
    3-element RGB color, with numbers from 0.0 to 1.0</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/imports.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">name2color</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return the 3-element RGB array of a given color name.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    name : str</span>
<span class="sd">        The name of a color</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    rgb : tuple</span>
<span class="sd">        3-element RGB color, with numbers from 0.0 to 1.0</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># give a friendly warning if the color name can&#39;t be found</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">color_hex</span> <span class="o">=</span> <span class="n">col</span><span class="o">.</span><span class="n">cnames</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">col</span><span class="o">.</span><span class="n">hex2color</span><span class="p">(</span><span class="n">color_hex</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="n">cheerfully_suggest</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The color </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> can&#39;t be found. (Returning black.)&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.get.timelike.average_lightcurve.one2another" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">one2another</span><span class="p">(</span><span class="n">bottom</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">alpha_bottom</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">alpha_top</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">256</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.get.timelike.average_lightcurve.one2another" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Create a cmap that goes smoothly (linearly in RGBA) from "bottom" to "top".</p>
<h4 id="chromatic.rainbows.get.timelike.average_lightcurve.one2another--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.get.timelike.average_lightcurve.one2another--parameters" title="Permanent link">#</a></h4>
<p>bottom : str
    Name of a color for the bottom of cmap (0.0)
top : str
    Name of a color for the top of the cmap (1.0)
alpha_bottom : float
    Opacity at the bottom of the cmap
alpha_top : float
    Opacitiy at the top of the cmap
N : int
    The number of levels in the listed color map</p>
<h4 id="chromatic.rainbows.get.timelike.average_lightcurve.one2another--returns">Returns<a class="headerlink" href="#chromatic.rainbows.get.timelike.average_lightcurve.one2another--returns" title="Permanent link">#</a></h4>
<p>cmap : Colormap
    A color map that goes linearly from the
    bottom to top color (and alpha).</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/imports.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">one2another</span><span class="p">(</span><span class="n">bottom</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">alpha_bottom</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">alpha_top</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">256</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a cmap that goes smoothly (linearly in RGBA) from &quot;bottom&quot; to &quot;top&quot;.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    bottom : str</span>
<span class="sd">        Name of a color for the bottom of cmap (0.0)</span>
<span class="sd">    top : str</span>
<span class="sd">        Name of a color for the top of the cmap (1.0)</span>
<span class="sd">    alpha_bottom : float</span>
<span class="sd">        Opacity at the bottom of the cmap</span>
<span class="sd">    alpha_top : float</span>
<span class="sd">        Opacitiy at the top of the cmap</span>
<span class="sd">    N : int</span>
<span class="sd">        The number of levels in the listed color map</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    cmap : Colormap</span>
<span class="sd">        A color map that goes linearly from the</span>
<span class="sd">        bottom to top color (and alpha).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># get the RGB values of the bottom and top of the cmap</span>
    <span class="n">rgb_bottom</span><span class="p">,</span> <span class="n">rgb_top</span> <span class="o">=</span> <span class="n">name2color</span><span class="p">(</span><span class="n">bottom</span><span class="p">),</span> <span class="n">name2color</span><span class="p">(</span><span class="n">top</span><span class="p">)</span>

    <span class="c1"># create linear gradients for all four RGBA channels</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">rgb_bottom</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">rgb_top</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">N</span><span class="p">)</span>
    <span class="n">g</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">rgb_bottom</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">rgb_top</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">N</span><span class="p">)</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">rgb_bottom</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">rgb_top</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">N</span><span class="p">)</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">alpha_bottom</span><span class="p">,</span> <span class="n">alpha_top</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>

    <span class="c1"># create (N,4) array + populate a listed colormap</span>
    <span class="n">colors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">]))</span>
    <span class="n">cmap</span> <span class="o">=</span> <span class="n">col</span><span class="o">.</span><span class="n">ListedColormap</span><span class="p">(</span><span class="n">colors</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{bottom}</span><span class="s2">2</span><span class="si">{top}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="nb">locals</span><span class="p">()))</span>

    <span class="c1"># return the colormap</span>
    <span class="k">return</span> <span class="n">cmap</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.get.timelike.average_lightcurve.remove_unit" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">remove_unit</span><span class="p">(</span><span class="n">x</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.get.timelike.average_lightcurve.remove_unit" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Quick wrapper to remove the unit from a quantity,
but not complain if it doesn't have one.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/imports.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">remove_unit</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Quick wrapper to remove the unit from a quantity,</span>
<span class="sd">    but not complain if it doesn&#39;t have one.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">x</span><span class="o">.</span><span class="n">value</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">x</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.get.timelike.average_lightcurve.resample_while_conserving_flux" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">resample_while_conserving_flux</span><span class="p">(</span><span class="n">xin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">yin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xout</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xin_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xout_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">replace_nans</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">visualize</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">pause</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.get.timelike.average_lightcurve.resample_while_conserving_flux" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Starting from some initial x and y, resample onto a
different grid (either higher or lower resolution),
while conserving total flux.</p>
<p>When including the entire range of <code>xin</code>,
<code>sum(yout) == sum(yin)</code> should be true.</p>
<p>When including only part of the range of <code>xin</code>,
the integral between any two points should be conserved.</p>
<h4 id="chromatic.rainbows.get.timelike.average_lightcurve.resample_while_conserving_flux--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.get.timelike.average_lightcurve.resample_while_conserving_flux--parameters" title="Permanent link">#</a></h4>
<p>xin : array
    The original independent variable.
yin : array
    The original dependent variable (same size as x).
xout : array
    The new grid of independent variables onto which
    you want to resample the y values. Refers to the
    center of each bin (use <code>xout_edges</code> for finer
    control over the exact edges of the bins)
xin_edges : array
    The edges of the original independent variable bins.
    The left and right edges of the bins are interpreted
    to be <code>xin_edges[:-1]</code> and <code>xin_edges[1:]</code>,
    respectively, so the associated <code>yin</code> should have exactly
    1 fewer element than <code>xin_edges</code>. This provides finer
    control over the size of each bin in the input than
    simply supplying <code>xin</code>(still a little experimental)
    They should probably be sorted?
xout_edges : array
    The edges of the new grid of bins for the independent
    variable, onto which you want to resample the y
    values. The left and right edges of the bins will be,
    respectively, <code>xout_edges[:-1]</code> and <code>xout_edges[1:]</code>,
    so the size of the output array will be
    <code>len(xout_edges) - 1</code>
replace_nans : float, str
    Replace nan values with this value.
    <code>replace_nans = 0</code>
        will add no flux where nans are
    <code>replace_nans = nan</code>
        will ensure you get nans returned everywhere
        if you try to resample over any nan
    <code>replace_nans = 'interpolate'</code>
        will try to replace nans by linearly interpolating
        from nearby values (not yet implemented)
visualize : bool
    Should we make a plot showing whether it worked?
pause : bool
    Should we pause to wait for a key press?</p>
<h4 id="chromatic.rainbows.get.timelike.average_lightcurve.resample_while_conserving_flux--returns">Returns<a class="headerlink" href="#chromatic.rainbows.get.timelike.average_lightcurve.resample_while_conserving_flux--returns" title="Permanent link">#</a></h4>
<p>result : dict
    A dictionary containing...
        <code>x</code> = the center of the output grid
        <code>y</code> = the resampled value on the output grid
        <code>edges</code> = the edges of the output grid, which will
            have one more element than x or y</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/tools/resampling.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">resample_while_conserving_flux</span><span class="p">(</span>
    <span class="n">xin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">yin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">xout</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">xin_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">xout_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">replace_nans</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
    <span class="n">visualize</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">pause</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Starting from some initial x and y, resample onto a</span>
<span class="sd">    different grid (either higher or lower resolution),</span>
<span class="sd">    while conserving total flux.</span>

<span class="sd">    When including the entire range of `xin`,</span>
<span class="sd">    `sum(yout) == sum(yin)` should be true.</span>

<span class="sd">    When including only part of the range of `xin`,</span>
<span class="sd">    the integral between any two points should be conserved.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    xin : array</span>
<span class="sd">        The original independent variable.</span>
<span class="sd">    yin : array</span>
<span class="sd">        The original dependent variable (same size as x).</span>
<span class="sd">    xout : array</span>
<span class="sd">        The new grid of independent variables onto which</span>
<span class="sd">        you want to resample the y values. Refers to the</span>
<span class="sd">        center of each bin (use `xout_edges` for finer</span>
<span class="sd">        control over the exact edges of the bins)</span>
<span class="sd">    xin_edges : array</span>
<span class="sd">        The edges of the original independent variable bins.</span>
<span class="sd">        The left and right edges of the bins are interpreted</span>
<span class="sd">        to be `xin_edges[:-1]` and `xin_edges[1:]`,</span>
<span class="sd">        respectively, so the associated `yin` should have exactly</span>
<span class="sd">        1 fewer element than `xin_edges`. This provides finer</span>
<span class="sd">        control over the size of each bin in the input than</span>
<span class="sd">        simply supplying `xin`(still a little experimental)</span>
<span class="sd">        They should probably be sorted?</span>
<span class="sd">    xout_edges : array</span>
<span class="sd">        The edges of the new grid of bins for the independent</span>
<span class="sd">        variable, onto which you want to resample the y</span>
<span class="sd">        values. The left and right edges of the bins will be,</span>
<span class="sd">        respectively, `xout_edges[:-1]` and `xout_edges[1:]`,</span>
<span class="sd">        so the size of the output array will be</span>
<span class="sd">        `len(xout_edges) - 1`</span>
<span class="sd">    replace_nans : float, str</span>
<span class="sd">        Replace nan values with this value.</span>
<span class="sd">        `replace_nans = 0`</span>
<span class="sd">            will add no flux where nans are</span>
<span class="sd">        `replace_nans = nan`</span>
<span class="sd">            will ensure you get nans returned everywhere</span>
<span class="sd">            if you try to resample over any nan</span>
<span class="sd">        `replace_nans = &#39;interpolate&#39;`</span>
<span class="sd">            will try to replace nans by linearly interpolating</span>
<span class="sd">            from nearby values (not yet implemented)</span>
<span class="sd">    visualize : bool</span>
<span class="sd">        Should we make a plot showing whether it worked?</span>
<span class="sd">    pause : bool</span>
<span class="sd">        Should we pause to wait for a key press?</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    result : dict</span>
<span class="sd">        A dictionary containing...</span>
<span class="sd">            `x` = the center of the output grid</span>
<span class="sd">            `y` = the resampled value on the output grid</span>
<span class="sd">            `edges` = the edges of the output grid, which will</span>
<span class="sd">                have one more element than x or y</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># make sure there are some reasonable input options</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">xin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">xin_edges</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">yin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">xout</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">xout_edges</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>

    <span class="c1"># set up the bins, to calculate cumulative distribution of y</span>
    <span class="k">if</span> <span class="n">xin_edges</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># make sure the sizes match up</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">xin</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">yin</span><span class="p">)</span>
        <span class="c1"># sort to make sure x is strictly increasing</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">xin</span><span class="p">)</span>
        <span class="n">xin_sorted</span> <span class="o">=</span> <span class="n">xin</span><span class="p">[</span><span class="n">s</span><span class="p">]</span>
        <span class="n">yin_sorted</span> <span class="o">=</span> <span class="n">yin</span><span class="p">[</span><span class="n">s</span><span class="p">]</span>
        <span class="c1"># estimate some bin edges (might fail for non-uniform grids)</span>
        <span class="n">xin_left</span><span class="p">,</span> <span class="n">xin_right</span> <span class="o">=</span> <span class="n">calculate_bin_leftright</span><span class="p">(</span><span class="n">xin_sorted</span><span class="p">)</span>
        <span class="c1"># define an array of edges</span>
        <span class="n">xin_edges</span> <span class="o">=</span> <span class="n">leftright_to_edges</span><span class="p">(</span><span class="n">xin_left</span><span class="p">,</span> <span class="n">xin_right</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># make sure the sizes match up</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">xin_edges</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">yin</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="c1"># sort to make sure x is strictly increasing</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">xin_edges</span><span class="p">)</span>
        <span class="n">xin_left</span><span class="p">,</span> <span class="n">xin_right</span> <span class="o">=</span> <span class="n">edges_to_leftright</span><span class="p">(</span><span class="n">xin_edges</span><span class="p">[</span><span class="n">s</span><span class="p">])</span>
        <span class="n">xin_sorted</span> <span class="o">=</span> <span class="p">(</span><span class="n">xin_left</span> <span class="o">+</span> <span class="n">xin_right</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">yin_sorted</span> <span class="o">=</span> <span class="n">yin</span><span class="p">[</span><span class="n">s</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>

    <span class="c1"># the first element should be the left edge of the first pixel</span>
    <span class="c1"># last element will be right edge of last pixel</span>
    <span class="n">xin_for_cdf</span> <span class="o">=</span> <span class="n">xin_edges</span>

    <span class="c1"># to the left of the first pixel, assume flux is zero</span>
    <span class="n">yin_for_cdf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">yin_sorted</span><span class="p">])</span>

    <span class="c1"># correct for any non-finite values</span>
    <span class="n">bad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">yin_for_cdf</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">replace_nans</span> <span class="o">==</span> <span class="s2">&quot;interpolate&quot;</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
            <span class="s2">&quot;The `replace_nans=&#39;interpolate&#39;`` option doens&#39;t exist yet!&quot;</span>
        <span class="p">)</span>
    <span class="n">yin_for_cdf</span><span class="p">[</span><span class="n">bad</span><span class="p">]</span> <span class="o">=</span> <span class="n">replace_nans</span>

    <span class="c1"># calculate the CDF of the flux (at pixel edge locations)</span>
    <span class="n">cdfin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">yin_for_cdf</span><span class="p">)</span>

    <span class="c1"># create an interpolator for that CDF</span>
    <span class="n">cdfinterpolator</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span>
        <span class="n">xin_for_cdf</span><span class="p">,</span>
        <span class="n">cdfin</span><span class="p">,</span>
        <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span>
        <span class="n">bounds_error</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">fill_value</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">yin</span><span class="p">)),</span>
    <span class="p">)</span>

    <span class="c1"># calculate bin edges (of size len(xout)+1)</span>
    <span class="k">if</span> <span class="n">xout_edges</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">xout_left</span><span class="p">,</span> <span class="n">xout_right</span> <span class="o">=</span> <span class="n">calculate_bin_leftright</span><span class="p">(</span><span class="n">xout</span><span class="p">)</span>
        <span class="n">xout_edges</span> <span class="o">=</span> <span class="n">leftright_to_edges</span><span class="p">(</span><span class="n">xout_left</span><span class="p">,</span> <span class="n">xout_right</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">xout_left</span><span class="p">,</span> <span class="n">xout_right</span> <span class="o">=</span> <span class="n">edges_to_leftright</span><span class="p">(</span><span class="n">xout_edges</span><span class="p">)</span>
        <span class="n">xout</span> <span class="o">=</span> <span class="p">(</span><span class="n">xout_left</span> <span class="o">+</span> <span class="n">xout_right</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>

    <span class="n">xout_for_cdf</span> <span class="o">=</span> <span class="n">leftright_to_edges</span><span class="p">(</span><span class="n">xout_left</span><span class="p">,</span> <span class="n">xout_right</span><span class="p">)</span>

    <span class="c1"># interpolate the CDF onto those bin edges</span>
    <span class="n">cdfout</span> <span class="o">=</span> <span class="n">cdfinterpolator</span><span class="p">(</span><span class="n">xout_for_cdf</span><span class="p">)</span>

    <span class="c1"># take  derivative of the CDF to get flux per resampled bin</span>
    <span class="c1"># (xout is bin center, and yout is the flux in that bin)</span>
    <span class="n">yout</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">cdfout</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">visualize</span><span class="p">:</span>
        <span class="n">fi</span><span class="p">,</span> <span class="p">(</span><span class="n">ax_cdf</span><span class="p">,</span> <span class="n">ax_pdf</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
        <span class="n">inkw</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
            <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span>
            <span class="n">markeredgecolor</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">outkw</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;darkorange&quot;</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span>
            <span class="n">markersize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
            <span class="n">markeredgecolor</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">legkw</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper left&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">xinbinsize</span> <span class="o">=</span> <span class="n">xin_right</span> <span class="o">-</span> <span class="n">xin_left</span>
        <span class="n">xoutbinsize</span> <span class="o">=</span> <span class="n">xout_right</span> <span class="o">-</span> <span class="n">xout_left</span>
        <span class="c1"># plot the PDFs</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="n">ax_pdf</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Flux per (Original) Pixel&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Pixel&quot;</span><span class="p">)</span>
        <span class="c1"># plot the original pixels (in df/dpixel to compare with resampled)</span>
        <span class="n">plot_as_boxes</span><span class="p">(</span>
            <span class="n">xin_sorted</span><span class="p">,</span> <span class="n">yin_sorted</span> <span class="o">/</span> <span class="n">xinbinsize</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Original Pixels&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">inkw</span>
        <span class="p">)</span>

        <span class="c1"># what would a bad interpolation look like?</span>
        <span class="n">interpolate_badly</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span>
            <span class="n">xin_sorted</span><span class="p">,</span>
            <span class="n">yin_sorted</span> <span class="o">/</span> <span class="n">xinbinsize</span><span class="p">,</span>
            <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span>
            <span class="n">bounds_error</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">fill_value</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
            <span class="n">xout</span><span class="p">,</span>
            <span class="n">interpolate_badly</span><span class="p">(</span><span class="n">xout</span><span class="p">),</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;cornflowerblue&quot;</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span>
            <span class="n">markersize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
            <span class="n">markeredgecolor</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Silly Simple Interpolation&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># plot the flux-conserving resampled data (again, in df/d&quot;pixel&quot;)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
            <span class="n">xout</span><span class="p">,</span> <span class="n">yout</span> <span class="o">/</span> <span class="n">xoutbinsize</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Flux-Conserving Interpolation&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">outkw</span>
        <span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="o">**</span><span class="n">legkw</span><span class="p">)</span>

        <span class="c1"># plot the CDFs</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="n">ax_cdf</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Cumulative Flux (from left)&quot;</span><span class="p">)</span>

        <span class="c1"># plot the original CDF</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xin_for_cdf</span><span class="p">,</span> <span class="n">cdfin</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Original Pixels&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">inkw</span><span class="p">)</span>

        <span class="c1"># plot the interpolated CDF</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xout_for_cdf</span><span class="p">,</span> <span class="n">cdfout</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Flux-Conserved Resample&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">outkw</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">pause</span><span class="p">:</span>
            <span class="n">a</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span>
                <span class="s2">&quot;Pausing a moment to check on interpolation; press return to continue.&quot;</span>
            <span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{:&gt;6}</span><span class="s2"> = </span><span class="si">{:.5f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;Actual&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">yin</span><span class="p">)))</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="s2">&quot;</span><span class="si">{:&gt;6}</span><span class="s2"> = </span><span class="si">{:.5f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="s2">&quot;Silly&quot;</span><span class="p">,</span>
                <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">interpolate_badly</span><span class="p">(</span><span class="n">xout</span><span class="p">)</span> <span class="o">*</span> <span class="n">xoutbinsize</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{:&gt;6}</span><span class="s2"> = </span><span class="si">{:.5f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;CDF&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">yout</span><span class="p">)))</span>

    <span class="c1"># return the resampled y-values</span>
    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="n">xout</span><span class="p">,</span> <span class="s2">&quot;x_edge_lower&quot;</span><span class="p">:</span> <span class="n">xout_left</span><span class="p">,</span> <span class="s2">&quot;x_edge_upper&quot;</span><span class="p">:</span> <span class="n">xout_right</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="n">yout</span><span class="p">}</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="chromatic.rainbows.get.timelike.median_lightcurve"></a>
    <div class="doc doc-contents first">









  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.get.timelike.median_lightcurve.bintoR" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">bintoR</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">unc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">R</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">weighting</span><span class="o">=</span><span class="s1">&#39;inversevariance&#39;</span><span class="p">,</span> <span class="n">drop_nans</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.get.timelike.median_lightcurve.bintoR" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Bin any x and y array onto a logarithmicly uniform grid.</p>
<h4 id="chromatic.rainbows.get.timelike.median_lightcurve.bintoR--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.get.timelike.median_lightcurve.bintoR--parameters" title="Permanent link">#</a></h4>
<p>x : array
    The original independent variable.
    (For a spectrum example = wavelength)
y : array
    The original dependent variable (same size as x).
    (For a spectrum example = flux)
unc : array, None, optional
    The unceratinty on the dependent variable
    (For a spectrum example = the flux uncertainty)
R : array, optional
    The spectral resolution R=x/dx for creating a new,
    logarithmically uniform grid that starts at the first
    value of x.
xlim : list, array, optional
    A two-element list indicating the min and max values of
    x for the new logarithmically spaced grid. If None,
    these limits will be created from the data themselves
weighting : str, optional
    How should we weight values when averaging
    them together into one larger bin?
    <code>weighting = 'inversevariance'</code>
        weights = 1/unc**2
     <code>weighting = {literally anything else}</code>
        uniform weights
    This will have no impact if <code>unc == None</code>, or for any
    new bins that effectively overlap less than one original
    unbinned point.
drop_nans : bool, optional
    Should we skip any bins turn out to be nans?
    This most often happens when bins are empty.</p>
<h4 id="chromatic.rainbows.get.timelike.median_lightcurve.bintoR--returns">Returns<a class="headerlink" href="#chromatic.rainbows.get.timelike.median_lightcurve.bintoR--returns" title="Permanent link">#</a></h4>
<p>result : dict
    A dictionary containing at least...
        <code>x</code> = the center of the output grid
        <code>y</code> = the resampled value on the output grid
        <code>x_edge_lower</code> = the lower edges of the output grid
        <code>x_edge_upper</code> = the upper edges of the output grid
    ...and possibly also
        <code>uncertainty</code> = the calculated uncertainty per bin</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/tools/resampling.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">bintoR</span><span class="p">(</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">unc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">R</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">weighting</span><span class="o">=</span><span class="s2">&quot;inversevariance&quot;</span><span class="p">,</span> <span class="n">drop_nans</span><span class="o">=</span><span class="kc">True</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Bin any x and y array onto a logarithmicly uniform grid.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : array</span>
<span class="sd">        The original independent variable.</span>
<span class="sd">        (For a spectrum example = wavelength)</span>
<span class="sd">    y : array</span>
<span class="sd">        The original dependent variable (same size as x).</span>
<span class="sd">        (For a spectrum example = flux)</span>
<span class="sd">    unc : array, None, optional</span>
<span class="sd">        The unceratinty on the dependent variable</span>
<span class="sd">        (For a spectrum example = the flux uncertainty)</span>
<span class="sd">    R : array, optional</span>
<span class="sd">        The spectral resolution R=x/dx for creating a new,</span>
<span class="sd">        logarithmically uniform grid that starts at the first</span>
<span class="sd">        value of x.</span>
<span class="sd">    xlim : list, array, optional</span>
<span class="sd">        A two-element list indicating the min and max values of</span>
<span class="sd">        x for the new logarithmically spaced grid. If None,</span>
<span class="sd">        these limits will be created from the data themselves</span>
<span class="sd">    weighting : str, optional</span>
<span class="sd">        How should we weight values when averaging</span>
<span class="sd">        them together into one larger bin?</span>
<span class="sd">        `weighting = &#39;inversevariance&#39;`</span>
<span class="sd">            weights = 1/unc**2</span>
<span class="sd">         `weighting = {literally anything else}`</span>
<span class="sd">            uniform weights</span>
<span class="sd">        This will have no impact if `unc == None`, or for any</span>
<span class="sd">        new bins that effectively overlap less than one original</span>
<span class="sd">        unbinned point.</span>
<span class="sd">    drop_nans : bool, optional</span>
<span class="sd">        Should we skip any bins turn out to be nans?</span>
<span class="sd">        This most often happens when bins are empty.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    result : dict</span>
<span class="sd">        A dictionary containing at least...</span>
<span class="sd">            `x` = the center of the output grid</span>
<span class="sd">            `y` = the resampled value on the output grid</span>
<span class="sd">            `x_edge_lower` = the lower edges of the output grid</span>
<span class="sd">            `x_edge_upper` = the upper edges of the output grid</span>
<span class="sd">        ...and possibly also</span>
<span class="sd">            `uncertainty` = the calculated uncertainty per bin</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">x_unit</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">unit</span>
        <span class="n">x_without_unit</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">value</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="n">x_unit</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">x_without_unit</span> <span class="o">=</span> <span class="n">x</span>

    <span class="c1"># create a new grid of x at the given resolution</span>
    <span class="n">lnx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">x_without_unit</span><span class="p">)</span>
    <span class="n">dnewlnx</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">R</span>

    <span class="c1"># set the limits of the new xgrid (in log space)</span>
    <span class="k">if</span> <span class="n">xlim</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># use the input grid to set the limits</span>
        <span class="n">lnxbottom</span><span class="p">,</span> <span class="n">lnxtop</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">lnx</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">lnx</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># use the custom xlim to set the limits</span>
        <span class="n">lnxbottom</span><span class="p">,</span> <span class="n">lnxtop</span> <span class="o">=</span> <span class="n">xlim</span>

    <span class="c1"># create a new, log-uniform grid of x values</span>
    <span class="n">newlnx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">lnxbottom</span><span class="p">,</span> <span class="n">lnxtop</span> <span class="o">+</span> <span class="n">dnewlnx</span><span class="p">,</span> <span class="n">dnewlnx</span><span class="p">)</span>

    <span class="c1"># now do the binning on a uniform grid of lnx</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">bintogrid</span><span class="p">(</span>
        <span class="n">lnx</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">unc</span><span class="p">,</span> <span class="n">newx</span><span class="o">=</span><span class="n">newlnx</span><span class="p">,</span> <span class="n">weighting</span><span class="o">=</span><span class="n">weighting</span><span class="p">,</span> <span class="n">drop_nans</span><span class="o">=</span><span class="n">drop_nans</span>
    <span class="p">)</span>

    <span class="c1"># convert back from log to real values</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;x_edge_lower&quot;</span><span class="p">,</span> <span class="s2">&quot;x_edge_upper&quot;</span><span class="p">]:</span>
        <span class="n">result</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="o">*</span> <span class="n">x_unit</span>

    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.get.timelike.median_lightcurve.bintogrid" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">bintogrid</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">unc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">newx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">newx_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">nx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">weighting</span><span class="o">=</span><span class="s1">&#39;inversevariance&#39;</span><span class="p">,</span> <span class="n">drop_nans</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">x_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">visualize</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.get.timelike.median_lightcurve.bintogrid" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Bin any x and y array onto a linearly uniform grid.</p>
<h4 id="chromatic.rainbows.get.timelike.median_lightcurve.bintogrid--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.get.timelike.median_lightcurve.bintogrid--parameters" title="Permanent link">#</a></h4>
<p>x : array
    The original independent variable.
    (For a spectrum example = wavelength)
y : array
    The original dependent variable (same size as x).
    (For a spectrum example = flux)
unc : array, None
    The unceratinty on the dependent variable
    (For a spectrum example = the flux uncertainty)
nx : array
    The number of bins from the original grid to
    bin together into the new one.
dx : array
    The fixed spacing for creating a new, linearly uniform
    grid that start at the first value of x. This will
    be ignored if <code>newx</code> != None.
newx : array
    A new custom grid onto which we should bin.
newx_edges : array
    The edges of the new grid of bins for the independent
    variable, onto which you want to resample the y
    values. The left and right edges of the bins will be,
    respectively, <code>newx_edges[:-1]</code> and <code>newx_edges[1:]</code>,
    so the size of the output array will be
    <code>len(newx_edges) - 1</code>
weighting : str
    How should we weight values when averaging
    them together into one larger bin?
    <code>weighting = 'inversevariance'</code>
        weights = 1/unc**2
     <code>weighting = {literally anything else}</code>
        uniform weights
    This will have no impact if <code>unc == None</code>, or for any
    new bins that effectively overlap less than one original
    unbinned point.
drop_nans : bool
    Should we skip any bins turn out to be nans?
    This most often happens when bins are empty.
x_edges : array
    The edges of the original independent variable bins.
    The left and right edges of the bins are interpreted
    to be <code>x_edges[:-1]</code> and <code>x_edges[1:]</code>,
    respectively, so the associated <code>y</code> should have exactly
    1 fewer element than <code>x_edges</code>. This provides finer
    control over the size of each bin in the input than
    simply supplying <code>x</code>(still a little experimental)</p>
<h4 id="chromatic.rainbows.get.timelike.median_lightcurve.bintogrid--returns">Returns<a class="headerlink" href="#chromatic.rainbows.get.timelike.median_lightcurve.bintogrid--returns" title="Permanent link">#</a></h4>
<p>result : dict
    A dictionary containing at least...
        <code>x</code> = the center of the output grid
        <code>y</code> = the resampled value on the output grid
        <code>x_edge_lower</code> = the lower edges of the output grid
        <code>x_edge_upper</code> = the upper edges of the output grid
    ...and possibly also
        <code>uncertainty</code> = the calculated uncertainty per bin</p>
<p>The order of precendence for setting the new grid is
[<code>newx_edges</code>, <code>newx</code>, <code>dx</code>, <code>nx</code>]
The first will be used, and others will be ignored.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/tools/resampling.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">bintogrid</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">unc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">newx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">newx_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">dx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">nx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">weighting</span><span class="o">=</span><span class="s2">&quot;inversevariance&quot;</span><span class="p">,</span>
    <span class="n">drop_nans</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">x_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">visualize</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Bin any x and y array onto a linearly uniform grid.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : array</span>
<span class="sd">        The original independent variable.</span>
<span class="sd">        (For a spectrum example = wavelength)</span>
<span class="sd">    y : array</span>
<span class="sd">        The original dependent variable (same size as x).</span>
<span class="sd">        (For a spectrum example = flux)</span>
<span class="sd">    unc : array, None</span>
<span class="sd">        The unceratinty on the dependent variable</span>
<span class="sd">        (For a spectrum example = the flux uncertainty)</span>
<span class="sd">    nx : array</span>
<span class="sd">        The number of bins from the original grid to</span>
<span class="sd">        bin together into the new one.</span>
<span class="sd">    dx : array</span>
<span class="sd">        The fixed spacing for creating a new, linearly uniform</span>
<span class="sd">        grid that start at the first value of x. This will</span>
<span class="sd">        be ignored if `newx` != None.</span>
<span class="sd">    newx : array</span>
<span class="sd">        A new custom grid onto which we should bin.</span>
<span class="sd">    newx_edges : array</span>
<span class="sd">        The edges of the new grid of bins for the independent</span>
<span class="sd">        variable, onto which you want to resample the y</span>
<span class="sd">        values. The left and right edges of the bins will be,</span>
<span class="sd">        respectively, `newx_edges[:-1]` and `newx_edges[1:]`,</span>
<span class="sd">        so the size of the output array will be</span>
<span class="sd">        `len(newx_edges) - 1`</span>
<span class="sd">    weighting : str</span>
<span class="sd">        How should we weight values when averaging</span>
<span class="sd">        them together into one larger bin?</span>
<span class="sd">        `weighting = &#39;inversevariance&#39;`</span>
<span class="sd">            weights = 1/unc**2</span>
<span class="sd">         `weighting = {literally anything else}`</span>
<span class="sd">            uniform weights</span>
<span class="sd">        This will have no impact if `unc == None`, or for any</span>
<span class="sd">        new bins that effectively overlap less than one original</span>
<span class="sd">        unbinned point.</span>
<span class="sd">    drop_nans : bool</span>
<span class="sd">        Should we skip any bins turn out to be nans?</span>
<span class="sd">        This most often happens when bins are empty.</span>
<span class="sd">    x_edges : array</span>
<span class="sd">        The edges of the original independent variable bins.</span>
<span class="sd">        The left and right edges of the bins are interpreted</span>
<span class="sd">        to be `x_edges[:-1]` and `x_edges[1:]`,</span>
<span class="sd">        respectively, so the associated `y` should have exactly</span>
<span class="sd">        1 fewer element than `x_edges`. This provides finer</span>
<span class="sd">        control over the size of each bin in the input than</span>
<span class="sd">        simply supplying `x`(still a little experimental)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    result : dict</span>
<span class="sd">        A dictionary containing at least...</span>
<span class="sd">            `x` = the center of the output grid</span>
<span class="sd">            `y` = the resampled value on the output grid</span>
<span class="sd">            `x_edge_lower` = the lower edges of the output grid</span>
<span class="sd">            `x_edge_upper` = the upper edges of the output grid</span>
<span class="sd">        ...and possibly also</span>
<span class="sd">            `uncertainty` = the calculated uncertainty per bin</span>


<span class="sd">    The order of precendence for setting the new grid is</span>
<span class="sd">    [`newx_edges`, `newx`, `dx`, `nx`]</span>
<span class="sd">    The first will be used, and others will be ignored.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># check that an OK set of inputs has been supplied</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">x_edges</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;🌈 Both `x` and `x_edges` were supplied to `bintogrid`. Confusing!&quot;&quot;&quot;</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">x_edges</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;🌈 At least one of `x` or `x_edges` must be supplied to `bintogrid`.&quot;&quot;&quot;</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="n">y</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;🌈 `y` must be supplied to `bintogrid`.&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="c1"># make sure the edges and the centers are set</span>
    <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">x_left</span><span class="p">,</span> <span class="n">x_right</span> <span class="o">=</span> <span class="n">edges_to_leftright</span><span class="p">(</span><span class="n">x_edges</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">left</span> <span class="o">+</span> <span class="n">right</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">x_left</span><span class="p">,</span> <span class="n">x_right</span> <span class="o">=</span> <span class="n">calculate_bin_leftright</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">x_edges</span> <span class="o">=</span> <span class="n">leftright_to_edges</span><span class="p">(</span><span class="n">x_left</span><span class="p">,</span> <span class="n">x_right</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">x_unit</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">unit</span>
        <span class="n">x_without_unit</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">value</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="n">x_unit</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">x_without_unit</span> <span class="o">=</span> <span class="n">x</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">y_unit</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">unit</span>
        <span class="n">y_without_unit</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">value</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="n">y_unit</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">y_without_unit</span> <span class="o">=</span> <span class="n">y</span>

    <span class="c1"># warn if multiple inputs are provided</span>
    <span class="n">number_of_grid_options</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span><span class="n">z</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="p">[</span><span class="n">newx_edges</span><span class="p">,</span> <span class="n">newx</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">nx</span><span class="p">]])</span>
    <span class="k">if</span> <span class="n">number_of_grid_options</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">cheerfully_suggest</span><span class="p">(</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;More than one output grid sent to `bintogrid`.</span>
<span class="sd">                         The one being used is the first to appear in</span>
<span class="sd">                         [`newx_edges`, `newx`, `dx`, `nx`]</span>
<span class="sd">                         but you might want to choose more carefully.&quot;&quot;&quot;</span>
        <span class="p">)</span>

    <span class="c1"># define inputs based on the following order</span>
    <span class="k">if</span> <span class="n">newx_edges</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># define grid by its edges (and define others from there)</span>
        <span class="n">newx_edges_without_unit</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">newx_edges</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">x_unit</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
        <span class="n">dx_without_unit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">newx_edges_without_unit</span><span class="p">)</span>
        <span class="n">newx_without_unit</span> <span class="o">=</span> <span class="n">newx_edges_without_unit</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">dx_without_unit</span>
        <span class="n">newx_left_without_unit</span> <span class="o">=</span> <span class="n">newx_edges_without_unit</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">newx_right_without_unit</span> <span class="o">=</span> <span class="n">newx_edges_without_unit</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

        <span class="c1"># make sure the final output grid is defined</span>
        <span class="n">final_newx</span><span class="p">,</span> <span class="n">final_newx_left</span><span class="p">,</span> <span class="n">final_newx_right</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">newx_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
            <span class="n">newx_left_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
            <span class="n">newx_right_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="n">newx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># define grid by its centers (and define others from there)</span>
        <span class="n">newx_without_unit</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">newx</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">x_unit</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
        <span class="n">newx_left_without_unit</span><span class="p">,</span> <span class="n">newx_right_without_unit</span> <span class="o">=</span> <span class="n">calculate_bin_leftright</span><span class="p">(</span>
            <span class="n">newx_without_unit</span>
        <span class="p">)</span>
        <span class="n">newx_edges_without_unit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span>
            <span class="p">[</span><span class="n">newx_left_without_unit</span><span class="p">,</span> <span class="n">newx_right_without_unit</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
        <span class="p">)</span>
        <span class="n">dx_without_unit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">newx_edges_without_unit</span><span class="p">)</span>

        <span class="c1"># make sure the final output grid is defined</span>
        <span class="n">final_newx</span><span class="p">,</span> <span class="n">final_newx_left</span><span class="p">,</span> <span class="n">final_newx_right</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">newx_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
            <span class="n">newx_left_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
            <span class="n">newx_right_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="n">dx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># define grid by a bin width (and define others from there)</span>
        <span class="n">dx_without_unit</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">dx</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">x_unit</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
        <span class="n">newx_without_unit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">x_without_unit</span><span class="p">),</span>
            <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">x_without_unit</span><span class="p">)</span> <span class="o">+</span> <span class="n">dx_without_unit</span><span class="p">,</span>
            <span class="n">dx_without_unit</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">newx_left_without_unit</span><span class="p">,</span> <span class="n">newx_right_without_unit</span> <span class="o">=</span> <span class="n">calculate_bin_leftright</span><span class="p">(</span>
            <span class="n">newx_without_unit</span>
        <span class="p">)</span>
        <span class="n">newx_edges_without_unit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span>
            <span class="p">[</span><span class="n">newx_left_without_unit</span><span class="p">,</span> <span class="n">newx_right_without_unit</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
        <span class="p">)</span>

        <span class="c1"># make sure the final output grid is defined</span>
        <span class="n">final_newx</span><span class="p">,</span> <span class="n">final_newx_left</span><span class="p">,</span> <span class="n">final_newx_right</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">newx_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
            <span class="n">newx_left_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
            <span class="n">newx_right_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">elif</span> <span class="n">nx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># keep track of the original input x values</span>
        <span class="n">original_x_without_unit</span> <span class="o">=</span> <span class="n">x_without_unit</span>

        <span class="c1"># redefine the input x to indices, to do interpolation in index space</span>
        <span class="n">x_without_unit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">x_without_unit</span><span class="p">))</span>

        <span class="c1"># define a grid of edges that will enclose the right number of indices</span>
        <span class="n">x_left_i</span><span class="p">,</span> <span class="n">x_right_i</span> <span class="o">=</span> <span class="n">calculate_bin_leftright</span><span class="p">(</span><span class="n">x_without_unit</span><span class="p">)</span>
        <span class="n">newx_edges_without_unit</span> <span class="o">=</span> <span class="n">leftright_to_edges</span><span class="p">(</span><span class="n">x_left_i</span><span class="p">,</span> <span class="n">x_right_i</span><span class="p">)[::</span><span class="n">nx</span><span class="p">]</span>
        <span class="n">newx_without_unit</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span>
            <span class="n">newx_edges_without_unit</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">+</span> <span class="n">newx_edges_without_unit</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="p">)</span>

        <span class="c1"># calculate the actual x values corresponding to the bins</span>
        <span class="n">original_edges</span> <span class="o">=</span> <span class="n">leftright_to_edges</span><span class="p">(</span>
            <span class="o">*</span><span class="n">calculate_bin_leftright</span><span class="p">(</span><span class="n">original_x_without_unit</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">final_edges</span> <span class="o">=</span> <span class="n">original_edges</span><span class="p">[::</span><span class="n">nx</span><span class="p">]</span> <span class="o">*</span> <span class="n">x_unit</span>
        <span class="n">final_newx_left</span><span class="p">,</span> <span class="n">final_newx_right</span> <span class="o">=</span> <span class="n">edges_to_leftright</span><span class="p">(</span><span class="n">final_edges</span><span class="p">)</span>
        <span class="n">final_newx</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">final_newx_left</span> <span class="o">+</span> <span class="n">final_newx_right</span><span class="p">)</span>
        <span class="n">dx_without_unit</span> <span class="o">=</span> <span class="p">(</span><span class="n">final_newx_right</span> <span class="o">-</span> <span class="n">final_newx_left</span><span class="p">)</span> <span class="o">/</span> <span class="n">x_unit</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;No output grid sent to `bintogrid`.</span>
<span class="sd">                              Please choose one of the following:</span>
<span class="sd">                              [`newx_edges`, `newx`, `dx`, `nx`]&quot;&quot;&quot;</span>
        <span class="p">)</span>

    <span class="c1"># don&#39;t complain about zero-divisions in here (to allow infinite uncertainties)</span>
    <span class="k">with</span> <span class="n">np</span><span class="o">.</span><span class="n">errstate</span><span class="p">(</span><span class="n">divide</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">invalid</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">):</span>

        <span class="c1"># calculate weight integrals for the bin array</span>
        <span class="n">ok</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">y_without_unit</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span>

        <span class="c1"># resample the sums onto that new grid</span>
        <span class="k">if</span> <span class="n">unc</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">x_without_unit</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">weighting</span> <span class="o">==</span> <span class="s2">&quot;inversevariance&quot;</span><span class="p">:</span>
                <span class="n">weights</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">unc</span><span class="o">**</span><span class="mi">2</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">x_without_unit</span><span class="p">)</span>

            <span class="c1"># ignore infinite weights (= 0 uncertainties)</span>
            <span class="n">ok</span> <span class="o">*=</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">ok</span><span class="p">):</span>
            <span class="n">numerator</span> <span class="o">=</span> <span class="n">resample_while_conserving_flux</span><span class="p">(</span>
                <span class="n">xin</span><span class="o">=</span><span class="n">x_without_unit</span><span class="p">[</span><span class="n">ok</span><span class="p">],</span>
                <span class="n">yin</span><span class="o">=</span><span class="p">(</span><span class="n">y_without_unit</span> <span class="o">*</span> <span class="n">weights</span><span class="p">)[</span><span class="n">ok</span><span class="p">],</span>
                <span class="n">xout_edges</span><span class="o">=</span><span class="n">newx_edges_without_unit</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">denominator</span> <span class="o">=</span> <span class="n">resample_while_conserving_flux</span><span class="p">(</span>
                <span class="n">xin</span><span class="o">=</span><span class="n">x_without_unit</span><span class="p">[</span><span class="n">ok</span><span class="p">],</span>
                <span class="n">yin</span><span class="o">=</span><span class="n">weights</span><span class="p">[</span><span class="n">ok</span><span class="p">],</span>
                <span class="n">xout_edges</span><span class="o">=</span><span class="n">newx_edges_without_unit</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="c1"># the binned weighted means on the new grid</span>
            <span class="n">newy</span> <span class="o">=</span> <span class="n">numerator</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">denominator</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span>

            <span class="c1"># the standard error on the means, for those bins</span>
            <span class="n">newunc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">denominator</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">])</span>

            <span class="c1"># keep track of the number of original bins going into each new bin</span>
            <span class="n">number_of_original_bins_per_new_bin</span> <span class="o">=</span> <span class="n">resample_while_conserving_flux</span><span class="p">(</span>
                <span class="n">xin</span><span class="o">=</span><span class="n">x_without_unit</span><span class="p">[</span><span class="n">ok</span><span class="p">],</span>
                <span class="n">yin</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">y_without_unit</span><span class="p">)[</span><span class="n">ok</span><span class="p">],</span>
                <span class="n">xout_edges</span><span class="o">=</span><span class="n">newx_edges_without_unit</span><span class="p">,</span>
            <span class="p">)[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">newy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="o">*</span> <span class="n">newx_without_unit</span>
            <span class="n">newunc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="o">*</span> <span class="n">newx_without_unit</span>
            <span class="n">number_of_original_bins_per_new_bin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">newx_without_unit</span><span class="p">)</span>

    <span class="c1"># remove any empty bins</span>
    <span class="k">if</span> <span class="n">drop_nans</span><span class="p">:</span>
        <span class="n">ok</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">newy</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ok</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">newx_without_unit</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>

    <span class="c1"># if no uncertainties were given, don&#39;t return uncertainties</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># populate the new grid centers + edges + values</span>
    <span class="n">result</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">final_newx</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span>
    <span class="n">result</span><span class="p">[</span><span class="s2">&quot;x_edge_lower&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">final_newx_left</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span>
    <span class="n">result</span><span class="p">[</span><span class="s2">&quot;x_edge_upper&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">final_newx_right</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span>

    <span class="c1"># populate the new grid values</span>
    <span class="n">result</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">newy</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span> <span class="o">*</span> <span class="n">y_unit</span>

    <span class="c1"># populate the new grid value uncertainties</span>
    <span class="k">if</span> <span class="n">unc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">result</span><span class="p">[</span><span class="s2">&quot;uncertainty&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">newunc</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span> <span class="o">*</span> <span class="n">y_unit</span>

    <span class="c1"># store how many of the original pixels made it into this new one</span>
    <span class="n">result</span><span class="p">[</span><span class="s2">&quot;N_unbinned/N_binned&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">number_of_original_bins_per_new_bin</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">visualize</span><span class="p">:</span>
        <span class="n">fi</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span>
            <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">gridspec_kw</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">height_ratios</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">])</span>
        <span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">plot_as_boxes</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">xleft</span><span class="o">=</span><span class="n">x_left</span><span class="p">,</span> <span class="n">xright</span><span class="o">=</span><span class="n">x_right</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;silver&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">ekw</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">elinewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">unc</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;silver&quot;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">ekw</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">],</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">],</span>
            <span class="n">yerr</span><span class="o">=</span><span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;uncertainty&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
            <span class="n">xerr</span><span class="o">=</span><span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s2">&quot;x_edge_upper&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;x_edge_lower&quot;</span><span class="p">])</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
            <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
            <span class="n">zorder</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
            <span class="o">**</span><span class="n">ekw</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">plot_as_boxes</span><span class="p">(</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">],</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;N_unbinned/N_binned&quot;</span><span class="p">],</span>
            <span class="n">xleft</span><span class="o">=</span><span class="n">result</span><span class="p">[</span><span class="s2">&quot;x_edge_lower&quot;</span><span class="p">],</span>
            <span class="n">xright</span><span class="o">=</span><span class="n">result</span><span class="p">[</span><span class="s2">&quot;x_edge_upper&quot;</span><span class="p">],</span>
        <span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;$N_</span><span class="si">{unbinned}</span><span class="s2">/N_</span><span class="si">{binned}</span><span class="s2">$&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.get.timelike.median_lightcurve.calculate_bin_leftright" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">calculate_bin_leftright</span><span class="p">(</span><span class="n">x</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.get.timelike.median_lightcurve.calculate_bin_leftright" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>If x is an array of bin centers, calculate the bin edges.
(assumes outermost bins are same size as their neighbors)</p>
<h4 id="chromatic.rainbows.get.timelike.median_lightcurve.calculate_bin_leftright--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.get.timelike.median_lightcurve.calculate_bin_leftright--parameters" title="Permanent link">#</a></h4>
<p>x : array
    The array of bin centers.</p>
<h4 id="chromatic.rainbows.get.timelike.median_lightcurve.calculate_bin_leftright--returns">Returns<a class="headerlink" href="#chromatic.rainbows.get.timelike.median_lightcurve.calculate_bin_leftright--returns" title="Permanent link">#</a></h4>
<p>l : array
    The left edges of the bins.
r : array
    The right edges of the bins.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/tools/resampling.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">calculate_bin_leftright</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    If x is an array of bin centers, calculate the bin edges.</span>
<span class="sd">    (assumes outermost bins are same size as their neighbors)</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : array</span>
<span class="sd">        The array of bin centers.</span>

<span class="sd">    Returns</span>
<span class="sd">    ----------</span>
<span class="sd">    l : array</span>
<span class="sd">        The left edges of the bins.</span>
<span class="sd">    r : array</span>
<span class="sd">        The right edges of the bins.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># what are bin edges (making a guess for those on the ends)</span>
    <span class="c1"># xbinsize = calculate_bin_widths(x)</span>
    <span class="c1"># left = x - xbinsize / 2.0</span>
    <span class="c1"># right = x + xbinsize / 2.0</span>

    <span class="c1"># weird corner case!</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">left</span><span class="p">,</span> <span class="n">right</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">left</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">right</span><span class="p">])</span>

    <span class="n">inner_edges</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="n">x</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">first_edge</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="n">inner_edges</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">last_edge</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">inner_edges</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

    <span class="n">left</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">first_edge</span><span class="p">,</span> <span class="n">inner_edges</span><span class="p">])</span>
    <span class="n">right</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">inner_edges</span><span class="p">,</span> <span class="n">last_edge</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.get.timelike.median_lightcurve.edges_to_leftright" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">edges_to_leftright</span><span class="p">(</span><span class="n">edges</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.get.timelike.median_lightcurve.edges_to_leftright" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Convert N+1 contiguous edges to two arrays of N left/right edges.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/tools/resampling.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">edges_to_leftright</span><span class="p">(</span><span class="n">edges</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert N+1 contiguous edges to two arrays of N left/right edges.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">left</span><span class="p">,</span> <span class="n">right</span> <span class="o">=</span> <span class="n">edges</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">edges</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="k">return</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.get.timelike.median_lightcurve.expand_filenames" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">expand_filenames</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.get.timelike.median_lightcurve.expand_filenames" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>A wrapper to expand a string or list into a list of filenames.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/imports.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">expand_filenames</span><span class="p">(</span><span class="n">filepath</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A wrapper to expand a string or list into a list of filenames.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
        <span class="n">filenames</span> <span class="o">=</span> <span class="n">filepath</span>
    <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span> <span class="o">==</span> <span class="n">Column</span><span class="p">:</span>
        <span class="n">filenames</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>
    <span class="k">elif</span> <span class="s2">&quot;*&quot;</span> <span class="ow">in</span> <span class="n">filepath</span><span class="p">:</span>
        <span class="n">filenames</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">filepath</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">filenames</span> <span class="o">=</span> <span class="p">[</span><span class="n">filepath</span><span class="p">]</span>
    <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">filenames</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.get.timelike.median_lightcurve.get_median_lightcurve" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_median_lightcurve</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.get.timelike.median_lightcurve.get_median_lightcurve" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Return a lightcurve of the star, medianed over all wavelengths.</p>
<h4 id="chromatic.rainbows.get.timelike.median_lightcurve.get_median_lightcurve--returns">Returns<a class="headerlink" href="#chromatic.rainbows.get.timelike.median_lightcurve.get_median_lightcurve--returns" title="Permanent link">#</a></h4>
<p>median_lightcurve : array
    Timelike array of fluxes.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/rainbows/get/timelike/median_lightcurve.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_median_lightcurve</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return a lightcurve of the star, medianed over all wavelengths.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    median_lightcurve : array</span>
<span class="sd">        Timelike array of fluxes.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmedian</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_ok_data</span><span class="p">(),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.get.timelike.median_lightcurve.leftright_to_edges" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">leftright_to_edges</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.get.timelike.median_lightcurve.leftright_to_edges" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Convert two arrays of N left/right edges to N+1 continugous edges.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/tools/resampling.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">leftright_to_edges</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert two arrays of N left/right edges to N+1 continugous edges.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">edges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>
    <span class="k">return</span> <span class="n">edges</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.get.timelike.median_lightcurve.name2color" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">name2color</span><span class="p">(</span><span class="n">name</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.get.timelike.median_lightcurve.name2color" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Return the 3-element RGB array of a given color name.</p>
<h4 id="chromatic.rainbows.get.timelike.median_lightcurve.name2color--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.get.timelike.median_lightcurve.name2color--parameters" title="Permanent link">#</a></h4>
<p>name : str
    The name of a color</p>
<h4 id="chromatic.rainbows.get.timelike.median_lightcurve.name2color--returns">Returns<a class="headerlink" href="#chromatic.rainbows.get.timelike.median_lightcurve.name2color--returns" title="Permanent link">#</a></h4>
<p>rgb : tuple
    3-element RGB color, with numbers from 0.0 to 1.0</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/imports.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">name2color</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return the 3-element RGB array of a given color name.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    name : str</span>
<span class="sd">        The name of a color</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    rgb : tuple</span>
<span class="sd">        3-element RGB color, with numbers from 0.0 to 1.0</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># give a friendly warning if the color name can&#39;t be found</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">color_hex</span> <span class="o">=</span> <span class="n">col</span><span class="o">.</span><span class="n">cnames</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">col</span><span class="o">.</span><span class="n">hex2color</span><span class="p">(</span><span class="n">color_hex</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="n">cheerfully_suggest</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The color </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> can&#39;t be found. (Returning black.)&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.get.timelike.median_lightcurve.one2another" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">one2another</span><span class="p">(</span><span class="n">bottom</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">alpha_bottom</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">alpha_top</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">256</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.get.timelike.median_lightcurve.one2another" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Create a cmap that goes smoothly (linearly in RGBA) from "bottom" to "top".</p>
<h4 id="chromatic.rainbows.get.timelike.median_lightcurve.one2another--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.get.timelike.median_lightcurve.one2another--parameters" title="Permanent link">#</a></h4>
<p>bottom : str
    Name of a color for the bottom of cmap (0.0)
top : str
    Name of a color for the top of the cmap (1.0)
alpha_bottom : float
    Opacity at the bottom of the cmap
alpha_top : float
    Opacitiy at the top of the cmap
N : int
    The number of levels in the listed color map</p>
<h4 id="chromatic.rainbows.get.timelike.median_lightcurve.one2another--returns">Returns<a class="headerlink" href="#chromatic.rainbows.get.timelike.median_lightcurve.one2another--returns" title="Permanent link">#</a></h4>
<p>cmap : Colormap
    A color map that goes linearly from the
    bottom to top color (and alpha).</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/imports.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">one2another</span><span class="p">(</span><span class="n">bottom</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">alpha_bottom</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">alpha_top</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">256</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a cmap that goes smoothly (linearly in RGBA) from &quot;bottom&quot; to &quot;top&quot;.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    bottom : str</span>
<span class="sd">        Name of a color for the bottom of cmap (0.0)</span>
<span class="sd">    top : str</span>
<span class="sd">        Name of a color for the top of the cmap (1.0)</span>
<span class="sd">    alpha_bottom : float</span>
<span class="sd">        Opacity at the bottom of the cmap</span>
<span class="sd">    alpha_top : float</span>
<span class="sd">        Opacitiy at the top of the cmap</span>
<span class="sd">    N : int</span>
<span class="sd">        The number of levels in the listed color map</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    cmap : Colormap</span>
<span class="sd">        A color map that goes linearly from the</span>
<span class="sd">        bottom to top color (and alpha).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># get the RGB values of the bottom and top of the cmap</span>
    <span class="n">rgb_bottom</span><span class="p">,</span> <span class="n">rgb_top</span> <span class="o">=</span> <span class="n">name2color</span><span class="p">(</span><span class="n">bottom</span><span class="p">),</span> <span class="n">name2color</span><span class="p">(</span><span class="n">top</span><span class="p">)</span>

    <span class="c1"># create linear gradients for all four RGBA channels</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">rgb_bottom</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">rgb_top</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">N</span><span class="p">)</span>
    <span class="n">g</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">rgb_bottom</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">rgb_top</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">N</span><span class="p">)</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">rgb_bottom</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">rgb_top</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">N</span><span class="p">)</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">alpha_bottom</span><span class="p">,</span> <span class="n">alpha_top</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>

    <span class="c1"># create (N,4) array + populate a listed colormap</span>
    <span class="n">colors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">]))</span>
    <span class="n">cmap</span> <span class="o">=</span> <span class="n">col</span><span class="o">.</span><span class="n">ListedColormap</span><span class="p">(</span><span class="n">colors</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{bottom}</span><span class="s2">2</span><span class="si">{top}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="nb">locals</span><span class="p">()))</span>

    <span class="c1"># return the colormap</span>
    <span class="k">return</span> <span class="n">cmap</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.get.timelike.median_lightcurve.remove_unit" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">remove_unit</span><span class="p">(</span><span class="n">x</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.get.timelike.median_lightcurve.remove_unit" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Quick wrapper to remove the unit from a quantity,
but not complain if it doesn't have one.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/imports.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">remove_unit</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Quick wrapper to remove the unit from a quantity,</span>
<span class="sd">    but not complain if it doesn&#39;t have one.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">x</span><span class="o">.</span><span class="n">value</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">x</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.get.timelike.median_lightcurve.resample_while_conserving_flux" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">resample_while_conserving_flux</span><span class="p">(</span><span class="n">xin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">yin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xout</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xin_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xout_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">replace_nans</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">visualize</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">pause</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.get.timelike.median_lightcurve.resample_while_conserving_flux" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Starting from some initial x and y, resample onto a
different grid (either higher or lower resolution),
while conserving total flux.</p>
<p>When including the entire range of <code>xin</code>,
<code>sum(yout) == sum(yin)</code> should be true.</p>
<p>When including only part of the range of <code>xin</code>,
the integral between any two points should be conserved.</p>
<h4 id="chromatic.rainbows.get.timelike.median_lightcurve.resample_while_conserving_flux--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.get.timelike.median_lightcurve.resample_while_conserving_flux--parameters" title="Permanent link">#</a></h4>
<p>xin : array
    The original independent variable.
yin : array
    The original dependent variable (same size as x).
xout : array
    The new grid of independent variables onto which
    you want to resample the y values. Refers to the
    center of each bin (use <code>xout_edges</code> for finer
    control over the exact edges of the bins)
xin_edges : array
    The edges of the original independent variable bins.
    The left and right edges of the bins are interpreted
    to be <code>xin_edges[:-1]</code> and <code>xin_edges[1:]</code>,
    respectively, so the associated <code>yin</code> should have exactly
    1 fewer element than <code>xin_edges</code>. This provides finer
    control over the size of each bin in the input than
    simply supplying <code>xin</code>(still a little experimental)
    They should probably be sorted?
xout_edges : array
    The edges of the new grid of bins for the independent
    variable, onto which you want to resample the y
    values. The left and right edges of the bins will be,
    respectively, <code>xout_edges[:-1]</code> and <code>xout_edges[1:]</code>,
    so the size of the output array will be
    <code>len(xout_edges) - 1</code>
replace_nans : float, str
    Replace nan values with this value.
    <code>replace_nans = 0</code>
        will add no flux where nans are
    <code>replace_nans = nan</code>
        will ensure you get nans returned everywhere
        if you try to resample over any nan
    <code>replace_nans = 'interpolate'</code>
        will try to replace nans by linearly interpolating
        from nearby values (not yet implemented)
visualize : bool
    Should we make a plot showing whether it worked?
pause : bool
    Should we pause to wait for a key press?</p>
<h4 id="chromatic.rainbows.get.timelike.median_lightcurve.resample_while_conserving_flux--returns">Returns<a class="headerlink" href="#chromatic.rainbows.get.timelike.median_lightcurve.resample_while_conserving_flux--returns" title="Permanent link">#</a></h4>
<p>result : dict
    A dictionary containing...
        <code>x</code> = the center of the output grid
        <code>y</code> = the resampled value on the output grid
        <code>edges</code> = the edges of the output grid, which will
            have one more element than x or y</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/tools/resampling.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">resample_while_conserving_flux</span><span class="p">(</span>
    <span class="n">xin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">yin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">xout</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">xin_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">xout_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">replace_nans</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
    <span class="n">visualize</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">pause</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Starting from some initial x and y, resample onto a</span>
<span class="sd">    different grid (either higher or lower resolution),</span>
<span class="sd">    while conserving total flux.</span>

<span class="sd">    When including the entire range of `xin`,</span>
<span class="sd">    `sum(yout) == sum(yin)` should be true.</span>

<span class="sd">    When including only part of the range of `xin`,</span>
<span class="sd">    the integral between any two points should be conserved.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    xin : array</span>
<span class="sd">        The original independent variable.</span>
<span class="sd">    yin : array</span>
<span class="sd">        The original dependent variable (same size as x).</span>
<span class="sd">    xout : array</span>
<span class="sd">        The new grid of independent variables onto which</span>
<span class="sd">        you want to resample the y values. Refers to the</span>
<span class="sd">        center of each bin (use `xout_edges` for finer</span>
<span class="sd">        control over the exact edges of the bins)</span>
<span class="sd">    xin_edges : array</span>
<span class="sd">        The edges of the original independent variable bins.</span>
<span class="sd">        The left and right edges of the bins are interpreted</span>
<span class="sd">        to be `xin_edges[:-1]` and `xin_edges[1:]`,</span>
<span class="sd">        respectively, so the associated `yin` should have exactly</span>
<span class="sd">        1 fewer element than `xin_edges`. This provides finer</span>
<span class="sd">        control over the size of each bin in the input than</span>
<span class="sd">        simply supplying `xin`(still a little experimental)</span>
<span class="sd">        They should probably be sorted?</span>
<span class="sd">    xout_edges : array</span>
<span class="sd">        The edges of the new grid of bins for the independent</span>
<span class="sd">        variable, onto which you want to resample the y</span>
<span class="sd">        values. The left and right edges of the bins will be,</span>
<span class="sd">        respectively, `xout_edges[:-1]` and `xout_edges[1:]`,</span>
<span class="sd">        so the size of the output array will be</span>
<span class="sd">        `len(xout_edges) - 1`</span>
<span class="sd">    replace_nans : float, str</span>
<span class="sd">        Replace nan values with this value.</span>
<span class="sd">        `replace_nans = 0`</span>
<span class="sd">            will add no flux where nans are</span>
<span class="sd">        `replace_nans = nan`</span>
<span class="sd">            will ensure you get nans returned everywhere</span>
<span class="sd">            if you try to resample over any nan</span>
<span class="sd">        `replace_nans = &#39;interpolate&#39;`</span>
<span class="sd">            will try to replace nans by linearly interpolating</span>
<span class="sd">            from nearby values (not yet implemented)</span>
<span class="sd">    visualize : bool</span>
<span class="sd">        Should we make a plot showing whether it worked?</span>
<span class="sd">    pause : bool</span>
<span class="sd">        Should we pause to wait for a key press?</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    result : dict</span>
<span class="sd">        A dictionary containing...</span>
<span class="sd">            `x` = the center of the output grid</span>
<span class="sd">            `y` = the resampled value on the output grid</span>
<span class="sd">            `edges` = the edges of the output grid, which will</span>
<span class="sd">                have one more element than x or y</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># make sure there are some reasonable input options</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">xin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">xin_edges</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">yin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">xout</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">xout_edges</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>

    <span class="c1"># set up the bins, to calculate cumulative distribution of y</span>
    <span class="k">if</span> <span class="n">xin_edges</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># make sure the sizes match up</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">xin</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">yin</span><span class="p">)</span>
        <span class="c1"># sort to make sure x is strictly increasing</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">xin</span><span class="p">)</span>
        <span class="n">xin_sorted</span> <span class="o">=</span> <span class="n">xin</span><span class="p">[</span><span class="n">s</span><span class="p">]</span>
        <span class="n">yin_sorted</span> <span class="o">=</span> <span class="n">yin</span><span class="p">[</span><span class="n">s</span><span class="p">]</span>
        <span class="c1"># estimate some bin edges (might fail for non-uniform grids)</span>
        <span class="n">xin_left</span><span class="p">,</span> <span class="n">xin_right</span> <span class="o">=</span> <span class="n">calculate_bin_leftright</span><span class="p">(</span><span class="n">xin_sorted</span><span class="p">)</span>
        <span class="c1"># define an array of edges</span>
        <span class="n">xin_edges</span> <span class="o">=</span> <span class="n">leftright_to_edges</span><span class="p">(</span><span class="n">xin_left</span><span class="p">,</span> <span class="n">xin_right</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># make sure the sizes match up</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">xin_edges</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">yin</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="c1"># sort to make sure x is strictly increasing</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">xin_edges</span><span class="p">)</span>
        <span class="n">xin_left</span><span class="p">,</span> <span class="n">xin_right</span> <span class="o">=</span> <span class="n">edges_to_leftright</span><span class="p">(</span><span class="n">xin_edges</span><span class="p">[</span><span class="n">s</span><span class="p">])</span>
        <span class="n">xin_sorted</span> <span class="o">=</span> <span class="p">(</span><span class="n">xin_left</span> <span class="o">+</span> <span class="n">xin_right</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">yin_sorted</span> <span class="o">=</span> <span class="n">yin</span><span class="p">[</span><span class="n">s</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>

    <span class="c1"># the first element should be the left edge of the first pixel</span>
    <span class="c1"># last element will be right edge of last pixel</span>
    <span class="n">xin_for_cdf</span> <span class="o">=</span> <span class="n">xin_edges</span>

    <span class="c1"># to the left of the first pixel, assume flux is zero</span>
    <span class="n">yin_for_cdf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">yin_sorted</span><span class="p">])</span>

    <span class="c1"># correct for any non-finite values</span>
    <span class="n">bad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">yin_for_cdf</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">replace_nans</span> <span class="o">==</span> <span class="s2">&quot;interpolate&quot;</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
            <span class="s2">&quot;The `replace_nans=&#39;interpolate&#39;`` option doens&#39;t exist yet!&quot;</span>
        <span class="p">)</span>
    <span class="n">yin_for_cdf</span><span class="p">[</span><span class="n">bad</span><span class="p">]</span> <span class="o">=</span> <span class="n">replace_nans</span>

    <span class="c1"># calculate the CDF of the flux (at pixel edge locations)</span>
    <span class="n">cdfin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">yin_for_cdf</span><span class="p">)</span>

    <span class="c1"># create an interpolator for that CDF</span>
    <span class="n">cdfinterpolator</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span>
        <span class="n">xin_for_cdf</span><span class="p">,</span>
        <span class="n">cdfin</span><span class="p">,</span>
        <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span>
        <span class="n">bounds_error</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">fill_value</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">yin</span><span class="p">)),</span>
    <span class="p">)</span>

    <span class="c1"># calculate bin edges (of size len(xout)+1)</span>
    <span class="k">if</span> <span class="n">xout_edges</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">xout_left</span><span class="p">,</span> <span class="n">xout_right</span> <span class="o">=</span> <span class="n">calculate_bin_leftright</span><span class="p">(</span><span class="n">xout</span><span class="p">)</span>
        <span class="n">xout_edges</span> <span class="o">=</span> <span class="n">leftright_to_edges</span><span class="p">(</span><span class="n">xout_left</span><span class="p">,</span> <span class="n">xout_right</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">xout_left</span><span class="p">,</span> <span class="n">xout_right</span> <span class="o">=</span> <span class="n">edges_to_leftright</span><span class="p">(</span><span class="n">xout_edges</span><span class="p">)</span>
        <span class="n">xout</span> <span class="o">=</span> <span class="p">(</span><span class="n">xout_left</span> <span class="o">+</span> <span class="n">xout_right</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>

    <span class="n">xout_for_cdf</span> <span class="o">=</span> <span class="n">leftright_to_edges</span><span class="p">(</span><span class="n">xout_left</span><span class="p">,</span> <span class="n">xout_right</span><span class="p">)</span>

    <span class="c1"># interpolate the CDF onto those bin edges</span>
    <span class="n">cdfout</span> <span class="o">=</span> <span class="n">cdfinterpolator</span><span class="p">(</span><span class="n">xout_for_cdf</span><span class="p">)</span>

    <span class="c1"># take  derivative of the CDF to get flux per resampled bin</span>
    <span class="c1"># (xout is bin center, and yout is the flux in that bin)</span>
    <span class="n">yout</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">cdfout</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">visualize</span><span class="p">:</span>
        <span class="n">fi</span><span class="p">,</span> <span class="p">(</span><span class="n">ax_cdf</span><span class="p">,</span> <span class="n">ax_pdf</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
        <span class="n">inkw</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
            <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span>
            <span class="n">markeredgecolor</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">outkw</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;darkorange&quot;</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span>
            <span class="n">markersize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
            <span class="n">markeredgecolor</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">legkw</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper left&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">xinbinsize</span> <span class="o">=</span> <span class="n">xin_right</span> <span class="o">-</span> <span class="n">xin_left</span>
        <span class="n">xoutbinsize</span> <span class="o">=</span> <span class="n">xout_right</span> <span class="o">-</span> <span class="n">xout_left</span>
        <span class="c1"># plot the PDFs</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="n">ax_pdf</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Flux per (Original) Pixel&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Pixel&quot;</span><span class="p">)</span>
        <span class="c1"># plot the original pixels (in df/dpixel to compare with resampled)</span>
        <span class="n">plot_as_boxes</span><span class="p">(</span>
            <span class="n">xin_sorted</span><span class="p">,</span> <span class="n">yin_sorted</span> <span class="o">/</span> <span class="n">xinbinsize</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Original Pixels&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">inkw</span>
        <span class="p">)</span>

        <span class="c1"># what would a bad interpolation look like?</span>
        <span class="n">interpolate_badly</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span>
            <span class="n">xin_sorted</span><span class="p">,</span>
            <span class="n">yin_sorted</span> <span class="o">/</span> <span class="n">xinbinsize</span><span class="p">,</span>
            <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span>
            <span class="n">bounds_error</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">fill_value</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
            <span class="n">xout</span><span class="p">,</span>
            <span class="n">interpolate_badly</span><span class="p">(</span><span class="n">xout</span><span class="p">),</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;cornflowerblue&quot;</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span>
            <span class="n">markersize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
            <span class="n">markeredgecolor</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Silly Simple Interpolation&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># plot the flux-conserving resampled data (again, in df/d&quot;pixel&quot;)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
            <span class="n">xout</span><span class="p">,</span> <span class="n">yout</span> <span class="o">/</span> <span class="n">xoutbinsize</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Flux-Conserving Interpolation&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">outkw</span>
        <span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="o">**</span><span class="n">legkw</span><span class="p">)</span>

        <span class="c1"># plot the CDFs</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="n">ax_cdf</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Cumulative Flux (from left)&quot;</span><span class="p">)</span>

        <span class="c1"># plot the original CDF</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xin_for_cdf</span><span class="p">,</span> <span class="n">cdfin</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Original Pixels&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">inkw</span><span class="p">)</span>

        <span class="c1"># plot the interpolated CDF</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xout_for_cdf</span><span class="p">,</span> <span class="n">cdfout</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Flux-Conserved Resample&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">outkw</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">pause</span><span class="p">:</span>
            <span class="n">a</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span>
                <span class="s2">&quot;Pausing a moment to check on interpolation; press return to continue.&quot;</span>
            <span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{:&gt;6}</span><span class="s2"> = </span><span class="si">{:.5f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;Actual&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">yin</span><span class="p">)))</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="s2">&quot;</span><span class="si">{:&gt;6}</span><span class="s2"> = </span><span class="si">{:.5f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="s2">&quot;Silly&quot;</span><span class="p">,</span>
                <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">interpolate_badly</span><span class="p">(</span><span class="n">xout</span><span class="p">)</span> <span class="o">*</span> <span class="n">xoutbinsize</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{:&gt;6}</span><span class="s2"> = </span><span class="si">{:.5f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;CDF&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">yout</span><span class="p">)))</span>

    <span class="c1"># return the resampled y-values</span>
    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="n">xout</span><span class="p">,</span> <span class="s2">&quot;x_edge_lower&quot;</span><span class="p">:</span> <span class="n">xout_left</span><span class="p">,</span> <span class="s2">&quot;x_edge_upper&quot;</span><span class="p">:</span> <span class="n">xout_right</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="n">yout</span><span class="p">}</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="chromatic.rainbows.get.timelike.subset"></a>
    <div class="doc doc-contents first">









  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.get.timelike.subset.bintoR" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">bintoR</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">unc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">R</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">weighting</span><span class="o">=</span><span class="s1">&#39;inversevariance&#39;</span><span class="p">,</span> <span class="n">drop_nans</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.get.timelike.subset.bintoR" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Bin any x and y array onto a logarithmicly uniform grid.</p>
<h4 id="chromatic.rainbows.get.timelike.subset.bintoR--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.get.timelike.subset.bintoR--parameters" title="Permanent link">#</a></h4>
<p>x : array
    The original independent variable.
    (For a spectrum example = wavelength)
y : array
    The original dependent variable (same size as x).
    (For a spectrum example = flux)
unc : array, None, optional
    The unceratinty on the dependent variable
    (For a spectrum example = the flux uncertainty)
R : array, optional
    The spectral resolution R=x/dx for creating a new,
    logarithmically uniform grid that starts at the first
    value of x.
xlim : list, array, optional
    A two-element list indicating the min and max values of
    x for the new logarithmically spaced grid. If None,
    these limits will be created from the data themselves
weighting : str, optional
    How should we weight values when averaging
    them together into one larger bin?
    <code>weighting = 'inversevariance'</code>
        weights = 1/unc**2
     <code>weighting = {literally anything else}</code>
        uniform weights
    This will have no impact if <code>unc == None</code>, or for any
    new bins that effectively overlap less than one original
    unbinned point.
drop_nans : bool, optional
    Should we skip any bins turn out to be nans?
    This most often happens when bins are empty.</p>
<h4 id="chromatic.rainbows.get.timelike.subset.bintoR--returns">Returns<a class="headerlink" href="#chromatic.rainbows.get.timelike.subset.bintoR--returns" title="Permanent link">#</a></h4>
<p>result : dict
    A dictionary containing at least...
        <code>x</code> = the center of the output grid
        <code>y</code> = the resampled value on the output grid
        <code>x_edge_lower</code> = the lower edges of the output grid
        <code>x_edge_upper</code> = the upper edges of the output grid
    ...and possibly also
        <code>uncertainty</code> = the calculated uncertainty per bin</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/tools/resampling.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">bintoR</span><span class="p">(</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">unc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">R</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">weighting</span><span class="o">=</span><span class="s2">&quot;inversevariance&quot;</span><span class="p">,</span> <span class="n">drop_nans</span><span class="o">=</span><span class="kc">True</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Bin any x and y array onto a logarithmicly uniform grid.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : array</span>
<span class="sd">        The original independent variable.</span>
<span class="sd">        (For a spectrum example = wavelength)</span>
<span class="sd">    y : array</span>
<span class="sd">        The original dependent variable (same size as x).</span>
<span class="sd">        (For a spectrum example = flux)</span>
<span class="sd">    unc : array, None, optional</span>
<span class="sd">        The unceratinty on the dependent variable</span>
<span class="sd">        (For a spectrum example = the flux uncertainty)</span>
<span class="sd">    R : array, optional</span>
<span class="sd">        The spectral resolution R=x/dx for creating a new,</span>
<span class="sd">        logarithmically uniform grid that starts at the first</span>
<span class="sd">        value of x.</span>
<span class="sd">    xlim : list, array, optional</span>
<span class="sd">        A two-element list indicating the min and max values of</span>
<span class="sd">        x for the new logarithmically spaced grid. If None,</span>
<span class="sd">        these limits will be created from the data themselves</span>
<span class="sd">    weighting : str, optional</span>
<span class="sd">        How should we weight values when averaging</span>
<span class="sd">        them together into one larger bin?</span>
<span class="sd">        `weighting = &#39;inversevariance&#39;`</span>
<span class="sd">            weights = 1/unc**2</span>
<span class="sd">         `weighting = {literally anything else}`</span>
<span class="sd">            uniform weights</span>
<span class="sd">        This will have no impact if `unc == None`, or for any</span>
<span class="sd">        new bins that effectively overlap less than one original</span>
<span class="sd">        unbinned point.</span>
<span class="sd">    drop_nans : bool, optional</span>
<span class="sd">        Should we skip any bins turn out to be nans?</span>
<span class="sd">        This most often happens when bins are empty.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    result : dict</span>
<span class="sd">        A dictionary containing at least...</span>
<span class="sd">            `x` = the center of the output grid</span>
<span class="sd">            `y` = the resampled value on the output grid</span>
<span class="sd">            `x_edge_lower` = the lower edges of the output grid</span>
<span class="sd">            `x_edge_upper` = the upper edges of the output grid</span>
<span class="sd">        ...and possibly also</span>
<span class="sd">            `uncertainty` = the calculated uncertainty per bin</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">x_unit</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">unit</span>
        <span class="n">x_without_unit</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">value</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="n">x_unit</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">x_without_unit</span> <span class="o">=</span> <span class="n">x</span>

    <span class="c1"># create a new grid of x at the given resolution</span>
    <span class="n">lnx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">x_without_unit</span><span class="p">)</span>
    <span class="n">dnewlnx</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">R</span>

    <span class="c1"># set the limits of the new xgrid (in log space)</span>
    <span class="k">if</span> <span class="n">xlim</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># use the input grid to set the limits</span>
        <span class="n">lnxbottom</span><span class="p">,</span> <span class="n">lnxtop</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">lnx</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">lnx</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># use the custom xlim to set the limits</span>
        <span class="n">lnxbottom</span><span class="p">,</span> <span class="n">lnxtop</span> <span class="o">=</span> <span class="n">xlim</span>

    <span class="c1"># create a new, log-uniform grid of x values</span>
    <span class="n">newlnx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">lnxbottom</span><span class="p">,</span> <span class="n">lnxtop</span> <span class="o">+</span> <span class="n">dnewlnx</span><span class="p">,</span> <span class="n">dnewlnx</span><span class="p">)</span>

    <span class="c1"># now do the binning on a uniform grid of lnx</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">bintogrid</span><span class="p">(</span>
        <span class="n">lnx</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">unc</span><span class="p">,</span> <span class="n">newx</span><span class="o">=</span><span class="n">newlnx</span><span class="p">,</span> <span class="n">weighting</span><span class="o">=</span><span class="n">weighting</span><span class="p">,</span> <span class="n">drop_nans</span><span class="o">=</span><span class="n">drop_nans</span>
    <span class="p">)</span>

    <span class="c1"># convert back from log to real values</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;x_edge_lower&quot;</span><span class="p">,</span> <span class="s2">&quot;x_edge_upper&quot;</span><span class="p">]:</span>
        <span class="n">result</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="o">*</span> <span class="n">x_unit</span>

    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.get.timelike.subset.bintogrid" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">bintogrid</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">unc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">newx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">newx_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">nx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">weighting</span><span class="o">=</span><span class="s1">&#39;inversevariance&#39;</span><span class="p">,</span> <span class="n">drop_nans</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">x_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">visualize</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.get.timelike.subset.bintogrid" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Bin any x and y array onto a linearly uniform grid.</p>
<h4 id="chromatic.rainbows.get.timelike.subset.bintogrid--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.get.timelike.subset.bintogrid--parameters" title="Permanent link">#</a></h4>
<p>x : array
    The original independent variable.
    (For a spectrum example = wavelength)
y : array
    The original dependent variable (same size as x).
    (For a spectrum example = flux)
unc : array, None
    The unceratinty on the dependent variable
    (For a spectrum example = the flux uncertainty)
nx : array
    The number of bins from the original grid to
    bin together into the new one.
dx : array
    The fixed spacing for creating a new, linearly uniform
    grid that start at the first value of x. This will
    be ignored if <code>newx</code> != None.
newx : array
    A new custom grid onto which we should bin.
newx_edges : array
    The edges of the new grid of bins for the independent
    variable, onto which you want to resample the y
    values. The left and right edges of the bins will be,
    respectively, <code>newx_edges[:-1]</code> and <code>newx_edges[1:]</code>,
    so the size of the output array will be
    <code>len(newx_edges) - 1</code>
weighting : str
    How should we weight values when averaging
    them together into one larger bin?
    <code>weighting = 'inversevariance'</code>
        weights = 1/unc**2
     <code>weighting = {literally anything else}</code>
        uniform weights
    This will have no impact if <code>unc == None</code>, or for any
    new bins that effectively overlap less than one original
    unbinned point.
drop_nans : bool
    Should we skip any bins turn out to be nans?
    This most often happens when bins are empty.
x_edges : array
    The edges of the original independent variable bins.
    The left and right edges of the bins are interpreted
    to be <code>x_edges[:-1]</code> and <code>x_edges[1:]</code>,
    respectively, so the associated <code>y</code> should have exactly
    1 fewer element than <code>x_edges</code>. This provides finer
    control over the size of each bin in the input than
    simply supplying <code>x</code>(still a little experimental)</p>
<h4 id="chromatic.rainbows.get.timelike.subset.bintogrid--returns">Returns<a class="headerlink" href="#chromatic.rainbows.get.timelike.subset.bintogrid--returns" title="Permanent link">#</a></h4>
<p>result : dict
    A dictionary containing at least...
        <code>x</code> = the center of the output grid
        <code>y</code> = the resampled value on the output grid
        <code>x_edge_lower</code> = the lower edges of the output grid
        <code>x_edge_upper</code> = the upper edges of the output grid
    ...and possibly also
        <code>uncertainty</code> = the calculated uncertainty per bin</p>
<p>The order of precendence for setting the new grid is
[<code>newx_edges</code>, <code>newx</code>, <code>dx</code>, <code>nx</code>]
The first will be used, and others will be ignored.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/tools/resampling.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">bintogrid</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">unc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">newx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">newx_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">dx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">nx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">weighting</span><span class="o">=</span><span class="s2">&quot;inversevariance&quot;</span><span class="p">,</span>
    <span class="n">drop_nans</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">x_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">visualize</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Bin any x and y array onto a linearly uniform grid.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : array</span>
<span class="sd">        The original independent variable.</span>
<span class="sd">        (For a spectrum example = wavelength)</span>
<span class="sd">    y : array</span>
<span class="sd">        The original dependent variable (same size as x).</span>
<span class="sd">        (For a spectrum example = flux)</span>
<span class="sd">    unc : array, None</span>
<span class="sd">        The unceratinty on the dependent variable</span>
<span class="sd">        (For a spectrum example = the flux uncertainty)</span>
<span class="sd">    nx : array</span>
<span class="sd">        The number of bins from the original grid to</span>
<span class="sd">        bin together into the new one.</span>
<span class="sd">    dx : array</span>
<span class="sd">        The fixed spacing for creating a new, linearly uniform</span>
<span class="sd">        grid that start at the first value of x. This will</span>
<span class="sd">        be ignored if `newx` != None.</span>
<span class="sd">    newx : array</span>
<span class="sd">        A new custom grid onto which we should bin.</span>
<span class="sd">    newx_edges : array</span>
<span class="sd">        The edges of the new grid of bins for the independent</span>
<span class="sd">        variable, onto which you want to resample the y</span>
<span class="sd">        values. The left and right edges of the bins will be,</span>
<span class="sd">        respectively, `newx_edges[:-1]` and `newx_edges[1:]`,</span>
<span class="sd">        so the size of the output array will be</span>
<span class="sd">        `len(newx_edges) - 1`</span>
<span class="sd">    weighting : str</span>
<span class="sd">        How should we weight values when averaging</span>
<span class="sd">        them together into one larger bin?</span>
<span class="sd">        `weighting = &#39;inversevariance&#39;`</span>
<span class="sd">            weights = 1/unc**2</span>
<span class="sd">         `weighting = {literally anything else}`</span>
<span class="sd">            uniform weights</span>
<span class="sd">        This will have no impact if `unc == None`, or for any</span>
<span class="sd">        new bins that effectively overlap less than one original</span>
<span class="sd">        unbinned point.</span>
<span class="sd">    drop_nans : bool</span>
<span class="sd">        Should we skip any bins turn out to be nans?</span>
<span class="sd">        This most often happens when bins are empty.</span>
<span class="sd">    x_edges : array</span>
<span class="sd">        The edges of the original independent variable bins.</span>
<span class="sd">        The left and right edges of the bins are interpreted</span>
<span class="sd">        to be `x_edges[:-1]` and `x_edges[1:]`,</span>
<span class="sd">        respectively, so the associated `y` should have exactly</span>
<span class="sd">        1 fewer element than `x_edges`. This provides finer</span>
<span class="sd">        control over the size of each bin in the input than</span>
<span class="sd">        simply supplying `x`(still a little experimental)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    result : dict</span>
<span class="sd">        A dictionary containing at least...</span>
<span class="sd">            `x` = the center of the output grid</span>
<span class="sd">            `y` = the resampled value on the output grid</span>
<span class="sd">            `x_edge_lower` = the lower edges of the output grid</span>
<span class="sd">            `x_edge_upper` = the upper edges of the output grid</span>
<span class="sd">        ...and possibly also</span>
<span class="sd">            `uncertainty` = the calculated uncertainty per bin</span>


<span class="sd">    The order of precendence for setting the new grid is</span>
<span class="sd">    [`newx_edges`, `newx`, `dx`, `nx`]</span>
<span class="sd">    The first will be used, and others will be ignored.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># check that an OK set of inputs has been supplied</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">x_edges</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;🌈 Both `x` and `x_edges` were supplied to `bintogrid`. Confusing!&quot;&quot;&quot;</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">x_edges</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;🌈 At least one of `x` or `x_edges` must be supplied to `bintogrid`.&quot;&quot;&quot;</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="n">y</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;🌈 `y` must be supplied to `bintogrid`.&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="c1"># make sure the edges and the centers are set</span>
    <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">x_left</span><span class="p">,</span> <span class="n">x_right</span> <span class="o">=</span> <span class="n">edges_to_leftright</span><span class="p">(</span><span class="n">x_edges</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">left</span> <span class="o">+</span> <span class="n">right</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">x_left</span><span class="p">,</span> <span class="n">x_right</span> <span class="o">=</span> <span class="n">calculate_bin_leftright</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">x_edges</span> <span class="o">=</span> <span class="n">leftright_to_edges</span><span class="p">(</span><span class="n">x_left</span><span class="p">,</span> <span class="n">x_right</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">x_unit</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">unit</span>
        <span class="n">x_without_unit</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">value</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="n">x_unit</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">x_without_unit</span> <span class="o">=</span> <span class="n">x</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">y_unit</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">unit</span>
        <span class="n">y_without_unit</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">value</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="n">y_unit</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">y_without_unit</span> <span class="o">=</span> <span class="n">y</span>

    <span class="c1"># warn if multiple inputs are provided</span>
    <span class="n">number_of_grid_options</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span><span class="n">z</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="p">[</span><span class="n">newx_edges</span><span class="p">,</span> <span class="n">newx</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">nx</span><span class="p">]])</span>
    <span class="k">if</span> <span class="n">number_of_grid_options</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">cheerfully_suggest</span><span class="p">(</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;More than one output grid sent to `bintogrid`.</span>
<span class="sd">                         The one being used is the first to appear in</span>
<span class="sd">                         [`newx_edges`, `newx`, `dx`, `nx`]</span>
<span class="sd">                         but you might want to choose more carefully.&quot;&quot;&quot;</span>
        <span class="p">)</span>

    <span class="c1"># define inputs based on the following order</span>
    <span class="k">if</span> <span class="n">newx_edges</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># define grid by its edges (and define others from there)</span>
        <span class="n">newx_edges_without_unit</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">newx_edges</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">x_unit</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
        <span class="n">dx_without_unit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">newx_edges_without_unit</span><span class="p">)</span>
        <span class="n">newx_without_unit</span> <span class="o">=</span> <span class="n">newx_edges_without_unit</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">dx_without_unit</span>
        <span class="n">newx_left_without_unit</span> <span class="o">=</span> <span class="n">newx_edges_without_unit</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">newx_right_without_unit</span> <span class="o">=</span> <span class="n">newx_edges_without_unit</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

        <span class="c1"># make sure the final output grid is defined</span>
        <span class="n">final_newx</span><span class="p">,</span> <span class="n">final_newx_left</span><span class="p">,</span> <span class="n">final_newx_right</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">newx_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
            <span class="n">newx_left_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
            <span class="n">newx_right_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="n">newx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># define grid by its centers (and define others from there)</span>
        <span class="n">newx_without_unit</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">newx</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">x_unit</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
        <span class="n">newx_left_without_unit</span><span class="p">,</span> <span class="n">newx_right_without_unit</span> <span class="o">=</span> <span class="n">calculate_bin_leftright</span><span class="p">(</span>
            <span class="n">newx_without_unit</span>
        <span class="p">)</span>
        <span class="n">newx_edges_without_unit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span>
            <span class="p">[</span><span class="n">newx_left_without_unit</span><span class="p">,</span> <span class="n">newx_right_without_unit</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
        <span class="p">)</span>
        <span class="n">dx_without_unit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">newx_edges_without_unit</span><span class="p">)</span>

        <span class="c1"># make sure the final output grid is defined</span>
        <span class="n">final_newx</span><span class="p">,</span> <span class="n">final_newx_left</span><span class="p">,</span> <span class="n">final_newx_right</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">newx_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
            <span class="n">newx_left_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
            <span class="n">newx_right_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="n">dx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># define grid by a bin width (and define others from there)</span>
        <span class="n">dx_without_unit</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">dx</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">x_unit</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
        <span class="n">newx_without_unit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">x_without_unit</span><span class="p">),</span>
            <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">x_without_unit</span><span class="p">)</span> <span class="o">+</span> <span class="n">dx_without_unit</span><span class="p">,</span>
            <span class="n">dx_without_unit</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">newx_left_without_unit</span><span class="p">,</span> <span class="n">newx_right_without_unit</span> <span class="o">=</span> <span class="n">calculate_bin_leftright</span><span class="p">(</span>
            <span class="n">newx_without_unit</span>
        <span class="p">)</span>
        <span class="n">newx_edges_without_unit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span>
            <span class="p">[</span><span class="n">newx_left_without_unit</span><span class="p">,</span> <span class="n">newx_right_without_unit</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
        <span class="p">)</span>

        <span class="c1"># make sure the final output grid is defined</span>
        <span class="n">final_newx</span><span class="p">,</span> <span class="n">final_newx_left</span><span class="p">,</span> <span class="n">final_newx_right</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">newx_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
            <span class="n">newx_left_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
            <span class="n">newx_right_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">elif</span> <span class="n">nx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># keep track of the original input x values</span>
        <span class="n">original_x_without_unit</span> <span class="o">=</span> <span class="n">x_without_unit</span>

        <span class="c1"># redefine the input x to indices, to do interpolation in index space</span>
        <span class="n">x_without_unit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">x_without_unit</span><span class="p">))</span>

        <span class="c1"># define a grid of edges that will enclose the right number of indices</span>
        <span class="n">x_left_i</span><span class="p">,</span> <span class="n">x_right_i</span> <span class="o">=</span> <span class="n">calculate_bin_leftright</span><span class="p">(</span><span class="n">x_without_unit</span><span class="p">)</span>
        <span class="n">newx_edges_without_unit</span> <span class="o">=</span> <span class="n">leftright_to_edges</span><span class="p">(</span><span class="n">x_left_i</span><span class="p">,</span> <span class="n">x_right_i</span><span class="p">)[::</span><span class="n">nx</span><span class="p">]</span>
        <span class="n">newx_without_unit</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span>
            <span class="n">newx_edges_without_unit</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">+</span> <span class="n">newx_edges_without_unit</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="p">)</span>

        <span class="c1"># calculate the actual x values corresponding to the bins</span>
        <span class="n">original_edges</span> <span class="o">=</span> <span class="n">leftright_to_edges</span><span class="p">(</span>
            <span class="o">*</span><span class="n">calculate_bin_leftright</span><span class="p">(</span><span class="n">original_x_without_unit</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">final_edges</span> <span class="o">=</span> <span class="n">original_edges</span><span class="p">[::</span><span class="n">nx</span><span class="p">]</span> <span class="o">*</span> <span class="n">x_unit</span>
        <span class="n">final_newx_left</span><span class="p">,</span> <span class="n">final_newx_right</span> <span class="o">=</span> <span class="n">edges_to_leftright</span><span class="p">(</span><span class="n">final_edges</span><span class="p">)</span>
        <span class="n">final_newx</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">final_newx_left</span> <span class="o">+</span> <span class="n">final_newx_right</span><span class="p">)</span>
        <span class="n">dx_without_unit</span> <span class="o">=</span> <span class="p">(</span><span class="n">final_newx_right</span> <span class="o">-</span> <span class="n">final_newx_left</span><span class="p">)</span> <span class="o">/</span> <span class="n">x_unit</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;No output grid sent to `bintogrid`.</span>
<span class="sd">                              Please choose one of the following:</span>
<span class="sd">                              [`newx_edges`, `newx`, `dx`, `nx`]&quot;&quot;&quot;</span>
        <span class="p">)</span>

    <span class="c1"># don&#39;t complain about zero-divisions in here (to allow infinite uncertainties)</span>
    <span class="k">with</span> <span class="n">np</span><span class="o">.</span><span class="n">errstate</span><span class="p">(</span><span class="n">divide</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">invalid</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">):</span>

        <span class="c1"># calculate weight integrals for the bin array</span>
        <span class="n">ok</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">y_without_unit</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span>

        <span class="c1"># resample the sums onto that new grid</span>
        <span class="k">if</span> <span class="n">unc</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">x_without_unit</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">weighting</span> <span class="o">==</span> <span class="s2">&quot;inversevariance&quot;</span><span class="p">:</span>
                <span class="n">weights</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">unc</span><span class="o">**</span><span class="mi">2</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">x_without_unit</span><span class="p">)</span>

            <span class="c1"># ignore infinite weights (= 0 uncertainties)</span>
            <span class="n">ok</span> <span class="o">*=</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">ok</span><span class="p">):</span>
            <span class="n">numerator</span> <span class="o">=</span> <span class="n">resample_while_conserving_flux</span><span class="p">(</span>
                <span class="n">xin</span><span class="o">=</span><span class="n">x_without_unit</span><span class="p">[</span><span class="n">ok</span><span class="p">],</span>
                <span class="n">yin</span><span class="o">=</span><span class="p">(</span><span class="n">y_without_unit</span> <span class="o">*</span> <span class="n">weights</span><span class="p">)[</span><span class="n">ok</span><span class="p">],</span>
                <span class="n">xout_edges</span><span class="o">=</span><span class="n">newx_edges_without_unit</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">denominator</span> <span class="o">=</span> <span class="n">resample_while_conserving_flux</span><span class="p">(</span>
                <span class="n">xin</span><span class="o">=</span><span class="n">x_without_unit</span><span class="p">[</span><span class="n">ok</span><span class="p">],</span>
                <span class="n">yin</span><span class="o">=</span><span class="n">weights</span><span class="p">[</span><span class="n">ok</span><span class="p">],</span>
                <span class="n">xout_edges</span><span class="o">=</span><span class="n">newx_edges_without_unit</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="c1"># the binned weighted means on the new grid</span>
            <span class="n">newy</span> <span class="o">=</span> <span class="n">numerator</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">denominator</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span>

            <span class="c1"># the standard error on the means, for those bins</span>
            <span class="n">newunc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">denominator</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">])</span>

            <span class="c1"># keep track of the number of original bins going into each new bin</span>
            <span class="n">number_of_original_bins_per_new_bin</span> <span class="o">=</span> <span class="n">resample_while_conserving_flux</span><span class="p">(</span>
                <span class="n">xin</span><span class="o">=</span><span class="n">x_without_unit</span><span class="p">[</span><span class="n">ok</span><span class="p">],</span>
                <span class="n">yin</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">y_without_unit</span><span class="p">)[</span><span class="n">ok</span><span class="p">],</span>
                <span class="n">xout_edges</span><span class="o">=</span><span class="n">newx_edges_without_unit</span><span class="p">,</span>
            <span class="p">)[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">newy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="o">*</span> <span class="n">newx_without_unit</span>
            <span class="n">newunc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="o">*</span> <span class="n">newx_without_unit</span>
            <span class="n">number_of_original_bins_per_new_bin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">newx_without_unit</span><span class="p">)</span>

    <span class="c1"># remove any empty bins</span>
    <span class="k">if</span> <span class="n">drop_nans</span><span class="p">:</span>
        <span class="n">ok</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">newy</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ok</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">newx_without_unit</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>

    <span class="c1"># if no uncertainties were given, don&#39;t return uncertainties</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># populate the new grid centers + edges + values</span>
    <span class="n">result</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">final_newx</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span>
    <span class="n">result</span><span class="p">[</span><span class="s2">&quot;x_edge_lower&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">final_newx_left</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span>
    <span class="n">result</span><span class="p">[</span><span class="s2">&quot;x_edge_upper&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">final_newx_right</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span>

    <span class="c1"># populate the new grid values</span>
    <span class="n">result</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">newy</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span> <span class="o">*</span> <span class="n">y_unit</span>

    <span class="c1"># populate the new grid value uncertainties</span>
    <span class="k">if</span> <span class="n">unc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">result</span><span class="p">[</span><span class="s2">&quot;uncertainty&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">newunc</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span> <span class="o">*</span> <span class="n">y_unit</span>

    <span class="c1"># store how many of the original pixels made it into this new one</span>
    <span class="n">result</span><span class="p">[</span><span class="s2">&quot;N_unbinned/N_binned&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">number_of_original_bins_per_new_bin</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">visualize</span><span class="p">:</span>
        <span class="n">fi</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span>
            <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">gridspec_kw</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">height_ratios</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">])</span>
        <span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">plot_as_boxes</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">xleft</span><span class="o">=</span><span class="n">x_left</span><span class="p">,</span> <span class="n">xright</span><span class="o">=</span><span class="n">x_right</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;silver&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">ekw</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">elinewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">unc</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;silver&quot;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">ekw</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">],</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">],</span>
            <span class="n">yerr</span><span class="o">=</span><span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;uncertainty&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
            <span class="n">xerr</span><span class="o">=</span><span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s2">&quot;x_edge_upper&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;x_edge_lower&quot;</span><span class="p">])</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
            <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
            <span class="n">zorder</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
            <span class="o">**</span><span class="n">ekw</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">plot_as_boxes</span><span class="p">(</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">],</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;N_unbinned/N_binned&quot;</span><span class="p">],</span>
            <span class="n">xleft</span><span class="o">=</span><span class="n">result</span><span class="p">[</span><span class="s2">&quot;x_edge_lower&quot;</span><span class="p">],</span>
            <span class="n">xright</span><span class="o">=</span><span class="n">result</span><span class="p">[</span><span class="s2">&quot;x_edge_upper&quot;</span><span class="p">],</span>
        <span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;$N_</span><span class="si">{unbinned}</span><span class="s2">/N_</span><span class="si">{binned}</span><span class="s2">$&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.get.timelike.subset.calculate_bin_leftright" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">calculate_bin_leftright</span><span class="p">(</span><span class="n">x</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.get.timelike.subset.calculate_bin_leftright" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>If x is an array of bin centers, calculate the bin edges.
(assumes outermost bins are same size as their neighbors)</p>
<h4 id="chromatic.rainbows.get.timelike.subset.calculate_bin_leftright--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.get.timelike.subset.calculate_bin_leftright--parameters" title="Permanent link">#</a></h4>
<p>x : array
    The array of bin centers.</p>
<h4 id="chromatic.rainbows.get.timelike.subset.calculate_bin_leftright--returns">Returns<a class="headerlink" href="#chromatic.rainbows.get.timelike.subset.calculate_bin_leftright--returns" title="Permanent link">#</a></h4>
<p>l : array
    The left edges of the bins.
r : array
    The right edges of the bins.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/tools/resampling.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">calculate_bin_leftright</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    If x is an array of bin centers, calculate the bin edges.</span>
<span class="sd">    (assumes outermost bins are same size as their neighbors)</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : array</span>
<span class="sd">        The array of bin centers.</span>

<span class="sd">    Returns</span>
<span class="sd">    ----------</span>
<span class="sd">    l : array</span>
<span class="sd">        The left edges of the bins.</span>
<span class="sd">    r : array</span>
<span class="sd">        The right edges of the bins.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># what are bin edges (making a guess for those on the ends)</span>
    <span class="c1"># xbinsize = calculate_bin_widths(x)</span>
    <span class="c1"># left = x - xbinsize / 2.0</span>
    <span class="c1"># right = x + xbinsize / 2.0</span>

    <span class="c1"># weird corner case!</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">left</span><span class="p">,</span> <span class="n">right</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">left</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">right</span><span class="p">])</span>

    <span class="n">inner_edges</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="n">x</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">first_edge</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="n">inner_edges</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">last_edge</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">inner_edges</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

    <span class="n">left</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">first_edge</span><span class="p">,</span> <span class="n">inner_edges</span><span class="p">])</span>
    <span class="n">right</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">inner_edges</span><span class="p">,</span> <span class="n">last_edge</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.get.timelike.subset.edges_to_leftright" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">edges_to_leftright</span><span class="p">(</span><span class="n">edges</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.get.timelike.subset.edges_to_leftright" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Convert N+1 contiguous edges to two arrays of N left/right edges.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/tools/resampling.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">edges_to_leftright</span><span class="p">(</span><span class="n">edges</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert N+1 contiguous edges to two arrays of N left/right edges.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">left</span><span class="p">,</span> <span class="n">right</span> <span class="o">=</span> <span class="n">edges</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">edges</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="k">return</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.get.timelike.subset.expand_filenames" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">expand_filenames</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.get.timelike.subset.expand_filenames" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>A wrapper to expand a string or list into a list of filenames.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/imports.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">expand_filenames</span><span class="p">(</span><span class="n">filepath</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A wrapper to expand a string or list into a list of filenames.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
        <span class="n">filenames</span> <span class="o">=</span> <span class="n">filepath</span>
    <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span> <span class="o">==</span> <span class="n">Column</span><span class="p">:</span>
        <span class="n">filenames</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>
    <span class="k">elif</span> <span class="s2">&quot;*&quot;</span> <span class="ow">in</span> <span class="n">filepath</span><span class="p">:</span>
        <span class="n">filenames</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">filepath</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">filenames</span> <span class="o">=</span> <span class="p">[</span><span class="n">filepath</span><span class="p">]</span>
    <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">filenames</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.get.timelike.subset.get_for_time" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_for_time</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">quantity</span><span class="o">=</span><span class="s1">&#39;flux&#39;</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.get.timelike.subset.get_for_time" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Get <code>'quantity'</code> associated with time <code>'i'</code>.</p>
<h4 id="chromatic.rainbows.get.timelike.subset.get_for_time--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.get.timelike.subset.get_for_time--parameters" title="Permanent link">#</a></h4>
<p>i : int
    The time index to retrieve.
quantity : string
    The quantity to retrieve. If it is flux-like,
    column 'i' will be returned. If it is wave-like,
    the array itself will be returned.</p>
<h4 id="chromatic.rainbows.get.timelike.subset.get_for_time--returns">Returns<a class="headerlink" href="#chromatic.rainbows.get.timelike.subset.get_for_time--returns" title="Permanent link">#</a></h4>
<p>quantity : array, Quantity
    The 1D array of 'quantity' corresponding to time 'i'.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/rainbows/get/timelike/subset.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_for_time</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">quantity</span><span class="o">=</span><span class="s2">&quot;flux&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get `&#39;quantity&#39;` associated with time `&#39;i&#39;`.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    i : int</span>
<span class="sd">        The time index to retrieve.</span>
<span class="sd">    quantity : string</span>
<span class="sd">        The quantity to retrieve. If it is flux-like,</span>
<span class="sd">        column &#39;i&#39; will be returned. If it is wave-like,</span>
<span class="sd">        the array itself will be returned.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    quantity : array, Quantity</span>
<span class="sd">        The 1D array of &#39;quantity&#39; corresponding to time &#39;i&#39;.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">quantity</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">z</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">z</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">z</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">nwave</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">z</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        You tried to retrieve time </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2"> from &#39;</span><span class="si">{</span><span class="n">quantity</span><span class="si">}</span><span class="s2">&#39;,</span>
<span class="s2">        but this quantity is neither flux-like nor wave-like.</span>
<span class="s2">        It&#39;s not possible to return a wave-like array. Sorry!</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.get.timelike.subset.get_ok_data_for_time" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_ok_data_for_time</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;wavelength&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;flux&#39;</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="s1">&#39;uncertainty&#39;</span><span class="p">,</span> <span class="n">minimum_acceptable_ok</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">express_badness_with_uncertainty</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.get.timelike.subset.get_ok_data_for_time" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>A small wrapper to get the good data from a time.</p>
<p>Extract a slice of data, marking data that are not <code>ok</code> either
by trimming them out entirely or by inflating their
uncertainties to infinity.</p>
<h4 id="chromatic.rainbows.get.timelike.subset.get_ok_data_for_time--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.get.timelike.subset.get_ok_data_for_time--parameters" title="Permanent link">#</a></h4>
<p>i : int
    The time index to retrieve.
x : string, optional
    What quantity should be retrieved as 'x'? (default = 'time')
y : string, optional
    What quantity should be retrieved as 'y'? (default = 'flux')
sigma : string, optional
    What quantity should be retrieved as 'sigma'? (default = 'uncertainty')
minimum_acceptable_ok : float, optional
    The smallest value of <code>ok</code> that will still be included.
    (1 for perfect data, 1e-10 for everything but terrible data, 0 for all data)
express_badness_with_uncertainty : bool, optional
    If False, data that don't pass the <code>ok</code> cut will be removed.
    If True, data that don't pass the <code>ok</code> cut will have their
    uncertainties inflated to infinity (np.inf).</p>
<h4 id="chromatic.rainbows.get.timelike.subset.get_ok_data_for_time--returns">Returns<a class="headerlink" href="#chromatic.rainbows.get.timelike.subset.get_ok_data_for_time--returns" title="Permanent link">#</a></h4>
<p>x : array
    The time.
y : array
    The desired quantity (default is <code>flux</code>)
sigma : array
    The uncertainty on the desired quantity</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/rainbows/get/timelike/subset.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_ok_data_for_time</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">i</span><span class="p">,</span>
    <span class="n">x</span><span class="o">=</span><span class="s2">&quot;wavelength&quot;</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s2">&quot;flux&quot;</span><span class="p">,</span>
    <span class="n">sigma</span><span class="o">=</span><span class="s2">&quot;uncertainty&quot;</span><span class="p">,</span>
    <span class="n">minimum_acceptable_ok</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">express_badness_with_uncertainty</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A small wrapper to get the good data from a time.</span>

<span class="sd">    Extract a slice of data, marking data that are not `ok` either</span>
<span class="sd">    by trimming them out entirely or by inflating their</span>
<span class="sd">    uncertainties to infinity.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    i : int</span>
<span class="sd">        The time index to retrieve.</span>
<span class="sd">    x : string, optional</span>
<span class="sd">        What quantity should be retrieved as &#39;x&#39;? (default = &#39;time&#39;)</span>
<span class="sd">    y : string, optional</span>
<span class="sd">        What quantity should be retrieved as &#39;y&#39;? (default = &#39;flux&#39;)</span>
<span class="sd">    sigma : string, optional</span>
<span class="sd">        What quantity should be retrieved as &#39;sigma&#39;? (default = &#39;uncertainty&#39;)</span>
<span class="sd">    minimum_acceptable_ok : float, optional</span>
<span class="sd">        The smallest value of `ok` that will still be included.</span>
<span class="sd">        (1 for perfect data, 1e-10 for everything but terrible data, 0 for all data)</span>
<span class="sd">    express_badness_with_uncertainty : bool, optional</span>
<span class="sd">        If False, data that don&#39;t pass the `ok` cut will be removed.</span>
<span class="sd">        If True, data that don&#39;t pass the `ok` cut will have their</span>
<span class="sd">        uncertainties inflated to infinity (np.inf).</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    x : array</span>
<span class="sd">        The time.</span>
<span class="sd">    y : array</span>
<span class="sd">        The desired quantity (default is `flux`)</span>
<span class="sd">    sigma : array</span>
<span class="sd">        The uncertainty on the desired quantity</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># get 1D independent variable</span>
    <span class="n">x_values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_for_time</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1</span>

    <span class="c1"># get 1D array of what to keep</span>
    <span class="n">ok</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ok</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">minimum_acceptable_ok</span>

    <span class="c1"># get 1D array of the quantity</span>
    <span class="n">y_values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_for_time</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1</span>

    <span class="c1"># get 1D array of uncertainty</span>
    <span class="n">sigma_values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_for_time</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">sigma</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1</span>

    <span class="k">if</span> <span class="n">express_badness_with_uncertainty</span><span class="p">:</span>
        <span class="n">sigma_values</span><span class="p">[</span><span class="n">ok</span> <span class="o">==</span> <span class="kc">False</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
        <span class="k">return</span> <span class="n">x_values</span><span class="p">,</span> <span class="n">y_values</span><span class="p">,</span> <span class="n">sigma_values</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">x_values</span><span class="p">[</span><span class="n">ok</span><span class="p">],</span> <span class="n">y_values</span><span class="p">[</span><span class="n">ok</span><span class="p">],</span> <span class="n">sigma_values</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.get.timelike.subset.leftright_to_edges" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">leftright_to_edges</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.get.timelike.subset.leftright_to_edges" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Convert two arrays of N left/right edges to N+1 continugous edges.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/tools/resampling.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">leftright_to_edges</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert two arrays of N left/right edges to N+1 continugous edges.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">edges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>
    <span class="k">return</span> <span class="n">edges</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.get.timelike.subset.name2color" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">name2color</span><span class="p">(</span><span class="n">name</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.get.timelike.subset.name2color" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Return the 3-element RGB array of a given color name.</p>
<h4 id="chromatic.rainbows.get.timelike.subset.name2color--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.get.timelike.subset.name2color--parameters" title="Permanent link">#</a></h4>
<p>name : str
    The name of a color</p>
<h4 id="chromatic.rainbows.get.timelike.subset.name2color--returns">Returns<a class="headerlink" href="#chromatic.rainbows.get.timelike.subset.name2color--returns" title="Permanent link">#</a></h4>
<p>rgb : tuple
    3-element RGB color, with numbers from 0.0 to 1.0</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/imports.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">name2color</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return the 3-element RGB array of a given color name.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    name : str</span>
<span class="sd">        The name of a color</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    rgb : tuple</span>
<span class="sd">        3-element RGB color, with numbers from 0.0 to 1.0</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># give a friendly warning if the color name can&#39;t be found</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">color_hex</span> <span class="o">=</span> <span class="n">col</span><span class="o">.</span><span class="n">cnames</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">col</span><span class="o">.</span><span class="n">hex2color</span><span class="p">(</span><span class="n">color_hex</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="n">cheerfully_suggest</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The color </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> can&#39;t be found. (Returning black.)&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.get.timelike.subset.one2another" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">one2another</span><span class="p">(</span><span class="n">bottom</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">alpha_bottom</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">alpha_top</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">256</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.get.timelike.subset.one2another" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Create a cmap that goes smoothly (linearly in RGBA) from "bottom" to "top".</p>
<h4 id="chromatic.rainbows.get.timelike.subset.one2another--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.get.timelike.subset.one2another--parameters" title="Permanent link">#</a></h4>
<p>bottom : str
    Name of a color for the bottom of cmap (0.0)
top : str
    Name of a color for the top of the cmap (1.0)
alpha_bottom : float
    Opacity at the bottom of the cmap
alpha_top : float
    Opacitiy at the top of the cmap
N : int
    The number of levels in the listed color map</p>
<h4 id="chromatic.rainbows.get.timelike.subset.one2another--returns">Returns<a class="headerlink" href="#chromatic.rainbows.get.timelike.subset.one2another--returns" title="Permanent link">#</a></h4>
<p>cmap : Colormap
    A color map that goes linearly from the
    bottom to top color (and alpha).</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/imports.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">one2another</span><span class="p">(</span><span class="n">bottom</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">alpha_bottom</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">alpha_top</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">256</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a cmap that goes smoothly (linearly in RGBA) from &quot;bottom&quot; to &quot;top&quot;.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    bottom : str</span>
<span class="sd">        Name of a color for the bottom of cmap (0.0)</span>
<span class="sd">    top : str</span>
<span class="sd">        Name of a color for the top of the cmap (1.0)</span>
<span class="sd">    alpha_bottom : float</span>
<span class="sd">        Opacity at the bottom of the cmap</span>
<span class="sd">    alpha_top : float</span>
<span class="sd">        Opacitiy at the top of the cmap</span>
<span class="sd">    N : int</span>
<span class="sd">        The number of levels in the listed color map</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    cmap : Colormap</span>
<span class="sd">        A color map that goes linearly from the</span>
<span class="sd">        bottom to top color (and alpha).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># get the RGB values of the bottom and top of the cmap</span>
    <span class="n">rgb_bottom</span><span class="p">,</span> <span class="n">rgb_top</span> <span class="o">=</span> <span class="n">name2color</span><span class="p">(</span><span class="n">bottom</span><span class="p">),</span> <span class="n">name2color</span><span class="p">(</span><span class="n">top</span><span class="p">)</span>

    <span class="c1"># create linear gradients for all four RGBA channels</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">rgb_bottom</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">rgb_top</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">N</span><span class="p">)</span>
    <span class="n">g</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">rgb_bottom</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">rgb_top</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">N</span><span class="p">)</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">rgb_bottom</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">rgb_top</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">N</span><span class="p">)</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">alpha_bottom</span><span class="p">,</span> <span class="n">alpha_top</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>

    <span class="c1"># create (N,4) array + populate a listed colormap</span>
    <span class="n">colors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">]))</span>
    <span class="n">cmap</span> <span class="o">=</span> <span class="n">col</span><span class="o">.</span><span class="n">ListedColormap</span><span class="p">(</span><span class="n">colors</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{bottom}</span><span class="s2">2</span><span class="si">{top}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="nb">locals</span><span class="p">()))</span>

    <span class="c1"># return the colormap</span>
    <span class="k">return</span> <span class="n">cmap</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.get.timelike.subset.remove_unit" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">remove_unit</span><span class="p">(</span><span class="n">x</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.get.timelike.subset.remove_unit" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Quick wrapper to remove the unit from a quantity,
but not complain if it doesn't have one.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/imports.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">remove_unit</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Quick wrapper to remove the unit from a quantity,</span>
<span class="sd">    but not complain if it doesn&#39;t have one.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">x</span><span class="o">.</span><span class="n">value</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">x</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.get.timelike.subset.resample_while_conserving_flux" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">resample_while_conserving_flux</span><span class="p">(</span><span class="n">xin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">yin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xout</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xin_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xout_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">replace_nans</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">visualize</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">pause</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.get.timelike.subset.resample_while_conserving_flux" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Starting from some initial x and y, resample onto a
different grid (either higher or lower resolution),
while conserving total flux.</p>
<p>When including the entire range of <code>xin</code>,
<code>sum(yout) == sum(yin)</code> should be true.</p>
<p>When including only part of the range of <code>xin</code>,
the integral between any two points should be conserved.</p>
<h4 id="chromatic.rainbows.get.timelike.subset.resample_while_conserving_flux--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.get.timelike.subset.resample_while_conserving_flux--parameters" title="Permanent link">#</a></h4>
<p>xin : array
    The original independent variable.
yin : array
    The original dependent variable (same size as x).
xout : array
    The new grid of independent variables onto which
    you want to resample the y values. Refers to the
    center of each bin (use <code>xout_edges</code> for finer
    control over the exact edges of the bins)
xin_edges : array
    The edges of the original independent variable bins.
    The left and right edges of the bins are interpreted
    to be <code>xin_edges[:-1]</code> and <code>xin_edges[1:]</code>,
    respectively, so the associated <code>yin</code> should have exactly
    1 fewer element than <code>xin_edges</code>. This provides finer
    control over the size of each bin in the input than
    simply supplying <code>xin</code>(still a little experimental)
    They should probably be sorted?
xout_edges : array
    The edges of the new grid of bins for the independent
    variable, onto which you want to resample the y
    values. The left and right edges of the bins will be,
    respectively, <code>xout_edges[:-1]</code> and <code>xout_edges[1:]</code>,
    so the size of the output array will be
    <code>len(xout_edges) - 1</code>
replace_nans : float, str
    Replace nan values with this value.
    <code>replace_nans = 0</code>
        will add no flux where nans are
    <code>replace_nans = nan</code>
        will ensure you get nans returned everywhere
        if you try to resample over any nan
    <code>replace_nans = 'interpolate'</code>
        will try to replace nans by linearly interpolating
        from nearby values (not yet implemented)
visualize : bool
    Should we make a plot showing whether it worked?
pause : bool
    Should we pause to wait for a key press?</p>
<h4 id="chromatic.rainbows.get.timelike.subset.resample_while_conserving_flux--returns">Returns<a class="headerlink" href="#chromatic.rainbows.get.timelike.subset.resample_while_conserving_flux--returns" title="Permanent link">#</a></h4>
<p>result : dict
    A dictionary containing...
        <code>x</code> = the center of the output grid
        <code>y</code> = the resampled value on the output grid
        <code>edges</code> = the edges of the output grid, which will
            have one more element than x or y</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/tools/resampling.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">resample_while_conserving_flux</span><span class="p">(</span>
    <span class="n">xin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">yin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">xout</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">xin_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">xout_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">replace_nans</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
    <span class="n">visualize</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">pause</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Starting from some initial x and y, resample onto a</span>
<span class="sd">    different grid (either higher or lower resolution),</span>
<span class="sd">    while conserving total flux.</span>

<span class="sd">    When including the entire range of `xin`,</span>
<span class="sd">    `sum(yout) == sum(yin)` should be true.</span>

<span class="sd">    When including only part of the range of `xin`,</span>
<span class="sd">    the integral between any two points should be conserved.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    xin : array</span>
<span class="sd">        The original independent variable.</span>
<span class="sd">    yin : array</span>
<span class="sd">        The original dependent variable (same size as x).</span>
<span class="sd">    xout : array</span>
<span class="sd">        The new grid of independent variables onto which</span>
<span class="sd">        you want to resample the y values. Refers to the</span>
<span class="sd">        center of each bin (use `xout_edges` for finer</span>
<span class="sd">        control over the exact edges of the bins)</span>
<span class="sd">    xin_edges : array</span>
<span class="sd">        The edges of the original independent variable bins.</span>
<span class="sd">        The left and right edges of the bins are interpreted</span>
<span class="sd">        to be `xin_edges[:-1]` and `xin_edges[1:]`,</span>
<span class="sd">        respectively, so the associated `yin` should have exactly</span>
<span class="sd">        1 fewer element than `xin_edges`. This provides finer</span>
<span class="sd">        control over the size of each bin in the input than</span>
<span class="sd">        simply supplying `xin`(still a little experimental)</span>
<span class="sd">        They should probably be sorted?</span>
<span class="sd">    xout_edges : array</span>
<span class="sd">        The edges of the new grid of bins for the independent</span>
<span class="sd">        variable, onto which you want to resample the y</span>
<span class="sd">        values. The left and right edges of the bins will be,</span>
<span class="sd">        respectively, `xout_edges[:-1]` and `xout_edges[1:]`,</span>
<span class="sd">        so the size of the output array will be</span>
<span class="sd">        `len(xout_edges) - 1`</span>
<span class="sd">    replace_nans : float, str</span>
<span class="sd">        Replace nan values with this value.</span>
<span class="sd">        `replace_nans = 0`</span>
<span class="sd">            will add no flux where nans are</span>
<span class="sd">        `replace_nans = nan`</span>
<span class="sd">            will ensure you get nans returned everywhere</span>
<span class="sd">            if you try to resample over any nan</span>
<span class="sd">        `replace_nans = &#39;interpolate&#39;`</span>
<span class="sd">            will try to replace nans by linearly interpolating</span>
<span class="sd">            from nearby values (not yet implemented)</span>
<span class="sd">    visualize : bool</span>
<span class="sd">        Should we make a plot showing whether it worked?</span>
<span class="sd">    pause : bool</span>
<span class="sd">        Should we pause to wait for a key press?</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    result : dict</span>
<span class="sd">        A dictionary containing...</span>
<span class="sd">            `x` = the center of the output grid</span>
<span class="sd">            `y` = the resampled value on the output grid</span>
<span class="sd">            `edges` = the edges of the output grid, which will</span>
<span class="sd">                have one more element than x or y</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># make sure there are some reasonable input options</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">xin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">xin_edges</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">yin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">xout</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">xout_edges</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>

    <span class="c1"># set up the bins, to calculate cumulative distribution of y</span>
    <span class="k">if</span> <span class="n">xin_edges</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># make sure the sizes match up</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">xin</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">yin</span><span class="p">)</span>
        <span class="c1"># sort to make sure x is strictly increasing</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">xin</span><span class="p">)</span>
        <span class="n">xin_sorted</span> <span class="o">=</span> <span class="n">xin</span><span class="p">[</span><span class="n">s</span><span class="p">]</span>
        <span class="n">yin_sorted</span> <span class="o">=</span> <span class="n">yin</span><span class="p">[</span><span class="n">s</span><span class="p">]</span>
        <span class="c1"># estimate some bin edges (might fail for non-uniform grids)</span>
        <span class="n">xin_left</span><span class="p">,</span> <span class="n">xin_right</span> <span class="o">=</span> <span class="n">calculate_bin_leftright</span><span class="p">(</span><span class="n">xin_sorted</span><span class="p">)</span>
        <span class="c1"># define an array of edges</span>
        <span class="n">xin_edges</span> <span class="o">=</span> <span class="n">leftright_to_edges</span><span class="p">(</span><span class="n">xin_left</span><span class="p">,</span> <span class="n">xin_right</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># make sure the sizes match up</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">xin_edges</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">yin</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="c1"># sort to make sure x is strictly increasing</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">xin_edges</span><span class="p">)</span>
        <span class="n">xin_left</span><span class="p">,</span> <span class="n">xin_right</span> <span class="o">=</span> <span class="n">edges_to_leftright</span><span class="p">(</span><span class="n">xin_edges</span><span class="p">[</span><span class="n">s</span><span class="p">])</span>
        <span class="n">xin_sorted</span> <span class="o">=</span> <span class="p">(</span><span class="n">xin_left</span> <span class="o">+</span> <span class="n">xin_right</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">yin_sorted</span> <span class="o">=</span> <span class="n">yin</span><span class="p">[</span><span class="n">s</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>

    <span class="c1"># the first element should be the left edge of the first pixel</span>
    <span class="c1"># last element will be right edge of last pixel</span>
    <span class="n">xin_for_cdf</span> <span class="o">=</span> <span class="n">xin_edges</span>

    <span class="c1"># to the left of the first pixel, assume flux is zero</span>
    <span class="n">yin_for_cdf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">yin_sorted</span><span class="p">])</span>

    <span class="c1"># correct for any non-finite values</span>
    <span class="n">bad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">yin_for_cdf</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">replace_nans</span> <span class="o">==</span> <span class="s2">&quot;interpolate&quot;</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
            <span class="s2">&quot;The `replace_nans=&#39;interpolate&#39;`` option doens&#39;t exist yet!&quot;</span>
        <span class="p">)</span>
    <span class="n">yin_for_cdf</span><span class="p">[</span><span class="n">bad</span><span class="p">]</span> <span class="o">=</span> <span class="n">replace_nans</span>

    <span class="c1"># calculate the CDF of the flux (at pixel edge locations)</span>
    <span class="n">cdfin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">yin_for_cdf</span><span class="p">)</span>

    <span class="c1"># create an interpolator for that CDF</span>
    <span class="n">cdfinterpolator</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span>
        <span class="n">xin_for_cdf</span><span class="p">,</span>
        <span class="n">cdfin</span><span class="p">,</span>
        <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span>
        <span class="n">bounds_error</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">fill_value</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">yin</span><span class="p">)),</span>
    <span class="p">)</span>

    <span class="c1"># calculate bin edges (of size len(xout)+1)</span>
    <span class="k">if</span> <span class="n">xout_edges</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">xout_left</span><span class="p">,</span> <span class="n">xout_right</span> <span class="o">=</span> <span class="n">calculate_bin_leftright</span><span class="p">(</span><span class="n">xout</span><span class="p">)</span>
        <span class="n">xout_edges</span> <span class="o">=</span> <span class="n">leftright_to_edges</span><span class="p">(</span><span class="n">xout_left</span><span class="p">,</span> <span class="n">xout_right</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">xout_left</span><span class="p">,</span> <span class="n">xout_right</span> <span class="o">=</span> <span class="n">edges_to_leftright</span><span class="p">(</span><span class="n">xout_edges</span><span class="p">)</span>
        <span class="n">xout</span> <span class="o">=</span> <span class="p">(</span><span class="n">xout_left</span> <span class="o">+</span> <span class="n">xout_right</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>

    <span class="n">xout_for_cdf</span> <span class="o">=</span> <span class="n">leftright_to_edges</span><span class="p">(</span><span class="n">xout_left</span><span class="p">,</span> <span class="n">xout_right</span><span class="p">)</span>

    <span class="c1"># interpolate the CDF onto those bin edges</span>
    <span class="n">cdfout</span> <span class="o">=</span> <span class="n">cdfinterpolator</span><span class="p">(</span><span class="n">xout_for_cdf</span><span class="p">)</span>

    <span class="c1"># take  derivative of the CDF to get flux per resampled bin</span>
    <span class="c1"># (xout is bin center, and yout is the flux in that bin)</span>
    <span class="n">yout</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">cdfout</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">visualize</span><span class="p">:</span>
        <span class="n">fi</span><span class="p">,</span> <span class="p">(</span><span class="n">ax_cdf</span><span class="p">,</span> <span class="n">ax_pdf</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
        <span class="n">inkw</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
            <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span>
            <span class="n">markeredgecolor</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">outkw</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;darkorange&quot;</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span>
            <span class="n">markersize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
            <span class="n">markeredgecolor</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">legkw</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper left&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">xinbinsize</span> <span class="o">=</span> <span class="n">xin_right</span> <span class="o">-</span> <span class="n">xin_left</span>
        <span class="n">xoutbinsize</span> <span class="o">=</span> <span class="n">xout_right</span> <span class="o">-</span> <span class="n">xout_left</span>
        <span class="c1"># plot the PDFs</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="n">ax_pdf</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Flux per (Original) Pixel&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Pixel&quot;</span><span class="p">)</span>
        <span class="c1"># plot the original pixels (in df/dpixel to compare with resampled)</span>
        <span class="n">plot_as_boxes</span><span class="p">(</span>
            <span class="n">xin_sorted</span><span class="p">,</span> <span class="n">yin_sorted</span> <span class="o">/</span> <span class="n">xinbinsize</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Original Pixels&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">inkw</span>
        <span class="p">)</span>

        <span class="c1"># what would a bad interpolation look like?</span>
        <span class="n">interpolate_badly</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span>
            <span class="n">xin_sorted</span><span class="p">,</span>
            <span class="n">yin_sorted</span> <span class="o">/</span> <span class="n">xinbinsize</span><span class="p">,</span>
            <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span>
            <span class="n">bounds_error</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">fill_value</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
            <span class="n">xout</span><span class="p">,</span>
            <span class="n">interpolate_badly</span><span class="p">(</span><span class="n">xout</span><span class="p">),</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;cornflowerblue&quot;</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span>
            <span class="n">markersize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
            <span class="n">markeredgecolor</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Silly Simple Interpolation&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># plot the flux-conserving resampled data (again, in df/d&quot;pixel&quot;)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
            <span class="n">xout</span><span class="p">,</span> <span class="n">yout</span> <span class="o">/</span> <span class="n">xoutbinsize</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Flux-Conserving Interpolation&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">outkw</span>
        <span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="o">**</span><span class="n">legkw</span><span class="p">)</span>

        <span class="c1"># plot the CDFs</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="n">ax_cdf</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Cumulative Flux (from left)&quot;</span><span class="p">)</span>

        <span class="c1"># plot the original CDF</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xin_for_cdf</span><span class="p">,</span> <span class="n">cdfin</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Original Pixels&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">inkw</span><span class="p">)</span>

        <span class="c1"># plot the interpolated CDF</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xout_for_cdf</span><span class="p">,</span> <span class="n">cdfout</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Flux-Conserved Resample&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">outkw</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">pause</span><span class="p">:</span>
            <span class="n">a</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span>
                <span class="s2">&quot;Pausing a moment to check on interpolation; press return to continue.&quot;</span>
            <span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{:&gt;6}</span><span class="s2"> = </span><span class="si">{:.5f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;Actual&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">yin</span><span class="p">)))</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="s2">&quot;</span><span class="si">{:&gt;6}</span><span class="s2"> = </span><span class="si">{:.5f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="s2">&quot;Silly&quot;</span><span class="p">,</span>
                <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">interpolate_badly</span><span class="p">(</span><span class="n">xout</span><span class="p">)</span> <span class="o">*</span> <span class="n">xoutbinsize</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{:&gt;6}</span><span class="s2"> = </span><span class="si">{:.5f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;CDF&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">yout</span><span class="p">)))</span>

    <span class="c1"># return the resampled y-values</span>
    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="n">xout</span><span class="p">,</span> <span class="s2">&quot;x_edge_lower&quot;</span><span class="p">:</span> <span class="n">xout_left</span><span class="p">,</span> <span class="s2">&quot;x_edge_upper&quot;</span><span class="p">:</span> <span class="n">xout_right</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="n">yout</span><span class="p">}</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="chromatic.rainbows.get.timelike.time"></a>
    <div class="doc doc-contents first">









  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.get.timelike.time.bintoR" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">bintoR</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">unc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">R</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">weighting</span><span class="o">=</span><span class="s1">&#39;inversevariance&#39;</span><span class="p">,</span> <span class="n">drop_nans</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.get.timelike.time.bintoR" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Bin any x and y array onto a logarithmicly uniform grid.</p>
<h4 id="chromatic.rainbows.get.timelike.time.bintoR--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.get.timelike.time.bintoR--parameters" title="Permanent link">#</a></h4>
<p>x : array
    The original independent variable.
    (For a spectrum example = wavelength)
y : array
    The original dependent variable (same size as x).
    (For a spectrum example = flux)
unc : array, None, optional
    The unceratinty on the dependent variable
    (For a spectrum example = the flux uncertainty)
R : array, optional
    The spectral resolution R=x/dx for creating a new,
    logarithmically uniform grid that starts at the first
    value of x.
xlim : list, array, optional
    A two-element list indicating the min and max values of
    x for the new logarithmically spaced grid. If None,
    these limits will be created from the data themselves
weighting : str, optional
    How should we weight values when averaging
    them together into one larger bin?
    <code>weighting = 'inversevariance'</code>
        weights = 1/unc**2
     <code>weighting = {literally anything else}</code>
        uniform weights
    This will have no impact if <code>unc == None</code>, or for any
    new bins that effectively overlap less than one original
    unbinned point.
drop_nans : bool, optional
    Should we skip any bins turn out to be nans?
    This most often happens when bins are empty.</p>
<h4 id="chromatic.rainbows.get.timelike.time.bintoR--returns">Returns<a class="headerlink" href="#chromatic.rainbows.get.timelike.time.bintoR--returns" title="Permanent link">#</a></h4>
<p>result : dict
    A dictionary containing at least...
        <code>x</code> = the center of the output grid
        <code>y</code> = the resampled value on the output grid
        <code>x_edge_lower</code> = the lower edges of the output grid
        <code>x_edge_upper</code> = the upper edges of the output grid
    ...and possibly also
        <code>uncertainty</code> = the calculated uncertainty per bin</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/tools/resampling.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">bintoR</span><span class="p">(</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">unc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">R</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">weighting</span><span class="o">=</span><span class="s2">&quot;inversevariance&quot;</span><span class="p">,</span> <span class="n">drop_nans</span><span class="o">=</span><span class="kc">True</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Bin any x and y array onto a logarithmicly uniform grid.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : array</span>
<span class="sd">        The original independent variable.</span>
<span class="sd">        (For a spectrum example = wavelength)</span>
<span class="sd">    y : array</span>
<span class="sd">        The original dependent variable (same size as x).</span>
<span class="sd">        (For a spectrum example = flux)</span>
<span class="sd">    unc : array, None, optional</span>
<span class="sd">        The unceratinty on the dependent variable</span>
<span class="sd">        (For a spectrum example = the flux uncertainty)</span>
<span class="sd">    R : array, optional</span>
<span class="sd">        The spectral resolution R=x/dx for creating a new,</span>
<span class="sd">        logarithmically uniform grid that starts at the first</span>
<span class="sd">        value of x.</span>
<span class="sd">    xlim : list, array, optional</span>
<span class="sd">        A two-element list indicating the min and max values of</span>
<span class="sd">        x for the new logarithmically spaced grid. If None,</span>
<span class="sd">        these limits will be created from the data themselves</span>
<span class="sd">    weighting : str, optional</span>
<span class="sd">        How should we weight values when averaging</span>
<span class="sd">        them together into one larger bin?</span>
<span class="sd">        `weighting = &#39;inversevariance&#39;`</span>
<span class="sd">            weights = 1/unc**2</span>
<span class="sd">         `weighting = {literally anything else}`</span>
<span class="sd">            uniform weights</span>
<span class="sd">        This will have no impact if `unc == None`, or for any</span>
<span class="sd">        new bins that effectively overlap less than one original</span>
<span class="sd">        unbinned point.</span>
<span class="sd">    drop_nans : bool, optional</span>
<span class="sd">        Should we skip any bins turn out to be nans?</span>
<span class="sd">        This most often happens when bins are empty.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    result : dict</span>
<span class="sd">        A dictionary containing at least...</span>
<span class="sd">            `x` = the center of the output grid</span>
<span class="sd">            `y` = the resampled value on the output grid</span>
<span class="sd">            `x_edge_lower` = the lower edges of the output grid</span>
<span class="sd">            `x_edge_upper` = the upper edges of the output grid</span>
<span class="sd">        ...and possibly also</span>
<span class="sd">            `uncertainty` = the calculated uncertainty per bin</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">x_unit</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">unit</span>
        <span class="n">x_without_unit</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">value</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="n">x_unit</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">x_without_unit</span> <span class="o">=</span> <span class="n">x</span>

    <span class="c1"># create a new grid of x at the given resolution</span>
    <span class="n">lnx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">x_without_unit</span><span class="p">)</span>
    <span class="n">dnewlnx</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">R</span>

    <span class="c1"># set the limits of the new xgrid (in log space)</span>
    <span class="k">if</span> <span class="n">xlim</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># use the input grid to set the limits</span>
        <span class="n">lnxbottom</span><span class="p">,</span> <span class="n">lnxtop</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">lnx</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">lnx</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># use the custom xlim to set the limits</span>
        <span class="n">lnxbottom</span><span class="p">,</span> <span class="n">lnxtop</span> <span class="o">=</span> <span class="n">xlim</span>

    <span class="c1"># create a new, log-uniform grid of x values</span>
    <span class="n">newlnx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">lnxbottom</span><span class="p">,</span> <span class="n">lnxtop</span> <span class="o">+</span> <span class="n">dnewlnx</span><span class="p">,</span> <span class="n">dnewlnx</span><span class="p">)</span>

    <span class="c1"># now do the binning on a uniform grid of lnx</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">bintogrid</span><span class="p">(</span>
        <span class="n">lnx</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">unc</span><span class="p">,</span> <span class="n">newx</span><span class="o">=</span><span class="n">newlnx</span><span class="p">,</span> <span class="n">weighting</span><span class="o">=</span><span class="n">weighting</span><span class="p">,</span> <span class="n">drop_nans</span><span class="o">=</span><span class="n">drop_nans</span>
    <span class="p">)</span>

    <span class="c1"># convert back from log to real values</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;x_edge_lower&quot;</span><span class="p">,</span> <span class="s2">&quot;x_edge_upper&quot;</span><span class="p">]:</span>
        <span class="n">result</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="o">*</span> <span class="n">x_unit</span>

    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.get.timelike.time.bintogrid" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">bintogrid</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">unc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">newx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">newx_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">nx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">weighting</span><span class="o">=</span><span class="s1">&#39;inversevariance&#39;</span><span class="p">,</span> <span class="n">drop_nans</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">x_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">visualize</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.get.timelike.time.bintogrid" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Bin any x and y array onto a linearly uniform grid.</p>
<h4 id="chromatic.rainbows.get.timelike.time.bintogrid--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.get.timelike.time.bintogrid--parameters" title="Permanent link">#</a></h4>
<p>x : array
    The original independent variable.
    (For a spectrum example = wavelength)
y : array
    The original dependent variable (same size as x).
    (For a spectrum example = flux)
unc : array, None
    The unceratinty on the dependent variable
    (For a spectrum example = the flux uncertainty)
nx : array
    The number of bins from the original grid to
    bin together into the new one.
dx : array
    The fixed spacing for creating a new, linearly uniform
    grid that start at the first value of x. This will
    be ignored if <code>newx</code> != None.
newx : array
    A new custom grid onto which we should bin.
newx_edges : array
    The edges of the new grid of bins for the independent
    variable, onto which you want to resample the y
    values. The left and right edges of the bins will be,
    respectively, <code>newx_edges[:-1]</code> and <code>newx_edges[1:]</code>,
    so the size of the output array will be
    <code>len(newx_edges) - 1</code>
weighting : str
    How should we weight values when averaging
    them together into one larger bin?
    <code>weighting = 'inversevariance'</code>
        weights = 1/unc**2
     <code>weighting = {literally anything else}</code>
        uniform weights
    This will have no impact if <code>unc == None</code>, or for any
    new bins that effectively overlap less than one original
    unbinned point.
drop_nans : bool
    Should we skip any bins turn out to be nans?
    This most often happens when bins are empty.
x_edges : array
    The edges of the original independent variable bins.
    The left and right edges of the bins are interpreted
    to be <code>x_edges[:-1]</code> and <code>x_edges[1:]</code>,
    respectively, so the associated <code>y</code> should have exactly
    1 fewer element than <code>x_edges</code>. This provides finer
    control over the size of each bin in the input than
    simply supplying <code>x</code>(still a little experimental)</p>
<h4 id="chromatic.rainbows.get.timelike.time.bintogrid--returns">Returns<a class="headerlink" href="#chromatic.rainbows.get.timelike.time.bintogrid--returns" title="Permanent link">#</a></h4>
<p>result : dict
    A dictionary containing at least...
        <code>x</code> = the center of the output grid
        <code>y</code> = the resampled value on the output grid
        <code>x_edge_lower</code> = the lower edges of the output grid
        <code>x_edge_upper</code> = the upper edges of the output grid
    ...and possibly also
        <code>uncertainty</code> = the calculated uncertainty per bin</p>
<p>The order of precendence for setting the new grid is
[<code>newx_edges</code>, <code>newx</code>, <code>dx</code>, <code>nx</code>]
The first will be used, and others will be ignored.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/tools/resampling.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">bintogrid</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">unc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">newx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">newx_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">dx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">nx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">weighting</span><span class="o">=</span><span class="s2">&quot;inversevariance&quot;</span><span class="p">,</span>
    <span class="n">drop_nans</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">x_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">visualize</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Bin any x and y array onto a linearly uniform grid.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : array</span>
<span class="sd">        The original independent variable.</span>
<span class="sd">        (For a spectrum example = wavelength)</span>
<span class="sd">    y : array</span>
<span class="sd">        The original dependent variable (same size as x).</span>
<span class="sd">        (For a spectrum example = flux)</span>
<span class="sd">    unc : array, None</span>
<span class="sd">        The unceratinty on the dependent variable</span>
<span class="sd">        (For a spectrum example = the flux uncertainty)</span>
<span class="sd">    nx : array</span>
<span class="sd">        The number of bins from the original grid to</span>
<span class="sd">        bin together into the new one.</span>
<span class="sd">    dx : array</span>
<span class="sd">        The fixed spacing for creating a new, linearly uniform</span>
<span class="sd">        grid that start at the first value of x. This will</span>
<span class="sd">        be ignored if `newx` != None.</span>
<span class="sd">    newx : array</span>
<span class="sd">        A new custom grid onto which we should bin.</span>
<span class="sd">    newx_edges : array</span>
<span class="sd">        The edges of the new grid of bins for the independent</span>
<span class="sd">        variable, onto which you want to resample the y</span>
<span class="sd">        values. The left and right edges of the bins will be,</span>
<span class="sd">        respectively, `newx_edges[:-1]` and `newx_edges[1:]`,</span>
<span class="sd">        so the size of the output array will be</span>
<span class="sd">        `len(newx_edges) - 1`</span>
<span class="sd">    weighting : str</span>
<span class="sd">        How should we weight values when averaging</span>
<span class="sd">        them together into one larger bin?</span>
<span class="sd">        `weighting = &#39;inversevariance&#39;`</span>
<span class="sd">            weights = 1/unc**2</span>
<span class="sd">         `weighting = {literally anything else}`</span>
<span class="sd">            uniform weights</span>
<span class="sd">        This will have no impact if `unc == None`, or for any</span>
<span class="sd">        new bins that effectively overlap less than one original</span>
<span class="sd">        unbinned point.</span>
<span class="sd">    drop_nans : bool</span>
<span class="sd">        Should we skip any bins turn out to be nans?</span>
<span class="sd">        This most often happens when bins are empty.</span>
<span class="sd">    x_edges : array</span>
<span class="sd">        The edges of the original independent variable bins.</span>
<span class="sd">        The left and right edges of the bins are interpreted</span>
<span class="sd">        to be `x_edges[:-1]` and `x_edges[1:]`,</span>
<span class="sd">        respectively, so the associated `y` should have exactly</span>
<span class="sd">        1 fewer element than `x_edges`. This provides finer</span>
<span class="sd">        control over the size of each bin in the input than</span>
<span class="sd">        simply supplying `x`(still a little experimental)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    result : dict</span>
<span class="sd">        A dictionary containing at least...</span>
<span class="sd">            `x` = the center of the output grid</span>
<span class="sd">            `y` = the resampled value on the output grid</span>
<span class="sd">            `x_edge_lower` = the lower edges of the output grid</span>
<span class="sd">            `x_edge_upper` = the upper edges of the output grid</span>
<span class="sd">        ...and possibly also</span>
<span class="sd">            `uncertainty` = the calculated uncertainty per bin</span>


<span class="sd">    The order of precendence for setting the new grid is</span>
<span class="sd">    [`newx_edges`, `newx`, `dx`, `nx`]</span>
<span class="sd">    The first will be used, and others will be ignored.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># check that an OK set of inputs has been supplied</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">x_edges</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;🌈 Both `x` and `x_edges` were supplied to `bintogrid`. Confusing!&quot;&quot;&quot;</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">x_edges</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;🌈 At least one of `x` or `x_edges` must be supplied to `bintogrid`.&quot;&quot;&quot;</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="n">y</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;🌈 `y` must be supplied to `bintogrid`.&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="c1"># make sure the edges and the centers are set</span>
    <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">x_left</span><span class="p">,</span> <span class="n">x_right</span> <span class="o">=</span> <span class="n">edges_to_leftright</span><span class="p">(</span><span class="n">x_edges</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">left</span> <span class="o">+</span> <span class="n">right</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">x_left</span><span class="p">,</span> <span class="n">x_right</span> <span class="o">=</span> <span class="n">calculate_bin_leftright</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">x_edges</span> <span class="o">=</span> <span class="n">leftright_to_edges</span><span class="p">(</span><span class="n">x_left</span><span class="p">,</span> <span class="n">x_right</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">x_unit</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">unit</span>
        <span class="n">x_without_unit</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">value</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="n">x_unit</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">x_without_unit</span> <span class="o">=</span> <span class="n">x</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">y_unit</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">unit</span>
        <span class="n">y_without_unit</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">value</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="n">y_unit</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">y_without_unit</span> <span class="o">=</span> <span class="n">y</span>

    <span class="c1"># warn if multiple inputs are provided</span>
    <span class="n">number_of_grid_options</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span><span class="n">z</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="p">[</span><span class="n">newx_edges</span><span class="p">,</span> <span class="n">newx</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">nx</span><span class="p">]])</span>
    <span class="k">if</span> <span class="n">number_of_grid_options</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">cheerfully_suggest</span><span class="p">(</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;More than one output grid sent to `bintogrid`.</span>
<span class="sd">                         The one being used is the first to appear in</span>
<span class="sd">                         [`newx_edges`, `newx`, `dx`, `nx`]</span>
<span class="sd">                         but you might want to choose more carefully.&quot;&quot;&quot;</span>
        <span class="p">)</span>

    <span class="c1"># define inputs based on the following order</span>
    <span class="k">if</span> <span class="n">newx_edges</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># define grid by its edges (and define others from there)</span>
        <span class="n">newx_edges_without_unit</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">newx_edges</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">x_unit</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
        <span class="n">dx_without_unit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">newx_edges_without_unit</span><span class="p">)</span>
        <span class="n">newx_without_unit</span> <span class="o">=</span> <span class="n">newx_edges_without_unit</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">dx_without_unit</span>
        <span class="n">newx_left_without_unit</span> <span class="o">=</span> <span class="n">newx_edges_without_unit</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">newx_right_without_unit</span> <span class="o">=</span> <span class="n">newx_edges_without_unit</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

        <span class="c1"># make sure the final output grid is defined</span>
        <span class="n">final_newx</span><span class="p">,</span> <span class="n">final_newx_left</span><span class="p">,</span> <span class="n">final_newx_right</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">newx_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
            <span class="n">newx_left_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
            <span class="n">newx_right_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="n">newx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># define grid by its centers (and define others from there)</span>
        <span class="n">newx_without_unit</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">newx</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">x_unit</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
        <span class="n">newx_left_without_unit</span><span class="p">,</span> <span class="n">newx_right_without_unit</span> <span class="o">=</span> <span class="n">calculate_bin_leftright</span><span class="p">(</span>
            <span class="n">newx_without_unit</span>
        <span class="p">)</span>
        <span class="n">newx_edges_without_unit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span>
            <span class="p">[</span><span class="n">newx_left_without_unit</span><span class="p">,</span> <span class="n">newx_right_without_unit</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
        <span class="p">)</span>
        <span class="n">dx_without_unit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">newx_edges_without_unit</span><span class="p">)</span>

        <span class="c1"># make sure the final output grid is defined</span>
        <span class="n">final_newx</span><span class="p">,</span> <span class="n">final_newx_left</span><span class="p">,</span> <span class="n">final_newx_right</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">newx_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
            <span class="n">newx_left_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
            <span class="n">newx_right_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="n">dx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># define grid by a bin width (and define others from there)</span>
        <span class="n">dx_without_unit</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">dx</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">x_unit</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
        <span class="n">newx_without_unit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">x_without_unit</span><span class="p">),</span>
            <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">x_without_unit</span><span class="p">)</span> <span class="o">+</span> <span class="n">dx_without_unit</span><span class="p">,</span>
            <span class="n">dx_without_unit</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">newx_left_without_unit</span><span class="p">,</span> <span class="n">newx_right_without_unit</span> <span class="o">=</span> <span class="n">calculate_bin_leftright</span><span class="p">(</span>
            <span class="n">newx_without_unit</span>
        <span class="p">)</span>
        <span class="n">newx_edges_without_unit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span>
            <span class="p">[</span><span class="n">newx_left_without_unit</span><span class="p">,</span> <span class="n">newx_right_without_unit</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
        <span class="p">)</span>

        <span class="c1"># make sure the final output grid is defined</span>
        <span class="n">final_newx</span><span class="p">,</span> <span class="n">final_newx_left</span><span class="p">,</span> <span class="n">final_newx_right</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">newx_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
            <span class="n">newx_left_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
            <span class="n">newx_right_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">elif</span> <span class="n">nx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># keep track of the original input x values</span>
        <span class="n">original_x_without_unit</span> <span class="o">=</span> <span class="n">x_without_unit</span>

        <span class="c1"># redefine the input x to indices, to do interpolation in index space</span>
        <span class="n">x_without_unit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">x_without_unit</span><span class="p">))</span>

        <span class="c1"># define a grid of edges that will enclose the right number of indices</span>
        <span class="n">x_left_i</span><span class="p">,</span> <span class="n">x_right_i</span> <span class="o">=</span> <span class="n">calculate_bin_leftright</span><span class="p">(</span><span class="n">x_without_unit</span><span class="p">)</span>
        <span class="n">newx_edges_without_unit</span> <span class="o">=</span> <span class="n">leftright_to_edges</span><span class="p">(</span><span class="n">x_left_i</span><span class="p">,</span> <span class="n">x_right_i</span><span class="p">)[::</span><span class="n">nx</span><span class="p">]</span>
        <span class="n">newx_without_unit</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span>
            <span class="n">newx_edges_without_unit</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">+</span> <span class="n">newx_edges_without_unit</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="p">)</span>

        <span class="c1"># calculate the actual x values corresponding to the bins</span>
        <span class="n">original_edges</span> <span class="o">=</span> <span class="n">leftright_to_edges</span><span class="p">(</span>
            <span class="o">*</span><span class="n">calculate_bin_leftright</span><span class="p">(</span><span class="n">original_x_without_unit</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">final_edges</span> <span class="o">=</span> <span class="n">original_edges</span><span class="p">[::</span><span class="n">nx</span><span class="p">]</span> <span class="o">*</span> <span class="n">x_unit</span>
        <span class="n">final_newx_left</span><span class="p">,</span> <span class="n">final_newx_right</span> <span class="o">=</span> <span class="n">edges_to_leftright</span><span class="p">(</span><span class="n">final_edges</span><span class="p">)</span>
        <span class="n">final_newx</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">final_newx_left</span> <span class="o">+</span> <span class="n">final_newx_right</span><span class="p">)</span>
        <span class="n">dx_without_unit</span> <span class="o">=</span> <span class="p">(</span><span class="n">final_newx_right</span> <span class="o">-</span> <span class="n">final_newx_left</span><span class="p">)</span> <span class="o">/</span> <span class="n">x_unit</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;No output grid sent to `bintogrid`.</span>
<span class="sd">                              Please choose one of the following:</span>
<span class="sd">                              [`newx_edges`, `newx`, `dx`, `nx`]&quot;&quot;&quot;</span>
        <span class="p">)</span>

    <span class="c1"># don&#39;t complain about zero-divisions in here (to allow infinite uncertainties)</span>
    <span class="k">with</span> <span class="n">np</span><span class="o">.</span><span class="n">errstate</span><span class="p">(</span><span class="n">divide</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">invalid</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">):</span>

        <span class="c1"># calculate weight integrals for the bin array</span>
        <span class="n">ok</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">y_without_unit</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span>

        <span class="c1"># resample the sums onto that new grid</span>
        <span class="k">if</span> <span class="n">unc</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">x_without_unit</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">weighting</span> <span class="o">==</span> <span class="s2">&quot;inversevariance&quot;</span><span class="p">:</span>
                <span class="n">weights</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">unc</span><span class="o">**</span><span class="mi">2</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">x_without_unit</span><span class="p">)</span>

            <span class="c1"># ignore infinite weights (= 0 uncertainties)</span>
            <span class="n">ok</span> <span class="o">*=</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">ok</span><span class="p">):</span>
            <span class="n">numerator</span> <span class="o">=</span> <span class="n">resample_while_conserving_flux</span><span class="p">(</span>
                <span class="n">xin</span><span class="o">=</span><span class="n">x_without_unit</span><span class="p">[</span><span class="n">ok</span><span class="p">],</span>
                <span class="n">yin</span><span class="o">=</span><span class="p">(</span><span class="n">y_without_unit</span> <span class="o">*</span> <span class="n">weights</span><span class="p">)[</span><span class="n">ok</span><span class="p">],</span>
                <span class="n">xout_edges</span><span class="o">=</span><span class="n">newx_edges_without_unit</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">denominator</span> <span class="o">=</span> <span class="n">resample_while_conserving_flux</span><span class="p">(</span>
                <span class="n">xin</span><span class="o">=</span><span class="n">x_without_unit</span><span class="p">[</span><span class="n">ok</span><span class="p">],</span>
                <span class="n">yin</span><span class="o">=</span><span class="n">weights</span><span class="p">[</span><span class="n">ok</span><span class="p">],</span>
                <span class="n">xout_edges</span><span class="o">=</span><span class="n">newx_edges_without_unit</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="c1"># the binned weighted means on the new grid</span>
            <span class="n">newy</span> <span class="o">=</span> <span class="n">numerator</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">denominator</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span>

            <span class="c1"># the standard error on the means, for those bins</span>
            <span class="n">newunc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">denominator</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">])</span>

            <span class="c1"># keep track of the number of original bins going into each new bin</span>
            <span class="n">number_of_original_bins_per_new_bin</span> <span class="o">=</span> <span class="n">resample_while_conserving_flux</span><span class="p">(</span>
                <span class="n">xin</span><span class="o">=</span><span class="n">x_without_unit</span><span class="p">[</span><span class="n">ok</span><span class="p">],</span>
                <span class="n">yin</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">y_without_unit</span><span class="p">)[</span><span class="n">ok</span><span class="p">],</span>
                <span class="n">xout_edges</span><span class="o">=</span><span class="n">newx_edges_without_unit</span><span class="p">,</span>
            <span class="p">)[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">newy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="o">*</span> <span class="n">newx_without_unit</span>
            <span class="n">newunc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="o">*</span> <span class="n">newx_without_unit</span>
            <span class="n">number_of_original_bins_per_new_bin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">newx_without_unit</span><span class="p">)</span>

    <span class="c1"># remove any empty bins</span>
    <span class="k">if</span> <span class="n">drop_nans</span><span class="p">:</span>
        <span class="n">ok</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">newy</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ok</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">newx_without_unit</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>

    <span class="c1"># if no uncertainties were given, don&#39;t return uncertainties</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># populate the new grid centers + edges + values</span>
    <span class="n">result</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">final_newx</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span>
    <span class="n">result</span><span class="p">[</span><span class="s2">&quot;x_edge_lower&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">final_newx_left</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span>
    <span class="n">result</span><span class="p">[</span><span class="s2">&quot;x_edge_upper&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">final_newx_right</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span>

    <span class="c1"># populate the new grid values</span>
    <span class="n">result</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">newy</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span> <span class="o">*</span> <span class="n">y_unit</span>

    <span class="c1"># populate the new grid value uncertainties</span>
    <span class="k">if</span> <span class="n">unc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">result</span><span class="p">[</span><span class="s2">&quot;uncertainty&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">newunc</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span> <span class="o">*</span> <span class="n">y_unit</span>

    <span class="c1"># store how many of the original pixels made it into this new one</span>
    <span class="n">result</span><span class="p">[</span><span class="s2">&quot;N_unbinned/N_binned&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">number_of_original_bins_per_new_bin</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">visualize</span><span class="p">:</span>
        <span class="n">fi</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span>
            <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">gridspec_kw</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">height_ratios</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">])</span>
        <span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">plot_as_boxes</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">xleft</span><span class="o">=</span><span class="n">x_left</span><span class="p">,</span> <span class="n">xright</span><span class="o">=</span><span class="n">x_right</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;silver&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">ekw</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">elinewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">unc</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;silver&quot;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">ekw</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">],</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">],</span>
            <span class="n">yerr</span><span class="o">=</span><span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;uncertainty&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
            <span class="n">xerr</span><span class="o">=</span><span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s2">&quot;x_edge_upper&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;x_edge_lower&quot;</span><span class="p">])</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
            <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
            <span class="n">zorder</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
            <span class="o">**</span><span class="n">ekw</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">plot_as_boxes</span><span class="p">(</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">],</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;N_unbinned/N_binned&quot;</span><span class="p">],</span>
            <span class="n">xleft</span><span class="o">=</span><span class="n">result</span><span class="p">[</span><span class="s2">&quot;x_edge_lower&quot;</span><span class="p">],</span>
            <span class="n">xright</span><span class="o">=</span><span class="n">result</span><span class="p">[</span><span class="s2">&quot;x_edge_upper&quot;</span><span class="p">],</span>
        <span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;$N_</span><span class="si">{unbinned}</span><span class="s2">/N_</span><span class="si">{binned}</span><span class="s2">$&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.get.timelike.time.calculate_bin_leftright" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">calculate_bin_leftright</span><span class="p">(</span><span class="n">x</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.get.timelike.time.calculate_bin_leftright" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>If x is an array of bin centers, calculate the bin edges.
(assumes outermost bins are same size as their neighbors)</p>
<h4 id="chromatic.rainbows.get.timelike.time.calculate_bin_leftright--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.get.timelike.time.calculate_bin_leftright--parameters" title="Permanent link">#</a></h4>
<p>x : array
    The array of bin centers.</p>
<h4 id="chromatic.rainbows.get.timelike.time.calculate_bin_leftright--returns">Returns<a class="headerlink" href="#chromatic.rainbows.get.timelike.time.calculate_bin_leftright--returns" title="Permanent link">#</a></h4>
<p>l : array
    The left edges of the bins.
r : array
    The right edges of the bins.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/tools/resampling.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">calculate_bin_leftright</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    If x is an array of bin centers, calculate the bin edges.</span>
<span class="sd">    (assumes outermost bins are same size as their neighbors)</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : array</span>
<span class="sd">        The array of bin centers.</span>

<span class="sd">    Returns</span>
<span class="sd">    ----------</span>
<span class="sd">    l : array</span>
<span class="sd">        The left edges of the bins.</span>
<span class="sd">    r : array</span>
<span class="sd">        The right edges of the bins.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># what are bin edges (making a guess for those on the ends)</span>
    <span class="c1"># xbinsize = calculate_bin_widths(x)</span>
    <span class="c1"># left = x - xbinsize / 2.0</span>
    <span class="c1"># right = x + xbinsize / 2.0</span>

    <span class="c1"># weird corner case!</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">left</span><span class="p">,</span> <span class="n">right</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">left</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">right</span><span class="p">])</span>

    <span class="n">inner_edges</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="n">x</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">first_edge</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="n">inner_edges</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">last_edge</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">inner_edges</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

    <span class="n">left</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">first_edge</span><span class="p">,</span> <span class="n">inner_edges</span><span class="p">])</span>
    <span class="n">right</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">inner_edges</span><span class="p">,</span> <span class="n">last_edge</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.get.timelike.time.edges_to_leftright" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">edges_to_leftright</span><span class="p">(</span><span class="n">edges</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.get.timelike.time.edges_to_leftright" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Convert N+1 contiguous edges to two arrays of N left/right edges.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/tools/resampling.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">edges_to_leftright</span><span class="p">(</span><span class="n">edges</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert N+1 contiguous edges to two arrays of N left/right edges.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">left</span><span class="p">,</span> <span class="n">right</span> <span class="o">=</span> <span class="n">edges</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">edges</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="k">return</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.get.timelike.time.expand_filenames" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">expand_filenames</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.get.timelike.time.expand_filenames" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>A wrapper to expand a string or list into a list of filenames.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/imports.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">expand_filenames</span><span class="p">(</span><span class="n">filepath</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A wrapper to expand a string or list into a list of filenames.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
        <span class="n">filenames</span> <span class="o">=</span> <span class="n">filepath</span>
    <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span> <span class="o">==</span> <span class="n">Column</span><span class="p">:</span>
        <span class="n">filenames</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>
    <span class="k">elif</span> <span class="s2">&quot;*&quot;</span> <span class="ow">in</span> <span class="n">filepath</span><span class="p">:</span>
        <span class="n">filenames</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">filepath</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">filenames</span> <span class="o">=</span> <span class="p">[</span><span class="n">filepath</span><span class="p">]</span>
    <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">filenames</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.get.timelike.time.get_times_as_astropy" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_times_as_astropy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">is_barycentric</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.get.timelike.time.get_times_as_astropy" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Convert times from a <code>Rainbow</code> into an astropy <code>Time</code> object.</p>
<h4 id="chromatic.rainbows.get.timelike.time.get_times_as_astropy--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.get.timelike.time.get_times_as_astropy--parameters" title="Permanent link">#</a></h4>
<p>time : Quantity, optional
    The time-like Quantity to be converted.
    If None (default), convert the time values in <code>self.time</code>
    If another time-like Quantity, convert those values.
format : str, optional
    The time format to supply to astropy.time.Time.
    If None (default), format will be pulled from
    <code>self.metadata['time_details']['format']</code>
scale : str, optional
    The time scale to supply to astropy.time.Time.
    If None (default), scale will be pulled from
    <code>self.metadata['time_details']['scale']</code>
is_barycentric : bool, optional
    Are the times already measured relative to the
    Solar System barycenter? This is mostly for warning
    the user that it's not.
    If <code>None</code> (default), <code>is_barycentric</code> will be pulled from
    <code>self.metadata['time_details']['is_barycentric']</code></p>
<h4 id="chromatic.rainbows.get.timelike.time.get_times_as_astropy--returns">Returns<a class="headerlink" href="#chromatic.rainbows.get.timelike.time.get_times_as_astropy--returns" title="Permanent link">#</a></h4>
<p>astropy_time : Time
    The times as an astropy <code>Time</code> object.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/rainbows/get/timelike/time.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">  4</span>
<span class="normal">  5</span>
<span class="normal">  6</span>
<span class="normal">  7</span>
<span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_times_as_astropy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">is_barycentric</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert times from a `Rainbow` into an astropy `Time` object.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    time : Quantity, optional</span>
<span class="sd">        The time-like Quantity to be converted.</span>
<span class="sd">        If None (default), convert the time values in `self.time`</span>
<span class="sd">        If another time-like Quantity, convert those values.</span>
<span class="sd">    format : str, optional</span>
<span class="sd">        The time format to supply to astropy.time.Time.</span>
<span class="sd">        If None (default), format will be pulled from</span>
<span class="sd">        `self.metadata[&#39;time_details&#39;][&#39;format&#39;]`</span>
<span class="sd">    scale : str, optional</span>
<span class="sd">        The time scale to supply to astropy.time.Time.</span>
<span class="sd">        If None (default), scale will be pulled from</span>
<span class="sd">        `self.metadata[&#39;time_details&#39;][&#39;scale&#39;]`</span>
<span class="sd">    is_barycentric : bool, optional</span>
<span class="sd">        Are the times already measured relative to the</span>
<span class="sd">        Solar System barycenter? This is mostly for warning</span>
<span class="sd">        the user that it&#39;s not.</span>
<span class="sd">        If `None` (default), `is_barycentric` will be pulled from</span>
<span class="sd">        `self.metadata[&#39;time_details&#39;][&#39;is_barycentric&#39;]`</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    astropy_time : Time</span>
<span class="sd">        The times as an astropy `Time` object.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># take times from self or from the keyword</span>
    <span class="k">if</span> <span class="n">time</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span>

    <span class="c1"># give a format warning</span>
    <span class="nb">format</span> <span class="o">=</span> <span class="nb">format</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;time_format&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">format</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">cheerfully_suggest</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        `.metadata[&#39;time_details&#39;][&#39;format&#39;]` is not set,</span>
<span class="s2">        nor was a `format=` keyword argument provided.</span>

<span class="s2">        Since `.time` is already an astropy Quantity,</span>
<span class="s2">        this is likely a question of whether the format is</span>
<span class="s2">        &#39;jd&#39; or &#39;mjd&#39; (= &#39;jd&#39; - 2400000.5) or something else.</span>
<span class="s2">        If you get this wrong, you might be lost in time!</span>

<span class="s2">        For more about astropy.Time formats, please see:</span>
<span class="s2">        https://docs.astropy.org/en/stable/time/index.html#time-format</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="p">)</span>

    <span class="c1"># give a scale warning</span>
    <span class="n">scale</span> <span class="o">=</span> <span class="n">scale</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;time_scale&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">scale</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">now</span> <span class="o">=</span> <span class="n">Time</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
        <span class="n">differences_string</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">now</span><span class="o">.</span><span class="n">SCALES</span><span class="p">:</span>
            <span class="n">dt</span> <span class="o">=</span> <span class="p">((</span><span class="nb">getattr</span><span class="p">(</span><span class="n">now</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span><span class="o">.</span><span class="n">jd</span> <span class="o">-</span> <span class="n">now</span><span class="o">.</span><span class="n">tdb</span><span class="o">.</span><span class="n">jd</span><span class="p">)</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">day</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">second</span><span class="p">)</span>
            <span class="n">differences_string</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">s</span><span class="si">:</span><span class="s2">&gt;15</span><span class="si">}</span><span class="s2"> - tdb = </span><span class="si">{</span><span class="n">dt</span><span class="si">:</span><span class="s2">10.6f</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">cheerfully_suggest</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        .metadata[&#39;time_details&#39;][&#39;scale&#39;] is not set,</span>
<span class="s2">        nor was a `scale=` keyword argument provided.</span>

<span class="s2">        The main question is whether the time scale is &#39;tdb&#39;</span>
<span class="s2">        (Barycentric Dynamical Time) or something close to it,</span>
<span class="s2">        or &#39;utc&#39; or something close to it. The differences</span>
<span class="s2">        between these options, at </span><span class="si">{</span><span class="n">now</span><span class="o">.</span><span class="n">utc</span><span class="o">.</span><span class="n">iso</span><span class="si">}</span><span class="s2"> (UTC), are:</span>
<span class="s2">        </span><span class="se">\n</span><span class="si">{</span><span class="n">differences_string</span><span class="si">}</span>
<span class="s2">        If you get this wrong, you might be lost in time!</span>

<span class="s2">        For more about astropy.Time scales, please see:</span>
<span class="s2">        https://docs.astropy.org/en/stable/time/index.html#time-scale</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="p">)</span>

    <span class="c1"># give some barycenter warnings</span>
    <span class="n">is_barycentric</span> <span class="o">=</span> <span class="n">is_barycentric</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;time_is_barycentric&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">is_barycentric</span> <span class="o">==</span> <span class="kc">True</span> <span class="ow">and</span> <span class="s2">&quot;ut&quot;</span> <span class="ow">in</span> <span class="n">scale</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
        <span class="n">cheerfully_suggest</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        barycentic=</span><span class="si">{</span><span class="n">is_barycentric</span><span class="si">}</span><span class="s2"> and scale=</span><span class="si">{</span><span class="n">scale</span><span class="si">}</span>
<span class="s2">        It&#39;s a deeply weird combination to have a barycentric</span>
<span class="s2">        time measured at the Solar System barycentric but in</span>
<span class="s2">        Earth&#39;s leap-second-based UTC system. Please consider</span>
<span class="s2">        checking your time details.</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="n">is_barycentric</span> <span class="o">!=</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">cheerfully_suggest</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        The returned time is not known to be measured relative</span>
<span class="s2">        to the Solar System barycenter. It&#39;s probably therefore</span>
<span class="s2">        measured from Earth or the position of your telescope,</span>
<span class="s2">        but please be warned that the timing of very distant event</span>
<span class="s2">        (like exoplanet transits) might be off by up to about</span>
<span class="s2">        8 minutes (= the light travel time between Earth + Sun).</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="p">)</span>

    <span class="c1"># generate astropy Time array</span>
    <span class="n">astropy_time</span> <span class="o">=</span> <span class="n">Time</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="nb">format</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">scale</span><span class="p">)</span>

    <span class="c1"># do a check that the values aren&#39;t really weird</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">astropy_time</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">.</span><span class="n">decimalyear</span> <span class="o">&lt;</span> <span class="mi">1000</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span>
        <span class="n">astropy_time</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">decimalyear</span> <span class="o">&gt;</span> <span class="mi">3000</span>
    <span class="p">):</span>
        <span class="n">cheerfully_suggest</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        The times, which span</span>
<span class="s2">        jd=</span><span class="si">{</span><span class="n">astropy_time</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">.</span><span class="n">jd</span><span class="si">}</span><span class="s2"> to jd=</span><span class="si">{</span><span class="n">astropy_time</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">jd</span><span class="si">}</span>
<span class="s2">        don&#39;t seem likely to be within the range of modern astronomical</span>
<span class="s2">        observations. Please consider double checking your time values</span>
<span class="s2">        and/or (format=&#39;</span><span class="si">{</span><span class="nb">format</span><span class="si">}</span><span class="s2">&#39;, scale=&#39;</span><span class="si">{</span><span class="n">scale</span><span class="si">}</span><span class="s2">&#39;).</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">astropy_time</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.get.timelike.time.leftright_to_edges" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">leftright_to_edges</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.get.timelike.time.leftright_to_edges" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Convert two arrays of N left/right edges to N+1 continugous edges.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/tools/resampling.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">leftright_to_edges</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert two arrays of N left/right edges to N+1 continugous edges.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">edges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>
    <span class="k">return</span> <span class="n">edges</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.get.timelike.time.name2color" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">name2color</span><span class="p">(</span><span class="n">name</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.get.timelike.time.name2color" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Return the 3-element RGB array of a given color name.</p>
<h4 id="chromatic.rainbows.get.timelike.time.name2color--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.get.timelike.time.name2color--parameters" title="Permanent link">#</a></h4>
<p>name : str
    The name of a color</p>
<h4 id="chromatic.rainbows.get.timelike.time.name2color--returns">Returns<a class="headerlink" href="#chromatic.rainbows.get.timelike.time.name2color--returns" title="Permanent link">#</a></h4>
<p>rgb : tuple
    3-element RGB color, with numbers from 0.0 to 1.0</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/imports.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">name2color</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return the 3-element RGB array of a given color name.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    name : str</span>
<span class="sd">        The name of a color</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    rgb : tuple</span>
<span class="sd">        3-element RGB color, with numbers from 0.0 to 1.0</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># give a friendly warning if the color name can&#39;t be found</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">color_hex</span> <span class="o">=</span> <span class="n">col</span><span class="o">.</span><span class="n">cnames</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">col</span><span class="o">.</span><span class="n">hex2color</span><span class="p">(</span><span class="n">color_hex</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="n">cheerfully_suggest</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The color </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> can&#39;t be found. (Returning black.)&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.get.timelike.time.one2another" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">one2another</span><span class="p">(</span><span class="n">bottom</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">alpha_bottom</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">alpha_top</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">256</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.get.timelike.time.one2another" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Create a cmap that goes smoothly (linearly in RGBA) from "bottom" to "top".</p>
<h4 id="chromatic.rainbows.get.timelike.time.one2another--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.get.timelike.time.one2another--parameters" title="Permanent link">#</a></h4>
<p>bottom : str
    Name of a color for the bottom of cmap (0.0)
top : str
    Name of a color for the top of the cmap (1.0)
alpha_bottom : float
    Opacity at the bottom of the cmap
alpha_top : float
    Opacitiy at the top of the cmap
N : int
    The number of levels in the listed color map</p>
<h4 id="chromatic.rainbows.get.timelike.time.one2another--returns">Returns<a class="headerlink" href="#chromatic.rainbows.get.timelike.time.one2another--returns" title="Permanent link">#</a></h4>
<p>cmap : Colormap
    A color map that goes linearly from the
    bottom to top color (and alpha).</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/imports.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">one2another</span><span class="p">(</span><span class="n">bottom</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">alpha_bottom</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">alpha_top</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">256</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a cmap that goes smoothly (linearly in RGBA) from &quot;bottom&quot; to &quot;top&quot;.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    bottom : str</span>
<span class="sd">        Name of a color for the bottom of cmap (0.0)</span>
<span class="sd">    top : str</span>
<span class="sd">        Name of a color for the top of the cmap (1.0)</span>
<span class="sd">    alpha_bottom : float</span>
<span class="sd">        Opacity at the bottom of the cmap</span>
<span class="sd">    alpha_top : float</span>
<span class="sd">        Opacitiy at the top of the cmap</span>
<span class="sd">    N : int</span>
<span class="sd">        The number of levels in the listed color map</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    cmap : Colormap</span>
<span class="sd">        A color map that goes linearly from the</span>
<span class="sd">        bottom to top color (and alpha).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># get the RGB values of the bottom and top of the cmap</span>
    <span class="n">rgb_bottom</span><span class="p">,</span> <span class="n">rgb_top</span> <span class="o">=</span> <span class="n">name2color</span><span class="p">(</span><span class="n">bottom</span><span class="p">),</span> <span class="n">name2color</span><span class="p">(</span><span class="n">top</span><span class="p">)</span>

    <span class="c1"># create linear gradients for all four RGBA channels</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">rgb_bottom</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">rgb_top</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">N</span><span class="p">)</span>
    <span class="n">g</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">rgb_bottom</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">rgb_top</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">N</span><span class="p">)</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">rgb_bottom</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">rgb_top</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">N</span><span class="p">)</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">alpha_bottom</span><span class="p">,</span> <span class="n">alpha_top</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>

    <span class="c1"># create (N,4) array + populate a listed colormap</span>
    <span class="n">colors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">]))</span>
    <span class="n">cmap</span> <span class="o">=</span> <span class="n">col</span><span class="o">.</span><span class="n">ListedColormap</span><span class="p">(</span><span class="n">colors</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{bottom}</span><span class="s2">2</span><span class="si">{top}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="nb">locals</span><span class="p">()))</span>

    <span class="c1"># return the colormap</span>
    <span class="k">return</span> <span class="n">cmap</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.get.timelike.time.remove_unit" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">remove_unit</span><span class="p">(</span><span class="n">x</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.get.timelike.time.remove_unit" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Quick wrapper to remove the unit from a quantity,
but not complain if it doesn't have one.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/imports.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">remove_unit</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Quick wrapper to remove the unit from a quantity,</span>
<span class="sd">    but not complain if it doesn&#39;t have one.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">x</span><span class="o">.</span><span class="n">value</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">x</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.get.timelike.time.resample_while_conserving_flux" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">resample_while_conserving_flux</span><span class="p">(</span><span class="n">xin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">yin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xout</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xin_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xout_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">replace_nans</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">visualize</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">pause</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.get.timelike.time.resample_while_conserving_flux" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Starting from some initial x and y, resample onto a
different grid (either higher or lower resolution),
while conserving total flux.</p>
<p>When including the entire range of <code>xin</code>,
<code>sum(yout) == sum(yin)</code> should be true.</p>
<p>When including only part of the range of <code>xin</code>,
the integral between any two points should be conserved.</p>
<h4 id="chromatic.rainbows.get.timelike.time.resample_while_conserving_flux--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.get.timelike.time.resample_while_conserving_flux--parameters" title="Permanent link">#</a></h4>
<p>xin : array
    The original independent variable.
yin : array
    The original dependent variable (same size as x).
xout : array
    The new grid of independent variables onto which
    you want to resample the y values. Refers to the
    center of each bin (use <code>xout_edges</code> for finer
    control over the exact edges of the bins)
xin_edges : array
    The edges of the original independent variable bins.
    The left and right edges of the bins are interpreted
    to be <code>xin_edges[:-1]</code> and <code>xin_edges[1:]</code>,
    respectively, so the associated <code>yin</code> should have exactly
    1 fewer element than <code>xin_edges</code>. This provides finer
    control over the size of each bin in the input than
    simply supplying <code>xin</code>(still a little experimental)
    They should probably be sorted?
xout_edges : array
    The edges of the new grid of bins for the independent
    variable, onto which you want to resample the y
    values. The left and right edges of the bins will be,
    respectively, <code>xout_edges[:-1]</code> and <code>xout_edges[1:]</code>,
    so the size of the output array will be
    <code>len(xout_edges) - 1</code>
replace_nans : float, str
    Replace nan values with this value.
    <code>replace_nans = 0</code>
        will add no flux where nans are
    <code>replace_nans = nan</code>
        will ensure you get nans returned everywhere
        if you try to resample over any nan
    <code>replace_nans = 'interpolate'</code>
        will try to replace nans by linearly interpolating
        from nearby values (not yet implemented)
visualize : bool
    Should we make a plot showing whether it worked?
pause : bool
    Should we pause to wait for a key press?</p>
<h4 id="chromatic.rainbows.get.timelike.time.resample_while_conserving_flux--returns">Returns<a class="headerlink" href="#chromatic.rainbows.get.timelike.time.resample_while_conserving_flux--returns" title="Permanent link">#</a></h4>
<p>result : dict
    A dictionary containing...
        <code>x</code> = the center of the output grid
        <code>y</code> = the resampled value on the output grid
        <code>edges</code> = the edges of the output grid, which will
            have one more element than x or y</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/tools/resampling.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">resample_while_conserving_flux</span><span class="p">(</span>
    <span class="n">xin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">yin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">xout</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">xin_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">xout_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">replace_nans</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
    <span class="n">visualize</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">pause</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Starting from some initial x and y, resample onto a</span>
<span class="sd">    different grid (either higher or lower resolution),</span>
<span class="sd">    while conserving total flux.</span>

<span class="sd">    When including the entire range of `xin`,</span>
<span class="sd">    `sum(yout) == sum(yin)` should be true.</span>

<span class="sd">    When including only part of the range of `xin`,</span>
<span class="sd">    the integral between any two points should be conserved.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    xin : array</span>
<span class="sd">        The original independent variable.</span>
<span class="sd">    yin : array</span>
<span class="sd">        The original dependent variable (same size as x).</span>
<span class="sd">    xout : array</span>
<span class="sd">        The new grid of independent variables onto which</span>
<span class="sd">        you want to resample the y values. Refers to the</span>
<span class="sd">        center of each bin (use `xout_edges` for finer</span>
<span class="sd">        control over the exact edges of the bins)</span>
<span class="sd">    xin_edges : array</span>
<span class="sd">        The edges of the original independent variable bins.</span>
<span class="sd">        The left and right edges of the bins are interpreted</span>
<span class="sd">        to be `xin_edges[:-1]` and `xin_edges[1:]`,</span>
<span class="sd">        respectively, so the associated `yin` should have exactly</span>
<span class="sd">        1 fewer element than `xin_edges`. This provides finer</span>
<span class="sd">        control over the size of each bin in the input than</span>
<span class="sd">        simply supplying `xin`(still a little experimental)</span>
<span class="sd">        They should probably be sorted?</span>
<span class="sd">    xout_edges : array</span>
<span class="sd">        The edges of the new grid of bins for the independent</span>
<span class="sd">        variable, onto which you want to resample the y</span>
<span class="sd">        values. The left and right edges of the bins will be,</span>
<span class="sd">        respectively, `xout_edges[:-1]` and `xout_edges[1:]`,</span>
<span class="sd">        so the size of the output array will be</span>
<span class="sd">        `len(xout_edges) - 1`</span>
<span class="sd">    replace_nans : float, str</span>
<span class="sd">        Replace nan values with this value.</span>
<span class="sd">        `replace_nans = 0`</span>
<span class="sd">            will add no flux where nans are</span>
<span class="sd">        `replace_nans = nan`</span>
<span class="sd">            will ensure you get nans returned everywhere</span>
<span class="sd">            if you try to resample over any nan</span>
<span class="sd">        `replace_nans = &#39;interpolate&#39;`</span>
<span class="sd">            will try to replace nans by linearly interpolating</span>
<span class="sd">            from nearby values (not yet implemented)</span>
<span class="sd">    visualize : bool</span>
<span class="sd">        Should we make a plot showing whether it worked?</span>
<span class="sd">    pause : bool</span>
<span class="sd">        Should we pause to wait for a key press?</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    result : dict</span>
<span class="sd">        A dictionary containing...</span>
<span class="sd">            `x` = the center of the output grid</span>
<span class="sd">            `y` = the resampled value on the output grid</span>
<span class="sd">            `edges` = the edges of the output grid, which will</span>
<span class="sd">                have one more element than x or y</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># make sure there are some reasonable input options</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">xin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">xin_edges</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">yin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">xout</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">xout_edges</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>

    <span class="c1"># set up the bins, to calculate cumulative distribution of y</span>
    <span class="k">if</span> <span class="n">xin_edges</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># make sure the sizes match up</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">xin</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">yin</span><span class="p">)</span>
        <span class="c1"># sort to make sure x is strictly increasing</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">xin</span><span class="p">)</span>
        <span class="n">xin_sorted</span> <span class="o">=</span> <span class="n">xin</span><span class="p">[</span><span class="n">s</span><span class="p">]</span>
        <span class="n">yin_sorted</span> <span class="o">=</span> <span class="n">yin</span><span class="p">[</span><span class="n">s</span><span class="p">]</span>
        <span class="c1"># estimate some bin edges (might fail for non-uniform grids)</span>
        <span class="n">xin_left</span><span class="p">,</span> <span class="n">xin_right</span> <span class="o">=</span> <span class="n">calculate_bin_leftright</span><span class="p">(</span><span class="n">xin_sorted</span><span class="p">)</span>
        <span class="c1"># define an array of edges</span>
        <span class="n">xin_edges</span> <span class="o">=</span> <span class="n">leftright_to_edges</span><span class="p">(</span><span class="n">xin_left</span><span class="p">,</span> <span class="n">xin_right</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># make sure the sizes match up</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">xin_edges</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">yin</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="c1"># sort to make sure x is strictly increasing</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">xin_edges</span><span class="p">)</span>
        <span class="n">xin_left</span><span class="p">,</span> <span class="n">xin_right</span> <span class="o">=</span> <span class="n">edges_to_leftright</span><span class="p">(</span><span class="n">xin_edges</span><span class="p">[</span><span class="n">s</span><span class="p">])</span>
        <span class="n">xin_sorted</span> <span class="o">=</span> <span class="p">(</span><span class="n">xin_left</span> <span class="o">+</span> <span class="n">xin_right</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">yin_sorted</span> <span class="o">=</span> <span class="n">yin</span><span class="p">[</span><span class="n">s</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>

    <span class="c1"># the first element should be the left edge of the first pixel</span>
    <span class="c1"># last element will be right edge of last pixel</span>
    <span class="n">xin_for_cdf</span> <span class="o">=</span> <span class="n">xin_edges</span>

    <span class="c1"># to the left of the first pixel, assume flux is zero</span>
    <span class="n">yin_for_cdf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">yin_sorted</span><span class="p">])</span>

    <span class="c1"># correct for any non-finite values</span>
    <span class="n">bad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">yin_for_cdf</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">replace_nans</span> <span class="o">==</span> <span class="s2">&quot;interpolate&quot;</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
            <span class="s2">&quot;The `replace_nans=&#39;interpolate&#39;`` option doens&#39;t exist yet!&quot;</span>
        <span class="p">)</span>
    <span class="n">yin_for_cdf</span><span class="p">[</span><span class="n">bad</span><span class="p">]</span> <span class="o">=</span> <span class="n">replace_nans</span>

    <span class="c1"># calculate the CDF of the flux (at pixel edge locations)</span>
    <span class="n">cdfin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">yin_for_cdf</span><span class="p">)</span>

    <span class="c1"># create an interpolator for that CDF</span>
    <span class="n">cdfinterpolator</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span>
        <span class="n">xin_for_cdf</span><span class="p">,</span>
        <span class="n">cdfin</span><span class="p">,</span>
        <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span>
        <span class="n">bounds_error</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">fill_value</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">yin</span><span class="p">)),</span>
    <span class="p">)</span>

    <span class="c1"># calculate bin edges (of size len(xout)+1)</span>
    <span class="k">if</span> <span class="n">xout_edges</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">xout_left</span><span class="p">,</span> <span class="n">xout_right</span> <span class="o">=</span> <span class="n">calculate_bin_leftright</span><span class="p">(</span><span class="n">xout</span><span class="p">)</span>
        <span class="n">xout_edges</span> <span class="o">=</span> <span class="n">leftright_to_edges</span><span class="p">(</span><span class="n">xout_left</span><span class="p">,</span> <span class="n">xout_right</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">xout_left</span><span class="p">,</span> <span class="n">xout_right</span> <span class="o">=</span> <span class="n">edges_to_leftright</span><span class="p">(</span><span class="n">xout_edges</span><span class="p">)</span>
        <span class="n">xout</span> <span class="o">=</span> <span class="p">(</span><span class="n">xout_left</span> <span class="o">+</span> <span class="n">xout_right</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>

    <span class="n">xout_for_cdf</span> <span class="o">=</span> <span class="n">leftright_to_edges</span><span class="p">(</span><span class="n">xout_left</span><span class="p">,</span> <span class="n">xout_right</span><span class="p">)</span>

    <span class="c1"># interpolate the CDF onto those bin edges</span>
    <span class="n">cdfout</span> <span class="o">=</span> <span class="n">cdfinterpolator</span><span class="p">(</span><span class="n">xout_for_cdf</span><span class="p">)</span>

    <span class="c1"># take  derivative of the CDF to get flux per resampled bin</span>
    <span class="c1"># (xout is bin center, and yout is the flux in that bin)</span>
    <span class="n">yout</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">cdfout</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">visualize</span><span class="p">:</span>
        <span class="n">fi</span><span class="p">,</span> <span class="p">(</span><span class="n">ax_cdf</span><span class="p">,</span> <span class="n">ax_pdf</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
        <span class="n">inkw</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
            <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span>
            <span class="n">markeredgecolor</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">outkw</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;darkorange&quot;</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span>
            <span class="n">markersize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
            <span class="n">markeredgecolor</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">legkw</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper left&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">xinbinsize</span> <span class="o">=</span> <span class="n">xin_right</span> <span class="o">-</span> <span class="n">xin_left</span>
        <span class="n">xoutbinsize</span> <span class="o">=</span> <span class="n">xout_right</span> <span class="o">-</span> <span class="n">xout_left</span>
        <span class="c1"># plot the PDFs</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="n">ax_pdf</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Flux per (Original) Pixel&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Pixel&quot;</span><span class="p">)</span>
        <span class="c1"># plot the original pixels (in df/dpixel to compare with resampled)</span>
        <span class="n">plot_as_boxes</span><span class="p">(</span>
            <span class="n">xin_sorted</span><span class="p">,</span> <span class="n">yin_sorted</span> <span class="o">/</span> <span class="n">xinbinsize</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Original Pixels&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">inkw</span>
        <span class="p">)</span>

        <span class="c1"># what would a bad interpolation look like?</span>
        <span class="n">interpolate_badly</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span>
            <span class="n">xin_sorted</span><span class="p">,</span>
            <span class="n">yin_sorted</span> <span class="o">/</span> <span class="n">xinbinsize</span><span class="p">,</span>
            <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span>
            <span class="n">bounds_error</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">fill_value</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
            <span class="n">xout</span><span class="p">,</span>
            <span class="n">interpolate_badly</span><span class="p">(</span><span class="n">xout</span><span class="p">),</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;cornflowerblue&quot;</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span>
            <span class="n">markersize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
            <span class="n">markeredgecolor</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Silly Simple Interpolation&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># plot the flux-conserving resampled data (again, in df/d&quot;pixel&quot;)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
            <span class="n">xout</span><span class="p">,</span> <span class="n">yout</span> <span class="o">/</span> <span class="n">xoutbinsize</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Flux-Conserving Interpolation&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">outkw</span>
        <span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="o">**</span><span class="n">legkw</span><span class="p">)</span>

        <span class="c1"># plot the CDFs</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="n">ax_cdf</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Cumulative Flux (from left)&quot;</span><span class="p">)</span>

        <span class="c1"># plot the original CDF</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xin_for_cdf</span><span class="p">,</span> <span class="n">cdfin</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Original Pixels&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">inkw</span><span class="p">)</span>

        <span class="c1"># plot the interpolated CDF</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xout_for_cdf</span><span class="p">,</span> <span class="n">cdfout</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Flux-Conserved Resample&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">outkw</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">pause</span><span class="p">:</span>
            <span class="n">a</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span>
                <span class="s2">&quot;Pausing a moment to check on interpolation; press return to continue.&quot;</span>
            <span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{:&gt;6}</span><span class="s2"> = </span><span class="si">{:.5f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;Actual&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">yin</span><span class="p">)))</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="s2">&quot;</span><span class="si">{:&gt;6}</span><span class="s2"> = </span><span class="si">{:.5f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="s2">&quot;Silly&quot;</span><span class="p">,</span>
                <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">interpolate_badly</span><span class="p">(</span><span class="n">xout</span><span class="p">)</span> <span class="o">*</span> <span class="n">xoutbinsize</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{:&gt;6}</span><span class="s2"> = </span><span class="si">{:.5f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;CDF&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">yout</span><span class="p">)))</span>

    <span class="c1"># return the resampled y-values</span>
    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="n">xout</span><span class="p">,</span> <span class="s2">&quot;x_edge_lower&quot;</span><span class="p">:</span> <span class="n">xout_left</span><span class="p">,</span> <span class="s2">&quot;x_edge_upper&quot;</span><span class="p">:</span> <span class="n">xout_right</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="n">yout</span><span class="p">}</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.get.timelike.time.set_times_from_astropy" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">set_times_from_astropy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">astropy_time</span><span class="p">,</span> <span class="n">is_barycentric</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.get.timelike.time.set_times_from_astropy" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Set the times for this <code>Rainbow</code> from an astropy <code>Time</code> object.</p>
<h4 id="chromatic.rainbows.get.timelike.time.set_times_from_astropy--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.get.timelike.time.set_times_from_astropy--parameters" title="Permanent link">#</a></h4>
<p>astropy_time : Time
    The times as an astropy <code>Time</code> object.
is_barycentric : bool, optional
    Are the times already measured relative to the
    Solar System barycenter? This is mostly for warning
    the user that it's not. Options are True, False,
    None (= don't know).</p>
<h4 id="chromatic.rainbows.get.timelike.time.set_times_from_astropy--returns">Returns<a class="headerlink" href="#chromatic.rainbows.get.timelike.time.set_times_from_astropy--returns" title="Permanent link">#</a></h4>
<p>time : Quantity
    An astropy Quantity with units of time,
    expressing the Time as julian day.
    In addition to this returned variable,
    the function sets the following internal
    variables:
    <code>self.time # (= the astropy Quantity of times)
    self.metadata['time_format'] # (= the format to convert back to Time)
    self.metadata['time_scale'] # (= the scale to convert back to Time)
    self.metadata['time_is_barycentric'] # (= is it barycentric?)</code></p>


            <details class="quote">
              <summary>Source code in <code>chromatic/rainbows/get/timelike/time.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">set_times_from_astropy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">astropy_time</span><span class="p">,</span> <span class="n">is_barycentric</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Set the times for this `Rainbow` from an astropy `Time` object.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    astropy_time : Time</span>
<span class="sd">        The times as an astropy `Time` object.</span>
<span class="sd">    is_barycentric : bool, optional</span>
<span class="sd">        Are the times already measured relative to the</span>
<span class="sd">        Solar System barycenter? This is mostly for warning</span>
<span class="sd">        the user that it&#39;s not. Options are True, False,</span>
<span class="sd">        None (= don&#39;t know).</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    time : Quantity</span>
<span class="sd">        An astropy Quantity with units of time,</span>
<span class="sd">        expressing the Time as julian day.</span>
<span class="sd">        In addition to this returned variable,</span>
<span class="sd">        the function sets the following internal</span>
<span class="sd">        variables:</span>
<span class="sd">        ```</span>
<span class="sd">        self.time # (= the astropy Quantity of times)</span>
<span class="sd">        self.metadata[&#39;time_format&#39;] # (= the format to convert back to Time)</span>
<span class="sd">        self.metadata[&#39;time_scale&#39;] # (= the scale to convert back to Time)</span>
<span class="sd">        self.metadata[&#39;time_is_barycentric&#39;] # (= is it barycentric?)</span>
<span class="sd">        ```</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># set the formats</span>
    <span class="nb">format</span> <span class="o">=</span> <span class="s2">&quot;jd&quot;</span>
    <span class="n">unit</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">day</span>
    <span class="n">scale</span> <span class="o">=</span> <span class="s2">&quot;tdb&quot;</span>

    <span class="c1"># store the necessary values</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">timelike</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">astropy_time</span><span class="p">,</span> <span class="n">scale</span><span class="p">),</span> <span class="nb">format</span><span class="p">)</span> <span class="o">*</span> <span class="n">unit</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;time_format&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">format</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;time_scale&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">scale</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;time_is_barycentric&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">is_barycentric</span>

    <span class="c1"># do some accounting to sync everything together</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_guess_tscale</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_make_sure_time_edges_are_defined</span><span class="p">()</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><h2 id="getwavelike">🌈 Get/Wavelike<a class="headerlink" href="#getwavelike" title="Permanent link">#</a></h2>


<div class="doc doc-object doc-module">



<a id="chromatic.rainbows.get.wavelike.average_spectrum"></a>
    <div class="doc doc-contents first">









  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.get.wavelike.average_spectrum.bintoR" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">bintoR</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">unc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">R</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">weighting</span><span class="o">=</span><span class="s1">&#39;inversevariance&#39;</span><span class="p">,</span> <span class="n">drop_nans</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.get.wavelike.average_spectrum.bintoR" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Bin any x and y array onto a logarithmicly uniform grid.</p>
<h4 id="chromatic.rainbows.get.wavelike.average_spectrum.bintoR--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.get.wavelike.average_spectrum.bintoR--parameters" title="Permanent link">#</a></h4>
<p>x : array
    The original independent variable.
    (For a spectrum example = wavelength)
y : array
    The original dependent variable (same size as x).
    (For a spectrum example = flux)
unc : array, None, optional
    The unceratinty on the dependent variable
    (For a spectrum example = the flux uncertainty)
R : array, optional
    The spectral resolution R=x/dx for creating a new,
    logarithmically uniform grid that starts at the first
    value of x.
xlim : list, array, optional
    A two-element list indicating the min and max values of
    x for the new logarithmically spaced grid. If None,
    these limits will be created from the data themselves
weighting : str, optional
    How should we weight values when averaging
    them together into one larger bin?
    <code>weighting = 'inversevariance'</code>
        weights = 1/unc**2
     <code>weighting = {literally anything else}</code>
        uniform weights
    This will have no impact if <code>unc == None</code>, or for any
    new bins that effectively overlap less than one original
    unbinned point.
drop_nans : bool, optional
    Should we skip any bins turn out to be nans?
    This most often happens when bins are empty.</p>
<h4 id="chromatic.rainbows.get.wavelike.average_spectrum.bintoR--returns">Returns<a class="headerlink" href="#chromatic.rainbows.get.wavelike.average_spectrum.bintoR--returns" title="Permanent link">#</a></h4>
<p>result : dict
    A dictionary containing at least...
        <code>x</code> = the center of the output grid
        <code>y</code> = the resampled value on the output grid
        <code>x_edge_lower</code> = the lower edges of the output grid
        <code>x_edge_upper</code> = the upper edges of the output grid
    ...and possibly also
        <code>uncertainty</code> = the calculated uncertainty per bin</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/tools/resampling.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">bintoR</span><span class="p">(</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">unc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">R</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">weighting</span><span class="o">=</span><span class="s2">&quot;inversevariance&quot;</span><span class="p">,</span> <span class="n">drop_nans</span><span class="o">=</span><span class="kc">True</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Bin any x and y array onto a logarithmicly uniform grid.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : array</span>
<span class="sd">        The original independent variable.</span>
<span class="sd">        (For a spectrum example = wavelength)</span>
<span class="sd">    y : array</span>
<span class="sd">        The original dependent variable (same size as x).</span>
<span class="sd">        (For a spectrum example = flux)</span>
<span class="sd">    unc : array, None, optional</span>
<span class="sd">        The unceratinty on the dependent variable</span>
<span class="sd">        (For a spectrum example = the flux uncertainty)</span>
<span class="sd">    R : array, optional</span>
<span class="sd">        The spectral resolution R=x/dx for creating a new,</span>
<span class="sd">        logarithmically uniform grid that starts at the first</span>
<span class="sd">        value of x.</span>
<span class="sd">    xlim : list, array, optional</span>
<span class="sd">        A two-element list indicating the min and max values of</span>
<span class="sd">        x for the new logarithmically spaced grid. If None,</span>
<span class="sd">        these limits will be created from the data themselves</span>
<span class="sd">    weighting : str, optional</span>
<span class="sd">        How should we weight values when averaging</span>
<span class="sd">        them together into one larger bin?</span>
<span class="sd">        `weighting = &#39;inversevariance&#39;`</span>
<span class="sd">            weights = 1/unc**2</span>
<span class="sd">         `weighting = {literally anything else}`</span>
<span class="sd">            uniform weights</span>
<span class="sd">        This will have no impact if `unc == None`, or for any</span>
<span class="sd">        new bins that effectively overlap less than one original</span>
<span class="sd">        unbinned point.</span>
<span class="sd">    drop_nans : bool, optional</span>
<span class="sd">        Should we skip any bins turn out to be nans?</span>
<span class="sd">        This most often happens when bins are empty.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    result : dict</span>
<span class="sd">        A dictionary containing at least...</span>
<span class="sd">            `x` = the center of the output grid</span>
<span class="sd">            `y` = the resampled value on the output grid</span>
<span class="sd">            `x_edge_lower` = the lower edges of the output grid</span>
<span class="sd">            `x_edge_upper` = the upper edges of the output grid</span>
<span class="sd">        ...and possibly also</span>
<span class="sd">            `uncertainty` = the calculated uncertainty per bin</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">x_unit</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">unit</span>
        <span class="n">x_without_unit</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">value</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="n">x_unit</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">x_without_unit</span> <span class="o">=</span> <span class="n">x</span>

    <span class="c1"># create a new grid of x at the given resolution</span>
    <span class="n">lnx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">x_without_unit</span><span class="p">)</span>
    <span class="n">dnewlnx</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">R</span>

    <span class="c1"># set the limits of the new xgrid (in log space)</span>
    <span class="k">if</span> <span class="n">xlim</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># use the input grid to set the limits</span>
        <span class="n">lnxbottom</span><span class="p">,</span> <span class="n">lnxtop</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">lnx</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">lnx</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># use the custom xlim to set the limits</span>
        <span class="n">lnxbottom</span><span class="p">,</span> <span class="n">lnxtop</span> <span class="o">=</span> <span class="n">xlim</span>

    <span class="c1"># create a new, log-uniform grid of x values</span>
    <span class="n">newlnx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">lnxbottom</span><span class="p">,</span> <span class="n">lnxtop</span> <span class="o">+</span> <span class="n">dnewlnx</span><span class="p">,</span> <span class="n">dnewlnx</span><span class="p">)</span>

    <span class="c1"># now do the binning on a uniform grid of lnx</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">bintogrid</span><span class="p">(</span>
        <span class="n">lnx</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">unc</span><span class="p">,</span> <span class="n">newx</span><span class="o">=</span><span class="n">newlnx</span><span class="p">,</span> <span class="n">weighting</span><span class="o">=</span><span class="n">weighting</span><span class="p">,</span> <span class="n">drop_nans</span><span class="o">=</span><span class="n">drop_nans</span>
    <span class="p">)</span>

    <span class="c1"># convert back from log to real values</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;x_edge_lower&quot;</span><span class="p">,</span> <span class="s2">&quot;x_edge_upper&quot;</span><span class="p">]:</span>
        <span class="n">result</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="o">*</span> <span class="n">x_unit</span>

    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.get.wavelike.average_spectrum.bintogrid" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">bintogrid</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">unc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">newx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">newx_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">nx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">weighting</span><span class="o">=</span><span class="s1">&#39;inversevariance&#39;</span><span class="p">,</span> <span class="n">drop_nans</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">x_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">visualize</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.get.wavelike.average_spectrum.bintogrid" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Bin any x and y array onto a linearly uniform grid.</p>
<h4 id="chromatic.rainbows.get.wavelike.average_spectrum.bintogrid--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.get.wavelike.average_spectrum.bintogrid--parameters" title="Permanent link">#</a></h4>
<p>x : array
    The original independent variable.
    (For a spectrum example = wavelength)
y : array
    The original dependent variable (same size as x).
    (For a spectrum example = flux)
unc : array, None
    The unceratinty on the dependent variable
    (For a spectrum example = the flux uncertainty)
nx : array
    The number of bins from the original grid to
    bin together into the new one.
dx : array
    The fixed spacing for creating a new, linearly uniform
    grid that start at the first value of x. This will
    be ignored if <code>newx</code> != None.
newx : array
    A new custom grid onto which we should bin.
newx_edges : array
    The edges of the new grid of bins for the independent
    variable, onto which you want to resample the y
    values. The left and right edges of the bins will be,
    respectively, <code>newx_edges[:-1]</code> and <code>newx_edges[1:]</code>,
    so the size of the output array will be
    <code>len(newx_edges) - 1</code>
weighting : str
    How should we weight values when averaging
    them together into one larger bin?
    <code>weighting = 'inversevariance'</code>
        weights = 1/unc**2
     <code>weighting = {literally anything else}</code>
        uniform weights
    This will have no impact if <code>unc == None</code>, or for any
    new bins that effectively overlap less than one original
    unbinned point.
drop_nans : bool
    Should we skip any bins turn out to be nans?
    This most often happens when bins are empty.
x_edges : array
    The edges of the original independent variable bins.
    The left and right edges of the bins are interpreted
    to be <code>x_edges[:-1]</code> and <code>x_edges[1:]</code>,
    respectively, so the associated <code>y</code> should have exactly
    1 fewer element than <code>x_edges</code>. This provides finer
    control over the size of each bin in the input than
    simply supplying <code>x</code>(still a little experimental)</p>
<h4 id="chromatic.rainbows.get.wavelike.average_spectrum.bintogrid--returns">Returns<a class="headerlink" href="#chromatic.rainbows.get.wavelike.average_spectrum.bintogrid--returns" title="Permanent link">#</a></h4>
<p>result : dict
    A dictionary containing at least...
        <code>x</code> = the center of the output grid
        <code>y</code> = the resampled value on the output grid
        <code>x_edge_lower</code> = the lower edges of the output grid
        <code>x_edge_upper</code> = the upper edges of the output grid
    ...and possibly also
        <code>uncertainty</code> = the calculated uncertainty per bin</p>
<p>The order of precendence for setting the new grid is
[<code>newx_edges</code>, <code>newx</code>, <code>dx</code>, <code>nx</code>]
The first will be used, and others will be ignored.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/tools/resampling.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">bintogrid</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">unc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">newx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">newx_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">dx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">nx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">weighting</span><span class="o">=</span><span class="s2">&quot;inversevariance&quot;</span><span class="p">,</span>
    <span class="n">drop_nans</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">x_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">visualize</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Bin any x and y array onto a linearly uniform grid.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : array</span>
<span class="sd">        The original independent variable.</span>
<span class="sd">        (For a spectrum example = wavelength)</span>
<span class="sd">    y : array</span>
<span class="sd">        The original dependent variable (same size as x).</span>
<span class="sd">        (For a spectrum example = flux)</span>
<span class="sd">    unc : array, None</span>
<span class="sd">        The unceratinty on the dependent variable</span>
<span class="sd">        (For a spectrum example = the flux uncertainty)</span>
<span class="sd">    nx : array</span>
<span class="sd">        The number of bins from the original grid to</span>
<span class="sd">        bin together into the new one.</span>
<span class="sd">    dx : array</span>
<span class="sd">        The fixed spacing for creating a new, linearly uniform</span>
<span class="sd">        grid that start at the first value of x. This will</span>
<span class="sd">        be ignored if `newx` != None.</span>
<span class="sd">    newx : array</span>
<span class="sd">        A new custom grid onto which we should bin.</span>
<span class="sd">    newx_edges : array</span>
<span class="sd">        The edges of the new grid of bins for the independent</span>
<span class="sd">        variable, onto which you want to resample the y</span>
<span class="sd">        values. The left and right edges of the bins will be,</span>
<span class="sd">        respectively, `newx_edges[:-1]` and `newx_edges[1:]`,</span>
<span class="sd">        so the size of the output array will be</span>
<span class="sd">        `len(newx_edges) - 1`</span>
<span class="sd">    weighting : str</span>
<span class="sd">        How should we weight values when averaging</span>
<span class="sd">        them together into one larger bin?</span>
<span class="sd">        `weighting = &#39;inversevariance&#39;`</span>
<span class="sd">            weights = 1/unc**2</span>
<span class="sd">         `weighting = {literally anything else}`</span>
<span class="sd">            uniform weights</span>
<span class="sd">        This will have no impact if `unc == None`, or for any</span>
<span class="sd">        new bins that effectively overlap less than one original</span>
<span class="sd">        unbinned point.</span>
<span class="sd">    drop_nans : bool</span>
<span class="sd">        Should we skip any bins turn out to be nans?</span>
<span class="sd">        This most often happens when bins are empty.</span>
<span class="sd">    x_edges : array</span>
<span class="sd">        The edges of the original independent variable bins.</span>
<span class="sd">        The left and right edges of the bins are interpreted</span>
<span class="sd">        to be `x_edges[:-1]` and `x_edges[1:]`,</span>
<span class="sd">        respectively, so the associated `y` should have exactly</span>
<span class="sd">        1 fewer element than `x_edges`. This provides finer</span>
<span class="sd">        control over the size of each bin in the input than</span>
<span class="sd">        simply supplying `x`(still a little experimental)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    result : dict</span>
<span class="sd">        A dictionary containing at least...</span>
<span class="sd">            `x` = the center of the output grid</span>
<span class="sd">            `y` = the resampled value on the output grid</span>
<span class="sd">            `x_edge_lower` = the lower edges of the output grid</span>
<span class="sd">            `x_edge_upper` = the upper edges of the output grid</span>
<span class="sd">        ...and possibly also</span>
<span class="sd">            `uncertainty` = the calculated uncertainty per bin</span>


<span class="sd">    The order of precendence for setting the new grid is</span>
<span class="sd">    [`newx_edges`, `newx`, `dx`, `nx`]</span>
<span class="sd">    The first will be used, and others will be ignored.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># check that an OK set of inputs has been supplied</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">x_edges</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;🌈 Both `x` and `x_edges` were supplied to `bintogrid`. Confusing!&quot;&quot;&quot;</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">x_edges</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;🌈 At least one of `x` or `x_edges` must be supplied to `bintogrid`.&quot;&quot;&quot;</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="n">y</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;🌈 `y` must be supplied to `bintogrid`.&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="c1"># make sure the edges and the centers are set</span>
    <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">x_left</span><span class="p">,</span> <span class="n">x_right</span> <span class="o">=</span> <span class="n">edges_to_leftright</span><span class="p">(</span><span class="n">x_edges</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">left</span> <span class="o">+</span> <span class="n">right</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">x_left</span><span class="p">,</span> <span class="n">x_right</span> <span class="o">=</span> <span class="n">calculate_bin_leftright</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">x_edges</span> <span class="o">=</span> <span class="n">leftright_to_edges</span><span class="p">(</span><span class="n">x_left</span><span class="p">,</span> <span class="n">x_right</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">x_unit</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">unit</span>
        <span class="n">x_without_unit</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">value</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="n">x_unit</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">x_without_unit</span> <span class="o">=</span> <span class="n">x</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">y_unit</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">unit</span>
        <span class="n">y_without_unit</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">value</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="n">y_unit</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">y_without_unit</span> <span class="o">=</span> <span class="n">y</span>

    <span class="c1"># warn if multiple inputs are provided</span>
    <span class="n">number_of_grid_options</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span><span class="n">z</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="p">[</span><span class="n">newx_edges</span><span class="p">,</span> <span class="n">newx</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">nx</span><span class="p">]])</span>
    <span class="k">if</span> <span class="n">number_of_grid_options</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">cheerfully_suggest</span><span class="p">(</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;More than one output grid sent to `bintogrid`.</span>
<span class="sd">                         The one being used is the first to appear in</span>
<span class="sd">                         [`newx_edges`, `newx`, `dx`, `nx`]</span>
<span class="sd">                         but you might want to choose more carefully.&quot;&quot;&quot;</span>
        <span class="p">)</span>

    <span class="c1"># define inputs based on the following order</span>
    <span class="k">if</span> <span class="n">newx_edges</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># define grid by its edges (and define others from there)</span>
        <span class="n">newx_edges_without_unit</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">newx_edges</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">x_unit</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
        <span class="n">dx_without_unit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">newx_edges_without_unit</span><span class="p">)</span>
        <span class="n">newx_without_unit</span> <span class="o">=</span> <span class="n">newx_edges_without_unit</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">dx_without_unit</span>
        <span class="n">newx_left_without_unit</span> <span class="o">=</span> <span class="n">newx_edges_without_unit</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">newx_right_without_unit</span> <span class="o">=</span> <span class="n">newx_edges_without_unit</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

        <span class="c1"># make sure the final output grid is defined</span>
        <span class="n">final_newx</span><span class="p">,</span> <span class="n">final_newx_left</span><span class="p">,</span> <span class="n">final_newx_right</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">newx_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
            <span class="n">newx_left_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
            <span class="n">newx_right_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="n">newx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># define grid by its centers (and define others from there)</span>
        <span class="n">newx_without_unit</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">newx</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">x_unit</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
        <span class="n">newx_left_without_unit</span><span class="p">,</span> <span class="n">newx_right_without_unit</span> <span class="o">=</span> <span class="n">calculate_bin_leftright</span><span class="p">(</span>
            <span class="n">newx_without_unit</span>
        <span class="p">)</span>
        <span class="n">newx_edges_without_unit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span>
            <span class="p">[</span><span class="n">newx_left_without_unit</span><span class="p">,</span> <span class="n">newx_right_without_unit</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
        <span class="p">)</span>
        <span class="n">dx_without_unit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">newx_edges_without_unit</span><span class="p">)</span>

        <span class="c1"># make sure the final output grid is defined</span>
        <span class="n">final_newx</span><span class="p">,</span> <span class="n">final_newx_left</span><span class="p">,</span> <span class="n">final_newx_right</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">newx_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
            <span class="n">newx_left_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
            <span class="n">newx_right_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="n">dx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># define grid by a bin width (and define others from there)</span>
        <span class="n">dx_without_unit</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">dx</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">x_unit</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
        <span class="n">newx_without_unit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">x_without_unit</span><span class="p">),</span>
            <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">x_without_unit</span><span class="p">)</span> <span class="o">+</span> <span class="n">dx_without_unit</span><span class="p">,</span>
            <span class="n">dx_without_unit</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">newx_left_without_unit</span><span class="p">,</span> <span class="n">newx_right_without_unit</span> <span class="o">=</span> <span class="n">calculate_bin_leftright</span><span class="p">(</span>
            <span class="n">newx_without_unit</span>
        <span class="p">)</span>
        <span class="n">newx_edges_without_unit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span>
            <span class="p">[</span><span class="n">newx_left_without_unit</span><span class="p">,</span> <span class="n">newx_right_without_unit</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
        <span class="p">)</span>

        <span class="c1"># make sure the final output grid is defined</span>
        <span class="n">final_newx</span><span class="p">,</span> <span class="n">final_newx_left</span><span class="p">,</span> <span class="n">final_newx_right</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">newx_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
            <span class="n">newx_left_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
            <span class="n">newx_right_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">elif</span> <span class="n">nx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># keep track of the original input x values</span>
        <span class="n">original_x_without_unit</span> <span class="o">=</span> <span class="n">x_without_unit</span>

        <span class="c1"># redefine the input x to indices, to do interpolation in index space</span>
        <span class="n">x_without_unit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">x_without_unit</span><span class="p">))</span>

        <span class="c1"># define a grid of edges that will enclose the right number of indices</span>
        <span class="n">x_left_i</span><span class="p">,</span> <span class="n">x_right_i</span> <span class="o">=</span> <span class="n">calculate_bin_leftright</span><span class="p">(</span><span class="n">x_without_unit</span><span class="p">)</span>
        <span class="n">newx_edges_without_unit</span> <span class="o">=</span> <span class="n">leftright_to_edges</span><span class="p">(</span><span class="n">x_left_i</span><span class="p">,</span> <span class="n">x_right_i</span><span class="p">)[::</span><span class="n">nx</span><span class="p">]</span>
        <span class="n">newx_without_unit</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span>
            <span class="n">newx_edges_without_unit</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">+</span> <span class="n">newx_edges_without_unit</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="p">)</span>

        <span class="c1"># calculate the actual x values corresponding to the bins</span>
        <span class="n">original_edges</span> <span class="o">=</span> <span class="n">leftright_to_edges</span><span class="p">(</span>
            <span class="o">*</span><span class="n">calculate_bin_leftright</span><span class="p">(</span><span class="n">original_x_without_unit</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">final_edges</span> <span class="o">=</span> <span class="n">original_edges</span><span class="p">[::</span><span class="n">nx</span><span class="p">]</span> <span class="o">*</span> <span class="n">x_unit</span>
        <span class="n">final_newx_left</span><span class="p">,</span> <span class="n">final_newx_right</span> <span class="o">=</span> <span class="n">edges_to_leftright</span><span class="p">(</span><span class="n">final_edges</span><span class="p">)</span>
        <span class="n">final_newx</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">final_newx_left</span> <span class="o">+</span> <span class="n">final_newx_right</span><span class="p">)</span>
        <span class="n">dx_without_unit</span> <span class="o">=</span> <span class="p">(</span><span class="n">final_newx_right</span> <span class="o">-</span> <span class="n">final_newx_left</span><span class="p">)</span> <span class="o">/</span> <span class="n">x_unit</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;No output grid sent to `bintogrid`.</span>
<span class="sd">                              Please choose one of the following:</span>
<span class="sd">                              [`newx_edges`, `newx`, `dx`, `nx`]&quot;&quot;&quot;</span>
        <span class="p">)</span>

    <span class="c1"># don&#39;t complain about zero-divisions in here (to allow infinite uncertainties)</span>
    <span class="k">with</span> <span class="n">np</span><span class="o">.</span><span class="n">errstate</span><span class="p">(</span><span class="n">divide</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">invalid</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">):</span>

        <span class="c1"># calculate weight integrals for the bin array</span>
        <span class="n">ok</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">y_without_unit</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span>

        <span class="c1"># resample the sums onto that new grid</span>
        <span class="k">if</span> <span class="n">unc</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">x_without_unit</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">weighting</span> <span class="o">==</span> <span class="s2">&quot;inversevariance&quot;</span><span class="p">:</span>
                <span class="n">weights</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">unc</span><span class="o">**</span><span class="mi">2</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">x_without_unit</span><span class="p">)</span>

            <span class="c1"># ignore infinite weights (= 0 uncertainties)</span>
            <span class="n">ok</span> <span class="o">*=</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">ok</span><span class="p">):</span>
            <span class="n">numerator</span> <span class="o">=</span> <span class="n">resample_while_conserving_flux</span><span class="p">(</span>
                <span class="n">xin</span><span class="o">=</span><span class="n">x_without_unit</span><span class="p">[</span><span class="n">ok</span><span class="p">],</span>
                <span class="n">yin</span><span class="o">=</span><span class="p">(</span><span class="n">y_without_unit</span> <span class="o">*</span> <span class="n">weights</span><span class="p">)[</span><span class="n">ok</span><span class="p">],</span>
                <span class="n">xout_edges</span><span class="o">=</span><span class="n">newx_edges_without_unit</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">denominator</span> <span class="o">=</span> <span class="n">resample_while_conserving_flux</span><span class="p">(</span>
                <span class="n">xin</span><span class="o">=</span><span class="n">x_without_unit</span><span class="p">[</span><span class="n">ok</span><span class="p">],</span>
                <span class="n">yin</span><span class="o">=</span><span class="n">weights</span><span class="p">[</span><span class="n">ok</span><span class="p">],</span>
                <span class="n">xout_edges</span><span class="o">=</span><span class="n">newx_edges_without_unit</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="c1"># the binned weighted means on the new grid</span>
            <span class="n">newy</span> <span class="o">=</span> <span class="n">numerator</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">denominator</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span>

            <span class="c1"># the standard error on the means, for those bins</span>
            <span class="n">newunc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">denominator</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">])</span>

            <span class="c1"># keep track of the number of original bins going into each new bin</span>
            <span class="n">number_of_original_bins_per_new_bin</span> <span class="o">=</span> <span class="n">resample_while_conserving_flux</span><span class="p">(</span>
                <span class="n">xin</span><span class="o">=</span><span class="n">x_without_unit</span><span class="p">[</span><span class="n">ok</span><span class="p">],</span>
                <span class="n">yin</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">y_without_unit</span><span class="p">)[</span><span class="n">ok</span><span class="p">],</span>
                <span class="n">xout_edges</span><span class="o">=</span><span class="n">newx_edges_without_unit</span><span class="p">,</span>
            <span class="p">)[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">newy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="o">*</span> <span class="n">newx_without_unit</span>
            <span class="n">newunc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="o">*</span> <span class="n">newx_without_unit</span>
            <span class="n">number_of_original_bins_per_new_bin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">newx_without_unit</span><span class="p">)</span>

    <span class="c1"># remove any empty bins</span>
    <span class="k">if</span> <span class="n">drop_nans</span><span class="p">:</span>
        <span class="n">ok</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">newy</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ok</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">newx_without_unit</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>

    <span class="c1"># if no uncertainties were given, don&#39;t return uncertainties</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># populate the new grid centers + edges + values</span>
    <span class="n">result</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">final_newx</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span>
    <span class="n">result</span><span class="p">[</span><span class="s2">&quot;x_edge_lower&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">final_newx_left</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span>
    <span class="n">result</span><span class="p">[</span><span class="s2">&quot;x_edge_upper&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">final_newx_right</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span>

    <span class="c1"># populate the new grid values</span>
    <span class="n">result</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">newy</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span> <span class="o">*</span> <span class="n">y_unit</span>

    <span class="c1"># populate the new grid value uncertainties</span>
    <span class="k">if</span> <span class="n">unc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">result</span><span class="p">[</span><span class="s2">&quot;uncertainty&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">newunc</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span> <span class="o">*</span> <span class="n">y_unit</span>

    <span class="c1"># store how many of the original pixels made it into this new one</span>
    <span class="n">result</span><span class="p">[</span><span class="s2">&quot;N_unbinned/N_binned&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">number_of_original_bins_per_new_bin</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">visualize</span><span class="p">:</span>
        <span class="n">fi</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span>
            <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">gridspec_kw</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">height_ratios</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">])</span>
        <span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">plot_as_boxes</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">xleft</span><span class="o">=</span><span class="n">x_left</span><span class="p">,</span> <span class="n">xright</span><span class="o">=</span><span class="n">x_right</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;silver&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">ekw</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">elinewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">unc</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;silver&quot;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">ekw</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">],</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">],</span>
            <span class="n">yerr</span><span class="o">=</span><span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;uncertainty&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
            <span class="n">xerr</span><span class="o">=</span><span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s2">&quot;x_edge_upper&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;x_edge_lower&quot;</span><span class="p">])</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
            <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
            <span class="n">zorder</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
            <span class="o">**</span><span class="n">ekw</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">plot_as_boxes</span><span class="p">(</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">],</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;N_unbinned/N_binned&quot;</span><span class="p">],</span>
            <span class="n">xleft</span><span class="o">=</span><span class="n">result</span><span class="p">[</span><span class="s2">&quot;x_edge_lower&quot;</span><span class="p">],</span>
            <span class="n">xright</span><span class="o">=</span><span class="n">result</span><span class="p">[</span><span class="s2">&quot;x_edge_upper&quot;</span><span class="p">],</span>
        <span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;$N_</span><span class="si">{unbinned}</span><span class="s2">/N_</span><span class="si">{binned}</span><span class="s2">$&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.get.wavelike.average_spectrum.calculate_bin_leftright" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">calculate_bin_leftright</span><span class="p">(</span><span class="n">x</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.get.wavelike.average_spectrum.calculate_bin_leftright" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>If x is an array of bin centers, calculate the bin edges.
(assumes outermost bins are same size as their neighbors)</p>
<h4 id="chromatic.rainbows.get.wavelike.average_spectrum.calculate_bin_leftright--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.get.wavelike.average_spectrum.calculate_bin_leftright--parameters" title="Permanent link">#</a></h4>
<p>x : array
    The array of bin centers.</p>
<h4 id="chromatic.rainbows.get.wavelike.average_spectrum.calculate_bin_leftright--returns">Returns<a class="headerlink" href="#chromatic.rainbows.get.wavelike.average_spectrum.calculate_bin_leftright--returns" title="Permanent link">#</a></h4>
<p>l : array
    The left edges of the bins.
r : array
    The right edges of the bins.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/tools/resampling.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">calculate_bin_leftright</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    If x is an array of bin centers, calculate the bin edges.</span>
<span class="sd">    (assumes outermost bins are same size as their neighbors)</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : array</span>
<span class="sd">        The array of bin centers.</span>

<span class="sd">    Returns</span>
<span class="sd">    ----------</span>
<span class="sd">    l : array</span>
<span class="sd">        The left edges of the bins.</span>
<span class="sd">    r : array</span>
<span class="sd">        The right edges of the bins.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># what are bin edges (making a guess for those on the ends)</span>
    <span class="c1"># xbinsize = calculate_bin_widths(x)</span>
    <span class="c1"># left = x - xbinsize / 2.0</span>
    <span class="c1"># right = x + xbinsize / 2.0</span>

    <span class="c1"># weird corner case!</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">left</span><span class="p">,</span> <span class="n">right</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">left</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">right</span><span class="p">])</span>

    <span class="n">inner_edges</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="n">x</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">first_edge</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="n">inner_edges</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">last_edge</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">inner_edges</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

    <span class="n">left</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">first_edge</span><span class="p">,</span> <span class="n">inner_edges</span><span class="p">])</span>
    <span class="n">right</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">inner_edges</span><span class="p">,</span> <span class="n">last_edge</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.get.wavelike.average_spectrum.edges_to_leftright" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">edges_to_leftright</span><span class="p">(</span><span class="n">edges</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.get.wavelike.average_spectrum.edges_to_leftright" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Convert N+1 contiguous edges to two arrays of N left/right edges.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/tools/resampling.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">edges_to_leftright</span><span class="p">(</span><span class="n">edges</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert N+1 contiguous edges to two arrays of N left/right edges.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">left</span><span class="p">,</span> <span class="n">right</span> <span class="o">=</span> <span class="n">edges</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">edges</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="k">return</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.get.wavelike.average_spectrum.expand_filenames" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">expand_filenames</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.get.wavelike.average_spectrum.expand_filenames" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>A wrapper to expand a string or list into a list of filenames.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/imports.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">expand_filenames</span><span class="p">(</span><span class="n">filepath</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A wrapper to expand a string or list into a list of filenames.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
        <span class="n">filenames</span> <span class="o">=</span> <span class="n">filepath</span>
    <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span> <span class="o">==</span> <span class="n">Column</span><span class="p">:</span>
        <span class="n">filenames</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>
    <span class="k">elif</span> <span class="s2">&quot;*&quot;</span> <span class="ow">in</span> <span class="n">filepath</span><span class="p">:</span>
        <span class="n">filenames</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">filepath</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">filenames</span> <span class="o">=</span> <span class="p">[</span><span class="n">filepath</span><span class="p">]</span>
    <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">filenames</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.get.wavelike.average_spectrum.get_average_spectrum" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_average_spectrum</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.get.wavelike.average_spectrum.get_average_spectrum" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Return a average_spectrum of the star, averaged over all times.</p>
<p>This uses <code>bin</code>, which is a horribly slow way of doing what is
fundamentally a very simply array calculation, because we
don't need to deal with partial pixels.</p>
<h4 id="chromatic.rainbows.get.wavelike.average_spectrum.get_average_spectrum--returns">Returns<a class="headerlink" href="#chromatic.rainbows.get.wavelike.average_spectrum.get_average_spectrum--returns" title="Permanent link">#</a></h4>
<p>average_spectrum : array
    Wavelike array of average spectrum.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/rainbows/get/wavelike/average_spectrum.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_average_spectrum</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return a average_spectrum of the star, averaged over all times.</span>

<span class="sd">    This uses `bin`, which is a horribly slow way of doing what is</span>
<span class="sd">    fundamentally a very simply array calculation, because we</span>
<span class="sd">    don&#39;t need to deal with partial pixels.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    average_spectrum : array</span>
<span class="sd">        Wavelike array of average spectrum.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_average_spectrum_as_rainbow</span><span class="p">()</span><span class="o">.</span><span class="n">flux</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.get.wavelike.average_spectrum.leftright_to_edges" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">leftright_to_edges</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.get.wavelike.average_spectrum.leftright_to_edges" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Convert two arrays of N left/right edges to N+1 continugous edges.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/tools/resampling.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">leftright_to_edges</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert two arrays of N left/right edges to N+1 continugous edges.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">edges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>
    <span class="k">return</span> <span class="n">edges</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.get.wavelike.average_spectrum.name2color" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">name2color</span><span class="p">(</span><span class="n">name</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.get.wavelike.average_spectrum.name2color" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Return the 3-element RGB array of a given color name.</p>
<h4 id="chromatic.rainbows.get.wavelike.average_spectrum.name2color--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.get.wavelike.average_spectrum.name2color--parameters" title="Permanent link">#</a></h4>
<p>name : str
    The name of a color</p>
<h4 id="chromatic.rainbows.get.wavelike.average_spectrum.name2color--returns">Returns<a class="headerlink" href="#chromatic.rainbows.get.wavelike.average_spectrum.name2color--returns" title="Permanent link">#</a></h4>
<p>rgb : tuple
    3-element RGB color, with numbers from 0.0 to 1.0</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/imports.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">name2color</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return the 3-element RGB array of a given color name.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    name : str</span>
<span class="sd">        The name of a color</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    rgb : tuple</span>
<span class="sd">        3-element RGB color, with numbers from 0.0 to 1.0</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># give a friendly warning if the color name can&#39;t be found</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">color_hex</span> <span class="o">=</span> <span class="n">col</span><span class="o">.</span><span class="n">cnames</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">col</span><span class="o">.</span><span class="n">hex2color</span><span class="p">(</span><span class="n">color_hex</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="n">cheerfully_suggest</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The color </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> can&#39;t be found. (Returning black.)&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.get.wavelike.average_spectrum.one2another" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">one2another</span><span class="p">(</span><span class="n">bottom</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">alpha_bottom</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">alpha_top</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">256</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.get.wavelike.average_spectrum.one2another" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Create a cmap that goes smoothly (linearly in RGBA) from "bottom" to "top".</p>
<h4 id="chromatic.rainbows.get.wavelike.average_spectrum.one2another--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.get.wavelike.average_spectrum.one2another--parameters" title="Permanent link">#</a></h4>
<p>bottom : str
    Name of a color for the bottom of cmap (0.0)
top : str
    Name of a color for the top of the cmap (1.0)
alpha_bottom : float
    Opacity at the bottom of the cmap
alpha_top : float
    Opacitiy at the top of the cmap
N : int
    The number of levels in the listed color map</p>
<h4 id="chromatic.rainbows.get.wavelike.average_spectrum.one2another--returns">Returns<a class="headerlink" href="#chromatic.rainbows.get.wavelike.average_spectrum.one2another--returns" title="Permanent link">#</a></h4>
<p>cmap : Colormap
    A color map that goes linearly from the
    bottom to top color (and alpha).</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/imports.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">one2another</span><span class="p">(</span><span class="n">bottom</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">alpha_bottom</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">alpha_top</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">256</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a cmap that goes smoothly (linearly in RGBA) from &quot;bottom&quot; to &quot;top&quot;.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    bottom : str</span>
<span class="sd">        Name of a color for the bottom of cmap (0.0)</span>
<span class="sd">    top : str</span>
<span class="sd">        Name of a color for the top of the cmap (1.0)</span>
<span class="sd">    alpha_bottom : float</span>
<span class="sd">        Opacity at the bottom of the cmap</span>
<span class="sd">    alpha_top : float</span>
<span class="sd">        Opacitiy at the top of the cmap</span>
<span class="sd">    N : int</span>
<span class="sd">        The number of levels in the listed color map</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    cmap : Colormap</span>
<span class="sd">        A color map that goes linearly from the</span>
<span class="sd">        bottom to top color (and alpha).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># get the RGB values of the bottom and top of the cmap</span>
    <span class="n">rgb_bottom</span><span class="p">,</span> <span class="n">rgb_top</span> <span class="o">=</span> <span class="n">name2color</span><span class="p">(</span><span class="n">bottom</span><span class="p">),</span> <span class="n">name2color</span><span class="p">(</span><span class="n">top</span><span class="p">)</span>

    <span class="c1"># create linear gradients for all four RGBA channels</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">rgb_bottom</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">rgb_top</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">N</span><span class="p">)</span>
    <span class="n">g</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">rgb_bottom</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">rgb_top</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">N</span><span class="p">)</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">rgb_bottom</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">rgb_top</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">N</span><span class="p">)</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">alpha_bottom</span><span class="p">,</span> <span class="n">alpha_top</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>

    <span class="c1"># create (N,4) array + populate a listed colormap</span>
    <span class="n">colors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">]))</span>
    <span class="n">cmap</span> <span class="o">=</span> <span class="n">col</span><span class="o">.</span><span class="n">ListedColormap</span><span class="p">(</span><span class="n">colors</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{bottom}</span><span class="s2">2</span><span class="si">{top}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="nb">locals</span><span class="p">()))</span>

    <span class="c1"># return the colormap</span>
    <span class="k">return</span> <span class="n">cmap</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.get.wavelike.average_spectrum.remove_unit" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">remove_unit</span><span class="p">(</span><span class="n">x</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.get.wavelike.average_spectrum.remove_unit" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Quick wrapper to remove the unit from a quantity,
but not complain if it doesn't have one.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/imports.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">remove_unit</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Quick wrapper to remove the unit from a quantity,</span>
<span class="sd">    but not complain if it doesn&#39;t have one.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">x</span><span class="o">.</span><span class="n">value</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">x</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.get.wavelike.average_spectrum.resample_while_conserving_flux" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">resample_while_conserving_flux</span><span class="p">(</span><span class="n">xin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">yin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xout</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xin_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xout_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">replace_nans</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">visualize</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">pause</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.get.wavelike.average_spectrum.resample_while_conserving_flux" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Starting from some initial x and y, resample onto a
different grid (either higher or lower resolution),
while conserving total flux.</p>
<p>When including the entire range of <code>xin</code>,
<code>sum(yout) == sum(yin)</code> should be true.</p>
<p>When including only part of the range of <code>xin</code>,
the integral between any two points should be conserved.</p>
<h4 id="chromatic.rainbows.get.wavelike.average_spectrum.resample_while_conserving_flux--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.get.wavelike.average_spectrum.resample_while_conserving_flux--parameters" title="Permanent link">#</a></h4>
<p>xin : array
    The original independent variable.
yin : array
    The original dependent variable (same size as x).
xout : array
    The new grid of independent variables onto which
    you want to resample the y values. Refers to the
    center of each bin (use <code>xout_edges</code> for finer
    control over the exact edges of the bins)
xin_edges : array
    The edges of the original independent variable bins.
    The left and right edges of the bins are interpreted
    to be <code>xin_edges[:-1]</code> and <code>xin_edges[1:]</code>,
    respectively, so the associated <code>yin</code> should have exactly
    1 fewer element than <code>xin_edges</code>. This provides finer
    control over the size of each bin in the input than
    simply supplying <code>xin</code>(still a little experimental)
    They should probably be sorted?
xout_edges : array
    The edges of the new grid of bins for the independent
    variable, onto which you want to resample the y
    values. The left and right edges of the bins will be,
    respectively, <code>xout_edges[:-1]</code> and <code>xout_edges[1:]</code>,
    so the size of the output array will be
    <code>len(xout_edges) - 1</code>
replace_nans : float, str
    Replace nan values with this value.
    <code>replace_nans = 0</code>
        will add no flux where nans are
    <code>replace_nans = nan</code>
        will ensure you get nans returned everywhere
        if you try to resample over any nan
    <code>replace_nans = 'interpolate'</code>
        will try to replace nans by linearly interpolating
        from nearby values (not yet implemented)
visualize : bool
    Should we make a plot showing whether it worked?
pause : bool
    Should we pause to wait for a key press?</p>
<h4 id="chromatic.rainbows.get.wavelike.average_spectrum.resample_while_conserving_flux--returns">Returns<a class="headerlink" href="#chromatic.rainbows.get.wavelike.average_spectrum.resample_while_conserving_flux--returns" title="Permanent link">#</a></h4>
<p>result : dict
    A dictionary containing...
        <code>x</code> = the center of the output grid
        <code>y</code> = the resampled value on the output grid
        <code>edges</code> = the edges of the output grid, which will
            have one more element than x or y</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/tools/resampling.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">resample_while_conserving_flux</span><span class="p">(</span>
    <span class="n">xin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">yin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">xout</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">xin_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">xout_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">replace_nans</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
    <span class="n">visualize</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">pause</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Starting from some initial x and y, resample onto a</span>
<span class="sd">    different grid (either higher or lower resolution),</span>
<span class="sd">    while conserving total flux.</span>

<span class="sd">    When including the entire range of `xin`,</span>
<span class="sd">    `sum(yout) == sum(yin)` should be true.</span>

<span class="sd">    When including only part of the range of `xin`,</span>
<span class="sd">    the integral between any two points should be conserved.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    xin : array</span>
<span class="sd">        The original independent variable.</span>
<span class="sd">    yin : array</span>
<span class="sd">        The original dependent variable (same size as x).</span>
<span class="sd">    xout : array</span>
<span class="sd">        The new grid of independent variables onto which</span>
<span class="sd">        you want to resample the y values. Refers to the</span>
<span class="sd">        center of each bin (use `xout_edges` for finer</span>
<span class="sd">        control over the exact edges of the bins)</span>
<span class="sd">    xin_edges : array</span>
<span class="sd">        The edges of the original independent variable bins.</span>
<span class="sd">        The left and right edges of the bins are interpreted</span>
<span class="sd">        to be `xin_edges[:-1]` and `xin_edges[1:]`,</span>
<span class="sd">        respectively, so the associated `yin` should have exactly</span>
<span class="sd">        1 fewer element than `xin_edges`. This provides finer</span>
<span class="sd">        control over the size of each bin in the input than</span>
<span class="sd">        simply supplying `xin`(still a little experimental)</span>
<span class="sd">        They should probably be sorted?</span>
<span class="sd">    xout_edges : array</span>
<span class="sd">        The edges of the new grid of bins for the independent</span>
<span class="sd">        variable, onto which you want to resample the y</span>
<span class="sd">        values. The left and right edges of the bins will be,</span>
<span class="sd">        respectively, `xout_edges[:-1]` and `xout_edges[1:]`,</span>
<span class="sd">        so the size of the output array will be</span>
<span class="sd">        `len(xout_edges) - 1`</span>
<span class="sd">    replace_nans : float, str</span>
<span class="sd">        Replace nan values with this value.</span>
<span class="sd">        `replace_nans = 0`</span>
<span class="sd">            will add no flux where nans are</span>
<span class="sd">        `replace_nans = nan`</span>
<span class="sd">            will ensure you get nans returned everywhere</span>
<span class="sd">            if you try to resample over any nan</span>
<span class="sd">        `replace_nans = &#39;interpolate&#39;`</span>
<span class="sd">            will try to replace nans by linearly interpolating</span>
<span class="sd">            from nearby values (not yet implemented)</span>
<span class="sd">    visualize : bool</span>
<span class="sd">        Should we make a plot showing whether it worked?</span>
<span class="sd">    pause : bool</span>
<span class="sd">        Should we pause to wait for a key press?</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    result : dict</span>
<span class="sd">        A dictionary containing...</span>
<span class="sd">            `x` = the center of the output grid</span>
<span class="sd">            `y` = the resampled value on the output grid</span>
<span class="sd">            `edges` = the edges of the output grid, which will</span>
<span class="sd">                have one more element than x or y</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># make sure there are some reasonable input options</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">xin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">xin_edges</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">yin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">xout</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">xout_edges</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>

    <span class="c1"># set up the bins, to calculate cumulative distribution of y</span>
    <span class="k">if</span> <span class="n">xin_edges</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># make sure the sizes match up</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">xin</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">yin</span><span class="p">)</span>
        <span class="c1"># sort to make sure x is strictly increasing</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">xin</span><span class="p">)</span>
        <span class="n">xin_sorted</span> <span class="o">=</span> <span class="n">xin</span><span class="p">[</span><span class="n">s</span><span class="p">]</span>
        <span class="n">yin_sorted</span> <span class="o">=</span> <span class="n">yin</span><span class="p">[</span><span class="n">s</span><span class="p">]</span>
        <span class="c1"># estimate some bin edges (might fail for non-uniform grids)</span>
        <span class="n">xin_left</span><span class="p">,</span> <span class="n">xin_right</span> <span class="o">=</span> <span class="n">calculate_bin_leftright</span><span class="p">(</span><span class="n">xin_sorted</span><span class="p">)</span>
        <span class="c1"># define an array of edges</span>
        <span class="n">xin_edges</span> <span class="o">=</span> <span class="n">leftright_to_edges</span><span class="p">(</span><span class="n">xin_left</span><span class="p">,</span> <span class="n">xin_right</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># make sure the sizes match up</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">xin_edges</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">yin</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="c1"># sort to make sure x is strictly increasing</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">xin_edges</span><span class="p">)</span>
        <span class="n">xin_left</span><span class="p">,</span> <span class="n">xin_right</span> <span class="o">=</span> <span class="n">edges_to_leftright</span><span class="p">(</span><span class="n">xin_edges</span><span class="p">[</span><span class="n">s</span><span class="p">])</span>
        <span class="n">xin_sorted</span> <span class="o">=</span> <span class="p">(</span><span class="n">xin_left</span> <span class="o">+</span> <span class="n">xin_right</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">yin_sorted</span> <span class="o">=</span> <span class="n">yin</span><span class="p">[</span><span class="n">s</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>

    <span class="c1"># the first element should be the left edge of the first pixel</span>
    <span class="c1"># last element will be right edge of last pixel</span>
    <span class="n">xin_for_cdf</span> <span class="o">=</span> <span class="n">xin_edges</span>

    <span class="c1"># to the left of the first pixel, assume flux is zero</span>
    <span class="n">yin_for_cdf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">yin_sorted</span><span class="p">])</span>

    <span class="c1"># correct for any non-finite values</span>
    <span class="n">bad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">yin_for_cdf</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">replace_nans</span> <span class="o">==</span> <span class="s2">&quot;interpolate&quot;</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
            <span class="s2">&quot;The `replace_nans=&#39;interpolate&#39;`` option doens&#39;t exist yet!&quot;</span>
        <span class="p">)</span>
    <span class="n">yin_for_cdf</span><span class="p">[</span><span class="n">bad</span><span class="p">]</span> <span class="o">=</span> <span class="n">replace_nans</span>

    <span class="c1"># calculate the CDF of the flux (at pixel edge locations)</span>
    <span class="n">cdfin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">yin_for_cdf</span><span class="p">)</span>

    <span class="c1"># create an interpolator for that CDF</span>
    <span class="n">cdfinterpolator</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span>
        <span class="n">xin_for_cdf</span><span class="p">,</span>
        <span class="n">cdfin</span><span class="p">,</span>
        <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span>
        <span class="n">bounds_error</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">fill_value</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">yin</span><span class="p">)),</span>
    <span class="p">)</span>

    <span class="c1"># calculate bin edges (of size len(xout)+1)</span>
    <span class="k">if</span> <span class="n">xout_edges</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">xout_left</span><span class="p">,</span> <span class="n">xout_right</span> <span class="o">=</span> <span class="n">calculate_bin_leftright</span><span class="p">(</span><span class="n">xout</span><span class="p">)</span>
        <span class="n">xout_edges</span> <span class="o">=</span> <span class="n">leftright_to_edges</span><span class="p">(</span><span class="n">xout_left</span><span class="p">,</span> <span class="n">xout_right</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">xout_left</span><span class="p">,</span> <span class="n">xout_right</span> <span class="o">=</span> <span class="n">edges_to_leftright</span><span class="p">(</span><span class="n">xout_edges</span><span class="p">)</span>
        <span class="n">xout</span> <span class="o">=</span> <span class="p">(</span><span class="n">xout_left</span> <span class="o">+</span> <span class="n">xout_right</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>

    <span class="n">xout_for_cdf</span> <span class="o">=</span> <span class="n">leftright_to_edges</span><span class="p">(</span><span class="n">xout_left</span><span class="p">,</span> <span class="n">xout_right</span><span class="p">)</span>

    <span class="c1"># interpolate the CDF onto those bin edges</span>
    <span class="n">cdfout</span> <span class="o">=</span> <span class="n">cdfinterpolator</span><span class="p">(</span><span class="n">xout_for_cdf</span><span class="p">)</span>

    <span class="c1"># take  derivative of the CDF to get flux per resampled bin</span>
    <span class="c1"># (xout is bin center, and yout is the flux in that bin)</span>
    <span class="n">yout</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">cdfout</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">visualize</span><span class="p">:</span>
        <span class="n">fi</span><span class="p">,</span> <span class="p">(</span><span class="n">ax_cdf</span><span class="p">,</span> <span class="n">ax_pdf</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
        <span class="n">inkw</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
            <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span>
            <span class="n">markeredgecolor</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">outkw</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;darkorange&quot;</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span>
            <span class="n">markersize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
            <span class="n">markeredgecolor</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">legkw</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper left&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">xinbinsize</span> <span class="o">=</span> <span class="n">xin_right</span> <span class="o">-</span> <span class="n">xin_left</span>
        <span class="n">xoutbinsize</span> <span class="o">=</span> <span class="n">xout_right</span> <span class="o">-</span> <span class="n">xout_left</span>
        <span class="c1"># plot the PDFs</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="n">ax_pdf</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Flux per (Original) Pixel&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Pixel&quot;</span><span class="p">)</span>
        <span class="c1"># plot the original pixels (in df/dpixel to compare with resampled)</span>
        <span class="n">plot_as_boxes</span><span class="p">(</span>
            <span class="n">xin_sorted</span><span class="p">,</span> <span class="n">yin_sorted</span> <span class="o">/</span> <span class="n">xinbinsize</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Original Pixels&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">inkw</span>
        <span class="p">)</span>

        <span class="c1"># what would a bad interpolation look like?</span>
        <span class="n">interpolate_badly</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span>
            <span class="n">xin_sorted</span><span class="p">,</span>
            <span class="n">yin_sorted</span> <span class="o">/</span> <span class="n">xinbinsize</span><span class="p">,</span>
            <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span>
            <span class="n">bounds_error</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">fill_value</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
            <span class="n">xout</span><span class="p">,</span>
            <span class="n">interpolate_badly</span><span class="p">(</span><span class="n">xout</span><span class="p">),</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;cornflowerblue&quot;</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span>
            <span class="n">markersize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
            <span class="n">markeredgecolor</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Silly Simple Interpolation&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># plot the flux-conserving resampled data (again, in df/d&quot;pixel&quot;)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
            <span class="n">xout</span><span class="p">,</span> <span class="n">yout</span> <span class="o">/</span> <span class="n">xoutbinsize</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Flux-Conserving Interpolation&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">outkw</span>
        <span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="o">**</span><span class="n">legkw</span><span class="p">)</span>

        <span class="c1"># plot the CDFs</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="n">ax_cdf</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Cumulative Flux (from left)&quot;</span><span class="p">)</span>

        <span class="c1"># plot the original CDF</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xin_for_cdf</span><span class="p">,</span> <span class="n">cdfin</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Original Pixels&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">inkw</span><span class="p">)</span>

        <span class="c1"># plot the interpolated CDF</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xout_for_cdf</span><span class="p">,</span> <span class="n">cdfout</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Flux-Conserved Resample&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">outkw</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">pause</span><span class="p">:</span>
            <span class="n">a</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span>
                <span class="s2">&quot;Pausing a moment to check on interpolation; press return to continue.&quot;</span>
            <span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{:&gt;6}</span><span class="s2"> = </span><span class="si">{:.5f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;Actual&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">yin</span><span class="p">)))</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="s2">&quot;</span><span class="si">{:&gt;6}</span><span class="s2"> = </span><span class="si">{:.5f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="s2">&quot;Silly&quot;</span><span class="p">,</span>
                <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">interpolate_badly</span><span class="p">(</span><span class="n">xout</span><span class="p">)</span> <span class="o">*</span> <span class="n">xoutbinsize</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{:&gt;6}</span><span class="s2"> = </span><span class="si">{:.5f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;CDF&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">yout</span><span class="p">)))</span>

    <span class="c1"># return the resampled y-values</span>
    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="n">xout</span><span class="p">,</span> <span class="s2">&quot;x_edge_lower&quot;</span><span class="p">:</span> <span class="n">xout_left</span><span class="p">,</span> <span class="s2">&quot;x_edge_upper&quot;</span><span class="p">:</span> <span class="n">xout_right</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="n">yout</span><span class="p">}</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="chromatic.rainbows.get.wavelike.expected_uncertainty"></a>
    <div class="doc doc-contents first">









  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.get.wavelike.expected_uncertainty.bintoR" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">bintoR</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">unc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">R</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">weighting</span><span class="o">=</span><span class="s1">&#39;inversevariance&#39;</span><span class="p">,</span> <span class="n">drop_nans</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.get.wavelike.expected_uncertainty.bintoR" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Bin any x and y array onto a logarithmicly uniform grid.</p>
<h4 id="chromatic.rainbows.get.wavelike.expected_uncertainty.bintoR--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.get.wavelike.expected_uncertainty.bintoR--parameters" title="Permanent link">#</a></h4>
<p>x : array
    The original independent variable.
    (For a spectrum example = wavelength)
y : array
    The original dependent variable (same size as x).
    (For a spectrum example = flux)
unc : array, None, optional
    The unceratinty on the dependent variable
    (For a spectrum example = the flux uncertainty)
R : array, optional
    The spectral resolution R=x/dx for creating a new,
    logarithmically uniform grid that starts at the first
    value of x.
xlim : list, array, optional
    A two-element list indicating the min and max values of
    x for the new logarithmically spaced grid. If None,
    these limits will be created from the data themselves
weighting : str, optional
    How should we weight values when averaging
    them together into one larger bin?
    <code>weighting = 'inversevariance'</code>
        weights = 1/unc**2
     <code>weighting = {literally anything else}</code>
        uniform weights
    This will have no impact if <code>unc == None</code>, or for any
    new bins that effectively overlap less than one original
    unbinned point.
drop_nans : bool, optional
    Should we skip any bins turn out to be nans?
    This most often happens when bins are empty.</p>
<h4 id="chromatic.rainbows.get.wavelike.expected_uncertainty.bintoR--returns">Returns<a class="headerlink" href="#chromatic.rainbows.get.wavelike.expected_uncertainty.bintoR--returns" title="Permanent link">#</a></h4>
<p>result : dict
    A dictionary containing at least...
        <code>x</code> = the center of the output grid
        <code>y</code> = the resampled value on the output grid
        <code>x_edge_lower</code> = the lower edges of the output grid
        <code>x_edge_upper</code> = the upper edges of the output grid
    ...and possibly also
        <code>uncertainty</code> = the calculated uncertainty per bin</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/tools/resampling.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">bintoR</span><span class="p">(</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">unc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">R</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">weighting</span><span class="o">=</span><span class="s2">&quot;inversevariance&quot;</span><span class="p">,</span> <span class="n">drop_nans</span><span class="o">=</span><span class="kc">True</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Bin any x and y array onto a logarithmicly uniform grid.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : array</span>
<span class="sd">        The original independent variable.</span>
<span class="sd">        (For a spectrum example = wavelength)</span>
<span class="sd">    y : array</span>
<span class="sd">        The original dependent variable (same size as x).</span>
<span class="sd">        (For a spectrum example = flux)</span>
<span class="sd">    unc : array, None, optional</span>
<span class="sd">        The unceratinty on the dependent variable</span>
<span class="sd">        (For a spectrum example = the flux uncertainty)</span>
<span class="sd">    R : array, optional</span>
<span class="sd">        The spectral resolution R=x/dx for creating a new,</span>
<span class="sd">        logarithmically uniform grid that starts at the first</span>
<span class="sd">        value of x.</span>
<span class="sd">    xlim : list, array, optional</span>
<span class="sd">        A two-element list indicating the min and max values of</span>
<span class="sd">        x for the new logarithmically spaced grid. If None,</span>
<span class="sd">        these limits will be created from the data themselves</span>
<span class="sd">    weighting : str, optional</span>
<span class="sd">        How should we weight values when averaging</span>
<span class="sd">        them together into one larger bin?</span>
<span class="sd">        `weighting = &#39;inversevariance&#39;`</span>
<span class="sd">            weights = 1/unc**2</span>
<span class="sd">         `weighting = {literally anything else}`</span>
<span class="sd">            uniform weights</span>
<span class="sd">        This will have no impact if `unc == None`, or for any</span>
<span class="sd">        new bins that effectively overlap less than one original</span>
<span class="sd">        unbinned point.</span>
<span class="sd">    drop_nans : bool, optional</span>
<span class="sd">        Should we skip any bins turn out to be nans?</span>
<span class="sd">        This most often happens when bins are empty.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    result : dict</span>
<span class="sd">        A dictionary containing at least...</span>
<span class="sd">            `x` = the center of the output grid</span>
<span class="sd">            `y` = the resampled value on the output grid</span>
<span class="sd">            `x_edge_lower` = the lower edges of the output grid</span>
<span class="sd">            `x_edge_upper` = the upper edges of the output grid</span>
<span class="sd">        ...and possibly also</span>
<span class="sd">            `uncertainty` = the calculated uncertainty per bin</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">x_unit</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">unit</span>
        <span class="n">x_without_unit</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">value</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="n">x_unit</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">x_without_unit</span> <span class="o">=</span> <span class="n">x</span>

    <span class="c1"># create a new grid of x at the given resolution</span>
    <span class="n">lnx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">x_without_unit</span><span class="p">)</span>
    <span class="n">dnewlnx</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">R</span>

    <span class="c1"># set the limits of the new xgrid (in log space)</span>
    <span class="k">if</span> <span class="n">xlim</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># use the input grid to set the limits</span>
        <span class="n">lnxbottom</span><span class="p">,</span> <span class="n">lnxtop</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">lnx</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">lnx</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># use the custom xlim to set the limits</span>
        <span class="n">lnxbottom</span><span class="p">,</span> <span class="n">lnxtop</span> <span class="o">=</span> <span class="n">xlim</span>

    <span class="c1"># create a new, log-uniform grid of x values</span>
    <span class="n">newlnx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">lnxbottom</span><span class="p">,</span> <span class="n">lnxtop</span> <span class="o">+</span> <span class="n">dnewlnx</span><span class="p">,</span> <span class="n">dnewlnx</span><span class="p">)</span>

    <span class="c1"># now do the binning on a uniform grid of lnx</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">bintogrid</span><span class="p">(</span>
        <span class="n">lnx</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">unc</span><span class="p">,</span> <span class="n">newx</span><span class="o">=</span><span class="n">newlnx</span><span class="p">,</span> <span class="n">weighting</span><span class="o">=</span><span class="n">weighting</span><span class="p">,</span> <span class="n">drop_nans</span><span class="o">=</span><span class="n">drop_nans</span>
    <span class="p">)</span>

    <span class="c1"># convert back from log to real values</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;x_edge_lower&quot;</span><span class="p">,</span> <span class="s2">&quot;x_edge_upper&quot;</span><span class="p">]:</span>
        <span class="n">result</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="o">*</span> <span class="n">x_unit</span>

    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.get.wavelike.expected_uncertainty.bintogrid" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">bintogrid</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">unc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">newx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">newx_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">nx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">weighting</span><span class="o">=</span><span class="s1">&#39;inversevariance&#39;</span><span class="p">,</span> <span class="n">drop_nans</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">x_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">visualize</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.get.wavelike.expected_uncertainty.bintogrid" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Bin any x and y array onto a linearly uniform grid.</p>
<h4 id="chromatic.rainbows.get.wavelike.expected_uncertainty.bintogrid--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.get.wavelike.expected_uncertainty.bintogrid--parameters" title="Permanent link">#</a></h4>
<p>x : array
    The original independent variable.
    (For a spectrum example = wavelength)
y : array
    The original dependent variable (same size as x).
    (For a spectrum example = flux)
unc : array, None
    The unceratinty on the dependent variable
    (For a spectrum example = the flux uncertainty)
nx : array
    The number of bins from the original grid to
    bin together into the new one.
dx : array
    The fixed spacing for creating a new, linearly uniform
    grid that start at the first value of x. This will
    be ignored if <code>newx</code> != None.
newx : array
    A new custom grid onto which we should bin.
newx_edges : array
    The edges of the new grid of bins for the independent
    variable, onto which you want to resample the y
    values. The left and right edges of the bins will be,
    respectively, <code>newx_edges[:-1]</code> and <code>newx_edges[1:]</code>,
    so the size of the output array will be
    <code>len(newx_edges) - 1</code>
weighting : str
    How should we weight values when averaging
    them together into one larger bin?
    <code>weighting = 'inversevariance'</code>
        weights = 1/unc**2
     <code>weighting = {literally anything else}</code>
        uniform weights
    This will have no impact if <code>unc == None</code>, or for any
    new bins that effectively overlap less than one original
    unbinned point.
drop_nans : bool
    Should we skip any bins turn out to be nans?
    This most often happens when bins are empty.
x_edges : array
    The edges of the original independent variable bins.
    The left and right edges of the bins are interpreted
    to be <code>x_edges[:-1]</code> and <code>x_edges[1:]</code>,
    respectively, so the associated <code>y</code> should have exactly
    1 fewer element than <code>x_edges</code>. This provides finer
    control over the size of each bin in the input than
    simply supplying <code>x</code>(still a little experimental)</p>
<h4 id="chromatic.rainbows.get.wavelike.expected_uncertainty.bintogrid--returns">Returns<a class="headerlink" href="#chromatic.rainbows.get.wavelike.expected_uncertainty.bintogrid--returns" title="Permanent link">#</a></h4>
<p>result : dict
    A dictionary containing at least...
        <code>x</code> = the center of the output grid
        <code>y</code> = the resampled value on the output grid
        <code>x_edge_lower</code> = the lower edges of the output grid
        <code>x_edge_upper</code> = the upper edges of the output grid
    ...and possibly also
        <code>uncertainty</code> = the calculated uncertainty per bin</p>
<p>The order of precendence for setting the new grid is
[<code>newx_edges</code>, <code>newx</code>, <code>dx</code>, <code>nx</code>]
The first will be used, and others will be ignored.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/tools/resampling.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">bintogrid</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">unc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">newx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">newx_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">dx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">nx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">weighting</span><span class="o">=</span><span class="s2">&quot;inversevariance&quot;</span><span class="p">,</span>
    <span class="n">drop_nans</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">x_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">visualize</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Bin any x and y array onto a linearly uniform grid.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : array</span>
<span class="sd">        The original independent variable.</span>
<span class="sd">        (For a spectrum example = wavelength)</span>
<span class="sd">    y : array</span>
<span class="sd">        The original dependent variable (same size as x).</span>
<span class="sd">        (For a spectrum example = flux)</span>
<span class="sd">    unc : array, None</span>
<span class="sd">        The unceratinty on the dependent variable</span>
<span class="sd">        (For a spectrum example = the flux uncertainty)</span>
<span class="sd">    nx : array</span>
<span class="sd">        The number of bins from the original grid to</span>
<span class="sd">        bin together into the new one.</span>
<span class="sd">    dx : array</span>
<span class="sd">        The fixed spacing for creating a new, linearly uniform</span>
<span class="sd">        grid that start at the first value of x. This will</span>
<span class="sd">        be ignored if `newx` != None.</span>
<span class="sd">    newx : array</span>
<span class="sd">        A new custom grid onto which we should bin.</span>
<span class="sd">    newx_edges : array</span>
<span class="sd">        The edges of the new grid of bins for the independent</span>
<span class="sd">        variable, onto which you want to resample the y</span>
<span class="sd">        values. The left and right edges of the bins will be,</span>
<span class="sd">        respectively, `newx_edges[:-1]` and `newx_edges[1:]`,</span>
<span class="sd">        so the size of the output array will be</span>
<span class="sd">        `len(newx_edges) - 1`</span>
<span class="sd">    weighting : str</span>
<span class="sd">        How should we weight values when averaging</span>
<span class="sd">        them together into one larger bin?</span>
<span class="sd">        `weighting = &#39;inversevariance&#39;`</span>
<span class="sd">            weights = 1/unc**2</span>
<span class="sd">         `weighting = {literally anything else}`</span>
<span class="sd">            uniform weights</span>
<span class="sd">        This will have no impact if `unc == None`, or for any</span>
<span class="sd">        new bins that effectively overlap less than one original</span>
<span class="sd">        unbinned point.</span>
<span class="sd">    drop_nans : bool</span>
<span class="sd">        Should we skip any bins turn out to be nans?</span>
<span class="sd">        This most often happens when bins are empty.</span>
<span class="sd">    x_edges : array</span>
<span class="sd">        The edges of the original independent variable bins.</span>
<span class="sd">        The left and right edges of the bins are interpreted</span>
<span class="sd">        to be `x_edges[:-1]` and `x_edges[1:]`,</span>
<span class="sd">        respectively, so the associated `y` should have exactly</span>
<span class="sd">        1 fewer element than `x_edges`. This provides finer</span>
<span class="sd">        control over the size of each bin in the input than</span>
<span class="sd">        simply supplying `x`(still a little experimental)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    result : dict</span>
<span class="sd">        A dictionary containing at least...</span>
<span class="sd">            `x` = the center of the output grid</span>
<span class="sd">            `y` = the resampled value on the output grid</span>
<span class="sd">            `x_edge_lower` = the lower edges of the output grid</span>
<span class="sd">            `x_edge_upper` = the upper edges of the output grid</span>
<span class="sd">        ...and possibly also</span>
<span class="sd">            `uncertainty` = the calculated uncertainty per bin</span>


<span class="sd">    The order of precendence for setting the new grid is</span>
<span class="sd">    [`newx_edges`, `newx`, `dx`, `nx`]</span>
<span class="sd">    The first will be used, and others will be ignored.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># check that an OK set of inputs has been supplied</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">x_edges</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;🌈 Both `x` and `x_edges` were supplied to `bintogrid`. Confusing!&quot;&quot;&quot;</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">x_edges</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;🌈 At least one of `x` or `x_edges` must be supplied to `bintogrid`.&quot;&quot;&quot;</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="n">y</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;🌈 `y` must be supplied to `bintogrid`.&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="c1"># make sure the edges and the centers are set</span>
    <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">x_left</span><span class="p">,</span> <span class="n">x_right</span> <span class="o">=</span> <span class="n">edges_to_leftright</span><span class="p">(</span><span class="n">x_edges</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">left</span> <span class="o">+</span> <span class="n">right</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">x_left</span><span class="p">,</span> <span class="n">x_right</span> <span class="o">=</span> <span class="n">calculate_bin_leftright</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">x_edges</span> <span class="o">=</span> <span class="n">leftright_to_edges</span><span class="p">(</span><span class="n">x_left</span><span class="p">,</span> <span class="n">x_right</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">x_unit</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">unit</span>
        <span class="n">x_without_unit</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">value</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="n">x_unit</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">x_without_unit</span> <span class="o">=</span> <span class="n">x</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">y_unit</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">unit</span>
        <span class="n">y_without_unit</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">value</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="n">y_unit</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">y_without_unit</span> <span class="o">=</span> <span class="n">y</span>

    <span class="c1"># warn if multiple inputs are provided</span>
    <span class="n">number_of_grid_options</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span><span class="n">z</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="p">[</span><span class="n">newx_edges</span><span class="p">,</span> <span class="n">newx</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">nx</span><span class="p">]])</span>
    <span class="k">if</span> <span class="n">number_of_grid_options</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">cheerfully_suggest</span><span class="p">(</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;More than one output grid sent to `bintogrid`.</span>
<span class="sd">                         The one being used is the first to appear in</span>
<span class="sd">                         [`newx_edges`, `newx`, `dx`, `nx`]</span>
<span class="sd">                         but you might want to choose more carefully.&quot;&quot;&quot;</span>
        <span class="p">)</span>

    <span class="c1"># define inputs based on the following order</span>
    <span class="k">if</span> <span class="n">newx_edges</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># define grid by its edges (and define others from there)</span>
        <span class="n">newx_edges_without_unit</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">newx_edges</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">x_unit</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
        <span class="n">dx_without_unit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">newx_edges_without_unit</span><span class="p">)</span>
        <span class="n">newx_without_unit</span> <span class="o">=</span> <span class="n">newx_edges_without_unit</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">dx_without_unit</span>
        <span class="n">newx_left_without_unit</span> <span class="o">=</span> <span class="n">newx_edges_without_unit</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">newx_right_without_unit</span> <span class="o">=</span> <span class="n">newx_edges_without_unit</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

        <span class="c1"># make sure the final output grid is defined</span>
        <span class="n">final_newx</span><span class="p">,</span> <span class="n">final_newx_left</span><span class="p">,</span> <span class="n">final_newx_right</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">newx_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
            <span class="n">newx_left_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
            <span class="n">newx_right_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="n">newx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># define grid by its centers (and define others from there)</span>
        <span class="n">newx_without_unit</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">newx</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">x_unit</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
        <span class="n">newx_left_without_unit</span><span class="p">,</span> <span class="n">newx_right_without_unit</span> <span class="o">=</span> <span class="n">calculate_bin_leftright</span><span class="p">(</span>
            <span class="n">newx_without_unit</span>
        <span class="p">)</span>
        <span class="n">newx_edges_without_unit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span>
            <span class="p">[</span><span class="n">newx_left_without_unit</span><span class="p">,</span> <span class="n">newx_right_without_unit</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
        <span class="p">)</span>
        <span class="n">dx_without_unit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">newx_edges_without_unit</span><span class="p">)</span>

        <span class="c1"># make sure the final output grid is defined</span>
        <span class="n">final_newx</span><span class="p">,</span> <span class="n">final_newx_left</span><span class="p">,</span> <span class="n">final_newx_right</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">newx_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
            <span class="n">newx_left_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
            <span class="n">newx_right_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="n">dx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># define grid by a bin width (and define others from there)</span>
        <span class="n">dx_without_unit</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">dx</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">x_unit</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
        <span class="n">newx_without_unit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">x_without_unit</span><span class="p">),</span>
            <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">x_without_unit</span><span class="p">)</span> <span class="o">+</span> <span class="n">dx_without_unit</span><span class="p">,</span>
            <span class="n">dx_without_unit</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">newx_left_without_unit</span><span class="p">,</span> <span class="n">newx_right_without_unit</span> <span class="o">=</span> <span class="n">calculate_bin_leftright</span><span class="p">(</span>
            <span class="n">newx_without_unit</span>
        <span class="p">)</span>
        <span class="n">newx_edges_without_unit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span>
            <span class="p">[</span><span class="n">newx_left_without_unit</span><span class="p">,</span> <span class="n">newx_right_without_unit</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
        <span class="p">)</span>

        <span class="c1"># make sure the final output grid is defined</span>
        <span class="n">final_newx</span><span class="p">,</span> <span class="n">final_newx_left</span><span class="p">,</span> <span class="n">final_newx_right</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">newx_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
            <span class="n">newx_left_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
            <span class="n">newx_right_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">elif</span> <span class="n">nx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># keep track of the original input x values</span>
        <span class="n">original_x_without_unit</span> <span class="o">=</span> <span class="n">x_without_unit</span>

        <span class="c1"># redefine the input x to indices, to do interpolation in index space</span>
        <span class="n">x_without_unit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">x_without_unit</span><span class="p">))</span>

        <span class="c1"># define a grid of edges that will enclose the right number of indices</span>
        <span class="n">x_left_i</span><span class="p">,</span> <span class="n">x_right_i</span> <span class="o">=</span> <span class="n">calculate_bin_leftright</span><span class="p">(</span><span class="n">x_without_unit</span><span class="p">)</span>
        <span class="n">newx_edges_without_unit</span> <span class="o">=</span> <span class="n">leftright_to_edges</span><span class="p">(</span><span class="n">x_left_i</span><span class="p">,</span> <span class="n">x_right_i</span><span class="p">)[::</span><span class="n">nx</span><span class="p">]</span>
        <span class="n">newx_without_unit</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span>
            <span class="n">newx_edges_without_unit</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">+</span> <span class="n">newx_edges_without_unit</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="p">)</span>

        <span class="c1"># calculate the actual x values corresponding to the bins</span>
        <span class="n">original_edges</span> <span class="o">=</span> <span class="n">leftright_to_edges</span><span class="p">(</span>
            <span class="o">*</span><span class="n">calculate_bin_leftright</span><span class="p">(</span><span class="n">original_x_without_unit</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">final_edges</span> <span class="o">=</span> <span class="n">original_edges</span><span class="p">[::</span><span class="n">nx</span><span class="p">]</span> <span class="o">*</span> <span class="n">x_unit</span>
        <span class="n">final_newx_left</span><span class="p">,</span> <span class="n">final_newx_right</span> <span class="o">=</span> <span class="n">edges_to_leftright</span><span class="p">(</span><span class="n">final_edges</span><span class="p">)</span>
        <span class="n">final_newx</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">final_newx_left</span> <span class="o">+</span> <span class="n">final_newx_right</span><span class="p">)</span>
        <span class="n">dx_without_unit</span> <span class="o">=</span> <span class="p">(</span><span class="n">final_newx_right</span> <span class="o">-</span> <span class="n">final_newx_left</span><span class="p">)</span> <span class="o">/</span> <span class="n">x_unit</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;No output grid sent to `bintogrid`.</span>
<span class="sd">                              Please choose one of the following:</span>
<span class="sd">                              [`newx_edges`, `newx`, `dx`, `nx`]&quot;&quot;&quot;</span>
        <span class="p">)</span>

    <span class="c1"># don&#39;t complain about zero-divisions in here (to allow infinite uncertainties)</span>
    <span class="k">with</span> <span class="n">np</span><span class="o">.</span><span class="n">errstate</span><span class="p">(</span><span class="n">divide</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">invalid</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">):</span>

        <span class="c1"># calculate weight integrals for the bin array</span>
        <span class="n">ok</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">y_without_unit</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span>

        <span class="c1"># resample the sums onto that new grid</span>
        <span class="k">if</span> <span class="n">unc</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">x_without_unit</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">weighting</span> <span class="o">==</span> <span class="s2">&quot;inversevariance&quot;</span><span class="p">:</span>
                <span class="n">weights</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">unc</span><span class="o">**</span><span class="mi">2</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">x_without_unit</span><span class="p">)</span>

            <span class="c1"># ignore infinite weights (= 0 uncertainties)</span>
            <span class="n">ok</span> <span class="o">*=</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">ok</span><span class="p">):</span>
            <span class="n">numerator</span> <span class="o">=</span> <span class="n">resample_while_conserving_flux</span><span class="p">(</span>
                <span class="n">xin</span><span class="o">=</span><span class="n">x_without_unit</span><span class="p">[</span><span class="n">ok</span><span class="p">],</span>
                <span class="n">yin</span><span class="o">=</span><span class="p">(</span><span class="n">y_without_unit</span> <span class="o">*</span> <span class="n">weights</span><span class="p">)[</span><span class="n">ok</span><span class="p">],</span>
                <span class="n">xout_edges</span><span class="o">=</span><span class="n">newx_edges_without_unit</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">denominator</span> <span class="o">=</span> <span class="n">resample_while_conserving_flux</span><span class="p">(</span>
                <span class="n">xin</span><span class="o">=</span><span class="n">x_without_unit</span><span class="p">[</span><span class="n">ok</span><span class="p">],</span>
                <span class="n">yin</span><span class="o">=</span><span class="n">weights</span><span class="p">[</span><span class="n">ok</span><span class="p">],</span>
                <span class="n">xout_edges</span><span class="o">=</span><span class="n">newx_edges_without_unit</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="c1"># the binned weighted means on the new grid</span>
            <span class="n">newy</span> <span class="o">=</span> <span class="n">numerator</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">denominator</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span>

            <span class="c1"># the standard error on the means, for those bins</span>
            <span class="n">newunc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">denominator</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">])</span>

            <span class="c1"># keep track of the number of original bins going into each new bin</span>
            <span class="n">number_of_original_bins_per_new_bin</span> <span class="o">=</span> <span class="n">resample_while_conserving_flux</span><span class="p">(</span>
                <span class="n">xin</span><span class="o">=</span><span class="n">x_without_unit</span><span class="p">[</span><span class="n">ok</span><span class="p">],</span>
                <span class="n">yin</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">y_without_unit</span><span class="p">)[</span><span class="n">ok</span><span class="p">],</span>
                <span class="n">xout_edges</span><span class="o">=</span><span class="n">newx_edges_without_unit</span><span class="p">,</span>
            <span class="p">)[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">newy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="o">*</span> <span class="n">newx_without_unit</span>
            <span class="n">newunc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="o">*</span> <span class="n">newx_without_unit</span>
            <span class="n">number_of_original_bins_per_new_bin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">newx_without_unit</span><span class="p">)</span>

    <span class="c1"># remove any empty bins</span>
    <span class="k">if</span> <span class="n">drop_nans</span><span class="p">:</span>
        <span class="n">ok</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">newy</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ok</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">newx_without_unit</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>

    <span class="c1"># if no uncertainties were given, don&#39;t return uncertainties</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># populate the new grid centers + edges + values</span>
    <span class="n">result</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">final_newx</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span>
    <span class="n">result</span><span class="p">[</span><span class="s2">&quot;x_edge_lower&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">final_newx_left</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span>
    <span class="n">result</span><span class="p">[</span><span class="s2">&quot;x_edge_upper&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">final_newx_right</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span>

    <span class="c1"># populate the new grid values</span>
    <span class="n">result</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">newy</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span> <span class="o">*</span> <span class="n">y_unit</span>

    <span class="c1"># populate the new grid value uncertainties</span>
    <span class="k">if</span> <span class="n">unc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">result</span><span class="p">[</span><span class="s2">&quot;uncertainty&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">newunc</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span> <span class="o">*</span> <span class="n">y_unit</span>

    <span class="c1"># store how many of the original pixels made it into this new one</span>
    <span class="n">result</span><span class="p">[</span><span class="s2">&quot;N_unbinned/N_binned&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">number_of_original_bins_per_new_bin</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">visualize</span><span class="p">:</span>
        <span class="n">fi</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span>
            <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">gridspec_kw</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">height_ratios</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">])</span>
        <span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">plot_as_boxes</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">xleft</span><span class="o">=</span><span class="n">x_left</span><span class="p">,</span> <span class="n">xright</span><span class="o">=</span><span class="n">x_right</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;silver&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">ekw</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">elinewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">unc</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;silver&quot;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">ekw</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">],</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">],</span>
            <span class="n">yerr</span><span class="o">=</span><span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;uncertainty&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
            <span class="n">xerr</span><span class="o">=</span><span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s2">&quot;x_edge_upper&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;x_edge_lower&quot;</span><span class="p">])</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
            <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
            <span class="n">zorder</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
            <span class="o">**</span><span class="n">ekw</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">plot_as_boxes</span><span class="p">(</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">],</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;N_unbinned/N_binned&quot;</span><span class="p">],</span>
            <span class="n">xleft</span><span class="o">=</span><span class="n">result</span><span class="p">[</span><span class="s2">&quot;x_edge_lower&quot;</span><span class="p">],</span>
            <span class="n">xright</span><span class="o">=</span><span class="n">result</span><span class="p">[</span><span class="s2">&quot;x_edge_upper&quot;</span><span class="p">],</span>
        <span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;$N_</span><span class="si">{unbinned}</span><span class="s2">/N_</span><span class="si">{binned}</span><span class="s2">$&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.get.wavelike.expected_uncertainty.calculate_bin_leftright" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">calculate_bin_leftright</span><span class="p">(</span><span class="n">x</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.get.wavelike.expected_uncertainty.calculate_bin_leftright" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>If x is an array of bin centers, calculate the bin edges.
(assumes outermost bins are same size as their neighbors)</p>
<h4 id="chromatic.rainbows.get.wavelike.expected_uncertainty.calculate_bin_leftright--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.get.wavelike.expected_uncertainty.calculate_bin_leftright--parameters" title="Permanent link">#</a></h4>
<p>x : array
    The array of bin centers.</p>
<h4 id="chromatic.rainbows.get.wavelike.expected_uncertainty.calculate_bin_leftright--returns">Returns<a class="headerlink" href="#chromatic.rainbows.get.wavelike.expected_uncertainty.calculate_bin_leftright--returns" title="Permanent link">#</a></h4>
<p>l : array
    The left edges of the bins.
r : array
    The right edges of the bins.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/tools/resampling.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">calculate_bin_leftright</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    If x is an array of bin centers, calculate the bin edges.</span>
<span class="sd">    (assumes outermost bins are same size as their neighbors)</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : array</span>
<span class="sd">        The array of bin centers.</span>

<span class="sd">    Returns</span>
<span class="sd">    ----------</span>
<span class="sd">    l : array</span>
<span class="sd">        The left edges of the bins.</span>
<span class="sd">    r : array</span>
<span class="sd">        The right edges of the bins.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># what are bin edges (making a guess for those on the ends)</span>
    <span class="c1"># xbinsize = calculate_bin_widths(x)</span>
    <span class="c1"># left = x - xbinsize / 2.0</span>
    <span class="c1"># right = x + xbinsize / 2.0</span>

    <span class="c1"># weird corner case!</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">left</span><span class="p">,</span> <span class="n">right</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">left</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">right</span><span class="p">])</span>

    <span class="n">inner_edges</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="n">x</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">first_edge</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="n">inner_edges</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">last_edge</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">inner_edges</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

    <span class="n">left</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">first_edge</span><span class="p">,</span> <span class="n">inner_edges</span><span class="p">])</span>
    <span class="n">right</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">inner_edges</span><span class="p">,</span> <span class="n">last_edge</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.get.wavelike.expected_uncertainty.edges_to_leftright" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">edges_to_leftright</span><span class="p">(</span><span class="n">edges</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.get.wavelike.expected_uncertainty.edges_to_leftright" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Convert N+1 contiguous edges to two arrays of N left/right edges.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/tools/resampling.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">edges_to_leftright</span><span class="p">(</span><span class="n">edges</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert N+1 contiguous edges to two arrays of N left/right edges.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">left</span><span class="p">,</span> <span class="n">right</span> <span class="o">=</span> <span class="n">edges</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">edges</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="k">return</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.get.wavelike.expected_uncertainty.expand_filenames" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">expand_filenames</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.get.wavelike.expected_uncertainty.expand_filenames" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>A wrapper to expand a string or list into a list of filenames.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/imports.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">expand_filenames</span><span class="p">(</span><span class="n">filepath</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A wrapper to expand a string or list into a list of filenames.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
        <span class="n">filenames</span> <span class="o">=</span> <span class="n">filepath</span>
    <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span> <span class="o">==</span> <span class="n">Column</span><span class="p">:</span>
        <span class="n">filenames</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>
    <span class="k">elif</span> <span class="s2">&quot;*&quot;</span> <span class="ow">in</span> <span class="n">filepath</span><span class="p">:</span>
        <span class="n">filenames</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">filepath</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">filenames</span> <span class="o">=</span> <span class="p">[</span><span class="n">filepath</span><span class="p">]</span>
    <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">filenames</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.get.wavelike.expected_uncertainty.get_expected_uncertainty" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_expected_uncertainty</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">function</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanmedian</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.get.wavelike.expected_uncertainty.get_expected_uncertainty" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Get the typical per-wavelength uncertainty.</p>
<h4 id="chromatic.rainbows.get.wavelike.expected_uncertainty.get_expected_uncertainty--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.get.wavelike.expected_uncertainty.get_expected_uncertainty--parameters" title="Permanent link">#</a></h4>
<p>function : function, optional
    What function should be used to choose the "typical"
    value for each wavelength? Good options are probably
    things like <code>np.nanmedian</code>, <code>np.median</code>, <code>np.nanmean</code>
    <code>np.mean</code>, <code>np.percentile</code>
<em>args : list, optional
    Addition arguments will be passed to <code>function</code>
</em>*kw : dict, optional
    Additional keyword arguments will be passed to <code>function</code></p>
<h4 id="chromatic.rainbows.get.wavelike.expected_uncertainty.get_expected_uncertainty--returns">Returns<a class="headerlink" href="#chromatic.rainbows.get.wavelike.expected_uncertainty.get_expected_uncertainty--returns" title="Permanent link">#</a></h4>
<p>uncertainty_per_wavelength : array
    The uncertainty associated with each wavelength.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/rainbows/get/wavelike/expected_uncertainty.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_expected_uncertainty</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">function</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanmedian</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get the typical per-wavelength uncertainty.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    function : function, optional</span>
<span class="sd">        What function should be used to choose the &quot;typical&quot;</span>
<span class="sd">        value for each wavelength? Good options are probably</span>
<span class="sd">        things like `np.nanmedian`, `np.median`, `np.nanmean`</span>
<span class="sd">        `np.mean`, `np.percentile`</span>
<span class="sd">    *args : list, optional</span>
<span class="sd">        Addition arguments will be passed to `function`</span>
<span class="sd">    **kw : dict, optional</span>
<span class="sd">        Additional keyword arguments will be passed to `function`</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    uncertainty_per_wavelength : array</span>
<span class="sd">        The uncertainty associated with each wavelength.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">uncertainty_per_wavelength</span> <span class="o">=</span> <span class="n">function</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">uncertainty</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">timeaxis</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">uncertainty_per_wavelength</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.get.wavelike.expected_uncertainty.leftright_to_edges" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">leftright_to_edges</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.get.wavelike.expected_uncertainty.leftright_to_edges" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Convert two arrays of N left/right edges to N+1 continugous edges.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/tools/resampling.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">leftright_to_edges</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert two arrays of N left/right edges to N+1 continugous edges.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">edges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>
    <span class="k">return</span> <span class="n">edges</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.get.wavelike.expected_uncertainty.name2color" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">name2color</span><span class="p">(</span><span class="n">name</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.get.wavelike.expected_uncertainty.name2color" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Return the 3-element RGB array of a given color name.</p>
<h4 id="chromatic.rainbows.get.wavelike.expected_uncertainty.name2color--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.get.wavelike.expected_uncertainty.name2color--parameters" title="Permanent link">#</a></h4>
<p>name : str
    The name of a color</p>
<h4 id="chromatic.rainbows.get.wavelike.expected_uncertainty.name2color--returns">Returns<a class="headerlink" href="#chromatic.rainbows.get.wavelike.expected_uncertainty.name2color--returns" title="Permanent link">#</a></h4>
<p>rgb : tuple
    3-element RGB color, with numbers from 0.0 to 1.0</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/imports.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">name2color</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return the 3-element RGB array of a given color name.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    name : str</span>
<span class="sd">        The name of a color</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    rgb : tuple</span>
<span class="sd">        3-element RGB color, with numbers from 0.0 to 1.0</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># give a friendly warning if the color name can&#39;t be found</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">color_hex</span> <span class="o">=</span> <span class="n">col</span><span class="o">.</span><span class="n">cnames</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">col</span><span class="o">.</span><span class="n">hex2color</span><span class="p">(</span><span class="n">color_hex</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="n">cheerfully_suggest</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The color </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> can&#39;t be found. (Returning black.)&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.get.wavelike.expected_uncertainty.one2another" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">one2another</span><span class="p">(</span><span class="n">bottom</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">alpha_bottom</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">alpha_top</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">256</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.get.wavelike.expected_uncertainty.one2another" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Create a cmap that goes smoothly (linearly in RGBA) from "bottom" to "top".</p>
<h4 id="chromatic.rainbows.get.wavelike.expected_uncertainty.one2another--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.get.wavelike.expected_uncertainty.one2another--parameters" title="Permanent link">#</a></h4>
<p>bottom : str
    Name of a color for the bottom of cmap (0.0)
top : str
    Name of a color for the top of the cmap (1.0)
alpha_bottom : float
    Opacity at the bottom of the cmap
alpha_top : float
    Opacitiy at the top of the cmap
N : int
    The number of levels in the listed color map</p>
<h4 id="chromatic.rainbows.get.wavelike.expected_uncertainty.one2another--returns">Returns<a class="headerlink" href="#chromatic.rainbows.get.wavelike.expected_uncertainty.one2another--returns" title="Permanent link">#</a></h4>
<p>cmap : Colormap
    A color map that goes linearly from the
    bottom to top color (and alpha).</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/imports.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">one2another</span><span class="p">(</span><span class="n">bottom</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">alpha_bottom</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">alpha_top</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">256</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a cmap that goes smoothly (linearly in RGBA) from &quot;bottom&quot; to &quot;top&quot;.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    bottom : str</span>
<span class="sd">        Name of a color for the bottom of cmap (0.0)</span>
<span class="sd">    top : str</span>
<span class="sd">        Name of a color for the top of the cmap (1.0)</span>
<span class="sd">    alpha_bottom : float</span>
<span class="sd">        Opacity at the bottom of the cmap</span>
<span class="sd">    alpha_top : float</span>
<span class="sd">        Opacitiy at the top of the cmap</span>
<span class="sd">    N : int</span>
<span class="sd">        The number of levels in the listed color map</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    cmap : Colormap</span>
<span class="sd">        A color map that goes linearly from the</span>
<span class="sd">        bottom to top color (and alpha).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># get the RGB values of the bottom and top of the cmap</span>
    <span class="n">rgb_bottom</span><span class="p">,</span> <span class="n">rgb_top</span> <span class="o">=</span> <span class="n">name2color</span><span class="p">(</span><span class="n">bottom</span><span class="p">),</span> <span class="n">name2color</span><span class="p">(</span><span class="n">top</span><span class="p">)</span>

    <span class="c1"># create linear gradients for all four RGBA channels</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">rgb_bottom</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">rgb_top</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">N</span><span class="p">)</span>
    <span class="n">g</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">rgb_bottom</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">rgb_top</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">N</span><span class="p">)</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">rgb_bottom</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">rgb_top</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">N</span><span class="p">)</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">alpha_bottom</span><span class="p">,</span> <span class="n">alpha_top</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>

    <span class="c1"># create (N,4) array + populate a listed colormap</span>
    <span class="n">colors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">]))</span>
    <span class="n">cmap</span> <span class="o">=</span> <span class="n">col</span><span class="o">.</span><span class="n">ListedColormap</span><span class="p">(</span><span class="n">colors</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{bottom}</span><span class="s2">2</span><span class="si">{top}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="nb">locals</span><span class="p">()))</span>

    <span class="c1"># return the colormap</span>
    <span class="k">return</span> <span class="n">cmap</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.get.wavelike.expected_uncertainty.remove_unit" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">remove_unit</span><span class="p">(</span><span class="n">x</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.get.wavelike.expected_uncertainty.remove_unit" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Quick wrapper to remove the unit from a quantity,
but not complain if it doesn't have one.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/imports.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">remove_unit</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Quick wrapper to remove the unit from a quantity,</span>
<span class="sd">    but not complain if it doesn&#39;t have one.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">x</span><span class="o">.</span><span class="n">value</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">x</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.get.wavelike.expected_uncertainty.resample_while_conserving_flux" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">resample_while_conserving_flux</span><span class="p">(</span><span class="n">xin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">yin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xout</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xin_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xout_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">replace_nans</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">visualize</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">pause</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.get.wavelike.expected_uncertainty.resample_while_conserving_flux" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Starting from some initial x and y, resample onto a
different grid (either higher or lower resolution),
while conserving total flux.</p>
<p>When including the entire range of <code>xin</code>,
<code>sum(yout) == sum(yin)</code> should be true.</p>
<p>When including only part of the range of <code>xin</code>,
the integral between any two points should be conserved.</p>
<h4 id="chromatic.rainbows.get.wavelike.expected_uncertainty.resample_while_conserving_flux--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.get.wavelike.expected_uncertainty.resample_while_conserving_flux--parameters" title="Permanent link">#</a></h4>
<p>xin : array
    The original independent variable.
yin : array
    The original dependent variable (same size as x).
xout : array
    The new grid of independent variables onto which
    you want to resample the y values. Refers to the
    center of each bin (use <code>xout_edges</code> for finer
    control over the exact edges of the bins)
xin_edges : array
    The edges of the original independent variable bins.
    The left and right edges of the bins are interpreted
    to be <code>xin_edges[:-1]</code> and <code>xin_edges[1:]</code>,
    respectively, so the associated <code>yin</code> should have exactly
    1 fewer element than <code>xin_edges</code>. This provides finer
    control over the size of each bin in the input than
    simply supplying <code>xin</code>(still a little experimental)
    They should probably be sorted?
xout_edges : array
    The edges of the new grid of bins for the independent
    variable, onto which you want to resample the y
    values. The left and right edges of the bins will be,
    respectively, <code>xout_edges[:-1]</code> and <code>xout_edges[1:]</code>,
    so the size of the output array will be
    <code>len(xout_edges) - 1</code>
replace_nans : float, str
    Replace nan values with this value.
    <code>replace_nans = 0</code>
        will add no flux where nans are
    <code>replace_nans = nan</code>
        will ensure you get nans returned everywhere
        if you try to resample over any nan
    <code>replace_nans = 'interpolate'</code>
        will try to replace nans by linearly interpolating
        from nearby values (not yet implemented)
visualize : bool
    Should we make a plot showing whether it worked?
pause : bool
    Should we pause to wait for a key press?</p>
<h4 id="chromatic.rainbows.get.wavelike.expected_uncertainty.resample_while_conserving_flux--returns">Returns<a class="headerlink" href="#chromatic.rainbows.get.wavelike.expected_uncertainty.resample_while_conserving_flux--returns" title="Permanent link">#</a></h4>
<p>result : dict
    A dictionary containing...
        <code>x</code> = the center of the output grid
        <code>y</code> = the resampled value on the output grid
        <code>edges</code> = the edges of the output grid, which will
            have one more element than x or y</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/tools/resampling.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">resample_while_conserving_flux</span><span class="p">(</span>
    <span class="n">xin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">yin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">xout</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">xin_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">xout_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">replace_nans</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
    <span class="n">visualize</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">pause</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Starting from some initial x and y, resample onto a</span>
<span class="sd">    different grid (either higher or lower resolution),</span>
<span class="sd">    while conserving total flux.</span>

<span class="sd">    When including the entire range of `xin`,</span>
<span class="sd">    `sum(yout) == sum(yin)` should be true.</span>

<span class="sd">    When including only part of the range of `xin`,</span>
<span class="sd">    the integral between any two points should be conserved.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    xin : array</span>
<span class="sd">        The original independent variable.</span>
<span class="sd">    yin : array</span>
<span class="sd">        The original dependent variable (same size as x).</span>
<span class="sd">    xout : array</span>
<span class="sd">        The new grid of independent variables onto which</span>
<span class="sd">        you want to resample the y values. Refers to the</span>
<span class="sd">        center of each bin (use `xout_edges` for finer</span>
<span class="sd">        control over the exact edges of the bins)</span>
<span class="sd">    xin_edges : array</span>
<span class="sd">        The edges of the original independent variable bins.</span>
<span class="sd">        The left and right edges of the bins are interpreted</span>
<span class="sd">        to be `xin_edges[:-1]` and `xin_edges[1:]`,</span>
<span class="sd">        respectively, so the associated `yin` should have exactly</span>
<span class="sd">        1 fewer element than `xin_edges`. This provides finer</span>
<span class="sd">        control over the size of each bin in the input than</span>
<span class="sd">        simply supplying `xin`(still a little experimental)</span>
<span class="sd">        They should probably be sorted?</span>
<span class="sd">    xout_edges : array</span>
<span class="sd">        The edges of the new grid of bins for the independent</span>
<span class="sd">        variable, onto which you want to resample the y</span>
<span class="sd">        values. The left and right edges of the bins will be,</span>
<span class="sd">        respectively, `xout_edges[:-1]` and `xout_edges[1:]`,</span>
<span class="sd">        so the size of the output array will be</span>
<span class="sd">        `len(xout_edges) - 1`</span>
<span class="sd">    replace_nans : float, str</span>
<span class="sd">        Replace nan values with this value.</span>
<span class="sd">        `replace_nans = 0`</span>
<span class="sd">            will add no flux where nans are</span>
<span class="sd">        `replace_nans = nan`</span>
<span class="sd">            will ensure you get nans returned everywhere</span>
<span class="sd">            if you try to resample over any nan</span>
<span class="sd">        `replace_nans = &#39;interpolate&#39;`</span>
<span class="sd">            will try to replace nans by linearly interpolating</span>
<span class="sd">            from nearby values (not yet implemented)</span>
<span class="sd">    visualize : bool</span>
<span class="sd">        Should we make a plot showing whether it worked?</span>
<span class="sd">    pause : bool</span>
<span class="sd">        Should we pause to wait for a key press?</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    result : dict</span>
<span class="sd">        A dictionary containing...</span>
<span class="sd">            `x` = the center of the output grid</span>
<span class="sd">            `y` = the resampled value on the output grid</span>
<span class="sd">            `edges` = the edges of the output grid, which will</span>
<span class="sd">                have one more element than x or y</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># make sure there are some reasonable input options</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">xin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">xin_edges</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">yin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">xout</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">xout_edges</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>

    <span class="c1"># set up the bins, to calculate cumulative distribution of y</span>
    <span class="k">if</span> <span class="n">xin_edges</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># make sure the sizes match up</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">xin</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">yin</span><span class="p">)</span>
        <span class="c1"># sort to make sure x is strictly increasing</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">xin</span><span class="p">)</span>
        <span class="n">xin_sorted</span> <span class="o">=</span> <span class="n">xin</span><span class="p">[</span><span class="n">s</span><span class="p">]</span>
        <span class="n">yin_sorted</span> <span class="o">=</span> <span class="n">yin</span><span class="p">[</span><span class="n">s</span><span class="p">]</span>
        <span class="c1"># estimate some bin edges (might fail for non-uniform grids)</span>
        <span class="n">xin_left</span><span class="p">,</span> <span class="n">xin_right</span> <span class="o">=</span> <span class="n">calculate_bin_leftright</span><span class="p">(</span><span class="n">xin_sorted</span><span class="p">)</span>
        <span class="c1"># define an array of edges</span>
        <span class="n">xin_edges</span> <span class="o">=</span> <span class="n">leftright_to_edges</span><span class="p">(</span><span class="n">xin_left</span><span class="p">,</span> <span class="n">xin_right</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># make sure the sizes match up</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">xin_edges</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">yin</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="c1"># sort to make sure x is strictly increasing</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">xin_edges</span><span class="p">)</span>
        <span class="n">xin_left</span><span class="p">,</span> <span class="n">xin_right</span> <span class="o">=</span> <span class="n">edges_to_leftright</span><span class="p">(</span><span class="n">xin_edges</span><span class="p">[</span><span class="n">s</span><span class="p">])</span>
        <span class="n">xin_sorted</span> <span class="o">=</span> <span class="p">(</span><span class="n">xin_left</span> <span class="o">+</span> <span class="n">xin_right</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">yin_sorted</span> <span class="o">=</span> <span class="n">yin</span><span class="p">[</span><span class="n">s</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>

    <span class="c1"># the first element should be the left edge of the first pixel</span>
    <span class="c1"># last element will be right edge of last pixel</span>
    <span class="n">xin_for_cdf</span> <span class="o">=</span> <span class="n">xin_edges</span>

    <span class="c1"># to the left of the first pixel, assume flux is zero</span>
    <span class="n">yin_for_cdf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">yin_sorted</span><span class="p">])</span>

    <span class="c1"># correct for any non-finite values</span>
    <span class="n">bad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">yin_for_cdf</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">replace_nans</span> <span class="o">==</span> <span class="s2">&quot;interpolate&quot;</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
            <span class="s2">&quot;The `replace_nans=&#39;interpolate&#39;`` option doens&#39;t exist yet!&quot;</span>
        <span class="p">)</span>
    <span class="n">yin_for_cdf</span><span class="p">[</span><span class="n">bad</span><span class="p">]</span> <span class="o">=</span> <span class="n">replace_nans</span>

    <span class="c1"># calculate the CDF of the flux (at pixel edge locations)</span>
    <span class="n">cdfin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">yin_for_cdf</span><span class="p">)</span>

    <span class="c1"># create an interpolator for that CDF</span>
    <span class="n">cdfinterpolator</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span>
        <span class="n">xin_for_cdf</span><span class="p">,</span>
        <span class="n">cdfin</span><span class="p">,</span>
        <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span>
        <span class="n">bounds_error</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">fill_value</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">yin</span><span class="p">)),</span>
    <span class="p">)</span>

    <span class="c1"># calculate bin edges (of size len(xout)+1)</span>
    <span class="k">if</span> <span class="n">xout_edges</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">xout_left</span><span class="p">,</span> <span class="n">xout_right</span> <span class="o">=</span> <span class="n">calculate_bin_leftright</span><span class="p">(</span><span class="n">xout</span><span class="p">)</span>
        <span class="n">xout_edges</span> <span class="o">=</span> <span class="n">leftright_to_edges</span><span class="p">(</span><span class="n">xout_left</span><span class="p">,</span> <span class="n">xout_right</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">xout_left</span><span class="p">,</span> <span class="n">xout_right</span> <span class="o">=</span> <span class="n">edges_to_leftright</span><span class="p">(</span><span class="n">xout_edges</span><span class="p">)</span>
        <span class="n">xout</span> <span class="o">=</span> <span class="p">(</span><span class="n">xout_left</span> <span class="o">+</span> <span class="n">xout_right</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>

    <span class="n">xout_for_cdf</span> <span class="o">=</span> <span class="n">leftright_to_edges</span><span class="p">(</span><span class="n">xout_left</span><span class="p">,</span> <span class="n">xout_right</span><span class="p">)</span>

    <span class="c1"># interpolate the CDF onto those bin edges</span>
    <span class="n">cdfout</span> <span class="o">=</span> <span class="n">cdfinterpolator</span><span class="p">(</span><span class="n">xout_for_cdf</span><span class="p">)</span>

    <span class="c1"># take  derivative of the CDF to get flux per resampled bin</span>
    <span class="c1"># (xout is bin center, and yout is the flux in that bin)</span>
    <span class="n">yout</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">cdfout</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">visualize</span><span class="p">:</span>
        <span class="n">fi</span><span class="p">,</span> <span class="p">(</span><span class="n">ax_cdf</span><span class="p">,</span> <span class="n">ax_pdf</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
        <span class="n">inkw</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
            <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span>
            <span class="n">markeredgecolor</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">outkw</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;darkorange&quot;</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span>
            <span class="n">markersize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
            <span class="n">markeredgecolor</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">legkw</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper left&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">xinbinsize</span> <span class="o">=</span> <span class="n">xin_right</span> <span class="o">-</span> <span class="n">xin_left</span>
        <span class="n">xoutbinsize</span> <span class="o">=</span> <span class="n">xout_right</span> <span class="o">-</span> <span class="n">xout_left</span>
        <span class="c1"># plot the PDFs</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="n">ax_pdf</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Flux per (Original) Pixel&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Pixel&quot;</span><span class="p">)</span>
        <span class="c1"># plot the original pixels (in df/dpixel to compare with resampled)</span>
        <span class="n">plot_as_boxes</span><span class="p">(</span>
            <span class="n">xin_sorted</span><span class="p">,</span> <span class="n">yin_sorted</span> <span class="o">/</span> <span class="n">xinbinsize</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Original Pixels&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">inkw</span>
        <span class="p">)</span>

        <span class="c1"># what would a bad interpolation look like?</span>
        <span class="n">interpolate_badly</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span>
            <span class="n">xin_sorted</span><span class="p">,</span>
            <span class="n">yin_sorted</span> <span class="o">/</span> <span class="n">xinbinsize</span><span class="p">,</span>
            <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span>
            <span class="n">bounds_error</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">fill_value</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
            <span class="n">xout</span><span class="p">,</span>
            <span class="n">interpolate_badly</span><span class="p">(</span><span class="n">xout</span><span class="p">),</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;cornflowerblue&quot;</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span>
            <span class="n">markersize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
            <span class="n">markeredgecolor</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Silly Simple Interpolation&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># plot the flux-conserving resampled data (again, in df/d&quot;pixel&quot;)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
            <span class="n">xout</span><span class="p">,</span> <span class="n">yout</span> <span class="o">/</span> <span class="n">xoutbinsize</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Flux-Conserving Interpolation&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">outkw</span>
        <span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="o">**</span><span class="n">legkw</span><span class="p">)</span>

        <span class="c1"># plot the CDFs</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="n">ax_cdf</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Cumulative Flux (from left)&quot;</span><span class="p">)</span>

        <span class="c1"># plot the original CDF</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xin_for_cdf</span><span class="p">,</span> <span class="n">cdfin</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Original Pixels&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">inkw</span><span class="p">)</span>

        <span class="c1"># plot the interpolated CDF</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xout_for_cdf</span><span class="p">,</span> <span class="n">cdfout</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Flux-Conserved Resample&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">outkw</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">pause</span><span class="p">:</span>
            <span class="n">a</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span>
                <span class="s2">&quot;Pausing a moment to check on interpolation; press return to continue.&quot;</span>
            <span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{:&gt;6}</span><span class="s2"> = </span><span class="si">{:.5f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;Actual&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">yin</span><span class="p">)))</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="s2">&quot;</span><span class="si">{:&gt;6}</span><span class="s2"> = </span><span class="si">{:.5f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="s2">&quot;Silly&quot;</span><span class="p">,</span>
                <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">interpolate_badly</span><span class="p">(</span><span class="n">xout</span><span class="p">)</span> <span class="o">*</span> <span class="n">xoutbinsize</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{:&gt;6}</span><span class="s2"> = </span><span class="si">{:.5f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;CDF&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">yout</span><span class="p">)))</span>

    <span class="c1"># return the resampled y-values</span>
    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="n">xout</span><span class="p">,</span> <span class="s2">&quot;x_edge_lower&quot;</span><span class="p">:</span> <span class="n">xout_left</span><span class="p">,</span> <span class="s2">&quot;x_edge_upper&quot;</span><span class="p">:</span> <span class="n">xout_right</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="n">yout</span><span class="p">}</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="chromatic.rainbows.get.wavelike.measured_scatter_in_bins"></a>
    <div class="doc doc-contents first">









  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.get.wavelike.measured_scatter_in_bins.bintoR" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">bintoR</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">unc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">R</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">weighting</span><span class="o">=</span><span class="s1">&#39;inversevariance&#39;</span><span class="p">,</span> <span class="n">drop_nans</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.get.wavelike.measured_scatter_in_bins.bintoR" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Bin any x and y array onto a logarithmicly uniform grid.</p>
<h4 id="chromatic.rainbows.get.wavelike.measured_scatter_in_bins.bintoR--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.get.wavelike.measured_scatter_in_bins.bintoR--parameters" title="Permanent link">#</a></h4>
<p>x : array
    The original independent variable.
    (For a spectrum example = wavelength)
y : array
    The original dependent variable (same size as x).
    (For a spectrum example = flux)
unc : array, None, optional
    The unceratinty on the dependent variable
    (For a spectrum example = the flux uncertainty)
R : array, optional
    The spectral resolution R=x/dx for creating a new,
    logarithmically uniform grid that starts at the first
    value of x.
xlim : list, array, optional
    A two-element list indicating the min and max values of
    x for the new logarithmically spaced grid. If None,
    these limits will be created from the data themselves
weighting : str, optional
    How should we weight values when averaging
    them together into one larger bin?
    <code>weighting = 'inversevariance'</code>
        weights = 1/unc**2
     <code>weighting = {literally anything else}</code>
        uniform weights
    This will have no impact if <code>unc == None</code>, or for any
    new bins that effectively overlap less than one original
    unbinned point.
drop_nans : bool, optional
    Should we skip any bins turn out to be nans?
    This most often happens when bins are empty.</p>
<h4 id="chromatic.rainbows.get.wavelike.measured_scatter_in_bins.bintoR--returns">Returns<a class="headerlink" href="#chromatic.rainbows.get.wavelike.measured_scatter_in_bins.bintoR--returns" title="Permanent link">#</a></h4>
<p>result : dict
    A dictionary containing at least...
        <code>x</code> = the center of the output grid
        <code>y</code> = the resampled value on the output grid
        <code>x_edge_lower</code> = the lower edges of the output grid
        <code>x_edge_upper</code> = the upper edges of the output grid
    ...and possibly also
        <code>uncertainty</code> = the calculated uncertainty per bin</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/tools/resampling.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">bintoR</span><span class="p">(</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">unc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">R</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">weighting</span><span class="o">=</span><span class="s2">&quot;inversevariance&quot;</span><span class="p">,</span> <span class="n">drop_nans</span><span class="o">=</span><span class="kc">True</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Bin any x and y array onto a logarithmicly uniform grid.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : array</span>
<span class="sd">        The original independent variable.</span>
<span class="sd">        (For a spectrum example = wavelength)</span>
<span class="sd">    y : array</span>
<span class="sd">        The original dependent variable (same size as x).</span>
<span class="sd">        (For a spectrum example = flux)</span>
<span class="sd">    unc : array, None, optional</span>
<span class="sd">        The unceratinty on the dependent variable</span>
<span class="sd">        (For a spectrum example = the flux uncertainty)</span>
<span class="sd">    R : array, optional</span>
<span class="sd">        The spectral resolution R=x/dx for creating a new,</span>
<span class="sd">        logarithmically uniform grid that starts at the first</span>
<span class="sd">        value of x.</span>
<span class="sd">    xlim : list, array, optional</span>
<span class="sd">        A two-element list indicating the min and max values of</span>
<span class="sd">        x for the new logarithmically spaced grid. If None,</span>
<span class="sd">        these limits will be created from the data themselves</span>
<span class="sd">    weighting : str, optional</span>
<span class="sd">        How should we weight values when averaging</span>
<span class="sd">        them together into one larger bin?</span>
<span class="sd">        `weighting = &#39;inversevariance&#39;`</span>
<span class="sd">            weights = 1/unc**2</span>
<span class="sd">         `weighting = {literally anything else}`</span>
<span class="sd">            uniform weights</span>
<span class="sd">        This will have no impact if `unc == None`, or for any</span>
<span class="sd">        new bins that effectively overlap less than one original</span>
<span class="sd">        unbinned point.</span>
<span class="sd">    drop_nans : bool, optional</span>
<span class="sd">        Should we skip any bins turn out to be nans?</span>
<span class="sd">        This most often happens when bins are empty.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    result : dict</span>
<span class="sd">        A dictionary containing at least...</span>
<span class="sd">            `x` = the center of the output grid</span>
<span class="sd">            `y` = the resampled value on the output grid</span>
<span class="sd">            `x_edge_lower` = the lower edges of the output grid</span>
<span class="sd">            `x_edge_upper` = the upper edges of the output grid</span>
<span class="sd">        ...and possibly also</span>
<span class="sd">            `uncertainty` = the calculated uncertainty per bin</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">x_unit</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">unit</span>
        <span class="n">x_without_unit</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">value</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="n">x_unit</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">x_without_unit</span> <span class="o">=</span> <span class="n">x</span>

    <span class="c1"># create a new grid of x at the given resolution</span>
    <span class="n">lnx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">x_without_unit</span><span class="p">)</span>
    <span class="n">dnewlnx</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">R</span>

    <span class="c1"># set the limits of the new xgrid (in log space)</span>
    <span class="k">if</span> <span class="n">xlim</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># use the input grid to set the limits</span>
        <span class="n">lnxbottom</span><span class="p">,</span> <span class="n">lnxtop</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">lnx</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">lnx</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># use the custom xlim to set the limits</span>
        <span class="n">lnxbottom</span><span class="p">,</span> <span class="n">lnxtop</span> <span class="o">=</span> <span class="n">xlim</span>

    <span class="c1"># create a new, log-uniform grid of x values</span>
    <span class="n">newlnx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">lnxbottom</span><span class="p">,</span> <span class="n">lnxtop</span> <span class="o">+</span> <span class="n">dnewlnx</span><span class="p">,</span> <span class="n">dnewlnx</span><span class="p">)</span>

    <span class="c1"># now do the binning on a uniform grid of lnx</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">bintogrid</span><span class="p">(</span>
        <span class="n">lnx</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">unc</span><span class="p">,</span> <span class="n">newx</span><span class="o">=</span><span class="n">newlnx</span><span class="p">,</span> <span class="n">weighting</span><span class="o">=</span><span class="n">weighting</span><span class="p">,</span> <span class="n">drop_nans</span><span class="o">=</span><span class="n">drop_nans</span>
    <span class="p">)</span>

    <span class="c1"># convert back from log to real values</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;x_edge_lower&quot;</span><span class="p">,</span> <span class="s2">&quot;x_edge_upper&quot;</span><span class="p">]:</span>
        <span class="n">result</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="o">*</span> <span class="n">x_unit</span>

    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.get.wavelike.measured_scatter_in_bins.bintogrid" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">bintogrid</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">unc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">newx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">newx_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">nx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">weighting</span><span class="o">=</span><span class="s1">&#39;inversevariance&#39;</span><span class="p">,</span> <span class="n">drop_nans</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">x_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">visualize</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.get.wavelike.measured_scatter_in_bins.bintogrid" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Bin any x and y array onto a linearly uniform grid.</p>
<h4 id="chromatic.rainbows.get.wavelike.measured_scatter_in_bins.bintogrid--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.get.wavelike.measured_scatter_in_bins.bintogrid--parameters" title="Permanent link">#</a></h4>
<p>x : array
    The original independent variable.
    (For a spectrum example = wavelength)
y : array
    The original dependent variable (same size as x).
    (For a spectrum example = flux)
unc : array, None
    The unceratinty on the dependent variable
    (For a spectrum example = the flux uncertainty)
nx : array
    The number of bins from the original grid to
    bin together into the new one.
dx : array
    The fixed spacing for creating a new, linearly uniform
    grid that start at the first value of x. This will
    be ignored if <code>newx</code> != None.
newx : array
    A new custom grid onto which we should bin.
newx_edges : array
    The edges of the new grid of bins for the independent
    variable, onto which you want to resample the y
    values. The left and right edges of the bins will be,
    respectively, <code>newx_edges[:-1]</code> and <code>newx_edges[1:]</code>,
    so the size of the output array will be
    <code>len(newx_edges) - 1</code>
weighting : str
    How should we weight values when averaging
    them together into one larger bin?
    <code>weighting = 'inversevariance'</code>
        weights = 1/unc**2
     <code>weighting = {literally anything else}</code>
        uniform weights
    This will have no impact if <code>unc == None</code>, or for any
    new bins that effectively overlap less than one original
    unbinned point.
drop_nans : bool
    Should we skip any bins turn out to be nans?
    This most often happens when bins are empty.
x_edges : array
    The edges of the original independent variable bins.
    The left and right edges of the bins are interpreted
    to be <code>x_edges[:-1]</code> and <code>x_edges[1:]</code>,
    respectively, so the associated <code>y</code> should have exactly
    1 fewer element than <code>x_edges</code>. This provides finer
    control over the size of each bin in the input than
    simply supplying <code>x</code>(still a little experimental)</p>
<h4 id="chromatic.rainbows.get.wavelike.measured_scatter_in_bins.bintogrid--returns">Returns<a class="headerlink" href="#chromatic.rainbows.get.wavelike.measured_scatter_in_bins.bintogrid--returns" title="Permanent link">#</a></h4>
<p>result : dict
    A dictionary containing at least...
        <code>x</code> = the center of the output grid
        <code>y</code> = the resampled value on the output grid
        <code>x_edge_lower</code> = the lower edges of the output grid
        <code>x_edge_upper</code> = the upper edges of the output grid
    ...and possibly also
        <code>uncertainty</code> = the calculated uncertainty per bin</p>
<p>The order of precendence for setting the new grid is
[<code>newx_edges</code>, <code>newx</code>, <code>dx</code>, <code>nx</code>]
The first will be used, and others will be ignored.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/tools/resampling.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">bintogrid</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">unc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">newx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">newx_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">dx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">nx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">weighting</span><span class="o">=</span><span class="s2">&quot;inversevariance&quot;</span><span class="p">,</span>
    <span class="n">drop_nans</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">x_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">visualize</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Bin any x and y array onto a linearly uniform grid.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : array</span>
<span class="sd">        The original independent variable.</span>
<span class="sd">        (For a spectrum example = wavelength)</span>
<span class="sd">    y : array</span>
<span class="sd">        The original dependent variable (same size as x).</span>
<span class="sd">        (For a spectrum example = flux)</span>
<span class="sd">    unc : array, None</span>
<span class="sd">        The unceratinty on the dependent variable</span>
<span class="sd">        (For a spectrum example = the flux uncertainty)</span>
<span class="sd">    nx : array</span>
<span class="sd">        The number of bins from the original grid to</span>
<span class="sd">        bin together into the new one.</span>
<span class="sd">    dx : array</span>
<span class="sd">        The fixed spacing for creating a new, linearly uniform</span>
<span class="sd">        grid that start at the first value of x. This will</span>
<span class="sd">        be ignored if `newx` != None.</span>
<span class="sd">    newx : array</span>
<span class="sd">        A new custom grid onto which we should bin.</span>
<span class="sd">    newx_edges : array</span>
<span class="sd">        The edges of the new grid of bins for the independent</span>
<span class="sd">        variable, onto which you want to resample the y</span>
<span class="sd">        values. The left and right edges of the bins will be,</span>
<span class="sd">        respectively, `newx_edges[:-1]` and `newx_edges[1:]`,</span>
<span class="sd">        so the size of the output array will be</span>
<span class="sd">        `len(newx_edges) - 1`</span>
<span class="sd">    weighting : str</span>
<span class="sd">        How should we weight values when averaging</span>
<span class="sd">        them together into one larger bin?</span>
<span class="sd">        `weighting = &#39;inversevariance&#39;`</span>
<span class="sd">            weights = 1/unc**2</span>
<span class="sd">         `weighting = {literally anything else}`</span>
<span class="sd">            uniform weights</span>
<span class="sd">        This will have no impact if `unc == None`, or for any</span>
<span class="sd">        new bins that effectively overlap less than one original</span>
<span class="sd">        unbinned point.</span>
<span class="sd">    drop_nans : bool</span>
<span class="sd">        Should we skip any bins turn out to be nans?</span>
<span class="sd">        This most often happens when bins are empty.</span>
<span class="sd">    x_edges : array</span>
<span class="sd">        The edges of the original independent variable bins.</span>
<span class="sd">        The left and right edges of the bins are interpreted</span>
<span class="sd">        to be `x_edges[:-1]` and `x_edges[1:]`,</span>
<span class="sd">        respectively, so the associated `y` should have exactly</span>
<span class="sd">        1 fewer element than `x_edges`. This provides finer</span>
<span class="sd">        control over the size of each bin in the input than</span>
<span class="sd">        simply supplying `x`(still a little experimental)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    result : dict</span>
<span class="sd">        A dictionary containing at least...</span>
<span class="sd">            `x` = the center of the output grid</span>
<span class="sd">            `y` = the resampled value on the output grid</span>
<span class="sd">            `x_edge_lower` = the lower edges of the output grid</span>
<span class="sd">            `x_edge_upper` = the upper edges of the output grid</span>
<span class="sd">        ...and possibly also</span>
<span class="sd">            `uncertainty` = the calculated uncertainty per bin</span>


<span class="sd">    The order of precendence for setting the new grid is</span>
<span class="sd">    [`newx_edges`, `newx`, `dx`, `nx`]</span>
<span class="sd">    The first will be used, and others will be ignored.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># check that an OK set of inputs has been supplied</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">x_edges</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;🌈 Both `x` and `x_edges` were supplied to `bintogrid`. Confusing!&quot;&quot;&quot;</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">x_edges</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;🌈 At least one of `x` or `x_edges` must be supplied to `bintogrid`.&quot;&quot;&quot;</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="n">y</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;🌈 `y` must be supplied to `bintogrid`.&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="c1"># make sure the edges and the centers are set</span>
    <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">x_left</span><span class="p">,</span> <span class="n">x_right</span> <span class="o">=</span> <span class="n">edges_to_leftright</span><span class="p">(</span><span class="n">x_edges</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">left</span> <span class="o">+</span> <span class="n">right</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">x_left</span><span class="p">,</span> <span class="n">x_right</span> <span class="o">=</span> <span class="n">calculate_bin_leftright</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">x_edges</span> <span class="o">=</span> <span class="n">leftright_to_edges</span><span class="p">(</span><span class="n">x_left</span><span class="p">,</span> <span class="n">x_right</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">x_unit</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">unit</span>
        <span class="n">x_without_unit</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">value</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="n">x_unit</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">x_without_unit</span> <span class="o">=</span> <span class="n">x</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">y_unit</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">unit</span>
        <span class="n">y_without_unit</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">value</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="n">y_unit</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">y_without_unit</span> <span class="o">=</span> <span class="n">y</span>

    <span class="c1"># warn if multiple inputs are provided</span>
    <span class="n">number_of_grid_options</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span><span class="n">z</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="p">[</span><span class="n">newx_edges</span><span class="p">,</span> <span class="n">newx</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">nx</span><span class="p">]])</span>
    <span class="k">if</span> <span class="n">number_of_grid_options</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">cheerfully_suggest</span><span class="p">(</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;More than one output grid sent to `bintogrid`.</span>
<span class="sd">                         The one being used is the first to appear in</span>
<span class="sd">                         [`newx_edges`, `newx`, `dx`, `nx`]</span>
<span class="sd">                         but you might want to choose more carefully.&quot;&quot;&quot;</span>
        <span class="p">)</span>

    <span class="c1"># define inputs based on the following order</span>
    <span class="k">if</span> <span class="n">newx_edges</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># define grid by its edges (and define others from there)</span>
        <span class="n">newx_edges_without_unit</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">newx_edges</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">x_unit</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
        <span class="n">dx_without_unit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">newx_edges_without_unit</span><span class="p">)</span>
        <span class="n">newx_without_unit</span> <span class="o">=</span> <span class="n">newx_edges_without_unit</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">dx_without_unit</span>
        <span class="n">newx_left_without_unit</span> <span class="o">=</span> <span class="n">newx_edges_without_unit</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">newx_right_without_unit</span> <span class="o">=</span> <span class="n">newx_edges_without_unit</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

        <span class="c1"># make sure the final output grid is defined</span>
        <span class="n">final_newx</span><span class="p">,</span> <span class="n">final_newx_left</span><span class="p">,</span> <span class="n">final_newx_right</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">newx_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
            <span class="n">newx_left_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
            <span class="n">newx_right_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="n">newx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># define grid by its centers (and define others from there)</span>
        <span class="n">newx_without_unit</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">newx</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">x_unit</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
        <span class="n">newx_left_without_unit</span><span class="p">,</span> <span class="n">newx_right_without_unit</span> <span class="o">=</span> <span class="n">calculate_bin_leftright</span><span class="p">(</span>
            <span class="n">newx_without_unit</span>
        <span class="p">)</span>
        <span class="n">newx_edges_without_unit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span>
            <span class="p">[</span><span class="n">newx_left_without_unit</span><span class="p">,</span> <span class="n">newx_right_without_unit</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
        <span class="p">)</span>
        <span class="n">dx_without_unit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">newx_edges_without_unit</span><span class="p">)</span>

        <span class="c1"># make sure the final output grid is defined</span>
        <span class="n">final_newx</span><span class="p">,</span> <span class="n">final_newx_left</span><span class="p">,</span> <span class="n">final_newx_right</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">newx_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
            <span class="n">newx_left_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
            <span class="n">newx_right_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="n">dx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># define grid by a bin width (and define others from there)</span>
        <span class="n">dx_without_unit</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">dx</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">x_unit</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
        <span class="n">newx_without_unit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">x_without_unit</span><span class="p">),</span>
            <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">x_without_unit</span><span class="p">)</span> <span class="o">+</span> <span class="n">dx_without_unit</span><span class="p">,</span>
            <span class="n">dx_without_unit</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">newx_left_without_unit</span><span class="p">,</span> <span class="n">newx_right_without_unit</span> <span class="o">=</span> <span class="n">calculate_bin_leftright</span><span class="p">(</span>
            <span class="n">newx_without_unit</span>
        <span class="p">)</span>
        <span class="n">newx_edges_without_unit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span>
            <span class="p">[</span><span class="n">newx_left_without_unit</span><span class="p">,</span> <span class="n">newx_right_without_unit</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
        <span class="p">)</span>

        <span class="c1"># make sure the final output grid is defined</span>
        <span class="n">final_newx</span><span class="p">,</span> <span class="n">final_newx_left</span><span class="p">,</span> <span class="n">final_newx_right</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">newx_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
            <span class="n">newx_left_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
            <span class="n">newx_right_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">elif</span> <span class="n">nx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># keep track of the original input x values</span>
        <span class="n">original_x_without_unit</span> <span class="o">=</span> <span class="n">x_without_unit</span>

        <span class="c1"># redefine the input x to indices, to do interpolation in index space</span>
        <span class="n">x_without_unit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">x_without_unit</span><span class="p">))</span>

        <span class="c1"># define a grid of edges that will enclose the right number of indices</span>
        <span class="n">x_left_i</span><span class="p">,</span> <span class="n">x_right_i</span> <span class="o">=</span> <span class="n">calculate_bin_leftright</span><span class="p">(</span><span class="n">x_without_unit</span><span class="p">)</span>
        <span class="n">newx_edges_without_unit</span> <span class="o">=</span> <span class="n">leftright_to_edges</span><span class="p">(</span><span class="n">x_left_i</span><span class="p">,</span> <span class="n">x_right_i</span><span class="p">)[::</span><span class="n">nx</span><span class="p">]</span>
        <span class="n">newx_without_unit</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span>
            <span class="n">newx_edges_without_unit</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">+</span> <span class="n">newx_edges_without_unit</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="p">)</span>

        <span class="c1"># calculate the actual x values corresponding to the bins</span>
        <span class="n">original_edges</span> <span class="o">=</span> <span class="n">leftright_to_edges</span><span class="p">(</span>
            <span class="o">*</span><span class="n">calculate_bin_leftright</span><span class="p">(</span><span class="n">original_x_without_unit</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">final_edges</span> <span class="o">=</span> <span class="n">original_edges</span><span class="p">[::</span><span class="n">nx</span><span class="p">]</span> <span class="o">*</span> <span class="n">x_unit</span>
        <span class="n">final_newx_left</span><span class="p">,</span> <span class="n">final_newx_right</span> <span class="o">=</span> <span class="n">edges_to_leftright</span><span class="p">(</span><span class="n">final_edges</span><span class="p">)</span>
        <span class="n">final_newx</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">final_newx_left</span> <span class="o">+</span> <span class="n">final_newx_right</span><span class="p">)</span>
        <span class="n">dx_without_unit</span> <span class="o">=</span> <span class="p">(</span><span class="n">final_newx_right</span> <span class="o">-</span> <span class="n">final_newx_left</span><span class="p">)</span> <span class="o">/</span> <span class="n">x_unit</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;No output grid sent to `bintogrid`.</span>
<span class="sd">                              Please choose one of the following:</span>
<span class="sd">                              [`newx_edges`, `newx`, `dx`, `nx`]&quot;&quot;&quot;</span>
        <span class="p">)</span>

    <span class="c1"># don&#39;t complain about zero-divisions in here (to allow infinite uncertainties)</span>
    <span class="k">with</span> <span class="n">np</span><span class="o">.</span><span class="n">errstate</span><span class="p">(</span><span class="n">divide</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">invalid</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">):</span>

        <span class="c1"># calculate weight integrals for the bin array</span>
        <span class="n">ok</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">y_without_unit</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span>

        <span class="c1"># resample the sums onto that new grid</span>
        <span class="k">if</span> <span class="n">unc</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">x_without_unit</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">weighting</span> <span class="o">==</span> <span class="s2">&quot;inversevariance&quot;</span><span class="p">:</span>
                <span class="n">weights</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">unc</span><span class="o">**</span><span class="mi">2</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">x_without_unit</span><span class="p">)</span>

            <span class="c1"># ignore infinite weights (= 0 uncertainties)</span>
            <span class="n">ok</span> <span class="o">*=</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">ok</span><span class="p">):</span>
            <span class="n">numerator</span> <span class="o">=</span> <span class="n">resample_while_conserving_flux</span><span class="p">(</span>
                <span class="n">xin</span><span class="o">=</span><span class="n">x_without_unit</span><span class="p">[</span><span class="n">ok</span><span class="p">],</span>
                <span class="n">yin</span><span class="o">=</span><span class="p">(</span><span class="n">y_without_unit</span> <span class="o">*</span> <span class="n">weights</span><span class="p">)[</span><span class="n">ok</span><span class="p">],</span>
                <span class="n">xout_edges</span><span class="o">=</span><span class="n">newx_edges_without_unit</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">denominator</span> <span class="o">=</span> <span class="n">resample_while_conserving_flux</span><span class="p">(</span>
                <span class="n">xin</span><span class="o">=</span><span class="n">x_without_unit</span><span class="p">[</span><span class="n">ok</span><span class="p">],</span>
                <span class="n">yin</span><span class="o">=</span><span class="n">weights</span><span class="p">[</span><span class="n">ok</span><span class="p">],</span>
                <span class="n">xout_edges</span><span class="o">=</span><span class="n">newx_edges_without_unit</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="c1"># the binned weighted means on the new grid</span>
            <span class="n">newy</span> <span class="o">=</span> <span class="n">numerator</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">denominator</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span>

            <span class="c1"># the standard error on the means, for those bins</span>
            <span class="n">newunc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">denominator</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">])</span>

            <span class="c1"># keep track of the number of original bins going into each new bin</span>
            <span class="n">number_of_original_bins_per_new_bin</span> <span class="o">=</span> <span class="n">resample_while_conserving_flux</span><span class="p">(</span>
                <span class="n">xin</span><span class="o">=</span><span class="n">x_without_unit</span><span class="p">[</span><span class="n">ok</span><span class="p">],</span>
                <span class="n">yin</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">y_without_unit</span><span class="p">)[</span><span class="n">ok</span><span class="p">],</span>
                <span class="n">xout_edges</span><span class="o">=</span><span class="n">newx_edges_without_unit</span><span class="p">,</span>
            <span class="p">)[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">newy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="o">*</span> <span class="n">newx_without_unit</span>
            <span class="n">newunc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="o">*</span> <span class="n">newx_without_unit</span>
            <span class="n">number_of_original_bins_per_new_bin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">newx_without_unit</span><span class="p">)</span>

    <span class="c1"># remove any empty bins</span>
    <span class="k">if</span> <span class="n">drop_nans</span><span class="p">:</span>
        <span class="n">ok</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">newy</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ok</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">newx_without_unit</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>

    <span class="c1"># if no uncertainties were given, don&#39;t return uncertainties</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># populate the new grid centers + edges + values</span>
    <span class="n">result</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">final_newx</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span>
    <span class="n">result</span><span class="p">[</span><span class="s2">&quot;x_edge_lower&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">final_newx_left</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span>
    <span class="n">result</span><span class="p">[</span><span class="s2">&quot;x_edge_upper&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">final_newx_right</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span>

    <span class="c1"># populate the new grid values</span>
    <span class="n">result</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">newy</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span> <span class="o">*</span> <span class="n">y_unit</span>

    <span class="c1"># populate the new grid value uncertainties</span>
    <span class="k">if</span> <span class="n">unc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">result</span><span class="p">[</span><span class="s2">&quot;uncertainty&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">newunc</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span> <span class="o">*</span> <span class="n">y_unit</span>

    <span class="c1"># store how many of the original pixels made it into this new one</span>
    <span class="n">result</span><span class="p">[</span><span class="s2">&quot;N_unbinned/N_binned&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">number_of_original_bins_per_new_bin</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">visualize</span><span class="p">:</span>
        <span class="n">fi</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span>
            <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">gridspec_kw</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">height_ratios</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">])</span>
        <span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">plot_as_boxes</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">xleft</span><span class="o">=</span><span class="n">x_left</span><span class="p">,</span> <span class="n">xright</span><span class="o">=</span><span class="n">x_right</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;silver&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">ekw</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">elinewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">unc</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;silver&quot;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">ekw</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">],</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">],</span>
            <span class="n">yerr</span><span class="o">=</span><span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;uncertainty&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
            <span class="n">xerr</span><span class="o">=</span><span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s2">&quot;x_edge_upper&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;x_edge_lower&quot;</span><span class="p">])</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
            <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
            <span class="n">zorder</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
            <span class="o">**</span><span class="n">ekw</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">plot_as_boxes</span><span class="p">(</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">],</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;N_unbinned/N_binned&quot;</span><span class="p">],</span>
            <span class="n">xleft</span><span class="o">=</span><span class="n">result</span><span class="p">[</span><span class="s2">&quot;x_edge_lower&quot;</span><span class="p">],</span>
            <span class="n">xright</span><span class="o">=</span><span class="n">result</span><span class="p">[</span><span class="s2">&quot;x_edge_upper&quot;</span><span class="p">],</span>
        <span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;$N_</span><span class="si">{unbinned}</span><span class="s2">/N_</span><span class="si">{binned}</span><span class="s2">$&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.get.wavelike.measured_scatter_in_bins.calculate_bin_leftright" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">calculate_bin_leftright</span><span class="p">(</span><span class="n">x</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.get.wavelike.measured_scatter_in_bins.calculate_bin_leftright" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>If x is an array of bin centers, calculate the bin edges.
(assumes outermost bins are same size as their neighbors)</p>
<h4 id="chromatic.rainbows.get.wavelike.measured_scatter_in_bins.calculate_bin_leftright--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.get.wavelike.measured_scatter_in_bins.calculate_bin_leftright--parameters" title="Permanent link">#</a></h4>
<p>x : array
    The array of bin centers.</p>
<h4 id="chromatic.rainbows.get.wavelike.measured_scatter_in_bins.calculate_bin_leftright--returns">Returns<a class="headerlink" href="#chromatic.rainbows.get.wavelike.measured_scatter_in_bins.calculate_bin_leftright--returns" title="Permanent link">#</a></h4>
<p>l : array
    The left edges of the bins.
r : array
    The right edges of the bins.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/tools/resampling.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">calculate_bin_leftright</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    If x is an array of bin centers, calculate the bin edges.</span>
<span class="sd">    (assumes outermost bins are same size as their neighbors)</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : array</span>
<span class="sd">        The array of bin centers.</span>

<span class="sd">    Returns</span>
<span class="sd">    ----------</span>
<span class="sd">    l : array</span>
<span class="sd">        The left edges of the bins.</span>
<span class="sd">    r : array</span>
<span class="sd">        The right edges of the bins.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># what are bin edges (making a guess for those on the ends)</span>
    <span class="c1"># xbinsize = calculate_bin_widths(x)</span>
    <span class="c1"># left = x - xbinsize / 2.0</span>
    <span class="c1"># right = x + xbinsize / 2.0</span>

    <span class="c1"># weird corner case!</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">left</span><span class="p">,</span> <span class="n">right</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">left</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">right</span><span class="p">])</span>

    <span class="n">inner_edges</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="n">x</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">first_edge</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="n">inner_edges</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">last_edge</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">inner_edges</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

    <span class="n">left</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">first_edge</span><span class="p">,</span> <span class="n">inner_edges</span><span class="p">])</span>
    <span class="n">right</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">inner_edges</span><span class="p">,</span> <span class="n">last_edge</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.get.wavelike.measured_scatter_in_bins.edges_to_leftright" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">edges_to_leftright</span><span class="p">(</span><span class="n">edges</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.get.wavelike.measured_scatter_in_bins.edges_to_leftright" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Convert N+1 contiguous edges to two arrays of N left/right edges.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/tools/resampling.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">edges_to_leftright</span><span class="p">(</span><span class="n">edges</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert N+1 contiguous edges to two arrays of N left/right edges.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">left</span><span class="p">,</span> <span class="n">right</span> <span class="o">=</span> <span class="n">edges</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">edges</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="k">return</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.get.wavelike.measured_scatter_in_bins.expand_filenames" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">expand_filenames</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.get.wavelike.measured_scatter_in_bins.expand_filenames" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>A wrapper to expand a string or list into a list of filenames.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/imports.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">expand_filenames</span><span class="p">(</span><span class="n">filepath</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A wrapper to expand a string or list into a list of filenames.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
        <span class="n">filenames</span> <span class="o">=</span> <span class="n">filepath</span>
    <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span> <span class="o">==</span> <span class="n">Column</span><span class="p">:</span>
        <span class="n">filenames</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>
    <span class="k">elif</span> <span class="s2">&quot;*&quot;</span> <span class="ow">in</span> <span class="n">filepath</span><span class="p">:</span>
        <span class="n">filenames</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">filepath</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">filenames</span> <span class="o">=</span> <span class="p">[</span><span class="n">filepath</span><span class="p">]</span>
    <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">filenames</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.get.wavelike.measured_scatter_in_bins.get_measured_scatter_in_bins" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_measured_scatter_in_bins</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ntimes</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">nbins</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;standard-deviation&#39;</span><span class="p">,</span> <span class="n">minimum_acceptable_ok</span><span class="o">=</span><span class="mf">1e-10</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.get.wavelike.measured_scatter_in_bins.get_measured_scatter_in_bins" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Get measured scatter in time bins of increasing sizes.</p>
<p>For uncorrelated Gaussian noise, the scatter should
decrease as 1/sqrt(N), where N is the number points
in a bin. This function calculates the scatter for
a range of N, thus providing a quick test for
correlated noise.</p>
<h4 id="chromatic.rainbows.get.wavelike.measured_scatter_in_bins.get_measured_scatter_in_bins--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.get.wavelike.measured_scatter_in_bins.get_measured_scatter_in_bins--parameters" title="Permanent link">#</a></h4>
<p>ntimes : int
    How many times should be binned together? Binning will
    continue recursively until fewer that nbins would be left.
nbins : int
    What's the smallest number of bins that should be used to
    calculate a scatter? The absolute minimum is 2.
method : string
    What method to use to obtain measured scatter. Current options are 'MAD', 'standard-deviation'.
minimum_acceptable_ok : float
    The smallest value of <code>ok</code> that will still be included.
    (1 for perfect data, 1e-10 for everything but terrible data, 0 for all data)</p>
<h4 id="chromatic.rainbows.get.wavelike.measured_scatter_in_bins.get_measured_scatter_in_bins--returns">Returns<a class="headerlink" href="#chromatic.rainbows.get.wavelike.measured_scatter_in_bins.get_measured_scatter_in_bins--returns" title="Permanent link">#</a></h4>
<p>scatter_dictionary : dict
    Dictionary with lots of information about scatter in bins per wavelength.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/rainbows/get/wavelike/measured_scatter_in_bins.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_measured_scatter_in_bins</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">ntimes</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">nbins</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;standard-deviation&quot;</span><span class="p">,</span> <span class="n">minimum_acceptable_ok</span><span class="o">=</span><span class="mf">1e-10</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get measured scatter in time bins of increasing sizes.</span>

<span class="sd">    For uncorrelated Gaussian noise, the scatter should</span>
<span class="sd">    decrease as 1/sqrt(N), where N is the number points</span>
<span class="sd">    in a bin. This function calculates the scatter for</span>
<span class="sd">    a range of N, thus providing a quick test for</span>
<span class="sd">    correlated noise.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    ntimes : int</span>
<span class="sd">        How many times should be binned together? Binning will</span>
<span class="sd">        continue recursively until fewer that nbins would be left.</span>
<span class="sd">    nbins : int</span>
<span class="sd">        What&#39;s the smallest number of bins that should be used to</span>
<span class="sd">        calculate a scatter? The absolute minimum is 2.</span>
<span class="sd">    method : string</span>
<span class="sd">        What method to use to obtain measured scatter. Current options are &#39;MAD&#39;, &#39;standard-deviation&#39;.</span>
<span class="sd">    minimum_acceptable_ok : float</span>
<span class="sd">        The smallest value of `ok` that will still be included.</span>
<span class="sd">        (1 for perfect data, 1e-10 for everything but terrible data, 0 for all data)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    scatter_dictionary : dict</span>
<span class="sd">        Dictionary with lots of information about scatter in bins per wavelength.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="kn">from</span><span class="w"> </span><span class="nn">...rainbow</span><span class="w"> </span><span class="kn">import</span> <span class="n">Rainbow</span>

    <span class="k">if</span> <span class="s2">&quot;remove_trends&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="p">():</span>
        <span class="n">cheerfully_suggest</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        The `remove_trends` function was applied to this `Rainbow`,</span>
<span class="s2">        making it very plausible that some long-timescale signals</span>
<span class="s2">        and/or noise have been suppressed. Be suspicious of binned</span>
<span class="s2">        scatters on long timescales.</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="p">)</span>

    <span class="c1"># create a simplified rainbow so we don&#39;t waste time binning</span>
    <span class="n">simple</span> <span class="o">=</span> <span class="n">Rainbow</span><span class="p">(</span>
        <span class="n">time</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">,</span>
        <span class="n">wavelength</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">wavelength</span><span class="p">,</span>
        <span class="n">flux</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="p">,</span>
        <span class="n">uncertainty</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">uncertainty</span><span class="p">,</span>
        <span class="n">ok</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ok</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># loop through binning until done</span>
    <span class="n">binnings</span> <span class="o">=</span> <span class="p">[</span><span class="n">simple</span><span class="p">]</span>
    <span class="n">N</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">while</span> <span class="n">binnings</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">ntime</span> <span class="o">&gt;</span> <span class="n">ntimes</span> <span class="o">*</span> <span class="n">nbins</span><span class="p">:</span>
        <span class="n">binnings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">binnings</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">bin</span><span class="p">(</span><span class="n">ntimes</span><span class="o">=</span><span class="n">ntimes</span><span class="p">,</span> <span class="n">minimum_acceptable_ok</span><span class="o">=</span><span class="n">minimum_acceptable_ok</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">N</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">N</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">ntimes</span><span class="p">)</span>

    <span class="n">scatters</span> <span class="o">=</span> <span class="p">[</span><span class="n">b</span><span class="o">.</span><span class="n">get_measured_scatter</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">)</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">binnings</span><span class="p">]</span>
    <span class="n">expectation</span> <span class="o">=</span> <span class="p">[</span><span class="n">b</span><span class="o">.</span><span class="n">get_expected_uncertainty</span><span class="p">()</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">binnings</span><span class="p">]</span>
    <span class="n">uncertainty_on_scatters</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">scatters</span>
        <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">b</span><span class="o">.</span><span class="n">ntime</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">binnings</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
    <span class="p">)</span>
    <span class="n">dt</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">time</span><span class="p">))</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">binnings</span><span class="p">]</span>

    <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span>
        <span class="n">N</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">N</span><span class="p">),</span>
        <span class="n">dt</span><span class="o">=</span><span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">dt</span><span class="p">),</span>
        <span class="n">scatters</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">scatters</span><span class="p">),</span>
        <span class="n">expectation</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">expectation</span><span class="p">),</span>
        <span class="n">uncertainty</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">uncertainty_on_scatters</span><span class="p">),</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.get.wavelike.measured_scatter_in_bins.leftright_to_edges" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">leftright_to_edges</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.get.wavelike.measured_scatter_in_bins.leftright_to_edges" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Convert two arrays of N left/right edges to N+1 continugous edges.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/tools/resampling.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">leftright_to_edges</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert two arrays of N left/right edges to N+1 continugous edges.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">edges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>
    <span class="k">return</span> <span class="n">edges</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.get.wavelike.measured_scatter_in_bins.name2color" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">name2color</span><span class="p">(</span><span class="n">name</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.get.wavelike.measured_scatter_in_bins.name2color" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Return the 3-element RGB array of a given color name.</p>
<h4 id="chromatic.rainbows.get.wavelike.measured_scatter_in_bins.name2color--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.get.wavelike.measured_scatter_in_bins.name2color--parameters" title="Permanent link">#</a></h4>
<p>name : str
    The name of a color</p>
<h4 id="chromatic.rainbows.get.wavelike.measured_scatter_in_bins.name2color--returns">Returns<a class="headerlink" href="#chromatic.rainbows.get.wavelike.measured_scatter_in_bins.name2color--returns" title="Permanent link">#</a></h4>
<p>rgb : tuple
    3-element RGB color, with numbers from 0.0 to 1.0</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/imports.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">name2color</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return the 3-element RGB array of a given color name.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    name : str</span>
<span class="sd">        The name of a color</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    rgb : tuple</span>
<span class="sd">        3-element RGB color, with numbers from 0.0 to 1.0</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># give a friendly warning if the color name can&#39;t be found</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">color_hex</span> <span class="o">=</span> <span class="n">col</span><span class="o">.</span><span class="n">cnames</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">col</span><span class="o">.</span><span class="n">hex2color</span><span class="p">(</span><span class="n">color_hex</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="n">cheerfully_suggest</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The color </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> can&#39;t be found. (Returning black.)&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.get.wavelike.measured_scatter_in_bins.one2another" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">one2another</span><span class="p">(</span><span class="n">bottom</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">alpha_bottom</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">alpha_top</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">256</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.get.wavelike.measured_scatter_in_bins.one2another" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Create a cmap that goes smoothly (linearly in RGBA) from "bottom" to "top".</p>
<h4 id="chromatic.rainbows.get.wavelike.measured_scatter_in_bins.one2another--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.get.wavelike.measured_scatter_in_bins.one2another--parameters" title="Permanent link">#</a></h4>
<p>bottom : str
    Name of a color for the bottom of cmap (0.0)
top : str
    Name of a color for the top of the cmap (1.0)
alpha_bottom : float
    Opacity at the bottom of the cmap
alpha_top : float
    Opacitiy at the top of the cmap
N : int
    The number of levels in the listed color map</p>
<h4 id="chromatic.rainbows.get.wavelike.measured_scatter_in_bins.one2another--returns">Returns<a class="headerlink" href="#chromatic.rainbows.get.wavelike.measured_scatter_in_bins.one2another--returns" title="Permanent link">#</a></h4>
<p>cmap : Colormap
    A color map that goes linearly from the
    bottom to top color (and alpha).</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/imports.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">one2another</span><span class="p">(</span><span class="n">bottom</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">alpha_bottom</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">alpha_top</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">256</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a cmap that goes smoothly (linearly in RGBA) from &quot;bottom&quot; to &quot;top&quot;.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    bottom : str</span>
<span class="sd">        Name of a color for the bottom of cmap (0.0)</span>
<span class="sd">    top : str</span>
<span class="sd">        Name of a color for the top of the cmap (1.0)</span>
<span class="sd">    alpha_bottom : float</span>
<span class="sd">        Opacity at the bottom of the cmap</span>
<span class="sd">    alpha_top : float</span>
<span class="sd">        Opacitiy at the top of the cmap</span>
<span class="sd">    N : int</span>
<span class="sd">        The number of levels in the listed color map</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    cmap : Colormap</span>
<span class="sd">        A color map that goes linearly from the</span>
<span class="sd">        bottom to top color (and alpha).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># get the RGB values of the bottom and top of the cmap</span>
    <span class="n">rgb_bottom</span><span class="p">,</span> <span class="n">rgb_top</span> <span class="o">=</span> <span class="n">name2color</span><span class="p">(</span><span class="n">bottom</span><span class="p">),</span> <span class="n">name2color</span><span class="p">(</span><span class="n">top</span><span class="p">)</span>

    <span class="c1"># create linear gradients for all four RGBA channels</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">rgb_bottom</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">rgb_top</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">N</span><span class="p">)</span>
    <span class="n">g</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">rgb_bottom</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">rgb_top</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">N</span><span class="p">)</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">rgb_bottom</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">rgb_top</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">N</span><span class="p">)</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">alpha_bottom</span><span class="p">,</span> <span class="n">alpha_top</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>

    <span class="c1"># create (N,4) array + populate a listed colormap</span>
    <span class="n">colors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">]))</span>
    <span class="n">cmap</span> <span class="o">=</span> <span class="n">col</span><span class="o">.</span><span class="n">ListedColormap</span><span class="p">(</span><span class="n">colors</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{bottom}</span><span class="s2">2</span><span class="si">{top}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="nb">locals</span><span class="p">()))</span>

    <span class="c1"># return the colormap</span>
    <span class="k">return</span> <span class="n">cmap</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.get.wavelike.measured_scatter_in_bins.remove_unit" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">remove_unit</span><span class="p">(</span><span class="n">x</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.get.wavelike.measured_scatter_in_bins.remove_unit" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Quick wrapper to remove the unit from a quantity,
but not complain if it doesn't have one.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/imports.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">remove_unit</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Quick wrapper to remove the unit from a quantity,</span>
<span class="sd">    but not complain if it doesn&#39;t have one.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">x</span><span class="o">.</span><span class="n">value</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">x</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.get.wavelike.measured_scatter_in_bins.resample_while_conserving_flux" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">resample_while_conserving_flux</span><span class="p">(</span><span class="n">xin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">yin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xout</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xin_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xout_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">replace_nans</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">visualize</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">pause</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.get.wavelike.measured_scatter_in_bins.resample_while_conserving_flux" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Starting from some initial x and y, resample onto a
different grid (either higher or lower resolution),
while conserving total flux.</p>
<p>When including the entire range of <code>xin</code>,
<code>sum(yout) == sum(yin)</code> should be true.</p>
<p>When including only part of the range of <code>xin</code>,
the integral between any two points should be conserved.</p>
<h4 id="chromatic.rainbows.get.wavelike.measured_scatter_in_bins.resample_while_conserving_flux--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.get.wavelike.measured_scatter_in_bins.resample_while_conserving_flux--parameters" title="Permanent link">#</a></h4>
<p>xin : array
    The original independent variable.
yin : array
    The original dependent variable (same size as x).
xout : array
    The new grid of independent variables onto which
    you want to resample the y values. Refers to the
    center of each bin (use <code>xout_edges</code> for finer
    control over the exact edges of the bins)
xin_edges : array
    The edges of the original independent variable bins.
    The left and right edges of the bins are interpreted
    to be <code>xin_edges[:-1]</code> and <code>xin_edges[1:]</code>,
    respectively, so the associated <code>yin</code> should have exactly
    1 fewer element than <code>xin_edges</code>. This provides finer
    control over the size of each bin in the input than
    simply supplying <code>xin</code>(still a little experimental)
    They should probably be sorted?
xout_edges : array
    The edges of the new grid of bins for the independent
    variable, onto which you want to resample the y
    values. The left and right edges of the bins will be,
    respectively, <code>xout_edges[:-1]</code> and <code>xout_edges[1:]</code>,
    so the size of the output array will be
    <code>len(xout_edges) - 1</code>
replace_nans : float, str
    Replace nan values with this value.
    <code>replace_nans = 0</code>
        will add no flux where nans are
    <code>replace_nans = nan</code>
        will ensure you get nans returned everywhere
        if you try to resample over any nan
    <code>replace_nans = 'interpolate'</code>
        will try to replace nans by linearly interpolating
        from nearby values (not yet implemented)
visualize : bool
    Should we make a plot showing whether it worked?
pause : bool
    Should we pause to wait for a key press?</p>
<h4 id="chromatic.rainbows.get.wavelike.measured_scatter_in_bins.resample_while_conserving_flux--returns">Returns<a class="headerlink" href="#chromatic.rainbows.get.wavelike.measured_scatter_in_bins.resample_while_conserving_flux--returns" title="Permanent link">#</a></h4>
<p>result : dict
    A dictionary containing...
        <code>x</code> = the center of the output grid
        <code>y</code> = the resampled value on the output grid
        <code>edges</code> = the edges of the output grid, which will
            have one more element than x or y</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/tools/resampling.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">resample_while_conserving_flux</span><span class="p">(</span>
    <span class="n">xin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">yin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">xout</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">xin_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">xout_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">replace_nans</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
    <span class="n">visualize</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">pause</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Starting from some initial x and y, resample onto a</span>
<span class="sd">    different grid (either higher or lower resolution),</span>
<span class="sd">    while conserving total flux.</span>

<span class="sd">    When including the entire range of `xin`,</span>
<span class="sd">    `sum(yout) == sum(yin)` should be true.</span>

<span class="sd">    When including only part of the range of `xin`,</span>
<span class="sd">    the integral between any two points should be conserved.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    xin : array</span>
<span class="sd">        The original independent variable.</span>
<span class="sd">    yin : array</span>
<span class="sd">        The original dependent variable (same size as x).</span>
<span class="sd">    xout : array</span>
<span class="sd">        The new grid of independent variables onto which</span>
<span class="sd">        you want to resample the y values. Refers to the</span>
<span class="sd">        center of each bin (use `xout_edges` for finer</span>
<span class="sd">        control over the exact edges of the bins)</span>
<span class="sd">    xin_edges : array</span>
<span class="sd">        The edges of the original independent variable bins.</span>
<span class="sd">        The left and right edges of the bins are interpreted</span>
<span class="sd">        to be `xin_edges[:-1]` and `xin_edges[1:]`,</span>
<span class="sd">        respectively, so the associated `yin` should have exactly</span>
<span class="sd">        1 fewer element than `xin_edges`. This provides finer</span>
<span class="sd">        control over the size of each bin in the input than</span>
<span class="sd">        simply supplying `xin`(still a little experimental)</span>
<span class="sd">        They should probably be sorted?</span>
<span class="sd">    xout_edges : array</span>
<span class="sd">        The edges of the new grid of bins for the independent</span>
<span class="sd">        variable, onto which you want to resample the y</span>
<span class="sd">        values. The left and right edges of the bins will be,</span>
<span class="sd">        respectively, `xout_edges[:-1]` and `xout_edges[1:]`,</span>
<span class="sd">        so the size of the output array will be</span>
<span class="sd">        `len(xout_edges) - 1`</span>
<span class="sd">    replace_nans : float, str</span>
<span class="sd">        Replace nan values with this value.</span>
<span class="sd">        `replace_nans = 0`</span>
<span class="sd">            will add no flux where nans are</span>
<span class="sd">        `replace_nans = nan`</span>
<span class="sd">            will ensure you get nans returned everywhere</span>
<span class="sd">            if you try to resample over any nan</span>
<span class="sd">        `replace_nans = &#39;interpolate&#39;`</span>
<span class="sd">            will try to replace nans by linearly interpolating</span>
<span class="sd">            from nearby values (not yet implemented)</span>
<span class="sd">    visualize : bool</span>
<span class="sd">        Should we make a plot showing whether it worked?</span>
<span class="sd">    pause : bool</span>
<span class="sd">        Should we pause to wait for a key press?</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    result : dict</span>
<span class="sd">        A dictionary containing...</span>
<span class="sd">            `x` = the center of the output grid</span>
<span class="sd">            `y` = the resampled value on the output grid</span>
<span class="sd">            `edges` = the edges of the output grid, which will</span>
<span class="sd">                have one more element than x or y</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># make sure there are some reasonable input options</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">xin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">xin_edges</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">yin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">xout</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">xout_edges</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>

    <span class="c1"># set up the bins, to calculate cumulative distribution of y</span>
    <span class="k">if</span> <span class="n">xin_edges</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># make sure the sizes match up</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">xin</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">yin</span><span class="p">)</span>
        <span class="c1"># sort to make sure x is strictly increasing</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">xin</span><span class="p">)</span>
        <span class="n">xin_sorted</span> <span class="o">=</span> <span class="n">xin</span><span class="p">[</span><span class="n">s</span><span class="p">]</span>
        <span class="n">yin_sorted</span> <span class="o">=</span> <span class="n">yin</span><span class="p">[</span><span class="n">s</span><span class="p">]</span>
        <span class="c1"># estimate some bin edges (might fail for non-uniform grids)</span>
        <span class="n">xin_left</span><span class="p">,</span> <span class="n">xin_right</span> <span class="o">=</span> <span class="n">calculate_bin_leftright</span><span class="p">(</span><span class="n">xin_sorted</span><span class="p">)</span>
        <span class="c1"># define an array of edges</span>
        <span class="n">xin_edges</span> <span class="o">=</span> <span class="n">leftright_to_edges</span><span class="p">(</span><span class="n">xin_left</span><span class="p">,</span> <span class="n">xin_right</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># make sure the sizes match up</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">xin_edges</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">yin</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="c1"># sort to make sure x is strictly increasing</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">xin_edges</span><span class="p">)</span>
        <span class="n">xin_left</span><span class="p">,</span> <span class="n">xin_right</span> <span class="o">=</span> <span class="n">edges_to_leftright</span><span class="p">(</span><span class="n">xin_edges</span><span class="p">[</span><span class="n">s</span><span class="p">])</span>
        <span class="n">xin_sorted</span> <span class="o">=</span> <span class="p">(</span><span class="n">xin_left</span> <span class="o">+</span> <span class="n">xin_right</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">yin_sorted</span> <span class="o">=</span> <span class="n">yin</span><span class="p">[</span><span class="n">s</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>

    <span class="c1"># the first element should be the left edge of the first pixel</span>
    <span class="c1"># last element will be right edge of last pixel</span>
    <span class="n">xin_for_cdf</span> <span class="o">=</span> <span class="n">xin_edges</span>

    <span class="c1"># to the left of the first pixel, assume flux is zero</span>
    <span class="n">yin_for_cdf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">yin_sorted</span><span class="p">])</span>

    <span class="c1"># correct for any non-finite values</span>
    <span class="n">bad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">yin_for_cdf</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">replace_nans</span> <span class="o">==</span> <span class="s2">&quot;interpolate&quot;</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
            <span class="s2">&quot;The `replace_nans=&#39;interpolate&#39;`` option doens&#39;t exist yet!&quot;</span>
        <span class="p">)</span>
    <span class="n">yin_for_cdf</span><span class="p">[</span><span class="n">bad</span><span class="p">]</span> <span class="o">=</span> <span class="n">replace_nans</span>

    <span class="c1"># calculate the CDF of the flux (at pixel edge locations)</span>
    <span class="n">cdfin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">yin_for_cdf</span><span class="p">)</span>

    <span class="c1"># create an interpolator for that CDF</span>
    <span class="n">cdfinterpolator</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span>
        <span class="n">xin_for_cdf</span><span class="p">,</span>
        <span class="n">cdfin</span><span class="p">,</span>
        <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span>
        <span class="n">bounds_error</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">fill_value</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">yin</span><span class="p">)),</span>
    <span class="p">)</span>

    <span class="c1"># calculate bin edges (of size len(xout)+1)</span>
    <span class="k">if</span> <span class="n">xout_edges</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">xout_left</span><span class="p">,</span> <span class="n">xout_right</span> <span class="o">=</span> <span class="n">calculate_bin_leftright</span><span class="p">(</span><span class="n">xout</span><span class="p">)</span>
        <span class="n">xout_edges</span> <span class="o">=</span> <span class="n">leftright_to_edges</span><span class="p">(</span><span class="n">xout_left</span><span class="p">,</span> <span class="n">xout_right</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">xout_left</span><span class="p">,</span> <span class="n">xout_right</span> <span class="o">=</span> <span class="n">edges_to_leftright</span><span class="p">(</span><span class="n">xout_edges</span><span class="p">)</span>
        <span class="n">xout</span> <span class="o">=</span> <span class="p">(</span><span class="n">xout_left</span> <span class="o">+</span> <span class="n">xout_right</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>

    <span class="n">xout_for_cdf</span> <span class="o">=</span> <span class="n">leftright_to_edges</span><span class="p">(</span><span class="n">xout_left</span><span class="p">,</span> <span class="n">xout_right</span><span class="p">)</span>

    <span class="c1"># interpolate the CDF onto those bin edges</span>
    <span class="n">cdfout</span> <span class="o">=</span> <span class="n">cdfinterpolator</span><span class="p">(</span><span class="n">xout_for_cdf</span><span class="p">)</span>

    <span class="c1"># take  derivative of the CDF to get flux per resampled bin</span>
    <span class="c1"># (xout is bin center, and yout is the flux in that bin)</span>
    <span class="n">yout</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">cdfout</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">visualize</span><span class="p">:</span>
        <span class="n">fi</span><span class="p">,</span> <span class="p">(</span><span class="n">ax_cdf</span><span class="p">,</span> <span class="n">ax_pdf</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
        <span class="n">inkw</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
            <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span>
            <span class="n">markeredgecolor</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">outkw</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;darkorange&quot;</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span>
            <span class="n">markersize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
            <span class="n">markeredgecolor</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">legkw</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper left&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">xinbinsize</span> <span class="o">=</span> <span class="n">xin_right</span> <span class="o">-</span> <span class="n">xin_left</span>
        <span class="n">xoutbinsize</span> <span class="o">=</span> <span class="n">xout_right</span> <span class="o">-</span> <span class="n">xout_left</span>
        <span class="c1"># plot the PDFs</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="n">ax_pdf</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Flux per (Original) Pixel&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Pixel&quot;</span><span class="p">)</span>
        <span class="c1"># plot the original pixels (in df/dpixel to compare with resampled)</span>
        <span class="n">plot_as_boxes</span><span class="p">(</span>
            <span class="n">xin_sorted</span><span class="p">,</span> <span class="n">yin_sorted</span> <span class="o">/</span> <span class="n">xinbinsize</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Original Pixels&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">inkw</span>
        <span class="p">)</span>

        <span class="c1"># what would a bad interpolation look like?</span>
        <span class="n">interpolate_badly</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span>
            <span class="n">xin_sorted</span><span class="p">,</span>
            <span class="n">yin_sorted</span> <span class="o">/</span> <span class="n">xinbinsize</span><span class="p">,</span>
            <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span>
            <span class="n">bounds_error</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">fill_value</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
            <span class="n">xout</span><span class="p">,</span>
            <span class="n">interpolate_badly</span><span class="p">(</span><span class="n">xout</span><span class="p">),</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;cornflowerblue&quot;</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span>
            <span class="n">markersize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
            <span class="n">markeredgecolor</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Silly Simple Interpolation&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># plot the flux-conserving resampled data (again, in df/d&quot;pixel&quot;)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
            <span class="n">xout</span><span class="p">,</span> <span class="n">yout</span> <span class="o">/</span> <span class="n">xoutbinsize</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Flux-Conserving Interpolation&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">outkw</span>
        <span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="o">**</span><span class="n">legkw</span><span class="p">)</span>

        <span class="c1"># plot the CDFs</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="n">ax_cdf</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Cumulative Flux (from left)&quot;</span><span class="p">)</span>

        <span class="c1"># plot the original CDF</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xin_for_cdf</span><span class="p">,</span> <span class="n">cdfin</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Original Pixels&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">inkw</span><span class="p">)</span>

        <span class="c1"># plot the interpolated CDF</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xout_for_cdf</span><span class="p">,</span> <span class="n">cdfout</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Flux-Conserved Resample&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">outkw</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">pause</span><span class="p">:</span>
            <span class="n">a</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span>
                <span class="s2">&quot;Pausing a moment to check on interpolation; press return to continue.&quot;</span>
            <span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{:&gt;6}</span><span class="s2"> = </span><span class="si">{:.5f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;Actual&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">yin</span><span class="p">)))</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="s2">&quot;</span><span class="si">{:&gt;6}</span><span class="s2"> = </span><span class="si">{:.5f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="s2">&quot;Silly&quot;</span><span class="p">,</span>
                <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">interpolate_badly</span><span class="p">(</span><span class="n">xout</span><span class="p">)</span> <span class="o">*</span> <span class="n">xoutbinsize</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{:&gt;6}</span><span class="s2"> = </span><span class="si">{:.5f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;CDF&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">yout</span><span class="p">)))</span>

    <span class="c1"># return the resampled y-values</span>
    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="n">xout</span><span class="p">,</span> <span class="s2">&quot;x_edge_lower&quot;</span><span class="p">:</span> <span class="n">xout_left</span><span class="p">,</span> <span class="s2">&quot;x_edge_upper&quot;</span><span class="p">:</span> <span class="n">xout_right</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="n">yout</span><span class="p">}</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="chromatic.rainbows.get.wavelike.measured_scatter"></a>
    <div class="doc doc-contents first">









  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.get.wavelike.measured_scatter.bintoR" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">bintoR</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">unc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">R</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">weighting</span><span class="o">=</span><span class="s1">&#39;inversevariance&#39;</span><span class="p">,</span> <span class="n">drop_nans</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.get.wavelike.measured_scatter.bintoR" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Bin any x and y array onto a logarithmicly uniform grid.</p>
<h4 id="chromatic.rainbows.get.wavelike.measured_scatter.bintoR--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.get.wavelike.measured_scatter.bintoR--parameters" title="Permanent link">#</a></h4>
<p>x : array
    The original independent variable.
    (For a spectrum example = wavelength)
y : array
    The original dependent variable (same size as x).
    (For a spectrum example = flux)
unc : array, None, optional
    The unceratinty on the dependent variable
    (For a spectrum example = the flux uncertainty)
R : array, optional
    The spectral resolution R=x/dx for creating a new,
    logarithmically uniform grid that starts at the first
    value of x.
xlim : list, array, optional
    A two-element list indicating the min and max values of
    x for the new logarithmically spaced grid. If None,
    these limits will be created from the data themselves
weighting : str, optional
    How should we weight values when averaging
    them together into one larger bin?
    <code>weighting = 'inversevariance'</code>
        weights = 1/unc**2
     <code>weighting = {literally anything else}</code>
        uniform weights
    This will have no impact if <code>unc == None</code>, or for any
    new bins that effectively overlap less than one original
    unbinned point.
drop_nans : bool, optional
    Should we skip any bins turn out to be nans?
    This most often happens when bins are empty.</p>
<h4 id="chromatic.rainbows.get.wavelike.measured_scatter.bintoR--returns">Returns<a class="headerlink" href="#chromatic.rainbows.get.wavelike.measured_scatter.bintoR--returns" title="Permanent link">#</a></h4>
<p>result : dict
    A dictionary containing at least...
        <code>x</code> = the center of the output grid
        <code>y</code> = the resampled value on the output grid
        <code>x_edge_lower</code> = the lower edges of the output grid
        <code>x_edge_upper</code> = the upper edges of the output grid
    ...and possibly also
        <code>uncertainty</code> = the calculated uncertainty per bin</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/tools/resampling.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">bintoR</span><span class="p">(</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">unc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">R</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">weighting</span><span class="o">=</span><span class="s2">&quot;inversevariance&quot;</span><span class="p">,</span> <span class="n">drop_nans</span><span class="o">=</span><span class="kc">True</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Bin any x and y array onto a logarithmicly uniform grid.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : array</span>
<span class="sd">        The original independent variable.</span>
<span class="sd">        (For a spectrum example = wavelength)</span>
<span class="sd">    y : array</span>
<span class="sd">        The original dependent variable (same size as x).</span>
<span class="sd">        (For a spectrum example = flux)</span>
<span class="sd">    unc : array, None, optional</span>
<span class="sd">        The unceratinty on the dependent variable</span>
<span class="sd">        (For a spectrum example = the flux uncertainty)</span>
<span class="sd">    R : array, optional</span>
<span class="sd">        The spectral resolution R=x/dx for creating a new,</span>
<span class="sd">        logarithmically uniform grid that starts at the first</span>
<span class="sd">        value of x.</span>
<span class="sd">    xlim : list, array, optional</span>
<span class="sd">        A two-element list indicating the min and max values of</span>
<span class="sd">        x for the new logarithmically spaced grid. If None,</span>
<span class="sd">        these limits will be created from the data themselves</span>
<span class="sd">    weighting : str, optional</span>
<span class="sd">        How should we weight values when averaging</span>
<span class="sd">        them together into one larger bin?</span>
<span class="sd">        `weighting = &#39;inversevariance&#39;`</span>
<span class="sd">            weights = 1/unc**2</span>
<span class="sd">         `weighting = {literally anything else}`</span>
<span class="sd">            uniform weights</span>
<span class="sd">        This will have no impact if `unc == None`, or for any</span>
<span class="sd">        new bins that effectively overlap less than one original</span>
<span class="sd">        unbinned point.</span>
<span class="sd">    drop_nans : bool, optional</span>
<span class="sd">        Should we skip any bins turn out to be nans?</span>
<span class="sd">        This most often happens when bins are empty.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    result : dict</span>
<span class="sd">        A dictionary containing at least...</span>
<span class="sd">            `x` = the center of the output grid</span>
<span class="sd">            `y` = the resampled value on the output grid</span>
<span class="sd">            `x_edge_lower` = the lower edges of the output grid</span>
<span class="sd">            `x_edge_upper` = the upper edges of the output grid</span>
<span class="sd">        ...and possibly also</span>
<span class="sd">            `uncertainty` = the calculated uncertainty per bin</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">x_unit</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">unit</span>
        <span class="n">x_without_unit</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">value</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="n">x_unit</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">x_without_unit</span> <span class="o">=</span> <span class="n">x</span>

    <span class="c1"># create a new grid of x at the given resolution</span>
    <span class="n">lnx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">x_without_unit</span><span class="p">)</span>
    <span class="n">dnewlnx</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">R</span>

    <span class="c1"># set the limits of the new xgrid (in log space)</span>
    <span class="k">if</span> <span class="n">xlim</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># use the input grid to set the limits</span>
        <span class="n">lnxbottom</span><span class="p">,</span> <span class="n">lnxtop</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">lnx</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">lnx</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># use the custom xlim to set the limits</span>
        <span class="n">lnxbottom</span><span class="p">,</span> <span class="n">lnxtop</span> <span class="o">=</span> <span class="n">xlim</span>

    <span class="c1"># create a new, log-uniform grid of x values</span>
    <span class="n">newlnx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">lnxbottom</span><span class="p">,</span> <span class="n">lnxtop</span> <span class="o">+</span> <span class="n">dnewlnx</span><span class="p">,</span> <span class="n">dnewlnx</span><span class="p">)</span>

    <span class="c1"># now do the binning on a uniform grid of lnx</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">bintogrid</span><span class="p">(</span>
        <span class="n">lnx</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">unc</span><span class="p">,</span> <span class="n">newx</span><span class="o">=</span><span class="n">newlnx</span><span class="p">,</span> <span class="n">weighting</span><span class="o">=</span><span class="n">weighting</span><span class="p">,</span> <span class="n">drop_nans</span><span class="o">=</span><span class="n">drop_nans</span>
    <span class="p">)</span>

    <span class="c1"># convert back from log to real values</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;x_edge_lower&quot;</span><span class="p">,</span> <span class="s2">&quot;x_edge_upper&quot;</span><span class="p">]:</span>
        <span class="n">result</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="o">*</span> <span class="n">x_unit</span>

    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.get.wavelike.measured_scatter.bintogrid" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">bintogrid</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">unc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">newx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">newx_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">nx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">weighting</span><span class="o">=</span><span class="s1">&#39;inversevariance&#39;</span><span class="p">,</span> <span class="n">drop_nans</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">x_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">visualize</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.get.wavelike.measured_scatter.bintogrid" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Bin any x and y array onto a linearly uniform grid.</p>
<h4 id="chromatic.rainbows.get.wavelike.measured_scatter.bintogrid--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.get.wavelike.measured_scatter.bintogrid--parameters" title="Permanent link">#</a></h4>
<p>x : array
    The original independent variable.
    (For a spectrum example = wavelength)
y : array
    The original dependent variable (same size as x).
    (For a spectrum example = flux)
unc : array, None
    The unceratinty on the dependent variable
    (For a spectrum example = the flux uncertainty)
nx : array
    The number of bins from the original grid to
    bin together into the new one.
dx : array
    The fixed spacing for creating a new, linearly uniform
    grid that start at the first value of x. This will
    be ignored if <code>newx</code> != None.
newx : array
    A new custom grid onto which we should bin.
newx_edges : array
    The edges of the new grid of bins for the independent
    variable, onto which you want to resample the y
    values. The left and right edges of the bins will be,
    respectively, <code>newx_edges[:-1]</code> and <code>newx_edges[1:]</code>,
    so the size of the output array will be
    <code>len(newx_edges) - 1</code>
weighting : str
    How should we weight values when averaging
    them together into one larger bin?
    <code>weighting = 'inversevariance'</code>
        weights = 1/unc**2
     <code>weighting = {literally anything else}</code>
        uniform weights
    This will have no impact if <code>unc == None</code>, or for any
    new bins that effectively overlap less than one original
    unbinned point.
drop_nans : bool
    Should we skip any bins turn out to be nans?
    This most often happens when bins are empty.
x_edges : array
    The edges of the original independent variable bins.
    The left and right edges of the bins are interpreted
    to be <code>x_edges[:-1]</code> and <code>x_edges[1:]</code>,
    respectively, so the associated <code>y</code> should have exactly
    1 fewer element than <code>x_edges</code>. This provides finer
    control over the size of each bin in the input than
    simply supplying <code>x</code>(still a little experimental)</p>
<h4 id="chromatic.rainbows.get.wavelike.measured_scatter.bintogrid--returns">Returns<a class="headerlink" href="#chromatic.rainbows.get.wavelike.measured_scatter.bintogrid--returns" title="Permanent link">#</a></h4>
<p>result : dict
    A dictionary containing at least...
        <code>x</code> = the center of the output grid
        <code>y</code> = the resampled value on the output grid
        <code>x_edge_lower</code> = the lower edges of the output grid
        <code>x_edge_upper</code> = the upper edges of the output grid
    ...and possibly also
        <code>uncertainty</code> = the calculated uncertainty per bin</p>
<p>The order of precendence for setting the new grid is
[<code>newx_edges</code>, <code>newx</code>, <code>dx</code>, <code>nx</code>]
The first will be used, and others will be ignored.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/tools/resampling.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">bintogrid</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">unc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">newx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">newx_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">dx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">nx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">weighting</span><span class="o">=</span><span class="s2">&quot;inversevariance&quot;</span><span class="p">,</span>
    <span class="n">drop_nans</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">x_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">visualize</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Bin any x and y array onto a linearly uniform grid.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : array</span>
<span class="sd">        The original independent variable.</span>
<span class="sd">        (For a spectrum example = wavelength)</span>
<span class="sd">    y : array</span>
<span class="sd">        The original dependent variable (same size as x).</span>
<span class="sd">        (For a spectrum example = flux)</span>
<span class="sd">    unc : array, None</span>
<span class="sd">        The unceratinty on the dependent variable</span>
<span class="sd">        (For a spectrum example = the flux uncertainty)</span>
<span class="sd">    nx : array</span>
<span class="sd">        The number of bins from the original grid to</span>
<span class="sd">        bin together into the new one.</span>
<span class="sd">    dx : array</span>
<span class="sd">        The fixed spacing for creating a new, linearly uniform</span>
<span class="sd">        grid that start at the first value of x. This will</span>
<span class="sd">        be ignored if `newx` != None.</span>
<span class="sd">    newx : array</span>
<span class="sd">        A new custom grid onto which we should bin.</span>
<span class="sd">    newx_edges : array</span>
<span class="sd">        The edges of the new grid of bins for the independent</span>
<span class="sd">        variable, onto which you want to resample the y</span>
<span class="sd">        values. The left and right edges of the bins will be,</span>
<span class="sd">        respectively, `newx_edges[:-1]` and `newx_edges[1:]`,</span>
<span class="sd">        so the size of the output array will be</span>
<span class="sd">        `len(newx_edges) - 1`</span>
<span class="sd">    weighting : str</span>
<span class="sd">        How should we weight values when averaging</span>
<span class="sd">        them together into one larger bin?</span>
<span class="sd">        `weighting = &#39;inversevariance&#39;`</span>
<span class="sd">            weights = 1/unc**2</span>
<span class="sd">         `weighting = {literally anything else}`</span>
<span class="sd">            uniform weights</span>
<span class="sd">        This will have no impact if `unc == None`, or for any</span>
<span class="sd">        new bins that effectively overlap less than one original</span>
<span class="sd">        unbinned point.</span>
<span class="sd">    drop_nans : bool</span>
<span class="sd">        Should we skip any bins turn out to be nans?</span>
<span class="sd">        This most often happens when bins are empty.</span>
<span class="sd">    x_edges : array</span>
<span class="sd">        The edges of the original independent variable bins.</span>
<span class="sd">        The left and right edges of the bins are interpreted</span>
<span class="sd">        to be `x_edges[:-1]` and `x_edges[1:]`,</span>
<span class="sd">        respectively, so the associated `y` should have exactly</span>
<span class="sd">        1 fewer element than `x_edges`. This provides finer</span>
<span class="sd">        control over the size of each bin in the input than</span>
<span class="sd">        simply supplying `x`(still a little experimental)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    result : dict</span>
<span class="sd">        A dictionary containing at least...</span>
<span class="sd">            `x` = the center of the output grid</span>
<span class="sd">            `y` = the resampled value on the output grid</span>
<span class="sd">            `x_edge_lower` = the lower edges of the output grid</span>
<span class="sd">            `x_edge_upper` = the upper edges of the output grid</span>
<span class="sd">        ...and possibly also</span>
<span class="sd">            `uncertainty` = the calculated uncertainty per bin</span>


<span class="sd">    The order of precendence for setting the new grid is</span>
<span class="sd">    [`newx_edges`, `newx`, `dx`, `nx`]</span>
<span class="sd">    The first will be used, and others will be ignored.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># check that an OK set of inputs has been supplied</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">x_edges</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;🌈 Both `x` and `x_edges` were supplied to `bintogrid`. Confusing!&quot;&quot;&quot;</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">x_edges</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;🌈 At least one of `x` or `x_edges` must be supplied to `bintogrid`.&quot;&quot;&quot;</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="n">y</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;🌈 `y` must be supplied to `bintogrid`.&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="c1"># make sure the edges and the centers are set</span>
    <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">x_left</span><span class="p">,</span> <span class="n">x_right</span> <span class="o">=</span> <span class="n">edges_to_leftright</span><span class="p">(</span><span class="n">x_edges</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">left</span> <span class="o">+</span> <span class="n">right</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">x_left</span><span class="p">,</span> <span class="n">x_right</span> <span class="o">=</span> <span class="n">calculate_bin_leftright</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">x_edges</span> <span class="o">=</span> <span class="n">leftright_to_edges</span><span class="p">(</span><span class="n">x_left</span><span class="p">,</span> <span class="n">x_right</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">x_unit</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">unit</span>
        <span class="n">x_without_unit</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">value</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="n">x_unit</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">x_without_unit</span> <span class="o">=</span> <span class="n">x</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">y_unit</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">unit</span>
        <span class="n">y_without_unit</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">value</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="n">y_unit</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">y_without_unit</span> <span class="o">=</span> <span class="n">y</span>

    <span class="c1"># warn if multiple inputs are provided</span>
    <span class="n">number_of_grid_options</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span><span class="n">z</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="p">[</span><span class="n">newx_edges</span><span class="p">,</span> <span class="n">newx</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">nx</span><span class="p">]])</span>
    <span class="k">if</span> <span class="n">number_of_grid_options</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">cheerfully_suggest</span><span class="p">(</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;More than one output grid sent to `bintogrid`.</span>
<span class="sd">                         The one being used is the first to appear in</span>
<span class="sd">                         [`newx_edges`, `newx`, `dx`, `nx`]</span>
<span class="sd">                         but you might want to choose more carefully.&quot;&quot;&quot;</span>
        <span class="p">)</span>

    <span class="c1"># define inputs based on the following order</span>
    <span class="k">if</span> <span class="n">newx_edges</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># define grid by its edges (and define others from there)</span>
        <span class="n">newx_edges_without_unit</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">newx_edges</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">x_unit</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
        <span class="n">dx_without_unit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">newx_edges_without_unit</span><span class="p">)</span>
        <span class="n">newx_without_unit</span> <span class="o">=</span> <span class="n">newx_edges_without_unit</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">dx_without_unit</span>
        <span class="n">newx_left_without_unit</span> <span class="o">=</span> <span class="n">newx_edges_without_unit</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">newx_right_without_unit</span> <span class="o">=</span> <span class="n">newx_edges_without_unit</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

        <span class="c1"># make sure the final output grid is defined</span>
        <span class="n">final_newx</span><span class="p">,</span> <span class="n">final_newx_left</span><span class="p">,</span> <span class="n">final_newx_right</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">newx_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
            <span class="n">newx_left_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
            <span class="n">newx_right_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="n">newx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># define grid by its centers (and define others from there)</span>
        <span class="n">newx_without_unit</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">newx</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">x_unit</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
        <span class="n">newx_left_without_unit</span><span class="p">,</span> <span class="n">newx_right_without_unit</span> <span class="o">=</span> <span class="n">calculate_bin_leftright</span><span class="p">(</span>
            <span class="n">newx_without_unit</span>
        <span class="p">)</span>
        <span class="n">newx_edges_without_unit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span>
            <span class="p">[</span><span class="n">newx_left_without_unit</span><span class="p">,</span> <span class="n">newx_right_without_unit</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
        <span class="p">)</span>
        <span class="n">dx_without_unit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">newx_edges_without_unit</span><span class="p">)</span>

        <span class="c1"># make sure the final output grid is defined</span>
        <span class="n">final_newx</span><span class="p">,</span> <span class="n">final_newx_left</span><span class="p">,</span> <span class="n">final_newx_right</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">newx_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
            <span class="n">newx_left_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
            <span class="n">newx_right_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="n">dx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># define grid by a bin width (and define others from there)</span>
        <span class="n">dx_without_unit</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">dx</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">x_unit</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
        <span class="n">newx_without_unit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">x_without_unit</span><span class="p">),</span>
            <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">x_without_unit</span><span class="p">)</span> <span class="o">+</span> <span class="n">dx_without_unit</span><span class="p">,</span>
            <span class="n">dx_without_unit</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">newx_left_without_unit</span><span class="p">,</span> <span class="n">newx_right_without_unit</span> <span class="o">=</span> <span class="n">calculate_bin_leftright</span><span class="p">(</span>
            <span class="n">newx_without_unit</span>
        <span class="p">)</span>
        <span class="n">newx_edges_without_unit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span>
            <span class="p">[</span><span class="n">newx_left_without_unit</span><span class="p">,</span> <span class="n">newx_right_without_unit</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
        <span class="p">)</span>

        <span class="c1"># make sure the final output grid is defined</span>
        <span class="n">final_newx</span><span class="p">,</span> <span class="n">final_newx_left</span><span class="p">,</span> <span class="n">final_newx_right</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">newx_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
            <span class="n">newx_left_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
            <span class="n">newx_right_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">elif</span> <span class="n">nx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># keep track of the original input x values</span>
        <span class="n">original_x_without_unit</span> <span class="o">=</span> <span class="n">x_without_unit</span>

        <span class="c1"># redefine the input x to indices, to do interpolation in index space</span>
        <span class="n">x_without_unit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">x_without_unit</span><span class="p">))</span>

        <span class="c1"># define a grid of edges that will enclose the right number of indices</span>
        <span class="n">x_left_i</span><span class="p">,</span> <span class="n">x_right_i</span> <span class="o">=</span> <span class="n">calculate_bin_leftright</span><span class="p">(</span><span class="n">x_without_unit</span><span class="p">)</span>
        <span class="n">newx_edges_without_unit</span> <span class="o">=</span> <span class="n">leftright_to_edges</span><span class="p">(</span><span class="n">x_left_i</span><span class="p">,</span> <span class="n">x_right_i</span><span class="p">)[::</span><span class="n">nx</span><span class="p">]</span>
        <span class="n">newx_without_unit</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span>
            <span class="n">newx_edges_without_unit</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">+</span> <span class="n">newx_edges_without_unit</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="p">)</span>

        <span class="c1"># calculate the actual x values corresponding to the bins</span>
        <span class="n">original_edges</span> <span class="o">=</span> <span class="n">leftright_to_edges</span><span class="p">(</span>
            <span class="o">*</span><span class="n">calculate_bin_leftright</span><span class="p">(</span><span class="n">original_x_without_unit</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">final_edges</span> <span class="o">=</span> <span class="n">original_edges</span><span class="p">[::</span><span class="n">nx</span><span class="p">]</span> <span class="o">*</span> <span class="n">x_unit</span>
        <span class="n">final_newx_left</span><span class="p">,</span> <span class="n">final_newx_right</span> <span class="o">=</span> <span class="n">edges_to_leftright</span><span class="p">(</span><span class="n">final_edges</span><span class="p">)</span>
        <span class="n">final_newx</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">final_newx_left</span> <span class="o">+</span> <span class="n">final_newx_right</span><span class="p">)</span>
        <span class="n">dx_without_unit</span> <span class="o">=</span> <span class="p">(</span><span class="n">final_newx_right</span> <span class="o">-</span> <span class="n">final_newx_left</span><span class="p">)</span> <span class="o">/</span> <span class="n">x_unit</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;No output grid sent to `bintogrid`.</span>
<span class="sd">                              Please choose one of the following:</span>
<span class="sd">                              [`newx_edges`, `newx`, `dx`, `nx`]&quot;&quot;&quot;</span>
        <span class="p">)</span>

    <span class="c1"># don&#39;t complain about zero-divisions in here (to allow infinite uncertainties)</span>
    <span class="k">with</span> <span class="n">np</span><span class="o">.</span><span class="n">errstate</span><span class="p">(</span><span class="n">divide</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">invalid</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">):</span>

        <span class="c1"># calculate weight integrals for the bin array</span>
        <span class="n">ok</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">y_without_unit</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span>

        <span class="c1"># resample the sums onto that new grid</span>
        <span class="k">if</span> <span class="n">unc</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">x_without_unit</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">weighting</span> <span class="o">==</span> <span class="s2">&quot;inversevariance&quot;</span><span class="p">:</span>
                <span class="n">weights</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">unc</span><span class="o">**</span><span class="mi">2</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">x_without_unit</span><span class="p">)</span>

            <span class="c1"># ignore infinite weights (= 0 uncertainties)</span>
            <span class="n">ok</span> <span class="o">*=</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">ok</span><span class="p">):</span>
            <span class="n">numerator</span> <span class="o">=</span> <span class="n">resample_while_conserving_flux</span><span class="p">(</span>
                <span class="n">xin</span><span class="o">=</span><span class="n">x_without_unit</span><span class="p">[</span><span class="n">ok</span><span class="p">],</span>
                <span class="n">yin</span><span class="o">=</span><span class="p">(</span><span class="n">y_without_unit</span> <span class="o">*</span> <span class="n">weights</span><span class="p">)[</span><span class="n">ok</span><span class="p">],</span>
                <span class="n">xout_edges</span><span class="o">=</span><span class="n">newx_edges_without_unit</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">denominator</span> <span class="o">=</span> <span class="n">resample_while_conserving_flux</span><span class="p">(</span>
                <span class="n">xin</span><span class="o">=</span><span class="n">x_without_unit</span><span class="p">[</span><span class="n">ok</span><span class="p">],</span>
                <span class="n">yin</span><span class="o">=</span><span class="n">weights</span><span class="p">[</span><span class="n">ok</span><span class="p">],</span>
                <span class="n">xout_edges</span><span class="o">=</span><span class="n">newx_edges_without_unit</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="c1"># the binned weighted means on the new grid</span>
            <span class="n">newy</span> <span class="o">=</span> <span class="n">numerator</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">denominator</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span>

            <span class="c1"># the standard error on the means, for those bins</span>
            <span class="n">newunc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">denominator</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">])</span>

            <span class="c1"># keep track of the number of original bins going into each new bin</span>
            <span class="n">number_of_original_bins_per_new_bin</span> <span class="o">=</span> <span class="n">resample_while_conserving_flux</span><span class="p">(</span>
                <span class="n">xin</span><span class="o">=</span><span class="n">x_without_unit</span><span class="p">[</span><span class="n">ok</span><span class="p">],</span>
                <span class="n">yin</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">y_without_unit</span><span class="p">)[</span><span class="n">ok</span><span class="p">],</span>
                <span class="n">xout_edges</span><span class="o">=</span><span class="n">newx_edges_without_unit</span><span class="p">,</span>
            <span class="p">)[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">newy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="o">*</span> <span class="n">newx_without_unit</span>
            <span class="n">newunc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="o">*</span> <span class="n">newx_without_unit</span>
            <span class="n">number_of_original_bins_per_new_bin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">newx_without_unit</span><span class="p">)</span>

    <span class="c1"># remove any empty bins</span>
    <span class="k">if</span> <span class="n">drop_nans</span><span class="p">:</span>
        <span class="n">ok</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">newy</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ok</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">newx_without_unit</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>

    <span class="c1"># if no uncertainties were given, don&#39;t return uncertainties</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># populate the new grid centers + edges + values</span>
    <span class="n">result</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">final_newx</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span>
    <span class="n">result</span><span class="p">[</span><span class="s2">&quot;x_edge_lower&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">final_newx_left</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span>
    <span class="n">result</span><span class="p">[</span><span class="s2">&quot;x_edge_upper&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">final_newx_right</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span>

    <span class="c1"># populate the new grid values</span>
    <span class="n">result</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">newy</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span> <span class="o">*</span> <span class="n">y_unit</span>

    <span class="c1"># populate the new grid value uncertainties</span>
    <span class="k">if</span> <span class="n">unc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">result</span><span class="p">[</span><span class="s2">&quot;uncertainty&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">newunc</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span> <span class="o">*</span> <span class="n">y_unit</span>

    <span class="c1"># store how many of the original pixels made it into this new one</span>
    <span class="n">result</span><span class="p">[</span><span class="s2">&quot;N_unbinned/N_binned&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">number_of_original_bins_per_new_bin</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">visualize</span><span class="p">:</span>
        <span class="n">fi</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span>
            <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">gridspec_kw</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">height_ratios</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">])</span>
        <span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">plot_as_boxes</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">xleft</span><span class="o">=</span><span class="n">x_left</span><span class="p">,</span> <span class="n">xright</span><span class="o">=</span><span class="n">x_right</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;silver&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">ekw</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">elinewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">unc</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;silver&quot;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">ekw</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">],</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">],</span>
            <span class="n">yerr</span><span class="o">=</span><span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;uncertainty&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
            <span class="n">xerr</span><span class="o">=</span><span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s2">&quot;x_edge_upper&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;x_edge_lower&quot;</span><span class="p">])</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
            <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
            <span class="n">zorder</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
            <span class="o">**</span><span class="n">ekw</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">plot_as_boxes</span><span class="p">(</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">],</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;N_unbinned/N_binned&quot;</span><span class="p">],</span>
            <span class="n">xleft</span><span class="o">=</span><span class="n">result</span><span class="p">[</span><span class="s2">&quot;x_edge_lower&quot;</span><span class="p">],</span>
            <span class="n">xright</span><span class="o">=</span><span class="n">result</span><span class="p">[</span><span class="s2">&quot;x_edge_upper&quot;</span><span class="p">],</span>
        <span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;$N_</span><span class="si">{unbinned}</span><span class="s2">/N_</span><span class="si">{binned}</span><span class="s2">$&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.get.wavelike.measured_scatter.calculate_bin_leftright" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">calculate_bin_leftright</span><span class="p">(</span><span class="n">x</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.get.wavelike.measured_scatter.calculate_bin_leftright" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>If x is an array of bin centers, calculate the bin edges.
(assumes outermost bins are same size as their neighbors)</p>
<h4 id="chromatic.rainbows.get.wavelike.measured_scatter.calculate_bin_leftright--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.get.wavelike.measured_scatter.calculate_bin_leftright--parameters" title="Permanent link">#</a></h4>
<p>x : array
    The array of bin centers.</p>
<h4 id="chromatic.rainbows.get.wavelike.measured_scatter.calculate_bin_leftright--returns">Returns<a class="headerlink" href="#chromatic.rainbows.get.wavelike.measured_scatter.calculate_bin_leftright--returns" title="Permanent link">#</a></h4>
<p>l : array
    The left edges of the bins.
r : array
    The right edges of the bins.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/tools/resampling.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">calculate_bin_leftright</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    If x is an array of bin centers, calculate the bin edges.</span>
<span class="sd">    (assumes outermost bins are same size as their neighbors)</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : array</span>
<span class="sd">        The array of bin centers.</span>

<span class="sd">    Returns</span>
<span class="sd">    ----------</span>
<span class="sd">    l : array</span>
<span class="sd">        The left edges of the bins.</span>
<span class="sd">    r : array</span>
<span class="sd">        The right edges of the bins.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># what are bin edges (making a guess for those on the ends)</span>
    <span class="c1"># xbinsize = calculate_bin_widths(x)</span>
    <span class="c1"># left = x - xbinsize / 2.0</span>
    <span class="c1"># right = x + xbinsize / 2.0</span>

    <span class="c1"># weird corner case!</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">left</span><span class="p">,</span> <span class="n">right</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">left</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">right</span><span class="p">])</span>

    <span class="n">inner_edges</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="n">x</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">first_edge</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="n">inner_edges</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">last_edge</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">inner_edges</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

    <span class="n">left</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">first_edge</span><span class="p">,</span> <span class="n">inner_edges</span><span class="p">])</span>
    <span class="n">right</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">inner_edges</span><span class="p">,</span> <span class="n">last_edge</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.get.wavelike.measured_scatter.edges_to_leftright" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">edges_to_leftright</span><span class="p">(</span><span class="n">edges</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.get.wavelike.measured_scatter.edges_to_leftright" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Convert N+1 contiguous edges to two arrays of N left/right edges.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/tools/resampling.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">edges_to_leftright</span><span class="p">(</span><span class="n">edges</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert N+1 contiguous edges to two arrays of N left/right edges.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">left</span><span class="p">,</span> <span class="n">right</span> <span class="o">=</span> <span class="n">edges</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">edges</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="k">return</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.get.wavelike.measured_scatter.expand_filenames" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">expand_filenames</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.get.wavelike.measured_scatter.expand_filenames" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>A wrapper to expand a string or list into a list of filenames.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/imports.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">expand_filenames</span><span class="p">(</span><span class="n">filepath</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A wrapper to expand a string or list into a list of filenames.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
        <span class="n">filenames</span> <span class="o">=</span> <span class="n">filepath</span>
    <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span> <span class="o">==</span> <span class="n">Column</span><span class="p">:</span>
        <span class="n">filenames</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>
    <span class="k">elif</span> <span class="s2">&quot;*&quot;</span> <span class="ow">in</span> <span class="n">filepath</span><span class="p">:</span>
        <span class="n">filenames</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">filepath</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">filenames</span> <span class="o">=</span> <span class="p">[</span><span class="n">filepath</span><span class="p">]</span>
    <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">filenames</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.get.wavelike.measured_scatter.get_measured_scatter" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_measured_scatter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">quantity</span><span class="o">=</span><span class="s1">&#39;flux&#39;</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;standard-deviation&#39;</span><span class="p">,</span> <span class="n">minimum_acceptable_ok</span><span class="o">=</span><span class="mf">1e-10</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.get.wavelike.measured_scatter.get_measured_scatter" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Get measured scatter for each wavelength.</p>
<p>Calculate the standard deviation (or outlier-robust
equivalent) for each wavelength, which can be compared
to the expected per-wavelength uncertainty.</p>
<h4 id="chromatic.rainbows.get.wavelike.measured_scatter.get_measured_scatter--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.get.wavelike.measured_scatter.get_measured_scatter--parameters" title="Permanent link">#</a></h4>
<p>quantity : string, optional
    The <code>fluxlike</code> quantity for which we should calculate the scatter.
method : string, optional
    What method to use to obtain measured scatter.
    Current options are 'MAD', 'standard-deviation'.
minimum_acceptable_ok : float, optional
    The smallest value of <code>ok</code> that will still be included.
    (1 for perfect data, 1e-10 for everything but terrible data, 0 for all data)</p>
<h4 id="chromatic.rainbows.get.wavelike.measured_scatter.get_measured_scatter--returns">Returns<a class="headerlink" href="#chromatic.rainbows.get.wavelike.measured_scatter.get_measured_scatter--returns" title="Permanent link">#</a></h4>
<p>scatter : array
    Wavelike array of measured scatters.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/rainbows/get/wavelike/measured_scatter.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_measured_scatter</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">quantity</span><span class="o">=</span><span class="s2">&quot;flux&quot;</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;standard-deviation&quot;</span><span class="p">,</span> <span class="n">minimum_acceptable_ok</span><span class="o">=</span><span class="mf">1e-10</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get measured scatter for each wavelength.</span>

<span class="sd">    Calculate the standard deviation (or outlier-robust</span>
<span class="sd">    equivalent) for each wavelength, which can be compared</span>
<span class="sd">    to the expected per-wavelength uncertainty.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    quantity : string, optional</span>
<span class="sd">        The `fluxlike` quantity for which we should calculate the scatter.</span>
<span class="sd">    method : string, optional</span>
<span class="sd">        What method to use to obtain measured scatter.</span>
<span class="sd">        Current options are &#39;MAD&#39;, &#39;standard-deviation&#39;.</span>
<span class="sd">    minimum_acceptable_ok : float, optional</span>
<span class="sd">        The smallest value of `ok` that will still be included.</span>
<span class="sd">        (1 for perfect data, 1e-10 for everything but terrible data, 0 for all data)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    scatter : array</span>
<span class="sd">        Wavelike array of measured scatters.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">method</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;standard-deviation&quot;</span><span class="p">,</span> <span class="s2">&quot;MAD&quot;</span><span class="p">]:</span>
        <span class="n">cheerfully_suggest</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        &#39;</span><span class="si">{</span><span class="n">method</span><span class="si">}</span><span class="s2">&#39; is not an available method.</span>
<span class="s2">        Please choose from [&#39;MAD&#39;, &#39;standard-deviation&#39;].</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="p">)</span>
    <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>

        <span class="n">scatters</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nwave</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nwave</span><span class="p">):</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">sigma</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_ok_data_for_wavelength</span><span class="p">(</span>
                <span class="n">i</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">quantity</span><span class="p">,</span> <span class="n">minimum_acceptable_ok</span><span class="o">=</span><span class="n">minimum_acceptable_ok</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">unit</span> <span class="o">==</span> <span class="n">u</span><span class="o">.</span><span class="n">Unit</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
                <span class="n">y_value</span><span class="p">,</span> <span class="n">y_unit</span> <span class="o">=</span> <span class="n">y</span><span class="p">,</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">y_value</span><span class="p">,</span> <span class="n">y_unit</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">y</span><span class="o">.</span><span class="n">unit</span>
            <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;standard-deviation&quot;</span><span class="p">:</span>
                <span class="n">scatters</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanstd</span><span class="p">(</span><span class="n">y_value</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;MAD&quot;</span><span class="p">:</span>
                <span class="n">scatters</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">mad_std</span><span class="p">(</span><span class="n">y_value</span><span class="p">,</span> <span class="n">ignore_nan</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">scatters</span> <span class="o">*</span> <span class="n">y_unit</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.get.wavelike.measured_scatter.leftright_to_edges" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">leftright_to_edges</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.get.wavelike.measured_scatter.leftright_to_edges" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Convert two arrays of N left/right edges to N+1 continugous edges.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/tools/resampling.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">leftright_to_edges</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert two arrays of N left/right edges to N+1 continugous edges.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">edges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>
    <span class="k">return</span> <span class="n">edges</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.get.wavelike.measured_scatter.name2color" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">name2color</span><span class="p">(</span><span class="n">name</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.get.wavelike.measured_scatter.name2color" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Return the 3-element RGB array of a given color name.</p>
<h4 id="chromatic.rainbows.get.wavelike.measured_scatter.name2color--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.get.wavelike.measured_scatter.name2color--parameters" title="Permanent link">#</a></h4>
<p>name : str
    The name of a color</p>
<h4 id="chromatic.rainbows.get.wavelike.measured_scatter.name2color--returns">Returns<a class="headerlink" href="#chromatic.rainbows.get.wavelike.measured_scatter.name2color--returns" title="Permanent link">#</a></h4>
<p>rgb : tuple
    3-element RGB color, with numbers from 0.0 to 1.0</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/imports.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">name2color</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return the 3-element RGB array of a given color name.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    name : str</span>
<span class="sd">        The name of a color</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    rgb : tuple</span>
<span class="sd">        3-element RGB color, with numbers from 0.0 to 1.0</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># give a friendly warning if the color name can&#39;t be found</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">color_hex</span> <span class="o">=</span> <span class="n">col</span><span class="o">.</span><span class="n">cnames</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">col</span><span class="o">.</span><span class="n">hex2color</span><span class="p">(</span><span class="n">color_hex</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="n">cheerfully_suggest</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The color </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> can&#39;t be found. (Returning black.)&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.get.wavelike.measured_scatter.one2another" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">one2another</span><span class="p">(</span><span class="n">bottom</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">alpha_bottom</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">alpha_top</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">256</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.get.wavelike.measured_scatter.one2another" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Create a cmap that goes smoothly (linearly in RGBA) from "bottom" to "top".</p>
<h4 id="chromatic.rainbows.get.wavelike.measured_scatter.one2another--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.get.wavelike.measured_scatter.one2another--parameters" title="Permanent link">#</a></h4>
<p>bottom : str
    Name of a color for the bottom of cmap (0.0)
top : str
    Name of a color for the top of the cmap (1.0)
alpha_bottom : float
    Opacity at the bottom of the cmap
alpha_top : float
    Opacitiy at the top of the cmap
N : int
    The number of levels in the listed color map</p>
<h4 id="chromatic.rainbows.get.wavelike.measured_scatter.one2another--returns">Returns<a class="headerlink" href="#chromatic.rainbows.get.wavelike.measured_scatter.one2another--returns" title="Permanent link">#</a></h4>
<p>cmap : Colormap
    A color map that goes linearly from the
    bottom to top color (and alpha).</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/imports.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">one2another</span><span class="p">(</span><span class="n">bottom</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">alpha_bottom</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">alpha_top</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">256</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a cmap that goes smoothly (linearly in RGBA) from &quot;bottom&quot; to &quot;top&quot;.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    bottom : str</span>
<span class="sd">        Name of a color for the bottom of cmap (0.0)</span>
<span class="sd">    top : str</span>
<span class="sd">        Name of a color for the top of the cmap (1.0)</span>
<span class="sd">    alpha_bottom : float</span>
<span class="sd">        Opacity at the bottom of the cmap</span>
<span class="sd">    alpha_top : float</span>
<span class="sd">        Opacitiy at the top of the cmap</span>
<span class="sd">    N : int</span>
<span class="sd">        The number of levels in the listed color map</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    cmap : Colormap</span>
<span class="sd">        A color map that goes linearly from the</span>
<span class="sd">        bottom to top color (and alpha).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># get the RGB values of the bottom and top of the cmap</span>
    <span class="n">rgb_bottom</span><span class="p">,</span> <span class="n">rgb_top</span> <span class="o">=</span> <span class="n">name2color</span><span class="p">(</span><span class="n">bottom</span><span class="p">),</span> <span class="n">name2color</span><span class="p">(</span><span class="n">top</span><span class="p">)</span>

    <span class="c1"># create linear gradients for all four RGBA channels</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">rgb_bottom</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">rgb_top</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">N</span><span class="p">)</span>
    <span class="n">g</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">rgb_bottom</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">rgb_top</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">N</span><span class="p">)</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">rgb_bottom</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">rgb_top</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">N</span><span class="p">)</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">alpha_bottom</span><span class="p">,</span> <span class="n">alpha_top</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>

    <span class="c1"># create (N,4) array + populate a listed colormap</span>
    <span class="n">colors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">]))</span>
    <span class="n">cmap</span> <span class="o">=</span> <span class="n">col</span><span class="o">.</span><span class="n">ListedColormap</span><span class="p">(</span><span class="n">colors</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{bottom}</span><span class="s2">2</span><span class="si">{top}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="nb">locals</span><span class="p">()))</span>

    <span class="c1"># return the colormap</span>
    <span class="k">return</span> <span class="n">cmap</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.get.wavelike.measured_scatter.remove_unit" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">remove_unit</span><span class="p">(</span><span class="n">x</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.get.wavelike.measured_scatter.remove_unit" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Quick wrapper to remove the unit from a quantity,
but not complain if it doesn't have one.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/imports.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">remove_unit</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Quick wrapper to remove the unit from a quantity,</span>
<span class="sd">    but not complain if it doesn&#39;t have one.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">x</span><span class="o">.</span><span class="n">value</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">x</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.get.wavelike.measured_scatter.resample_while_conserving_flux" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">resample_while_conserving_flux</span><span class="p">(</span><span class="n">xin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">yin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xout</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xin_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xout_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">replace_nans</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">visualize</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">pause</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.get.wavelike.measured_scatter.resample_while_conserving_flux" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Starting from some initial x and y, resample onto a
different grid (either higher or lower resolution),
while conserving total flux.</p>
<p>When including the entire range of <code>xin</code>,
<code>sum(yout) == sum(yin)</code> should be true.</p>
<p>When including only part of the range of <code>xin</code>,
the integral between any two points should be conserved.</p>
<h4 id="chromatic.rainbows.get.wavelike.measured_scatter.resample_while_conserving_flux--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.get.wavelike.measured_scatter.resample_while_conserving_flux--parameters" title="Permanent link">#</a></h4>
<p>xin : array
    The original independent variable.
yin : array
    The original dependent variable (same size as x).
xout : array
    The new grid of independent variables onto which
    you want to resample the y values. Refers to the
    center of each bin (use <code>xout_edges</code> for finer
    control over the exact edges of the bins)
xin_edges : array
    The edges of the original independent variable bins.
    The left and right edges of the bins are interpreted
    to be <code>xin_edges[:-1]</code> and <code>xin_edges[1:]</code>,
    respectively, so the associated <code>yin</code> should have exactly
    1 fewer element than <code>xin_edges</code>. This provides finer
    control over the size of each bin in the input than
    simply supplying <code>xin</code>(still a little experimental)
    They should probably be sorted?
xout_edges : array
    The edges of the new grid of bins for the independent
    variable, onto which you want to resample the y
    values. The left and right edges of the bins will be,
    respectively, <code>xout_edges[:-1]</code> and <code>xout_edges[1:]</code>,
    so the size of the output array will be
    <code>len(xout_edges) - 1</code>
replace_nans : float, str
    Replace nan values with this value.
    <code>replace_nans = 0</code>
        will add no flux where nans are
    <code>replace_nans = nan</code>
        will ensure you get nans returned everywhere
        if you try to resample over any nan
    <code>replace_nans = 'interpolate'</code>
        will try to replace nans by linearly interpolating
        from nearby values (not yet implemented)
visualize : bool
    Should we make a plot showing whether it worked?
pause : bool
    Should we pause to wait for a key press?</p>
<h4 id="chromatic.rainbows.get.wavelike.measured_scatter.resample_while_conserving_flux--returns">Returns<a class="headerlink" href="#chromatic.rainbows.get.wavelike.measured_scatter.resample_while_conserving_flux--returns" title="Permanent link">#</a></h4>
<p>result : dict
    A dictionary containing...
        <code>x</code> = the center of the output grid
        <code>y</code> = the resampled value on the output grid
        <code>edges</code> = the edges of the output grid, which will
            have one more element than x or y</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/tools/resampling.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">resample_while_conserving_flux</span><span class="p">(</span>
    <span class="n">xin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">yin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">xout</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">xin_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">xout_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">replace_nans</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
    <span class="n">visualize</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">pause</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Starting from some initial x and y, resample onto a</span>
<span class="sd">    different grid (either higher or lower resolution),</span>
<span class="sd">    while conserving total flux.</span>

<span class="sd">    When including the entire range of `xin`,</span>
<span class="sd">    `sum(yout) == sum(yin)` should be true.</span>

<span class="sd">    When including only part of the range of `xin`,</span>
<span class="sd">    the integral between any two points should be conserved.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    xin : array</span>
<span class="sd">        The original independent variable.</span>
<span class="sd">    yin : array</span>
<span class="sd">        The original dependent variable (same size as x).</span>
<span class="sd">    xout : array</span>
<span class="sd">        The new grid of independent variables onto which</span>
<span class="sd">        you want to resample the y values. Refers to the</span>
<span class="sd">        center of each bin (use `xout_edges` for finer</span>
<span class="sd">        control over the exact edges of the bins)</span>
<span class="sd">    xin_edges : array</span>
<span class="sd">        The edges of the original independent variable bins.</span>
<span class="sd">        The left and right edges of the bins are interpreted</span>
<span class="sd">        to be `xin_edges[:-1]` and `xin_edges[1:]`,</span>
<span class="sd">        respectively, so the associated `yin` should have exactly</span>
<span class="sd">        1 fewer element than `xin_edges`. This provides finer</span>
<span class="sd">        control over the size of each bin in the input than</span>
<span class="sd">        simply supplying `xin`(still a little experimental)</span>
<span class="sd">        They should probably be sorted?</span>
<span class="sd">    xout_edges : array</span>
<span class="sd">        The edges of the new grid of bins for the independent</span>
<span class="sd">        variable, onto which you want to resample the y</span>
<span class="sd">        values. The left and right edges of the bins will be,</span>
<span class="sd">        respectively, `xout_edges[:-1]` and `xout_edges[1:]`,</span>
<span class="sd">        so the size of the output array will be</span>
<span class="sd">        `len(xout_edges) - 1`</span>
<span class="sd">    replace_nans : float, str</span>
<span class="sd">        Replace nan values with this value.</span>
<span class="sd">        `replace_nans = 0`</span>
<span class="sd">            will add no flux where nans are</span>
<span class="sd">        `replace_nans = nan`</span>
<span class="sd">            will ensure you get nans returned everywhere</span>
<span class="sd">            if you try to resample over any nan</span>
<span class="sd">        `replace_nans = &#39;interpolate&#39;`</span>
<span class="sd">            will try to replace nans by linearly interpolating</span>
<span class="sd">            from nearby values (not yet implemented)</span>
<span class="sd">    visualize : bool</span>
<span class="sd">        Should we make a plot showing whether it worked?</span>
<span class="sd">    pause : bool</span>
<span class="sd">        Should we pause to wait for a key press?</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    result : dict</span>
<span class="sd">        A dictionary containing...</span>
<span class="sd">            `x` = the center of the output grid</span>
<span class="sd">            `y` = the resampled value on the output grid</span>
<span class="sd">            `edges` = the edges of the output grid, which will</span>
<span class="sd">                have one more element than x or y</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># make sure there are some reasonable input options</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">xin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">xin_edges</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">yin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">xout</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">xout_edges</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>

    <span class="c1"># set up the bins, to calculate cumulative distribution of y</span>
    <span class="k">if</span> <span class="n">xin_edges</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># make sure the sizes match up</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">xin</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">yin</span><span class="p">)</span>
        <span class="c1"># sort to make sure x is strictly increasing</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">xin</span><span class="p">)</span>
        <span class="n">xin_sorted</span> <span class="o">=</span> <span class="n">xin</span><span class="p">[</span><span class="n">s</span><span class="p">]</span>
        <span class="n">yin_sorted</span> <span class="o">=</span> <span class="n">yin</span><span class="p">[</span><span class="n">s</span><span class="p">]</span>
        <span class="c1"># estimate some bin edges (might fail for non-uniform grids)</span>
        <span class="n">xin_left</span><span class="p">,</span> <span class="n">xin_right</span> <span class="o">=</span> <span class="n">calculate_bin_leftright</span><span class="p">(</span><span class="n">xin_sorted</span><span class="p">)</span>
        <span class="c1"># define an array of edges</span>
        <span class="n">xin_edges</span> <span class="o">=</span> <span class="n">leftright_to_edges</span><span class="p">(</span><span class="n">xin_left</span><span class="p">,</span> <span class="n">xin_right</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># make sure the sizes match up</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">xin_edges</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">yin</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="c1"># sort to make sure x is strictly increasing</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">xin_edges</span><span class="p">)</span>
        <span class="n">xin_left</span><span class="p">,</span> <span class="n">xin_right</span> <span class="o">=</span> <span class="n">edges_to_leftright</span><span class="p">(</span><span class="n">xin_edges</span><span class="p">[</span><span class="n">s</span><span class="p">])</span>
        <span class="n">xin_sorted</span> <span class="o">=</span> <span class="p">(</span><span class="n">xin_left</span> <span class="o">+</span> <span class="n">xin_right</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">yin_sorted</span> <span class="o">=</span> <span class="n">yin</span><span class="p">[</span><span class="n">s</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>

    <span class="c1"># the first element should be the left edge of the first pixel</span>
    <span class="c1"># last element will be right edge of last pixel</span>
    <span class="n">xin_for_cdf</span> <span class="o">=</span> <span class="n">xin_edges</span>

    <span class="c1"># to the left of the first pixel, assume flux is zero</span>
    <span class="n">yin_for_cdf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">yin_sorted</span><span class="p">])</span>

    <span class="c1"># correct for any non-finite values</span>
    <span class="n">bad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">yin_for_cdf</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">replace_nans</span> <span class="o">==</span> <span class="s2">&quot;interpolate&quot;</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
            <span class="s2">&quot;The `replace_nans=&#39;interpolate&#39;`` option doens&#39;t exist yet!&quot;</span>
        <span class="p">)</span>
    <span class="n">yin_for_cdf</span><span class="p">[</span><span class="n">bad</span><span class="p">]</span> <span class="o">=</span> <span class="n">replace_nans</span>

    <span class="c1"># calculate the CDF of the flux (at pixel edge locations)</span>
    <span class="n">cdfin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">yin_for_cdf</span><span class="p">)</span>

    <span class="c1"># create an interpolator for that CDF</span>
    <span class="n">cdfinterpolator</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span>
        <span class="n">xin_for_cdf</span><span class="p">,</span>
        <span class="n">cdfin</span><span class="p">,</span>
        <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span>
        <span class="n">bounds_error</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">fill_value</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">yin</span><span class="p">)),</span>
    <span class="p">)</span>

    <span class="c1"># calculate bin edges (of size len(xout)+1)</span>
    <span class="k">if</span> <span class="n">xout_edges</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">xout_left</span><span class="p">,</span> <span class="n">xout_right</span> <span class="o">=</span> <span class="n">calculate_bin_leftright</span><span class="p">(</span><span class="n">xout</span><span class="p">)</span>
        <span class="n">xout_edges</span> <span class="o">=</span> <span class="n">leftright_to_edges</span><span class="p">(</span><span class="n">xout_left</span><span class="p">,</span> <span class="n">xout_right</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">xout_left</span><span class="p">,</span> <span class="n">xout_right</span> <span class="o">=</span> <span class="n">edges_to_leftright</span><span class="p">(</span><span class="n">xout_edges</span><span class="p">)</span>
        <span class="n">xout</span> <span class="o">=</span> <span class="p">(</span><span class="n">xout_left</span> <span class="o">+</span> <span class="n">xout_right</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>

    <span class="n">xout_for_cdf</span> <span class="o">=</span> <span class="n">leftright_to_edges</span><span class="p">(</span><span class="n">xout_left</span><span class="p">,</span> <span class="n">xout_right</span><span class="p">)</span>

    <span class="c1"># interpolate the CDF onto those bin edges</span>
    <span class="n">cdfout</span> <span class="o">=</span> <span class="n">cdfinterpolator</span><span class="p">(</span><span class="n">xout_for_cdf</span><span class="p">)</span>

    <span class="c1"># take  derivative of the CDF to get flux per resampled bin</span>
    <span class="c1"># (xout is bin center, and yout is the flux in that bin)</span>
    <span class="n">yout</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">cdfout</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">visualize</span><span class="p">:</span>
        <span class="n">fi</span><span class="p">,</span> <span class="p">(</span><span class="n">ax_cdf</span><span class="p">,</span> <span class="n">ax_pdf</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
        <span class="n">inkw</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
            <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span>
            <span class="n">markeredgecolor</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">outkw</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;darkorange&quot;</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span>
            <span class="n">markersize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
            <span class="n">markeredgecolor</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">legkw</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper left&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">xinbinsize</span> <span class="o">=</span> <span class="n">xin_right</span> <span class="o">-</span> <span class="n">xin_left</span>
        <span class="n">xoutbinsize</span> <span class="o">=</span> <span class="n">xout_right</span> <span class="o">-</span> <span class="n">xout_left</span>
        <span class="c1"># plot the PDFs</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="n">ax_pdf</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Flux per (Original) Pixel&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Pixel&quot;</span><span class="p">)</span>
        <span class="c1"># plot the original pixels (in df/dpixel to compare with resampled)</span>
        <span class="n">plot_as_boxes</span><span class="p">(</span>
            <span class="n">xin_sorted</span><span class="p">,</span> <span class="n">yin_sorted</span> <span class="o">/</span> <span class="n">xinbinsize</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Original Pixels&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">inkw</span>
        <span class="p">)</span>

        <span class="c1"># what would a bad interpolation look like?</span>
        <span class="n">interpolate_badly</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span>
            <span class="n">xin_sorted</span><span class="p">,</span>
            <span class="n">yin_sorted</span> <span class="o">/</span> <span class="n">xinbinsize</span><span class="p">,</span>
            <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span>
            <span class="n">bounds_error</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">fill_value</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
            <span class="n">xout</span><span class="p">,</span>
            <span class="n">interpolate_badly</span><span class="p">(</span><span class="n">xout</span><span class="p">),</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;cornflowerblue&quot;</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span>
            <span class="n">markersize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
            <span class="n">markeredgecolor</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Silly Simple Interpolation&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># plot the flux-conserving resampled data (again, in df/d&quot;pixel&quot;)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
            <span class="n">xout</span><span class="p">,</span> <span class="n">yout</span> <span class="o">/</span> <span class="n">xoutbinsize</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Flux-Conserving Interpolation&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">outkw</span>
        <span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="o">**</span><span class="n">legkw</span><span class="p">)</span>

        <span class="c1"># plot the CDFs</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="n">ax_cdf</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Cumulative Flux (from left)&quot;</span><span class="p">)</span>

        <span class="c1"># plot the original CDF</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xin_for_cdf</span><span class="p">,</span> <span class="n">cdfin</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Original Pixels&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">inkw</span><span class="p">)</span>

        <span class="c1"># plot the interpolated CDF</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xout_for_cdf</span><span class="p">,</span> <span class="n">cdfout</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Flux-Conserved Resample&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">outkw</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">pause</span><span class="p">:</span>
            <span class="n">a</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span>
                <span class="s2">&quot;Pausing a moment to check on interpolation; press return to continue.&quot;</span>
            <span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{:&gt;6}</span><span class="s2"> = </span><span class="si">{:.5f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;Actual&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">yin</span><span class="p">)))</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="s2">&quot;</span><span class="si">{:&gt;6}</span><span class="s2"> = </span><span class="si">{:.5f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="s2">&quot;Silly&quot;</span><span class="p">,</span>
                <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">interpolate_badly</span><span class="p">(</span><span class="n">xout</span><span class="p">)</span> <span class="o">*</span> <span class="n">xoutbinsize</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{:&gt;6}</span><span class="s2"> = </span><span class="si">{:.5f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;CDF&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">yout</span><span class="p">)))</span>

    <span class="c1"># return the resampled y-values</span>
    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="n">xout</span><span class="p">,</span> <span class="s2">&quot;x_edge_lower&quot;</span><span class="p">:</span> <span class="n">xout_left</span><span class="p">,</span> <span class="s2">&quot;x_edge_upper&quot;</span><span class="p">:</span> <span class="n">xout_right</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="n">yout</span><span class="p">}</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="chromatic.rainbows.get.wavelike.median_spectrum"></a>
    <div class="doc doc-contents first">









  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.get.wavelike.median_spectrum.bintoR" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">bintoR</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">unc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">R</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">weighting</span><span class="o">=</span><span class="s1">&#39;inversevariance&#39;</span><span class="p">,</span> <span class="n">drop_nans</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.get.wavelike.median_spectrum.bintoR" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Bin any x and y array onto a logarithmicly uniform grid.</p>
<h4 id="chromatic.rainbows.get.wavelike.median_spectrum.bintoR--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.get.wavelike.median_spectrum.bintoR--parameters" title="Permanent link">#</a></h4>
<p>x : array
    The original independent variable.
    (For a spectrum example = wavelength)
y : array
    The original dependent variable (same size as x).
    (For a spectrum example = flux)
unc : array, None, optional
    The unceratinty on the dependent variable
    (For a spectrum example = the flux uncertainty)
R : array, optional
    The spectral resolution R=x/dx for creating a new,
    logarithmically uniform grid that starts at the first
    value of x.
xlim : list, array, optional
    A two-element list indicating the min and max values of
    x for the new logarithmically spaced grid. If None,
    these limits will be created from the data themselves
weighting : str, optional
    How should we weight values when averaging
    them together into one larger bin?
    <code>weighting = 'inversevariance'</code>
        weights = 1/unc**2
     <code>weighting = {literally anything else}</code>
        uniform weights
    This will have no impact if <code>unc == None</code>, or for any
    new bins that effectively overlap less than one original
    unbinned point.
drop_nans : bool, optional
    Should we skip any bins turn out to be nans?
    This most often happens when bins are empty.</p>
<h4 id="chromatic.rainbows.get.wavelike.median_spectrum.bintoR--returns">Returns<a class="headerlink" href="#chromatic.rainbows.get.wavelike.median_spectrum.bintoR--returns" title="Permanent link">#</a></h4>
<p>result : dict
    A dictionary containing at least...
        <code>x</code> = the center of the output grid
        <code>y</code> = the resampled value on the output grid
        <code>x_edge_lower</code> = the lower edges of the output grid
        <code>x_edge_upper</code> = the upper edges of the output grid
    ...and possibly also
        <code>uncertainty</code> = the calculated uncertainty per bin</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/tools/resampling.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">bintoR</span><span class="p">(</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">unc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">R</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">weighting</span><span class="o">=</span><span class="s2">&quot;inversevariance&quot;</span><span class="p">,</span> <span class="n">drop_nans</span><span class="o">=</span><span class="kc">True</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Bin any x and y array onto a logarithmicly uniform grid.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : array</span>
<span class="sd">        The original independent variable.</span>
<span class="sd">        (For a spectrum example = wavelength)</span>
<span class="sd">    y : array</span>
<span class="sd">        The original dependent variable (same size as x).</span>
<span class="sd">        (For a spectrum example = flux)</span>
<span class="sd">    unc : array, None, optional</span>
<span class="sd">        The unceratinty on the dependent variable</span>
<span class="sd">        (For a spectrum example = the flux uncertainty)</span>
<span class="sd">    R : array, optional</span>
<span class="sd">        The spectral resolution R=x/dx for creating a new,</span>
<span class="sd">        logarithmically uniform grid that starts at the first</span>
<span class="sd">        value of x.</span>
<span class="sd">    xlim : list, array, optional</span>
<span class="sd">        A two-element list indicating the min and max values of</span>
<span class="sd">        x for the new logarithmically spaced grid. If None,</span>
<span class="sd">        these limits will be created from the data themselves</span>
<span class="sd">    weighting : str, optional</span>
<span class="sd">        How should we weight values when averaging</span>
<span class="sd">        them together into one larger bin?</span>
<span class="sd">        `weighting = &#39;inversevariance&#39;`</span>
<span class="sd">            weights = 1/unc**2</span>
<span class="sd">         `weighting = {literally anything else}`</span>
<span class="sd">            uniform weights</span>
<span class="sd">        This will have no impact if `unc == None`, or for any</span>
<span class="sd">        new bins that effectively overlap less than one original</span>
<span class="sd">        unbinned point.</span>
<span class="sd">    drop_nans : bool, optional</span>
<span class="sd">        Should we skip any bins turn out to be nans?</span>
<span class="sd">        This most often happens when bins are empty.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    result : dict</span>
<span class="sd">        A dictionary containing at least...</span>
<span class="sd">            `x` = the center of the output grid</span>
<span class="sd">            `y` = the resampled value on the output grid</span>
<span class="sd">            `x_edge_lower` = the lower edges of the output grid</span>
<span class="sd">            `x_edge_upper` = the upper edges of the output grid</span>
<span class="sd">        ...and possibly also</span>
<span class="sd">            `uncertainty` = the calculated uncertainty per bin</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">x_unit</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">unit</span>
        <span class="n">x_without_unit</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">value</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="n">x_unit</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">x_without_unit</span> <span class="o">=</span> <span class="n">x</span>

    <span class="c1"># create a new grid of x at the given resolution</span>
    <span class="n">lnx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">x_without_unit</span><span class="p">)</span>
    <span class="n">dnewlnx</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">R</span>

    <span class="c1"># set the limits of the new xgrid (in log space)</span>
    <span class="k">if</span> <span class="n">xlim</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># use the input grid to set the limits</span>
        <span class="n">lnxbottom</span><span class="p">,</span> <span class="n">lnxtop</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">lnx</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">lnx</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># use the custom xlim to set the limits</span>
        <span class="n">lnxbottom</span><span class="p">,</span> <span class="n">lnxtop</span> <span class="o">=</span> <span class="n">xlim</span>

    <span class="c1"># create a new, log-uniform grid of x values</span>
    <span class="n">newlnx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">lnxbottom</span><span class="p">,</span> <span class="n">lnxtop</span> <span class="o">+</span> <span class="n">dnewlnx</span><span class="p">,</span> <span class="n">dnewlnx</span><span class="p">)</span>

    <span class="c1"># now do the binning on a uniform grid of lnx</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">bintogrid</span><span class="p">(</span>
        <span class="n">lnx</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">unc</span><span class="p">,</span> <span class="n">newx</span><span class="o">=</span><span class="n">newlnx</span><span class="p">,</span> <span class="n">weighting</span><span class="o">=</span><span class="n">weighting</span><span class="p">,</span> <span class="n">drop_nans</span><span class="o">=</span><span class="n">drop_nans</span>
    <span class="p">)</span>

    <span class="c1"># convert back from log to real values</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;x_edge_lower&quot;</span><span class="p">,</span> <span class="s2">&quot;x_edge_upper&quot;</span><span class="p">]:</span>
        <span class="n">result</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="o">*</span> <span class="n">x_unit</span>

    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.get.wavelike.median_spectrum.bintogrid" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">bintogrid</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">unc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">newx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">newx_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">nx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">weighting</span><span class="o">=</span><span class="s1">&#39;inversevariance&#39;</span><span class="p">,</span> <span class="n">drop_nans</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">x_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">visualize</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.get.wavelike.median_spectrum.bintogrid" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Bin any x and y array onto a linearly uniform grid.</p>
<h4 id="chromatic.rainbows.get.wavelike.median_spectrum.bintogrid--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.get.wavelike.median_spectrum.bintogrid--parameters" title="Permanent link">#</a></h4>
<p>x : array
    The original independent variable.
    (For a spectrum example = wavelength)
y : array
    The original dependent variable (same size as x).
    (For a spectrum example = flux)
unc : array, None
    The unceratinty on the dependent variable
    (For a spectrum example = the flux uncertainty)
nx : array
    The number of bins from the original grid to
    bin together into the new one.
dx : array
    The fixed spacing for creating a new, linearly uniform
    grid that start at the first value of x. This will
    be ignored if <code>newx</code> != None.
newx : array
    A new custom grid onto which we should bin.
newx_edges : array
    The edges of the new grid of bins for the independent
    variable, onto which you want to resample the y
    values. The left and right edges of the bins will be,
    respectively, <code>newx_edges[:-1]</code> and <code>newx_edges[1:]</code>,
    so the size of the output array will be
    <code>len(newx_edges) - 1</code>
weighting : str
    How should we weight values when averaging
    them together into one larger bin?
    <code>weighting = 'inversevariance'</code>
        weights = 1/unc**2
     <code>weighting = {literally anything else}</code>
        uniform weights
    This will have no impact if <code>unc == None</code>, or for any
    new bins that effectively overlap less than one original
    unbinned point.
drop_nans : bool
    Should we skip any bins turn out to be nans?
    This most often happens when bins are empty.
x_edges : array
    The edges of the original independent variable bins.
    The left and right edges of the bins are interpreted
    to be <code>x_edges[:-1]</code> and <code>x_edges[1:]</code>,
    respectively, so the associated <code>y</code> should have exactly
    1 fewer element than <code>x_edges</code>. This provides finer
    control over the size of each bin in the input than
    simply supplying <code>x</code>(still a little experimental)</p>
<h4 id="chromatic.rainbows.get.wavelike.median_spectrum.bintogrid--returns">Returns<a class="headerlink" href="#chromatic.rainbows.get.wavelike.median_spectrum.bintogrid--returns" title="Permanent link">#</a></h4>
<p>result : dict
    A dictionary containing at least...
        <code>x</code> = the center of the output grid
        <code>y</code> = the resampled value on the output grid
        <code>x_edge_lower</code> = the lower edges of the output grid
        <code>x_edge_upper</code> = the upper edges of the output grid
    ...and possibly also
        <code>uncertainty</code> = the calculated uncertainty per bin</p>
<p>The order of precendence for setting the new grid is
[<code>newx_edges</code>, <code>newx</code>, <code>dx</code>, <code>nx</code>]
The first will be used, and others will be ignored.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/tools/resampling.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">bintogrid</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">unc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">newx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">newx_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">dx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">nx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">weighting</span><span class="o">=</span><span class="s2">&quot;inversevariance&quot;</span><span class="p">,</span>
    <span class="n">drop_nans</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">x_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">visualize</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Bin any x and y array onto a linearly uniform grid.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : array</span>
<span class="sd">        The original independent variable.</span>
<span class="sd">        (For a spectrum example = wavelength)</span>
<span class="sd">    y : array</span>
<span class="sd">        The original dependent variable (same size as x).</span>
<span class="sd">        (For a spectrum example = flux)</span>
<span class="sd">    unc : array, None</span>
<span class="sd">        The unceratinty on the dependent variable</span>
<span class="sd">        (For a spectrum example = the flux uncertainty)</span>
<span class="sd">    nx : array</span>
<span class="sd">        The number of bins from the original grid to</span>
<span class="sd">        bin together into the new one.</span>
<span class="sd">    dx : array</span>
<span class="sd">        The fixed spacing for creating a new, linearly uniform</span>
<span class="sd">        grid that start at the first value of x. This will</span>
<span class="sd">        be ignored if `newx` != None.</span>
<span class="sd">    newx : array</span>
<span class="sd">        A new custom grid onto which we should bin.</span>
<span class="sd">    newx_edges : array</span>
<span class="sd">        The edges of the new grid of bins for the independent</span>
<span class="sd">        variable, onto which you want to resample the y</span>
<span class="sd">        values. The left and right edges of the bins will be,</span>
<span class="sd">        respectively, `newx_edges[:-1]` and `newx_edges[1:]`,</span>
<span class="sd">        so the size of the output array will be</span>
<span class="sd">        `len(newx_edges) - 1`</span>
<span class="sd">    weighting : str</span>
<span class="sd">        How should we weight values when averaging</span>
<span class="sd">        them together into one larger bin?</span>
<span class="sd">        `weighting = &#39;inversevariance&#39;`</span>
<span class="sd">            weights = 1/unc**2</span>
<span class="sd">         `weighting = {literally anything else}`</span>
<span class="sd">            uniform weights</span>
<span class="sd">        This will have no impact if `unc == None`, or for any</span>
<span class="sd">        new bins that effectively overlap less than one original</span>
<span class="sd">        unbinned point.</span>
<span class="sd">    drop_nans : bool</span>
<span class="sd">        Should we skip any bins turn out to be nans?</span>
<span class="sd">        This most often happens when bins are empty.</span>
<span class="sd">    x_edges : array</span>
<span class="sd">        The edges of the original independent variable bins.</span>
<span class="sd">        The left and right edges of the bins are interpreted</span>
<span class="sd">        to be `x_edges[:-1]` and `x_edges[1:]`,</span>
<span class="sd">        respectively, so the associated `y` should have exactly</span>
<span class="sd">        1 fewer element than `x_edges`. This provides finer</span>
<span class="sd">        control over the size of each bin in the input than</span>
<span class="sd">        simply supplying `x`(still a little experimental)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    result : dict</span>
<span class="sd">        A dictionary containing at least...</span>
<span class="sd">            `x` = the center of the output grid</span>
<span class="sd">            `y` = the resampled value on the output grid</span>
<span class="sd">            `x_edge_lower` = the lower edges of the output grid</span>
<span class="sd">            `x_edge_upper` = the upper edges of the output grid</span>
<span class="sd">        ...and possibly also</span>
<span class="sd">            `uncertainty` = the calculated uncertainty per bin</span>


<span class="sd">    The order of precendence for setting the new grid is</span>
<span class="sd">    [`newx_edges`, `newx`, `dx`, `nx`]</span>
<span class="sd">    The first will be used, and others will be ignored.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># check that an OK set of inputs has been supplied</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">x_edges</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;🌈 Both `x` and `x_edges` were supplied to `bintogrid`. Confusing!&quot;&quot;&quot;</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">x_edges</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;🌈 At least one of `x` or `x_edges` must be supplied to `bintogrid`.&quot;&quot;&quot;</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="n">y</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;🌈 `y` must be supplied to `bintogrid`.&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="c1"># make sure the edges and the centers are set</span>
    <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">x_left</span><span class="p">,</span> <span class="n">x_right</span> <span class="o">=</span> <span class="n">edges_to_leftright</span><span class="p">(</span><span class="n">x_edges</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">left</span> <span class="o">+</span> <span class="n">right</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">x_left</span><span class="p">,</span> <span class="n">x_right</span> <span class="o">=</span> <span class="n">calculate_bin_leftright</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">x_edges</span> <span class="o">=</span> <span class="n">leftright_to_edges</span><span class="p">(</span><span class="n">x_left</span><span class="p">,</span> <span class="n">x_right</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">x_unit</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">unit</span>
        <span class="n">x_without_unit</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">value</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="n">x_unit</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">x_without_unit</span> <span class="o">=</span> <span class="n">x</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">y_unit</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">unit</span>
        <span class="n">y_without_unit</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">value</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="n">y_unit</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">y_without_unit</span> <span class="o">=</span> <span class="n">y</span>

    <span class="c1"># warn if multiple inputs are provided</span>
    <span class="n">number_of_grid_options</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span><span class="n">z</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="p">[</span><span class="n">newx_edges</span><span class="p">,</span> <span class="n">newx</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">nx</span><span class="p">]])</span>
    <span class="k">if</span> <span class="n">number_of_grid_options</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">cheerfully_suggest</span><span class="p">(</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;More than one output grid sent to `bintogrid`.</span>
<span class="sd">                         The one being used is the first to appear in</span>
<span class="sd">                         [`newx_edges`, `newx`, `dx`, `nx`]</span>
<span class="sd">                         but you might want to choose more carefully.&quot;&quot;&quot;</span>
        <span class="p">)</span>

    <span class="c1"># define inputs based on the following order</span>
    <span class="k">if</span> <span class="n">newx_edges</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># define grid by its edges (and define others from there)</span>
        <span class="n">newx_edges_without_unit</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">newx_edges</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">x_unit</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
        <span class="n">dx_without_unit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">newx_edges_without_unit</span><span class="p">)</span>
        <span class="n">newx_without_unit</span> <span class="o">=</span> <span class="n">newx_edges_without_unit</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">dx_without_unit</span>
        <span class="n">newx_left_without_unit</span> <span class="o">=</span> <span class="n">newx_edges_without_unit</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">newx_right_without_unit</span> <span class="o">=</span> <span class="n">newx_edges_without_unit</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

        <span class="c1"># make sure the final output grid is defined</span>
        <span class="n">final_newx</span><span class="p">,</span> <span class="n">final_newx_left</span><span class="p">,</span> <span class="n">final_newx_right</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">newx_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
            <span class="n">newx_left_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
            <span class="n">newx_right_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="n">newx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># define grid by its centers (and define others from there)</span>
        <span class="n">newx_without_unit</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">newx</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">x_unit</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
        <span class="n">newx_left_without_unit</span><span class="p">,</span> <span class="n">newx_right_without_unit</span> <span class="o">=</span> <span class="n">calculate_bin_leftright</span><span class="p">(</span>
            <span class="n">newx_without_unit</span>
        <span class="p">)</span>
        <span class="n">newx_edges_without_unit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span>
            <span class="p">[</span><span class="n">newx_left_without_unit</span><span class="p">,</span> <span class="n">newx_right_without_unit</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
        <span class="p">)</span>
        <span class="n">dx_without_unit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">newx_edges_without_unit</span><span class="p">)</span>

        <span class="c1"># make sure the final output grid is defined</span>
        <span class="n">final_newx</span><span class="p">,</span> <span class="n">final_newx_left</span><span class="p">,</span> <span class="n">final_newx_right</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">newx_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
            <span class="n">newx_left_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
            <span class="n">newx_right_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="n">dx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># define grid by a bin width (and define others from there)</span>
        <span class="n">dx_without_unit</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">dx</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">x_unit</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
        <span class="n">newx_without_unit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">x_without_unit</span><span class="p">),</span>
            <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">x_without_unit</span><span class="p">)</span> <span class="o">+</span> <span class="n">dx_without_unit</span><span class="p">,</span>
            <span class="n">dx_without_unit</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">newx_left_without_unit</span><span class="p">,</span> <span class="n">newx_right_without_unit</span> <span class="o">=</span> <span class="n">calculate_bin_leftright</span><span class="p">(</span>
            <span class="n">newx_without_unit</span>
        <span class="p">)</span>
        <span class="n">newx_edges_without_unit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span>
            <span class="p">[</span><span class="n">newx_left_without_unit</span><span class="p">,</span> <span class="n">newx_right_without_unit</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
        <span class="p">)</span>

        <span class="c1"># make sure the final output grid is defined</span>
        <span class="n">final_newx</span><span class="p">,</span> <span class="n">final_newx_left</span><span class="p">,</span> <span class="n">final_newx_right</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">newx_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
            <span class="n">newx_left_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
            <span class="n">newx_right_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">elif</span> <span class="n">nx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># keep track of the original input x values</span>
        <span class="n">original_x_without_unit</span> <span class="o">=</span> <span class="n">x_without_unit</span>

        <span class="c1"># redefine the input x to indices, to do interpolation in index space</span>
        <span class="n">x_without_unit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">x_without_unit</span><span class="p">))</span>

        <span class="c1"># define a grid of edges that will enclose the right number of indices</span>
        <span class="n">x_left_i</span><span class="p">,</span> <span class="n">x_right_i</span> <span class="o">=</span> <span class="n">calculate_bin_leftright</span><span class="p">(</span><span class="n">x_without_unit</span><span class="p">)</span>
        <span class="n">newx_edges_without_unit</span> <span class="o">=</span> <span class="n">leftright_to_edges</span><span class="p">(</span><span class="n">x_left_i</span><span class="p">,</span> <span class="n">x_right_i</span><span class="p">)[::</span><span class="n">nx</span><span class="p">]</span>
        <span class="n">newx_without_unit</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span>
            <span class="n">newx_edges_without_unit</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">+</span> <span class="n">newx_edges_without_unit</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="p">)</span>

        <span class="c1"># calculate the actual x values corresponding to the bins</span>
        <span class="n">original_edges</span> <span class="o">=</span> <span class="n">leftright_to_edges</span><span class="p">(</span>
            <span class="o">*</span><span class="n">calculate_bin_leftright</span><span class="p">(</span><span class="n">original_x_without_unit</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">final_edges</span> <span class="o">=</span> <span class="n">original_edges</span><span class="p">[::</span><span class="n">nx</span><span class="p">]</span> <span class="o">*</span> <span class="n">x_unit</span>
        <span class="n">final_newx_left</span><span class="p">,</span> <span class="n">final_newx_right</span> <span class="o">=</span> <span class="n">edges_to_leftright</span><span class="p">(</span><span class="n">final_edges</span><span class="p">)</span>
        <span class="n">final_newx</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">final_newx_left</span> <span class="o">+</span> <span class="n">final_newx_right</span><span class="p">)</span>
        <span class="n">dx_without_unit</span> <span class="o">=</span> <span class="p">(</span><span class="n">final_newx_right</span> <span class="o">-</span> <span class="n">final_newx_left</span><span class="p">)</span> <span class="o">/</span> <span class="n">x_unit</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;No output grid sent to `bintogrid`.</span>
<span class="sd">                              Please choose one of the following:</span>
<span class="sd">                              [`newx_edges`, `newx`, `dx`, `nx`]&quot;&quot;&quot;</span>
        <span class="p">)</span>

    <span class="c1"># don&#39;t complain about zero-divisions in here (to allow infinite uncertainties)</span>
    <span class="k">with</span> <span class="n">np</span><span class="o">.</span><span class="n">errstate</span><span class="p">(</span><span class="n">divide</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">invalid</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">):</span>

        <span class="c1"># calculate weight integrals for the bin array</span>
        <span class="n">ok</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">y_without_unit</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span>

        <span class="c1"># resample the sums onto that new grid</span>
        <span class="k">if</span> <span class="n">unc</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">x_without_unit</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">weighting</span> <span class="o">==</span> <span class="s2">&quot;inversevariance&quot;</span><span class="p">:</span>
                <span class="n">weights</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">unc</span><span class="o">**</span><span class="mi">2</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">x_without_unit</span><span class="p">)</span>

            <span class="c1"># ignore infinite weights (= 0 uncertainties)</span>
            <span class="n">ok</span> <span class="o">*=</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">ok</span><span class="p">):</span>
            <span class="n">numerator</span> <span class="o">=</span> <span class="n">resample_while_conserving_flux</span><span class="p">(</span>
                <span class="n">xin</span><span class="o">=</span><span class="n">x_without_unit</span><span class="p">[</span><span class="n">ok</span><span class="p">],</span>
                <span class="n">yin</span><span class="o">=</span><span class="p">(</span><span class="n">y_without_unit</span> <span class="o">*</span> <span class="n">weights</span><span class="p">)[</span><span class="n">ok</span><span class="p">],</span>
                <span class="n">xout_edges</span><span class="o">=</span><span class="n">newx_edges_without_unit</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">denominator</span> <span class="o">=</span> <span class="n">resample_while_conserving_flux</span><span class="p">(</span>
                <span class="n">xin</span><span class="o">=</span><span class="n">x_without_unit</span><span class="p">[</span><span class="n">ok</span><span class="p">],</span>
                <span class="n">yin</span><span class="o">=</span><span class="n">weights</span><span class="p">[</span><span class="n">ok</span><span class="p">],</span>
                <span class="n">xout_edges</span><span class="o">=</span><span class="n">newx_edges_without_unit</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="c1"># the binned weighted means on the new grid</span>
            <span class="n">newy</span> <span class="o">=</span> <span class="n">numerator</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">denominator</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span>

            <span class="c1"># the standard error on the means, for those bins</span>
            <span class="n">newunc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">denominator</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">])</span>

            <span class="c1"># keep track of the number of original bins going into each new bin</span>
            <span class="n">number_of_original_bins_per_new_bin</span> <span class="o">=</span> <span class="n">resample_while_conserving_flux</span><span class="p">(</span>
                <span class="n">xin</span><span class="o">=</span><span class="n">x_without_unit</span><span class="p">[</span><span class="n">ok</span><span class="p">],</span>
                <span class="n">yin</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">y_without_unit</span><span class="p">)[</span><span class="n">ok</span><span class="p">],</span>
                <span class="n">xout_edges</span><span class="o">=</span><span class="n">newx_edges_without_unit</span><span class="p">,</span>
            <span class="p">)[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">newy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="o">*</span> <span class="n">newx_without_unit</span>
            <span class="n">newunc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="o">*</span> <span class="n">newx_without_unit</span>
            <span class="n">number_of_original_bins_per_new_bin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">newx_without_unit</span><span class="p">)</span>

    <span class="c1"># remove any empty bins</span>
    <span class="k">if</span> <span class="n">drop_nans</span><span class="p">:</span>
        <span class="n">ok</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">newy</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ok</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">newx_without_unit</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>

    <span class="c1"># if no uncertainties were given, don&#39;t return uncertainties</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># populate the new grid centers + edges + values</span>
    <span class="n">result</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">final_newx</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span>
    <span class="n">result</span><span class="p">[</span><span class="s2">&quot;x_edge_lower&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">final_newx_left</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span>
    <span class="n">result</span><span class="p">[</span><span class="s2">&quot;x_edge_upper&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">final_newx_right</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span>

    <span class="c1"># populate the new grid values</span>
    <span class="n">result</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">newy</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span> <span class="o">*</span> <span class="n">y_unit</span>

    <span class="c1"># populate the new grid value uncertainties</span>
    <span class="k">if</span> <span class="n">unc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">result</span><span class="p">[</span><span class="s2">&quot;uncertainty&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">newunc</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span> <span class="o">*</span> <span class="n">y_unit</span>

    <span class="c1"># store how many of the original pixels made it into this new one</span>
    <span class="n">result</span><span class="p">[</span><span class="s2">&quot;N_unbinned/N_binned&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">number_of_original_bins_per_new_bin</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">visualize</span><span class="p">:</span>
        <span class="n">fi</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span>
            <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">gridspec_kw</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">height_ratios</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">])</span>
        <span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">plot_as_boxes</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">xleft</span><span class="o">=</span><span class="n">x_left</span><span class="p">,</span> <span class="n">xright</span><span class="o">=</span><span class="n">x_right</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;silver&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">ekw</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">elinewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">unc</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;silver&quot;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">ekw</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">],</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">],</span>
            <span class="n">yerr</span><span class="o">=</span><span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;uncertainty&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
            <span class="n">xerr</span><span class="o">=</span><span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s2">&quot;x_edge_upper&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;x_edge_lower&quot;</span><span class="p">])</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
            <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
            <span class="n">zorder</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
            <span class="o">**</span><span class="n">ekw</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">plot_as_boxes</span><span class="p">(</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">],</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;N_unbinned/N_binned&quot;</span><span class="p">],</span>
            <span class="n">xleft</span><span class="o">=</span><span class="n">result</span><span class="p">[</span><span class="s2">&quot;x_edge_lower&quot;</span><span class="p">],</span>
            <span class="n">xright</span><span class="o">=</span><span class="n">result</span><span class="p">[</span><span class="s2">&quot;x_edge_upper&quot;</span><span class="p">],</span>
        <span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;$N_</span><span class="si">{unbinned}</span><span class="s2">/N_</span><span class="si">{binned}</span><span class="s2">$&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.get.wavelike.median_spectrum.calculate_bin_leftright" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">calculate_bin_leftright</span><span class="p">(</span><span class="n">x</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.get.wavelike.median_spectrum.calculate_bin_leftright" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>If x is an array of bin centers, calculate the bin edges.
(assumes outermost bins are same size as their neighbors)</p>
<h4 id="chromatic.rainbows.get.wavelike.median_spectrum.calculate_bin_leftright--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.get.wavelike.median_spectrum.calculate_bin_leftright--parameters" title="Permanent link">#</a></h4>
<p>x : array
    The array of bin centers.</p>
<h4 id="chromatic.rainbows.get.wavelike.median_spectrum.calculate_bin_leftright--returns">Returns<a class="headerlink" href="#chromatic.rainbows.get.wavelike.median_spectrum.calculate_bin_leftright--returns" title="Permanent link">#</a></h4>
<p>l : array
    The left edges of the bins.
r : array
    The right edges of the bins.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/tools/resampling.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">calculate_bin_leftright</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    If x is an array of bin centers, calculate the bin edges.</span>
<span class="sd">    (assumes outermost bins are same size as their neighbors)</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : array</span>
<span class="sd">        The array of bin centers.</span>

<span class="sd">    Returns</span>
<span class="sd">    ----------</span>
<span class="sd">    l : array</span>
<span class="sd">        The left edges of the bins.</span>
<span class="sd">    r : array</span>
<span class="sd">        The right edges of the bins.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># what are bin edges (making a guess for those on the ends)</span>
    <span class="c1"># xbinsize = calculate_bin_widths(x)</span>
    <span class="c1"># left = x - xbinsize / 2.0</span>
    <span class="c1"># right = x + xbinsize / 2.0</span>

    <span class="c1"># weird corner case!</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">left</span><span class="p">,</span> <span class="n">right</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">left</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">right</span><span class="p">])</span>

    <span class="n">inner_edges</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="n">x</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">first_edge</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="n">inner_edges</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">last_edge</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">inner_edges</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

    <span class="n">left</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">first_edge</span><span class="p">,</span> <span class="n">inner_edges</span><span class="p">])</span>
    <span class="n">right</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">inner_edges</span><span class="p">,</span> <span class="n">last_edge</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.get.wavelike.median_spectrum.edges_to_leftright" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">edges_to_leftright</span><span class="p">(</span><span class="n">edges</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.get.wavelike.median_spectrum.edges_to_leftright" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Convert N+1 contiguous edges to two arrays of N left/right edges.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/tools/resampling.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">edges_to_leftright</span><span class="p">(</span><span class="n">edges</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert N+1 contiguous edges to two arrays of N left/right edges.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">left</span><span class="p">,</span> <span class="n">right</span> <span class="o">=</span> <span class="n">edges</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">edges</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="k">return</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.get.wavelike.median_spectrum.expand_filenames" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">expand_filenames</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.get.wavelike.median_spectrum.expand_filenames" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>A wrapper to expand a string or list into a list of filenames.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/imports.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">expand_filenames</span><span class="p">(</span><span class="n">filepath</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A wrapper to expand a string or list into a list of filenames.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
        <span class="n">filenames</span> <span class="o">=</span> <span class="n">filepath</span>
    <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span> <span class="o">==</span> <span class="n">Column</span><span class="p">:</span>
        <span class="n">filenames</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>
    <span class="k">elif</span> <span class="s2">&quot;*&quot;</span> <span class="ow">in</span> <span class="n">filepath</span><span class="p">:</span>
        <span class="n">filenames</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">filepath</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">filenames</span> <span class="o">=</span> <span class="p">[</span><span class="n">filepath</span><span class="p">]</span>
    <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">filenames</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.get.wavelike.median_spectrum.get_median_spectrum" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_median_spectrum</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.get.wavelike.median_spectrum.get_median_spectrum" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Return a spectrum of the star, medianed over all times.</p>
<h4 id="chromatic.rainbows.get.wavelike.median_spectrum.get_median_spectrum--returns">Returns<a class="headerlink" href="#chromatic.rainbows.get.wavelike.median_spectrum.get_median_spectrum--returns" title="Permanent link">#</a></h4>
<p>median_spectrum : array
    Wavelike array of fluxes.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/rainbows/get/wavelike/median_spectrum.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_median_spectrum</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return a spectrum of the star, medianed over all times.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    median_spectrum : array</span>
<span class="sd">        Wavelike array of fluxes.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmedian</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_ok_data</span><span class="p">(),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.get.wavelike.median_spectrum.leftright_to_edges" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">leftright_to_edges</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.get.wavelike.median_spectrum.leftright_to_edges" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Convert two arrays of N left/right edges to N+1 continugous edges.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/tools/resampling.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">leftright_to_edges</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert two arrays of N left/right edges to N+1 continugous edges.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">edges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>
    <span class="k">return</span> <span class="n">edges</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.get.wavelike.median_spectrum.name2color" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">name2color</span><span class="p">(</span><span class="n">name</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.get.wavelike.median_spectrum.name2color" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Return the 3-element RGB array of a given color name.</p>
<h4 id="chromatic.rainbows.get.wavelike.median_spectrum.name2color--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.get.wavelike.median_spectrum.name2color--parameters" title="Permanent link">#</a></h4>
<p>name : str
    The name of a color</p>
<h4 id="chromatic.rainbows.get.wavelike.median_spectrum.name2color--returns">Returns<a class="headerlink" href="#chromatic.rainbows.get.wavelike.median_spectrum.name2color--returns" title="Permanent link">#</a></h4>
<p>rgb : tuple
    3-element RGB color, with numbers from 0.0 to 1.0</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/imports.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">name2color</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return the 3-element RGB array of a given color name.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    name : str</span>
<span class="sd">        The name of a color</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    rgb : tuple</span>
<span class="sd">        3-element RGB color, with numbers from 0.0 to 1.0</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># give a friendly warning if the color name can&#39;t be found</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">color_hex</span> <span class="o">=</span> <span class="n">col</span><span class="o">.</span><span class="n">cnames</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">col</span><span class="o">.</span><span class="n">hex2color</span><span class="p">(</span><span class="n">color_hex</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="n">cheerfully_suggest</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The color </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> can&#39;t be found. (Returning black.)&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.get.wavelike.median_spectrum.one2another" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">one2another</span><span class="p">(</span><span class="n">bottom</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">alpha_bottom</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">alpha_top</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">256</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.get.wavelike.median_spectrum.one2another" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Create a cmap that goes smoothly (linearly in RGBA) from "bottom" to "top".</p>
<h4 id="chromatic.rainbows.get.wavelike.median_spectrum.one2another--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.get.wavelike.median_spectrum.one2another--parameters" title="Permanent link">#</a></h4>
<p>bottom : str
    Name of a color for the bottom of cmap (0.0)
top : str
    Name of a color for the top of the cmap (1.0)
alpha_bottom : float
    Opacity at the bottom of the cmap
alpha_top : float
    Opacitiy at the top of the cmap
N : int
    The number of levels in the listed color map</p>
<h4 id="chromatic.rainbows.get.wavelike.median_spectrum.one2another--returns">Returns<a class="headerlink" href="#chromatic.rainbows.get.wavelike.median_spectrum.one2another--returns" title="Permanent link">#</a></h4>
<p>cmap : Colormap
    A color map that goes linearly from the
    bottom to top color (and alpha).</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/imports.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">one2another</span><span class="p">(</span><span class="n">bottom</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">alpha_bottom</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">alpha_top</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">256</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a cmap that goes smoothly (linearly in RGBA) from &quot;bottom&quot; to &quot;top&quot;.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    bottom : str</span>
<span class="sd">        Name of a color for the bottom of cmap (0.0)</span>
<span class="sd">    top : str</span>
<span class="sd">        Name of a color for the top of the cmap (1.0)</span>
<span class="sd">    alpha_bottom : float</span>
<span class="sd">        Opacity at the bottom of the cmap</span>
<span class="sd">    alpha_top : float</span>
<span class="sd">        Opacitiy at the top of the cmap</span>
<span class="sd">    N : int</span>
<span class="sd">        The number of levels in the listed color map</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    cmap : Colormap</span>
<span class="sd">        A color map that goes linearly from the</span>
<span class="sd">        bottom to top color (and alpha).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># get the RGB values of the bottom and top of the cmap</span>
    <span class="n">rgb_bottom</span><span class="p">,</span> <span class="n">rgb_top</span> <span class="o">=</span> <span class="n">name2color</span><span class="p">(</span><span class="n">bottom</span><span class="p">),</span> <span class="n">name2color</span><span class="p">(</span><span class="n">top</span><span class="p">)</span>

    <span class="c1"># create linear gradients for all four RGBA channels</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">rgb_bottom</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">rgb_top</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">N</span><span class="p">)</span>
    <span class="n">g</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">rgb_bottom</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">rgb_top</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">N</span><span class="p">)</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">rgb_bottom</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">rgb_top</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">N</span><span class="p">)</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">alpha_bottom</span><span class="p">,</span> <span class="n">alpha_top</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>

    <span class="c1"># create (N,4) array + populate a listed colormap</span>
    <span class="n">colors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">]))</span>
    <span class="n">cmap</span> <span class="o">=</span> <span class="n">col</span><span class="o">.</span><span class="n">ListedColormap</span><span class="p">(</span><span class="n">colors</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{bottom}</span><span class="s2">2</span><span class="si">{top}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="nb">locals</span><span class="p">()))</span>

    <span class="c1"># return the colormap</span>
    <span class="k">return</span> <span class="n">cmap</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.get.wavelike.median_spectrum.remove_unit" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">remove_unit</span><span class="p">(</span><span class="n">x</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.get.wavelike.median_spectrum.remove_unit" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Quick wrapper to remove the unit from a quantity,
but not complain if it doesn't have one.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/imports.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">remove_unit</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Quick wrapper to remove the unit from a quantity,</span>
<span class="sd">    but not complain if it doesn&#39;t have one.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">x</span><span class="o">.</span><span class="n">value</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">x</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.get.wavelike.median_spectrum.resample_while_conserving_flux" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">resample_while_conserving_flux</span><span class="p">(</span><span class="n">xin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">yin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xout</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xin_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xout_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">replace_nans</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">visualize</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">pause</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.get.wavelike.median_spectrum.resample_while_conserving_flux" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Starting from some initial x and y, resample onto a
different grid (either higher or lower resolution),
while conserving total flux.</p>
<p>When including the entire range of <code>xin</code>,
<code>sum(yout) == sum(yin)</code> should be true.</p>
<p>When including only part of the range of <code>xin</code>,
the integral between any two points should be conserved.</p>
<h4 id="chromatic.rainbows.get.wavelike.median_spectrum.resample_while_conserving_flux--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.get.wavelike.median_spectrum.resample_while_conserving_flux--parameters" title="Permanent link">#</a></h4>
<p>xin : array
    The original independent variable.
yin : array
    The original dependent variable (same size as x).
xout : array
    The new grid of independent variables onto which
    you want to resample the y values. Refers to the
    center of each bin (use <code>xout_edges</code> for finer
    control over the exact edges of the bins)
xin_edges : array
    The edges of the original independent variable bins.
    The left and right edges of the bins are interpreted
    to be <code>xin_edges[:-1]</code> and <code>xin_edges[1:]</code>,
    respectively, so the associated <code>yin</code> should have exactly
    1 fewer element than <code>xin_edges</code>. This provides finer
    control over the size of each bin in the input than
    simply supplying <code>xin</code>(still a little experimental)
    They should probably be sorted?
xout_edges : array
    The edges of the new grid of bins for the independent
    variable, onto which you want to resample the y
    values. The left and right edges of the bins will be,
    respectively, <code>xout_edges[:-1]</code> and <code>xout_edges[1:]</code>,
    so the size of the output array will be
    <code>len(xout_edges) - 1</code>
replace_nans : float, str
    Replace nan values with this value.
    <code>replace_nans = 0</code>
        will add no flux where nans are
    <code>replace_nans = nan</code>
        will ensure you get nans returned everywhere
        if you try to resample over any nan
    <code>replace_nans = 'interpolate'</code>
        will try to replace nans by linearly interpolating
        from nearby values (not yet implemented)
visualize : bool
    Should we make a plot showing whether it worked?
pause : bool
    Should we pause to wait for a key press?</p>
<h4 id="chromatic.rainbows.get.wavelike.median_spectrum.resample_while_conserving_flux--returns">Returns<a class="headerlink" href="#chromatic.rainbows.get.wavelike.median_spectrum.resample_while_conserving_flux--returns" title="Permanent link">#</a></h4>
<p>result : dict
    A dictionary containing...
        <code>x</code> = the center of the output grid
        <code>y</code> = the resampled value on the output grid
        <code>edges</code> = the edges of the output grid, which will
            have one more element than x or y</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/tools/resampling.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">resample_while_conserving_flux</span><span class="p">(</span>
    <span class="n">xin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">yin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">xout</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">xin_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">xout_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">replace_nans</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
    <span class="n">visualize</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">pause</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Starting from some initial x and y, resample onto a</span>
<span class="sd">    different grid (either higher or lower resolution),</span>
<span class="sd">    while conserving total flux.</span>

<span class="sd">    When including the entire range of `xin`,</span>
<span class="sd">    `sum(yout) == sum(yin)` should be true.</span>

<span class="sd">    When including only part of the range of `xin`,</span>
<span class="sd">    the integral between any two points should be conserved.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    xin : array</span>
<span class="sd">        The original independent variable.</span>
<span class="sd">    yin : array</span>
<span class="sd">        The original dependent variable (same size as x).</span>
<span class="sd">    xout : array</span>
<span class="sd">        The new grid of independent variables onto which</span>
<span class="sd">        you want to resample the y values. Refers to the</span>
<span class="sd">        center of each bin (use `xout_edges` for finer</span>
<span class="sd">        control over the exact edges of the bins)</span>
<span class="sd">    xin_edges : array</span>
<span class="sd">        The edges of the original independent variable bins.</span>
<span class="sd">        The left and right edges of the bins are interpreted</span>
<span class="sd">        to be `xin_edges[:-1]` and `xin_edges[1:]`,</span>
<span class="sd">        respectively, so the associated `yin` should have exactly</span>
<span class="sd">        1 fewer element than `xin_edges`. This provides finer</span>
<span class="sd">        control over the size of each bin in the input than</span>
<span class="sd">        simply supplying `xin`(still a little experimental)</span>
<span class="sd">        They should probably be sorted?</span>
<span class="sd">    xout_edges : array</span>
<span class="sd">        The edges of the new grid of bins for the independent</span>
<span class="sd">        variable, onto which you want to resample the y</span>
<span class="sd">        values. The left and right edges of the bins will be,</span>
<span class="sd">        respectively, `xout_edges[:-1]` and `xout_edges[1:]`,</span>
<span class="sd">        so the size of the output array will be</span>
<span class="sd">        `len(xout_edges) - 1`</span>
<span class="sd">    replace_nans : float, str</span>
<span class="sd">        Replace nan values with this value.</span>
<span class="sd">        `replace_nans = 0`</span>
<span class="sd">            will add no flux where nans are</span>
<span class="sd">        `replace_nans = nan`</span>
<span class="sd">            will ensure you get nans returned everywhere</span>
<span class="sd">            if you try to resample over any nan</span>
<span class="sd">        `replace_nans = &#39;interpolate&#39;`</span>
<span class="sd">            will try to replace nans by linearly interpolating</span>
<span class="sd">            from nearby values (not yet implemented)</span>
<span class="sd">    visualize : bool</span>
<span class="sd">        Should we make a plot showing whether it worked?</span>
<span class="sd">    pause : bool</span>
<span class="sd">        Should we pause to wait for a key press?</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    result : dict</span>
<span class="sd">        A dictionary containing...</span>
<span class="sd">            `x` = the center of the output grid</span>
<span class="sd">            `y` = the resampled value on the output grid</span>
<span class="sd">            `edges` = the edges of the output grid, which will</span>
<span class="sd">                have one more element than x or y</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># make sure there are some reasonable input options</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">xin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">xin_edges</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">yin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">xout</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">xout_edges</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>

    <span class="c1"># set up the bins, to calculate cumulative distribution of y</span>
    <span class="k">if</span> <span class="n">xin_edges</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># make sure the sizes match up</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">xin</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">yin</span><span class="p">)</span>
        <span class="c1"># sort to make sure x is strictly increasing</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">xin</span><span class="p">)</span>
        <span class="n">xin_sorted</span> <span class="o">=</span> <span class="n">xin</span><span class="p">[</span><span class="n">s</span><span class="p">]</span>
        <span class="n">yin_sorted</span> <span class="o">=</span> <span class="n">yin</span><span class="p">[</span><span class="n">s</span><span class="p">]</span>
        <span class="c1"># estimate some bin edges (might fail for non-uniform grids)</span>
        <span class="n">xin_left</span><span class="p">,</span> <span class="n">xin_right</span> <span class="o">=</span> <span class="n">calculate_bin_leftright</span><span class="p">(</span><span class="n">xin_sorted</span><span class="p">)</span>
        <span class="c1"># define an array of edges</span>
        <span class="n">xin_edges</span> <span class="o">=</span> <span class="n">leftright_to_edges</span><span class="p">(</span><span class="n">xin_left</span><span class="p">,</span> <span class="n">xin_right</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># make sure the sizes match up</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">xin_edges</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">yin</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="c1"># sort to make sure x is strictly increasing</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">xin_edges</span><span class="p">)</span>
        <span class="n">xin_left</span><span class="p">,</span> <span class="n">xin_right</span> <span class="o">=</span> <span class="n">edges_to_leftright</span><span class="p">(</span><span class="n">xin_edges</span><span class="p">[</span><span class="n">s</span><span class="p">])</span>
        <span class="n">xin_sorted</span> <span class="o">=</span> <span class="p">(</span><span class="n">xin_left</span> <span class="o">+</span> <span class="n">xin_right</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">yin_sorted</span> <span class="o">=</span> <span class="n">yin</span><span class="p">[</span><span class="n">s</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>

    <span class="c1"># the first element should be the left edge of the first pixel</span>
    <span class="c1"># last element will be right edge of last pixel</span>
    <span class="n">xin_for_cdf</span> <span class="o">=</span> <span class="n">xin_edges</span>

    <span class="c1"># to the left of the first pixel, assume flux is zero</span>
    <span class="n">yin_for_cdf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">yin_sorted</span><span class="p">])</span>

    <span class="c1"># correct for any non-finite values</span>
    <span class="n">bad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">yin_for_cdf</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">replace_nans</span> <span class="o">==</span> <span class="s2">&quot;interpolate&quot;</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
            <span class="s2">&quot;The `replace_nans=&#39;interpolate&#39;`` option doens&#39;t exist yet!&quot;</span>
        <span class="p">)</span>
    <span class="n">yin_for_cdf</span><span class="p">[</span><span class="n">bad</span><span class="p">]</span> <span class="o">=</span> <span class="n">replace_nans</span>

    <span class="c1"># calculate the CDF of the flux (at pixel edge locations)</span>
    <span class="n">cdfin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">yin_for_cdf</span><span class="p">)</span>

    <span class="c1"># create an interpolator for that CDF</span>
    <span class="n">cdfinterpolator</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span>
        <span class="n">xin_for_cdf</span><span class="p">,</span>
        <span class="n">cdfin</span><span class="p">,</span>
        <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span>
        <span class="n">bounds_error</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">fill_value</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">yin</span><span class="p">)),</span>
    <span class="p">)</span>

    <span class="c1"># calculate bin edges (of size len(xout)+1)</span>
    <span class="k">if</span> <span class="n">xout_edges</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">xout_left</span><span class="p">,</span> <span class="n">xout_right</span> <span class="o">=</span> <span class="n">calculate_bin_leftright</span><span class="p">(</span><span class="n">xout</span><span class="p">)</span>
        <span class="n">xout_edges</span> <span class="o">=</span> <span class="n">leftright_to_edges</span><span class="p">(</span><span class="n">xout_left</span><span class="p">,</span> <span class="n">xout_right</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">xout_left</span><span class="p">,</span> <span class="n">xout_right</span> <span class="o">=</span> <span class="n">edges_to_leftright</span><span class="p">(</span><span class="n">xout_edges</span><span class="p">)</span>
        <span class="n">xout</span> <span class="o">=</span> <span class="p">(</span><span class="n">xout_left</span> <span class="o">+</span> <span class="n">xout_right</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>

    <span class="n">xout_for_cdf</span> <span class="o">=</span> <span class="n">leftright_to_edges</span><span class="p">(</span><span class="n">xout_left</span><span class="p">,</span> <span class="n">xout_right</span><span class="p">)</span>

    <span class="c1"># interpolate the CDF onto those bin edges</span>
    <span class="n">cdfout</span> <span class="o">=</span> <span class="n">cdfinterpolator</span><span class="p">(</span><span class="n">xout_for_cdf</span><span class="p">)</span>

    <span class="c1"># take  derivative of the CDF to get flux per resampled bin</span>
    <span class="c1"># (xout is bin center, and yout is the flux in that bin)</span>
    <span class="n">yout</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">cdfout</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">visualize</span><span class="p">:</span>
        <span class="n">fi</span><span class="p">,</span> <span class="p">(</span><span class="n">ax_cdf</span><span class="p">,</span> <span class="n">ax_pdf</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
        <span class="n">inkw</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
            <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span>
            <span class="n">markeredgecolor</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">outkw</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;darkorange&quot;</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span>
            <span class="n">markersize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
            <span class="n">markeredgecolor</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">legkw</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper left&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">xinbinsize</span> <span class="o">=</span> <span class="n">xin_right</span> <span class="o">-</span> <span class="n">xin_left</span>
        <span class="n">xoutbinsize</span> <span class="o">=</span> <span class="n">xout_right</span> <span class="o">-</span> <span class="n">xout_left</span>
        <span class="c1"># plot the PDFs</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="n">ax_pdf</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Flux per (Original) Pixel&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Pixel&quot;</span><span class="p">)</span>
        <span class="c1"># plot the original pixels (in df/dpixel to compare with resampled)</span>
        <span class="n">plot_as_boxes</span><span class="p">(</span>
            <span class="n">xin_sorted</span><span class="p">,</span> <span class="n">yin_sorted</span> <span class="o">/</span> <span class="n">xinbinsize</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Original Pixels&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">inkw</span>
        <span class="p">)</span>

        <span class="c1"># what would a bad interpolation look like?</span>
        <span class="n">interpolate_badly</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span>
            <span class="n">xin_sorted</span><span class="p">,</span>
            <span class="n">yin_sorted</span> <span class="o">/</span> <span class="n">xinbinsize</span><span class="p">,</span>
            <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span>
            <span class="n">bounds_error</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">fill_value</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
            <span class="n">xout</span><span class="p">,</span>
            <span class="n">interpolate_badly</span><span class="p">(</span><span class="n">xout</span><span class="p">),</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;cornflowerblue&quot;</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span>
            <span class="n">markersize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
            <span class="n">markeredgecolor</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Silly Simple Interpolation&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># plot the flux-conserving resampled data (again, in df/d&quot;pixel&quot;)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
            <span class="n">xout</span><span class="p">,</span> <span class="n">yout</span> <span class="o">/</span> <span class="n">xoutbinsize</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Flux-Conserving Interpolation&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">outkw</span>
        <span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="o">**</span><span class="n">legkw</span><span class="p">)</span>

        <span class="c1"># plot the CDFs</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="n">ax_cdf</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Cumulative Flux (from left)&quot;</span><span class="p">)</span>

        <span class="c1"># plot the original CDF</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xin_for_cdf</span><span class="p">,</span> <span class="n">cdfin</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Original Pixels&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">inkw</span><span class="p">)</span>

        <span class="c1"># plot the interpolated CDF</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xout_for_cdf</span><span class="p">,</span> <span class="n">cdfout</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Flux-Conserved Resample&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">outkw</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">pause</span><span class="p">:</span>
            <span class="n">a</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span>
                <span class="s2">&quot;Pausing a moment to check on interpolation; press return to continue.&quot;</span>
            <span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{:&gt;6}</span><span class="s2"> = </span><span class="si">{:.5f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;Actual&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">yin</span><span class="p">)))</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="s2">&quot;</span><span class="si">{:&gt;6}</span><span class="s2"> = </span><span class="si">{:.5f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="s2">&quot;Silly&quot;</span><span class="p">,</span>
                <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">interpolate_badly</span><span class="p">(</span><span class="n">xout</span><span class="p">)</span> <span class="o">*</span> <span class="n">xoutbinsize</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{:&gt;6}</span><span class="s2"> = </span><span class="si">{:.5f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;CDF&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">yout</span><span class="p">)))</span>

    <span class="c1"># return the resampled y-values</span>
    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="n">xout</span><span class="p">,</span> <span class="s2">&quot;x_edge_lower&quot;</span><span class="p">:</span> <span class="n">xout_left</span><span class="p">,</span> <span class="s2">&quot;x_edge_upper&quot;</span><span class="p">:</span> <span class="n">xout_right</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="n">yout</span><span class="p">}</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="chromatic.rainbows.get.wavelike.spectral_resolution"></a>
    <div class="doc doc-contents first">









  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.get.wavelike.spectral_resolution.bintoR" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">bintoR</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">unc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">R</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">weighting</span><span class="o">=</span><span class="s1">&#39;inversevariance&#39;</span><span class="p">,</span> <span class="n">drop_nans</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.get.wavelike.spectral_resolution.bintoR" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Bin any x and y array onto a logarithmicly uniform grid.</p>
<h4 id="chromatic.rainbows.get.wavelike.spectral_resolution.bintoR--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.get.wavelike.spectral_resolution.bintoR--parameters" title="Permanent link">#</a></h4>
<p>x : array
    The original independent variable.
    (For a spectrum example = wavelength)
y : array
    The original dependent variable (same size as x).
    (For a spectrum example = flux)
unc : array, None, optional
    The unceratinty on the dependent variable
    (For a spectrum example = the flux uncertainty)
R : array, optional
    The spectral resolution R=x/dx for creating a new,
    logarithmically uniform grid that starts at the first
    value of x.
xlim : list, array, optional
    A two-element list indicating the min and max values of
    x for the new logarithmically spaced grid. If None,
    these limits will be created from the data themselves
weighting : str, optional
    How should we weight values when averaging
    them together into one larger bin?
    <code>weighting = 'inversevariance'</code>
        weights = 1/unc**2
     <code>weighting = {literally anything else}</code>
        uniform weights
    This will have no impact if <code>unc == None</code>, or for any
    new bins that effectively overlap less than one original
    unbinned point.
drop_nans : bool, optional
    Should we skip any bins turn out to be nans?
    This most often happens when bins are empty.</p>
<h4 id="chromatic.rainbows.get.wavelike.spectral_resolution.bintoR--returns">Returns<a class="headerlink" href="#chromatic.rainbows.get.wavelike.spectral_resolution.bintoR--returns" title="Permanent link">#</a></h4>
<p>result : dict
    A dictionary containing at least...
        <code>x</code> = the center of the output grid
        <code>y</code> = the resampled value on the output grid
        <code>x_edge_lower</code> = the lower edges of the output grid
        <code>x_edge_upper</code> = the upper edges of the output grid
    ...and possibly also
        <code>uncertainty</code> = the calculated uncertainty per bin</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/tools/resampling.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">bintoR</span><span class="p">(</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">unc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">R</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">weighting</span><span class="o">=</span><span class="s2">&quot;inversevariance&quot;</span><span class="p">,</span> <span class="n">drop_nans</span><span class="o">=</span><span class="kc">True</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Bin any x and y array onto a logarithmicly uniform grid.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : array</span>
<span class="sd">        The original independent variable.</span>
<span class="sd">        (For a spectrum example = wavelength)</span>
<span class="sd">    y : array</span>
<span class="sd">        The original dependent variable (same size as x).</span>
<span class="sd">        (For a spectrum example = flux)</span>
<span class="sd">    unc : array, None, optional</span>
<span class="sd">        The unceratinty on the dependent variable</span>
<span class="sd">        (For a spectrum example = the flux uncertainty)</span>
<span class="sd">    R : array, optional</span>
<span class="sd">        The spectral resolution R=x/dx for creating a new,</span>
<span class="sd">        logarithmically uniform grid that starts at the first</span>
<span class="sd">        value of x.</span>
<span class="sd">    xlim : list, array, optional</span>
<span class="sd">        A two-element list indicating the min and max values of</span>
<span class="sd">        x for the new logarithmically spaced grid. If None,</span>
<span class="sd">        these limits will be created from the data themselves</span>
<span class="sd">    weighting : str, optional</span>
<span class="sd">        How should we weight values when averaging</span>
<span class="sd">        them together into one larger bin?</span>
<span class="sd">        `weighting = &#39;inversevariance&#39;`</span>
<span class="sd">            weights = 1/unc**2</span>
<span class="sd">         `weighting = {literally anything else}`</span>
<span class="sd">            uniform weights</span>
<span class="sd">        This will have no impact if `unc == None`, or for any</span>
<span class="sd">        new bins that effectively overlap less than one original</span>
<span class="sd">        unbinned point.</span>
<span class="sd">    drop_nans : bool, optional</span>
<span class="sd">        Should we skip any bins turn out to be nans?</span>
<span class="sd">        This most often happens when bins are empty.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    result : dict</span>
<span class="sd">        A dictionary containing at least...</span>
<span class="sd">            `x` = the center of the output grid</span>
<span class="sd">            `y` = the resampled value on the output grid</span>
<span class="sd">            `x_edge_lower` = the lower edges of the output grid</span>
<span class="sd">            `x_edge_upper` = the upper edges of the output grid</span>
<span class="sd">        ...and possibly also</span>
<span class="sd">            `uncertainty` = the calculated uncertainty per bin</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">x_unit</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">unit</span>
        <span class="n">x_without_unit</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">value</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="n">x_unit</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">x_without_unit</span> <span class="o">=</span> <span class="n">x</span>

    <span class="c1"># create a new grid of x at the given resolution</span>
    <span class="n">lnx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">x_without_unit</span><span class="p">)</span>
    <span class="n">dnewlnx</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">R</span>

    <span class="c1"># set the limits of the new xgrid (in log space)</span>
    <span class="k">if</span> <span class="n">xlim</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># use the input grid to set the limits</span>
        <span class="n">lnxbottom</span><span class="p">,</span> <span class="n">lnxtop</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">lnx</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">lnx</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># use the custom xlim to set the limits</span>
        <span class="n">lnxbottom</span><span class="p">,</span> <span class="n">lnxtop</span> <span class="o">=</span> <span class="n">xlim</span>

    <span class="c1"># create a new, log-uniform grid of x values</span>
    <span class="n">newlnx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">lnxbottom</span><span class="p">,</span> <span class="n">lnxtop</span> <span class="o">+</span> <span class="n">dnewlnx</span><span class="p">,</span> <span class="n">dnewlnx</span><span class="p">)</span>

    <span class="c1"># now do the binning on a uniform grid of lnx</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">bintogrid</span><span class="p">(</span>
        <span class="n">lnx</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">unc</span><span class="p">,</span> <span class="n">newx</span><span class="o">=</span><span class="n">newlnx</span><span class="p">,</span> <span class="n">weighting</span><span class="o">=</span><span class="n">weighting</span><span class="p">,</span> <span class="n">drop_nans</span><span class="o">=</span><span class="n">drop_nans</span>
    <span class="p">)</span>

    <span class="c1"># convert back from log to real values</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;x_edge_lower&quot;</span><span class="p">,</span> <span class="s2">&quot;x_edge_upper&quot;</span><span class="p">]:</span>
        <span class="n">result</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="o">*</span> <span class="n">x_unit</span>

    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.get.wavelike.spectral_resolution.bintogrid" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">bintogrid</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">unc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">newx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">newx_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">nx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">weighting</span><span class="o">=</span><span class="s1">&#39;inversevariance&#39;</span><span class="p">,</span> <span class="n">drop_nans</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">x_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">visualize</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.get.wavelike.spectral_resolution.bintogrid" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Bin any x and y array onto a linearly uniform grid.</p>
<h4 id="chromatic.rainbows.get.wavelike.spectral_resolution.bintogrid--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.get.wavelike.spectral_resolution.bintogrid--parameters" title="Permanent link">#</a></h4>
<p>x : array
    The original independent variable.
    (For a spectrum example = wavelength)
y : array
    The original dependent variable (same size as x).
    (For a spectrum example = flux)
unc : array, None
    The unceratinty on the dependent variable
    (For a spectrum example = the flux uncertainty)
nx : array
    The number of bins from the original grid to
    bin together into the new one.
dx : array
    The fixed spacing for creating a new, linearly uniform
    grid that start at the first value of x. This will
    be ignored if <code>newx</code> != None.
newx : array
    A new custom grid onto which we should bin.
newx_edges : array
    The edges of the new grid of bins for the independent
    variable, onto which you want to resample the y
    values. The left and right edges of the bins will be,
    respectively, <code>newx_edges[:-1]</code> and <code>newx_edges[1:]</code>,
    so the size of the output array will be
    <code>len(newx_edges) - 1</code>
weighting : str
    How should we weight values when averaging
    them together into one larger bin?
    <code>weighting = 'inversevariance'</code>
        weights = 1/unc**2
     <code>weighting = {literally anything else}</code>
        uniform weights
    This will have no impact if <code>unc == None</code>, or for any
    new bins that effectively overlap less than one original
    unbinned point.
drop_nans : bool
    Should we skip any bins turn out to be nans?
    This most often happens when bins are empty.
x_edges : array
    The edges of the original independent variable bins.
    The left and right edges of the bins are interpreted
    to be <code>x_edges[:-1]</code> and <code>x_edges[1:]</code>,
    respectively, so the associated <code>y</code> should have exactly
    1 fewer element than <code>x_edges</code>. This provides finer
    control over the size of each bin in the input than
    simply supplying <code>x</code>(still a little experimental)</p>
<h4 id="chromatic.rainbows.get.wavelike.spectral_resolution.bintogrid--returns">Returns<a class="headerlink" href="#chromatic.rainbows.get.wavelike.spectral_resolution.bintogrid--returns" title="Permanent link">#</a></h4>
<p>result : dict
    A dictionary containing at least...
        <code>x</code> = the center of the output grid
        <code>y</code> = the resampled value on the output grid
        <code>x_edge_lower</code> = the lower edges of the output grid
        <code>x_edge_upper</code> = the upper edges of the output grid
    ...and possibly also
        <code>uncertainty</code> = the calculated uncertainty per bin</p>
<p>The order of precendence for setting the new grid is
[<code>newx_edges</code>, <code>newx</code>, <code>dx</code>, <code>nx</code>]
The first will be used, and others will be ignored.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/tools/resampling.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">bintogrid</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">unc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">newx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">newx_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">dx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">nx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">weighting</span><span class="o">=</span><span class="s2">&quot;inversevariance&quot;</span><span class="p">,</span>
    <span class="n">drop_nans</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">x_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">visualize</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Bin any x and y array onto a linearly uniform grid.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : array</span>
<span class="sd">        The original independent variable.</span>
<span class="sd">        (For a spectrum example = wavelength)</span>
<span class="sd">    y : array</span>
<span class="sd">        The original dependent variable (same size as x).</span>
<span class="sd">        (For a spectrum example = flux)</span>
<span class="sd">    unc : array, None</span>
<span class="sd">        The unceratinty on the dependent variable</span>
<span class="sd">        (For a spectrum example = the flux uncertainty)</span>
<span class="sd">    nx : array</span>
<span class="sd">        The number of bins from the original grid to</span>
<span class="sd">        bin together into the new one.</span>
<span class="sd">    dx : array</span>
<span class="sd">        The fixed spacing for creating a new, linearly uniform</span>
<span class="sd">        grid that start at the first value of x. This will</span>
<span class="sd">        be ignored if `newx` != None.</span>
<span class="sd">    newx : array</span>
<span class="sd">        A new custom grid onto which we should bin.</span>
<span class="sd">    newx_edges : array</span>
<span class="sd">        The edges of the new grid of bins for the independent</span>
<span class="sd">        variable, onto which you want to resample the y</span>
<span class="sd">        values. The left and right edges of the bins will be,</span>
<span class="sd">        respectively, `newx_edges[:-1]` and `newx_edges[1:]`,</span>
<span class="sd">        so the size of the output array will be</span>
<span class="sd">        `len(newx_edges) - 1`</span>
<span class="sd">    weighting : str</span>
<span class="sd">        How should we weight values when averaging</span>
<span class="sd">        them together into one larger bin?</span>
<span class="sd">        `weighting = &#39;inversevariance&#39;`</span>
<span class="sd">            weights = 1/unc**2</span>
<span class="sd">         `weighting = {literally anything else}`</span>
<span class="sd">            uniform weights</span>
<span class="sd">        This will have no impact if `unc == None`, or for any</span>
<span class="sd">        new bins that effectively overlap less than one original</span>
<span class="sd">        unbinned point.</span>
<span class="sd">    drop_nans : bool</span>
<span class="sd">        Should we skip any bins turn out to be nans?</span>
<span class="sd">        This most often happens when bins are empty.</span>
<span class="sd">    x_edges : array</span>
<span class="sd">        The edges of the original independent variable bins.</span>
<span class="sd">        The left and right edges of the bins are interpreted</span>
<span class="sd">        to be `x_edges[:-1]` and `x_edges[1:]`,</span>
<span class="sd">        respectively, so the associated `y` should have exactly</span>
<span class="sd">        1 fewer element than `x_edges`. This provides finer</span>
<span class="sd">        control over the size of each bin in the input than</span>
<span class="sd">        simply supplying `x`(still a little experimental)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    result : dict</span>
<span class="sd">        A dictionary containing at least...</span>
<span class="sd">            `x` = the center of the output grid</span>
<span class="sd">            `y` = the resampled value on the output grid</span>
<span class="sd">            `x_edge_lower` = the lower edges of the output grid</span>
<span class="sd">            `x_edge_upper` = the upper edges of the output grid</span>
<span class="sd">        ...and possibly also</span>
<span class="sd">            `uncertainty` = the calculated uncertainty per bin</span>


<span class="sd">    The order of precendence for setting the new grid is</span>
<span class="sd">    [`newx_edges`, `newx`, `dx`, `nx`]</span>
<span class="sd">    The first will be used, and others will be ignored.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># check that an OK set of inputs has been supplied</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">x_edges</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;🌈 Both `x` and `x_edges` were supplied to `bintogrid`. Confusing!&quot;&quot;&quot;</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">x_edges</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;🌈 At least one of `x` or `x_edges` must be supplied to `bintogrid`.&quot;&quot;&quot;</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="n">y</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;🌈 `y` must be supplied to `bintogrid`.&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="c1"># make sure the edges and the centers are set</span>
    <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">x_left</span><span class="p">,</span> <span class="n">x_right</span> <span class="o">=</span> <span class="n">edges_to_leftright</span><span class="p">(</span><span class="n">x_edges</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">left</span> <span class="o">+</span> <span class="n">right</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">x_left</span><span class="p">,</span> <span class="n">x_right</span> <span class="o">=</span> <span class="n">calculate_bin_leftright</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">x_edges</span> <span class="o">=</span> <span class="n">leftright_to_edges</span><span class="p">(</span><span class="n">x_left</span><span class="p">,</span> <span class="n">x_right</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">x_unit</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">unit</span>
        <span class="n">x_without_unit</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">value</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="n">x_unit</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">x_without_unit</span> <span class="o">=</span> <span class="n">x</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">y_unit</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">unit</span>
        <span class="n">y_without_unit</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">value</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="n">y_unit</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">y_without_unit</span> <span class="o">=</span> <span class="n">y</span>

    <span class="c1"># warn if multiple inputs are provided</span>
    <span class="n">number_of_grid_options</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span><span class="n">z</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="p">[</span><span class="n">newx_edges</span><span class="p">,</span> <span class="n">newx</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">nx</span><span class="p">]])</span>
    <span class="k">if</span> <span class="n">number_of_grid_options</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">cheerfully_suggest</span><span class="p">(</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;More than one output grid sent to `bintogrid`.</span>
<span class="sd">                         The one being used is the first to appear in</span>
<span class="sd">                         [`newx_edges`, `newx`, `dx`, `nx`]</span>
<span class="sd">                         but you might want to choose more carefully.&quot;&quot;&quot;</span>
        <span class="p">)</span>

    <span class="c1"># define inputs based on the following order</span>
    <span class="k">if</span> <span class="n">newx_edges</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># define grid by its edges (and define others from there)</span>
        <span class="n">newx_edges_without_unit</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">newx_edges</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">x_unit</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
        <span class="n">dx_without_unit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">newx_edges_without_unit</span><span class="p">)</span>
        <span class="n">newx_without_unit</span> <span class="o">=</span> <span class="n">newx_edges_without_unit</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">dx_without_unit</span>
        <span class="n">newx_left_without_unit</span> <span class="o">=</span> <span class="n">newx_edges_without_unit</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">newx_right_without_unit</span> <span class="o">=</span> <span class="n">newx_edges_without_unit</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

        <span class="c1"># make sure the final output grid is defined</span>
        <span class="n">final_newx</span><span class="p">,</span> <span class="n">final_newx_left</span><span class="p">,</span> <span class="n">final_newx_right</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">newx_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
            <span class="n">newx_left_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
            <span class="n">newx_right_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="n">newx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># define grid by its centers (and define others from there)</span>
        <span class="n">newx_without_unit</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">newx</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">x_unit</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
        <span class="n">newx_left_without_unit</span><span class="p">,</span> <span class="n">newx_right_without_unit</span> <span class="o">=</span> <span class="n">calculate_bin_leftright</span><span class="p">(</span>
            <span class="n">newx_without_unit</span>
        <span class="p">)</span>
        <span class="n">newx_edges_without_unit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span>
            <span class="p">[</span><span class="n">newx_left_without_unit</span><span class="p">,</span> <span class="n">newx_right_without_unit</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
        <span class="p">)</span>
        <span class="n">dx_without_unit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">newx_edges_without_unit</span><span class="p">)</span>

        <span class="c1"># make sure the final output grid is defined</span>
        <span class="n">final_newx</span><span class="p">,</span> <span class="n">final_newx_left</span><span class="p">,</span> <span class="n">final_newx_right</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">newx_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
            <span class="n">newx_left_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
            <span class="n">newx_right_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="n">dx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># define grid by a bin width (and define others from there)</span>
        <span class="n">dx_without_unit</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">dx</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">x_unit</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
        <span class="n">newx_without_unit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">x_without_unit</span><span class="p">),</span>
            <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">x_without_unit</span><span class="p">)</span> <span class="o">+</span> <span class="n">dx_without_unit</span><span class="p">,</span>
            <span class="n">dx_without_unit</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">newx_left_without_unit</span><span class="p">,</span> <span class="n">newx_right_without_unit</span> <span class="o">=</span> <span class="n">calculate_bin_leftright</span><span class="p">(</span>
            <span class="n">newx_without_unit</span>
        <span class="p">)</span>
        <span class="n">newx_edges_without_unit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span>
            <span class="p">[</span><span class="n">newx_left_without_unit</span><span class="p">,</span> <span class="n">newx_right_without_unit</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
        <span class="p">)</span>

        <span class="c1"># make sure the final output grid is defined</span>
        <span class="n">final_newx</span><span class="p">,</span> <span class="n">final_newx_left</span><span class="p">,</span> <span class="n">final_newx_right</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">newx_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
            <span class="n">newx_left_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
            <span class="n">newx_right_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">elif</span> <span class="n">nx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># keep track of the original input x values</span>
        <span class="n">original_x_without_unit</span> <span class="o">=</span> <span class="n">x_without_unit</span>

        <span class="c1"># redefine the input x to indices, to do interpolation in index space</span>
        <span class="n">x_without_unit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">x_without_unit</span><span class="p">))</span>

        <span class="c1"># define a grid of edges that will enclose the right number of indices</span>
        <span class="n">x_left_i</span><span class="p">,</span> <span class="n">x_right_i</span> <span class="o">=</span> <span class="n">calculate_bin_leftright</span><span class="p">(</span><span class="n">x_without_unit</span><span class="p">)</span>
        <span class="n">newx_edges_without_unit</span> <span class="o">=</span> <span class="n">leftright_to_edges</span><span class="p">(</span><span class="n">x_left_i</span><span class="p">,</span> <span class="n">x_right_i</span><span class="p">)[::</span><span class="n">nx</span><span class="p">]</span>
        <span class="n">newx_without_unit</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span>
            <span class="n">newx_edges_without_unit</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">+</span> <span class="n">newx_edges_without_unit</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="p">)</span>

        <span class="c1"># calculate the actual x values corresponding to the bins</span>
        <span class="n">original_edges</span> <span class="o">=</span> <span class="n">leftright_to_edges</span><span class="p">(</span>
            <span class="o">*</span><span class="n">calculate_bin_leftright</span><span class="p">(</span><span class="n">original_x_without_unit</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">final_edges</span> <span class="o">=</span> <span class="n">original_edges</span><span class="p">[::</span><span class="n">nx</span><span class="p">]</span> <span class="o">*</span> <span class="n">x_unit</span>
        <span class="n">final_newx_left</span><span class="p">,</span> <span class="n">final_newx_right</span> <span class="o">=</span> <span class="n">edges_to_leftright</span><span class="p">(</span><span class="n">final_edges</span><span class="p">)</span>
        <span class="n">final_newx</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">final_newx_left</span> <span class="o">+</span> <span class="n">final_newx_right</span><span class="p">)</span>
        <span class="n">dx_without_unit</span> <span class="o">=</span> <span class="p">(</span><span class="n">final_newx_right</span> <span class="o">-</span> <span class="n">final_newx_left</span><span class="p">)</span> <span class="o">/</span> <span class="n">x_unit</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;No output grid sent to `bintogrid`.</span>
<span class="sd">                              Please choose one of the following:</span>
<span class="sd">                              [`newx_edges`, `newx`, `dx`, `nx`]&quot;&quot;&quot;</span>
        <span class="p">)</span>

    <span class="c1"># don&#39;t complain about zero-divisions in here (to allow infinite uncertainties)</span>
    <span class="k">with</span> <span class="n">np</span><span class="o">.</span><span class="n">errstate</span><span class="p">(</span><span class="n">divide</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">invalid</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">):</span>

        <span class="c1"># calculate weight integrals for the bin array</span>
        <span class="n">ok</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">y_without_unit</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span>

        <span class="c1"># resample the sums onto that new grid</span>
        <span class="k">if</span> <span class="n">unc</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">x_without_unit</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">weighting</span> <span class="o">==</span> <span class="s2">&quot;inversevariance&quot;</span><span class="p">:</span>
                <span class="n">weights</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">unc</span><span class="o">**</span><span class="mi">2</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">x_without_unit</span><span class="p">)</span>

            <span class="c1"># ignore infinite weights (= 0 uncertainties)</span>
            <span class="n">ok</span> <span class="o">*=</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">ok</span><span class="p">):</span>
            <span class="n">numerator</span> <span class="o">=</span> <span class="n">resample_while_conserving_flux</span><span class="p">(</span>
                <span class="n">xin</span><span class="o">=</span><span class="n">x_without_unit</span><span class="p">[</span><span class="n">ok</span><span class="p">],</span>
                <span class="n">yin</span><span class="o">=</span><span class="p">(</span><span class="n">y_without_unit</span> <span class="o">*</span> <span class="n">weights</span><span class="p">)[</span><span class="n">ok</span><span class="p">],</span>
                <span class="n">xout_edges</span><span class="o">=</span><span class="n">newx_edges_without_unit</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">denominator</span> <span class="o">=</span> <span class="n">resample_while_conserving_flux</span><span class="p">(</span>
                <span class="n">xin</span><span class="o">=</span><span class="n">x_without_unit</span><span class="p">[</span><span class="n">ok</span><span class="p">],</span>
                <span class="n">yin</span><span class="o">=</span><span class="n">weights</span><span class="p">[</span><span class="n">ok</span><span class="p">],</span>
                <span class="n">xout_edges</span><span class="o">=</span><span class="n">newx_edges_without_unit</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="c1"># the binned weighted means on the new grid</span>
            <span class="n">newy</span> <span class="o">=</span> <span class="n">numerator</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">denominator</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span>

            <span class="c1"># the standard error on the means, for those bins</span>
            <span class="n">newunc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">denominator</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">])</span>

            <span class="c1"># keep track of the number of original bins going into each new bin</span>
            <span class="n">number_of_original_bins_per_new_bin</span> <span class="o">=</span> <span class="n">resample_while_conserving_flux</span><span class="p">(</span>
                <span class="n">xin</span><span class="o">=</span><span class="n">x_without_unit</span><span class="p">[</span><span class="n">ok</span><span class="p">],</span>
                <span class="n">yin</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">y_without_unit</span><span class="p">)[</span><span class="n">ok</span><span class="p">],</span>
                <span class="n">xout_edges</span><span class="o">=</span><span class="n">newx_edges_without_unit</span><span class="p">,</span>
            <span class="p">)[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">newy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="o">*</span> <span class="n">newx_without_unit</span>
            <span class="n">newunc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="o">*</span> <span class="n">newx_without_unit</span>
            <span class="n">number_of_original_bins_per_new_bin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">newx_without_unit</span><span class="p">)</span>

    <span class="c1"># remove any empty bins</span>
    <span class="k">if</span> <span class="n">drop_nans</span><span class="p">:</span>
        <span class="n">ok</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">newy</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ok</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">newx_without_unit</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>

    <span class="c1"># if no uncertainties were given, don&#39;t return uncertainties</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># populate the new grid centers + edges + values</span>
    <span class="n">result</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">final_newx</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span>
    <span class="n">result</span><span class="p">[</span><span class="s2">&quot;x_edge_lower&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">final_newx_left</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span>
    <span class="n">result</span><span class="p">[</span><span class="s2">&quot;x_edge_upper&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">final_newx_right</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span>

    <span class="c1"># populate the new grid values</span>
    <span class="n">result</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">newy</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span> <span class="o">*</span> <span class="n">y_unit</span>

    <span class="c1"># populate the new grid value uncertainties</span>
    <span class="k">if</span> <span class="n">unc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">result</span><span class="p">[</span><span class="s2">&quot;uncertainty&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">newunc</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span> <span class="o">*</span> <span class="n">y_unit</span>

    <span class="c1"># store how many of the original pixels made it into this new one</span>
    <span class="n">result</span><span class="p">[</span><span class="s2">&quot;N_unbinned/N_binned&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">number_of_original_bins_per_new_bin</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">visualize</span><span class="p">:</span>
        <span class="n">fi</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span>
            <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">gridspec_kw</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">height_ratios</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">])</span>
        <span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">plot_as_boxes</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">xleft</span><span class="o">=</span><span class="n">x_left</span><span class="p">,</span> <span class="n">xright</span><span class="o">=</span><span class="n">x_right</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;silver&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">ekw</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">elinewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">unc</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;silver&quot;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">ekw</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">],</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">],</span>
            <span class="n">yerr</span><span class="o">=</span><span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;uncertainty&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
            <span class="n">xerr</span><span class="o">=</span><span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s2">&quot;x_edge_upper&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;x_edge_lower&quot;</span><span class="p">])</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
            <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
            <span class="n">zorder</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
            <span class="o">**</span><span class="n">ekw</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">plot_as_boxes</span><span class="p">(</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">],</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;N_unbinned/N_binned&quot;</span><span class="p">],</span>
            <span class="n">xleft</span><span class="o">=</span><span class="n">result</span><span class="p">[</span><span class="s2">&quot;x_edge_lower&quot;</span><span class="p">],</span>
            <span class="n">xright</span><span class="o">=</span><span class="n">result</span><span class="p">[</span><span class="s2">&quot;x_edge_upper&quot;</span><span class="p">],</span>
        <span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;$N_</span><span class="si">{unbinned}</span><span class="s2">/N_</span><span class="si">{binned}</span><span class="s2">$&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.get.wavelike.spectral_resolution.calculate_bin_leftright" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">calculate_bin_leftright</span><span class="p">(</span><span class="n">x</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.get.wavelike.spectral_resolution.calculate_bin_leftright" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>If x is an array of bin centers, calculate the bin edges.
(assumes outermost bins are same size as their neighbors)</p>
<h4 id="chromatic.rainbows.get.wavelike.spectral_resolution.calculate_bin_leftright--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.get.wavelike.spectral_resolution.calculate_bin_leftright--parameters" title="Permanent link">#</a></h4>
<p>x : array
    The array of bin centers.</p>
<h4 id="chromatic.rainbows.get.wavelike.spectral_resolution.calculate_bin_leftright--returns">Returns<a class="headerlink" href="#chromatic.rainbows.get.wavelike.spectral_resolution.calculate_bin_leftright--returns" title="Permanent link">#</a></h4>
<p>l : array
    The left edges of the bins.
r : array
    The right edges of the bins.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/tools/resampling.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">calculate_bin_leftright</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    If x is an array of bin centers, calculate the bin edges.</span>
<span class="sd">    (assumes outermost bins are same size as their neighbors)</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : array</span>
<span class="sd">        The array of bin centers.</span>

<span class="sd">    Returns</span>
<span class="sd">    ----------</span>
<span class="sd">    l : array</span>
<span class="sd">        The left edges of the bins.</span>
<span class="sd">    r : array</span>
<span class="sd">        The right edges of the bins.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># what are bin edges (making a guess for those on the ends)</span>
    <span class="c1"># xbinsize = calculate_bin_widths(x)</span>
    <span class="c1"># left = x - xbinsize / 2.0</span>
    <span class="c1"># right = x + xbinsize / 2.0</span>

    <span class="c1"># weird corner case!</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">left</span><span class="p">,</span> <span class="n">right</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">left</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">right</span><span class="p">])</span>

    <span class="n">inner_edges</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="n">x</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">first_edge</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="n">inner_edges</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">last_edge</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">inner_edges</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

    <span class="n">left</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">first_edge</span><span class="p">,</span> <span class="n">inner_edges</span><span class="p">])</span>
    <span class="n">right</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">inner_edges</span><span class="p">,</span> <span class="n">last_edge</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.get.wavelike.spectral_resolution.edges_to_leftright" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">edges_to_leftright</span><span class="p">(</span><span class="n">edges</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.get.wavelike.spectral_resolution.edges_to_leftright" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Convert N+1 contiguous edges to two arrays of N left/right edges.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/tools/resampling.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">edges_to_leftright</span><span class="p">(</span><span class="n">edges</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert N+1 contiguous edges to two arrays of N left/right edges.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">left</span><span class="p">,</span> <span class="n">right</span> <span class="o">=</span> <span class="n">edges</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">edges</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="k">return</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.get.wavelike.spectral_resolution.expand_filenames" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">expand_filenames</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.get.wavelike.spectral_resolution.expand_filenames" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>A wrapper to expand a string or list into a list of filenames.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/imports.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">expand_filenames</span><span class="p">(</span><span class="n">filepath</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A wrapper to expand a string or list into a list of filenames.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
        <span class="n">filenames</span> <span class="o">=</span> <span class="n">filepath</span>
    <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span> <span class="o">==</span> <span class="n">Column</span><span class="p">:</span>
        <span class="n">filenames</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>
    <span class="k">elif</span> <span class="s2">&quot;*&quot;</span> <span class="ow">in</span> <span class="n">filepath</span><span class="p">:</span>
        <span class="n">filenames</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">filepath</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">filenames</span> <span class="o">=</span> <span class="p">[</span><span class="n">filepath</span><span class="p">]</span>
    <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">filenames</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.get.wavelike.spectral_resolution.get_spectral_resolution" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_spectral_resolution</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pixels_per_resolution_element</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.get.wavelike.spectral_resolution.get_spectral_resolution" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Estimate the R=w/dw spectral resolution.</p>
<p>Higher spectral resolutions correspond to more wavelength
points within a particular interval. By default, it's
estimated for the interval between adjacent wavelength
bins. In unbinned data coming directly from a telescope,
there's a good chance that adjacent pixels both sample
the same resolution element as blurred by the telescope
optics, so the <code>pixels_per_resolution_element</code> keyword
should likely be larger than 1.</p>
<h4 id="chromatic.rainbows.get.wavelike.spectral_resolution.get_spectral_resolution--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.get.wavelike.spectral_resolution.get_spectral_resolution--parameters" title="Permanent link">#</a></h4>
<p>pixels_per_resolution_element : float, optional
    How many pixels do we consider as a resolution element?</p>
<h4 id="chromatic.rainbows.get.wavelike.spectral_resolution.get_spectral_resolution--returns">Returns<a class="headerlink" href="#chromatic.rainbows.get.wavelike.spectral_resolution.get_spectral_resolution--returns" title="Permanent link">#</a></h4>
<p>R : array
    The spectral resolution at each wavelength.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/rainbows/get/wavelike/spectral_resolution.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_spectral_resolution</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pixels_per_resolution_element</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Estimate the R=w/dw spectral resolution.</span>

<span class="sd">    Higher spectral resolutions correspond to more wavelength</span>
<span class="sd">    points within a particular interval. By default, it&#39;s</span>
<span class="sd">    estimated for the interval between adjacent wavelength</span>
<span class="sd">    bins. In unbinned data coming directly from a telescope,</span>
<span class="sd">    there&#39;s a good chance that adjacent pixels both sample</span>
<span class="sd">    the same resolution element as blurred by the telescope</span>
<span class="sd">    optics, so the `pixels_per_resolution_element` keyword</span>
<span class="sd">    should likely be larger than 1.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    pixels_per_resolution_element : float, optional</span>
<span class="sd">        How many pixels do we consider as a resolution element?</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    R : array</span>
<span class="sd">        The spectral resolution at each wavelength.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># calculate spectral resolution, for this pixels/element</span>
    <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wavelength</span>
    <span class="n">dw</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">gradient</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wavelength</span><span class="p">)</span>
    <span class="n">R</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">w</span> <span class="o">/</span> <span class="n">dw</span> <span class="o">/</span> <span class="n">pixels_per_resolution_element</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">R</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.get.wavelike.spectral_resolution.leftright_to_edges" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">leftright_to_edges</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.get.wavelike.spectral_resolution.leftright_to_edges" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Convert two arrays of N left/right edges to N+1 continugous edges.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/tools/resampling.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">leftright_to_edges</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert two arrays of N left/right edges to N+1 continugous edges.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">edges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>
    <span class="k">return</span> <span class="n">edges</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.get.wavelike.spectral_resolution.name2color" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">name2color</span><span class="p">(</span><span class="n">name</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.get.wavelike.spectral_resolution.name2color" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Return the 3-element RGB array of a given color name.</p>
<h4 id="chromatic.rainbows.get.wavelike.spectral_resolution.name2color--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.get.wavelike.spectral_resolution.name2color--parameters" title="Permanent link">#</a></h4>
<p>name : str
    The name of a color</p>
<h4 id="chromatic.rainbows.get.wavelike.spectral_resolution.name2color--returns">Returns<a class="headerlink" href="#chromatic.rainbows.get.wavelike.spectral_resolution.name2color--returns" title="Permanent link">#</a></h4>
<p>rgb : tuple
    3-element RGB color, with numbers from 0.0 to 1.0</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/imports.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">name2color</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return the 3-element RGB array of a given color name.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    name : str</span>
<span class="sd">        The name of a color</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    rgb : tuple</span>
<span class="sd">        3-element RGB color, with numbers from 0.0 to 1.0</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># give a friendly warning if the color name can&#39;t be found</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">color_hex</span> <span class="o">=</span> <span class="n">col</span><span class="o">.</span><span class="n">cnames</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">col</span><span class="o">.</span><span class="n">hex2color</span><span class="p">(</span><span class="n">color_hex</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="n">cheerfully_suggest</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The color </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> can&#39;t be found. (Returning black.)&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.get.wavelike.spectral_resolution.one2another" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">one2another</span><span class="p">(</span><span class="n">bottom</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">alpha_bottom</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">alpha_top</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">256</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.get.wavelike.spectral_resolution.one2another" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Create a cmap that goes smoothly (linearly in RGBA) from "bottom" to "top".</p>
<h4 id="chromatic.rainbows.get.wavelike.spectral_resolution.one2another--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.get.wavelike.spectral_resolution.one2another--parameters" title="Permanent link">#</a></h4>
<p>bottom : str
    Name of a color for the bottom of cmap (0.0)
top : str
    Name of a color for the top of the cmap (1.0)
alpha_bottom : float
    Opacity at the bottom of the cmap
alpha_top : float
    Opacitiy at the top of the cmap
N : int
    The number of levels in the listed color map</p>
<h4 id="chromatic.rainbows.get.wavelike.spectral_resolution.one2another--returns">Returns<a class="headerlink" href="#chromatic.rainbows.get.wavelike.spectral_resolution.one2another--returns" title="Permanent link">#</a></h4>
<p>cmap : Colormap
    A color map that goes linearly from the
    bottom to top color (and alpha).</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/imports.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">one2another</span><span class="p">(</span><span class="n">bottom</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">alpha_bottom</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">alpha_top</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">256</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a cmap that goes smoothly (linearly in RGBA) from &quot;bottom&quot; to &quot;top&quot;.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    bottom : str</span>
<span class="sd">        Name of a color for the bottom of cmap (0.0)</span>
<span class="sd">    top : str</span>
<span class="sd">        Name of a color for the top of the cmap (1.0)</span>
<span class="sd">    alpha_bottom : float</span>
<span class="sd">        Opacity at the bottom of the cmap</span>
<span class="sd">    alpha_top : float</span>
<span class="sd">        Opacitiy at the top of the cmap</span>
<span class="sd">    N : int</span>
<span class="sd">        The number of levels in the listed color map</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    cmap : Colormap</span>
<span class="sd">        A color map that goes linearly from the</span>
<span class="sd">        bottom to top color (and alpha).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># get the RGB values of the bottom and top of the cmap</span>
    <span class="n">rgb_bottom</span><span class="p">,</span> <span class="n">rgb_top</span> <span class="o">=</span> <span class="n">name2color</span><span class="p">(</span><span class="n">bottom</span><span class="p">),</span> <span class="n">name2color</span><span class="p">(</span><span class="n">top</span><span class="p">)</span>

    <span class="c1"># create linear gradients for all four RGBA channels</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">rgb_bottom</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">rgb_top</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">N</span><span class="p">)</span>
    <span class="n">g</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">rgb_bottom</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">rgb_top</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">N</span><span class="p">)</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">rgb_bottom</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">rgb_top</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">N</span><span class="p">)</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">alpha_bottom</span><span class="p">,</span> <span class="n">alpha_top</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>

    <span class="c1"># create (N,4) array + populate a listed colormap</span>
    <span class="n">colors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">]))</span>
    <span class="n">cmap</span> <span class="o">=</span> <span class="n">col</span><span class="o">.</span><span class="n">ListedColormap</span><span class="p">(</span><span class="n">colors</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{bottom}</span><span class="s2">2</span><span class="si">{top}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="nb">locals</span><span class="p">()))</span>

    <span class="c1"># return the colormap</span>
    <span class="k">return</span> <span class="n">cmap</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.get.wavelike.spectral_resolution.remove_unit" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">remove_unit</span><span class="p">(</span><span class="n">x</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.get.wavelike.spectral_resolution.remove_unit" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Quick wrapper to remove the unit from a quantity,
but not complain if it doesn't have one.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/imports.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">remove_unit</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Quick wrapper to remove the unit from a quantity,</span>
<span class="sd">    but not complain if it doesn&#39;t have one.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">x</span><span class="o">.</span><span class="n">value</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">x</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.get.wavelike.spectral_resolution.resample_while_conserving_flux" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">resample_while_conserving_flux</span><span class="p">(</span><span class="n">xin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">yin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xout</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xin_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xout_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">replace_nans</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">visualize</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">pause</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.get.wavelike.spectral_resolution.resample_while_conserving_flux" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Starting from some initial x and y, resample onto a
different grid (either higher or lower resolution),
while conserving total flux.</p>
<p>When including the entire range of <code>xin</code>,
<code>sum(yout) == sum(yin)</code> should be true.</p>
<p>When including only part of the range of <code>xin</code>,
the integral between any two points should be conserved.</p>
<h4 id="chromatic.rainbows.get.wavelike.spectral_resolution.resample_while_conserving_flux--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.get.wavelike.spectral_resolution.resample_while_conserving_flux--parameters" title="Permanent link">#</a></h4>
<p>xin : array
    The original independent variable.
yin : array
    The original dependent variable (same size as x).
xout : array
    The new grid of independent variables onto which
    you want to resample the y values. Refers to the
    center of each bin (use <code>xout_edges</code> for finer
    control over the exact edges of the bins)
xin_edges : array
    The edges of the original independent variable bins.
    The left and right edges of the bins are interpreted
    to be <code>xin_edges[:-1]</code> and <code>xin_edges[1:]</code>,
    respectively, so the associated <code>yin</code> should have exactly
    1 fewer element than <code>xin_edges</code>. This provides finer
    control over the size of each bin in the input than
    simply supplying <code>xin</code>(still a little experimental)
    They should probably be sorted?
xout_edges : array
    The edges of the new grid of bins for the independent
    variable, onto which you want to resample the y
    values. The left and right edges of the bins will be,
    respectively, <code>xout_edges[:-1]</code> and <code>xout_edges[1:]</code>,
    so the size of the output array will be
    <code>len(xout_edges) - 1</code>
replace_nans : float, str
    Replace nan values with this value.
    <code>replace_nans = 0</code>
        will add no flux where nans are
    <code>replace_nans = nan</code>
        will ensure you get nans returned everywhere
        if you try to resample over any nan
    <code>replace_nans = 'interpolate'</code>
        will try to replace nans by linearly interpolating
        from nearby values (not yet implemented)
visualize : bool
    Should we make a plot showing whether it worked?
pause : bool
    Should we pause to wait for a key press?</p>
<h4 id="chromatic.rainbows.get.wavelike.spectral_resolution.resample_while_conserving_flux--returns">Returns<a class="headerlink" href="#chromatic.rainbows.get.wavelike.spectral_resolution.resample_while_conserving_flux--returns" title="Permanent link">#</a></h4>
<p>result : dict
    A dictionary containing...
        <code>x</code> = the center of the output grid
        <code>y</code> = the resampled value on the output grid
        <code>edges</code> = the edges of the output grid, which will
            have one more element than x or y</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/tools/resampling.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">resample_while_conserving_flux</span><span class="p">(</span>
    <span class="n">xin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">yin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">xout</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">xin_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">xout_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">replace_nans</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
    <span class="n">visualize</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">pause</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Starting from some initial x and y, resample onto a</span>
<span class="sd">    different grid (either higher or lower resolution),</span>
<span class="sd">    while conserving total flux.</span>

<span class="sd">    When including the entire range of `xin`,</span>
<span class="sd">    `sum(yout) == sum(yin)` should be true.</span>

<span class="sd">    When including only part of the range of `xin`,</span>
<span class="sd">    the integral between any two points should be conserved.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    xin : array</span>
<span class="sd">        The original independent variable.</span>
<span class="sd">    yin : array</span>
<span class="sd">        The original dependent variable (same size as x).</span>
<span class="sd">    xout : array</span>
<span class="sd">        The new grid of independent variables onto which</span>
<span class="sd">        you want to resample the y values. Refers to the</span>
<span class="sd">        center of each bin (use `xout_edges` for finer</span>
<span class="sd">        control over the exact edges of the bins)</span>
<span class="sd">    xin_edges : array</span>
<span class="sd">        The edges of the original independent variable bins.</span>
<span class="sd">        The left and right edges of the bins are interpreted</span>
<span class="sd">        to be `xin_edges[:-1]` and `xin_edges[1:]`,</span>
<span class="sd">        respectively, so the associated `yin` should have exactly</span>
<span class="sd">        1 fewer element than `xin_edges`. This provides finer</span>
<span class="sd">        control over the size of each bin in the input than</span>
<span class="sd">        simply supplying `xin`(still a little experimental)</span>
<span class="sd">        They should probably be sorted?</span>
<span class="sd">    xout_edges : array</span>
<span class="sd">        The edges of the new grid of bins for the independent</span>
<span class="sd">        variable, onto which you want to resample the y</span>
<span class="sd">        values. The left and right edges of the bins will be,</span>
<span class="sd">        respectively, `xout_edges[:-1]` and `xout_edges[1:]`,</span>
<span class="sd">        so the size of the output array will be</span>
<span class="sd">        `len(xout_edges) - 1`</span>
<span class="sd">    replace_nans : float, str</span>
<span class="sd">        Replace nan values with this value.</span>
<span class="sd">        `replace_nans = 0`</span>
<span class="sd">            will add no flux where nans are</span>
<span class="sd">        `replace_nans = nan`</span>
<span class="sd">            will ensure you get nans returned everywhere</span>
<span class="sd">            if you try to resample over any nan</span>
<span class="sd">        `replace_nans = &#39;interpolate&#39;`</span>
<span class="sd">            will try to replace nans by linearly interpolating</span>
<span class="sd">            from nearby values (not yet implemented)</span>
<span class="sd">    visualize : bool</span>
<span class="sd">        Should we make a plot showing whether it worked?</span>
<span class="sd">    pause : bool</span>
<span class="sd">        Should we pause to wait for a key press?</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    result : dict</span>
<span class="sd">        A dictionary containing...</span>
<span class="sd">            `x` = the center of the output grid</span>
<span class="sd">            `y` = the resampled value on the output grid</span>
<span class="sd">            `edges` = the edges of the output grid, which will</span>
<span class="sd">                have one more element than x or y</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># make sure there are some reasonable input options</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">xin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">xin_edges</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">yin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">xout</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">xout_edges</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>

    <span class="c1"># set up the bins, to calculate cumulative distribution of y</span>
    <span class="k">if</span> <span class="n">xin_edges</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># make sure the sizes match up</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">xin</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">yin</span><span class="p">)</span>
        <span class="c1"># sort to make sure x is strictly increasing</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">xin</span><span class="p">)</span>
        <span class="n">xin_sorted</span> <span class="o">=</span> <span class="n">xin</span><span class="p">[</span><span class="n">s</span><span class="p">]</span>
        <span class="n">yin_sorted</span> <span class="o">=</span> <span class="n">yin</span><span class="p">[</span><span class="n">s</span><span class="p">]</span>
        <span class="c1"># estimate some bin edges (might fail for non-uniform grids)</span>
        <span class="n">xin_left</span><span class="p">,</span> <span class="n">xin_right</span> <span class="o">=</span> <span class="n">calculate_bin_leftright</span><span class="p">(</span><span class="n">xin_sorted</span><span class="p">)</span>
        <span class="c1"># define an array of edges</span>
        <span class="n">xin_edges</span> <span class="o">=</span> <span class="n">leftright_to_edges</span><span class="p">(</span><span class="n">xin_left</span><span class="p">,</span> <span class="n">xin_right</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># make sure the sizes match up</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">xin_edges</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">yin</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="c1"># sort to make sure x is strictly increasing</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">xin_edges</span><span class="p">)</span>
        <span class="n">xin_left</span><span class="p">,</span> <span class="n">xin_right</span> <span class="o">=</span> <span class="n">edges_to_leftright</span><span class="p">(</span><span class="n">xin_edges</span><span class="p">[</span><span class="n">s</span><span class="p">])</span>
        <span class="n">xin_sorted</span> <span class="o">=</span> <span class="p">(</span><span class="n">xin_left</span> <span class="o">+</span> <span class="n">xin_right</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">yin_sorted</span> <span class="o">=</span> <span class="n">yin</span><span class="p">[</span><span class="n">s</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>

    <span class="c1"># the first element should be the left edge of the first pixel</span>
    <span class="c1"># last element will be right edge of last pixel</span>
    <span class="n">xin_for_cdf</span> <span class="o">=</span> <span class="n">xin_edges</span>

    <span class="c1"># to the left of the first pixel, assume flux is zero</span>
    <span class="n">yin_for_cdf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">yin_sorted</span><span class="p">])</span>

    <span class="c1"># correct for any non-finite values</span>
    <span class="n">bad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">yin_for_cdf</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">replace_nans</span> <span class="o">==</span> <span class="s2">&quot;interpolate&quot;</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
            <span class="s2">&quot;The `replace_nans=&#39;interpolate&#39;`` option doens&#39;t exist yet!&quot;</span>
        <span class="p">)</span>
    <span class="n">yin_for_cdf</span><span class="p">[</span><span class="n">bad</span><span class="p">]</span> <span class="o">=</span> <span class="n">replace_nans</span>

    <span class="c1"># calculate the CDF of the flux (at pixel edge locations)</span>
    <span class="n">cdfin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">yin_for_cdf</span><span class="p">)</span>

    <span class="c1"># create an interpolator for that CDF</span>
    <span class="n">cdfinterpolator</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span>
        <span class="n">xin_for_cdf</span><span class="p">,</span>
        <span class="n">cdfin</span><span class="p">,</span>
        <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span>
        <span class="n">bounds_error</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">fill_value</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">yin</span><span class="p">)),</span>
    <span class="p">)</span>

    <span class="c1"># calculate bin edges (of size len(xout)+1)</span>
    <span class="k">if</span> <span class="n">xout_edges</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">xout_left</span><span class="p">,</span> <span class="n">xout_right</span> <span class="o">=</span> <span class="n">calculate_bin_leftright</span><span class="p">(</span><span class="n">xout</span><span class="p">)</span>
        <span class="n">xout_edges</span> <span class="o">=</span> <span class="n">leftright_to_edges</span><span class="p">(</span><span class="n">xout_left</span><span class="p">,</span> <span class="n">xout_right</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">xout_left</span><span class="p">,</span> <span class="n">xout_right</span> <span class="o">=</span> <span class="n">edges_to_leftright</span><span class="p">(</span><span class="n">xout_edges</span><span class="p">)</span>
        <span class="n">xout</span> <span class="o">=</span> <span class="p">(</span><span class="n">xout_left</span> <span class="o">+</span> <span class="n">xout_right</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>

    <span class="n">xout_for_cdf</span> <span class="o">=</span> <span class="n">leftright_to_edges</span><span class="p">(</span><span class="n">xout_left</span><span class="p">,</span> <span class="n">xout_right</span><span class="p">)</span>

    <span class="c1"># interpolate the CDF onto those bin edges</span>
    <span class="n">cdfout</span> <span class="o">=</span> <span class="n">cdfinterpolator</span><span class="p">(</span><span class="n">xout_for_cdf</span><span class="p">)</span>

    <span class="c1"># take  derivative of the CDF to get flux per resampled bin</span>
    <span class="c1"># (xout is bin center, and yout is the flux in that bin)</span>
    <span class="n">yout</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">cdfout</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">visualize</span><span class="p">:</span>
        <span class="n">fi</span><span class="p">,</span> <span class="p">(</span><span class="n">ax_cdf</span><span class="p">,</span> <span class="n">ax_pdf</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
        <span class="n">inkw</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
            <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span>
            <span class="n">markeredgecolor</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">outkw</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;darkorange&quot;</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span>
            <span class="n">markersize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
            <span class="n">markeredgecolor</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">legkw</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper left&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">xinbinsize</span> <span class="o">=</span> <span class="n">xin_right</span> <span class="o">-</span> <span class="n">xin_left</span>
        <span class="n">xoutbinsize</span> <span class="o">=</span> <span class="n">xout_right</span> <span class="o">-</span> <span class="n">xout_left</span>
        <span class="c1"># plot the PDFs</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="n">ax_pdf</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Flux per (Original) Pixel&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Pixel&quot;</span><span class="p">)</span>
        <span class="c1"># plot the original pixels (in df/dpixel to compare with resampled)</span>
        <span class="n">plot_as_boxes</span><span class="p">(</span>
            <span class="n">xin_sorted</span><span class="p">,</span> <span class="n">yin_sorted</span> <span class="o">/</span> <span class="n">xinbinsize</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Original Pixels&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">inkw</span>
        <span class="p">)</span>

        <span class="c1"># what would a bad interpolation look like?</span>
        <span class="n">interpolate_badly</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span>
            <span class="n">xin_sorted</span><span class="p">,</span>
            <span class="n">yin_sorted</span> <span class="o">/</span> <span class="n">xinbinsize</span><span class="p">,</span>
            <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span>
            <span class="n">bounds_error</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">fill_value</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
            <span class="n">xout</span><span class="p">,</span>
            <span class="n">interpolate_badly</span><span class="p">(</span><span class="n">xout</span><span class="p">),</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;cornflowerblue&quot;</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span>
            <span class="n">markersize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
            <span class="n">markeredgecolor</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Silly Simple Interpolation&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># plot the flux-conserving resampled data (again, in df/d&quot;pixel&quot;)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
            <span class="n">xout</span><span class="p">,</span> <span class="n">yout</span> <span class="o">/</span> <span class="n">xoutbinsize</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Flux-Conserving Interpolation&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">outkw</span>
        <span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="o">**</span><span class="n">legkw</span><span class="p">)</span>

        <span class="c1"># plot the CDFs</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="n">ax_cdf</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Cumulative Flux (from left)&quot;</span><span class="p">)</span>

        <span class="c1"># plot the original CDF</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xin_for_cdf</span><span class="p">,</span> <span class="n">cdfin</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Original Pixels&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">inkw</span><span class="p">)</span>

        <span class="c1"># plot the interpolated CDF</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xout_for_cdf</span><span class="p">,</span> <span class="n">cdfout</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Flux-Conserved Resample&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">outkw</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">pause</span><span class="p">:</span>
            <span class="n">a</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span>
                <span class="s2">&quot;Pausing a moment to check on interpolation; press return to continue.&quot;</span>
            <span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{:&gt;6}</span><span class="s2"> = </span><span class="si">{:.5f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;Actual&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">yin</span><span class="p">)))</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="s2">&quot;</span><span class="si">{:&gt;6}</span><span class="s2"> = </span><span class="si">{:.5f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="s2">&quot;Silly&quot;</span><span class="p">,</span>
                <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">interpolate_badly</span><span class="p">(</span><span class="n">xout</span><span class="p">)</span> <span class="o">*</span> <span class="n">xoutbinsize</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{:&gt;6}</span><span class="s2"> = </span><span class="si">{:.5f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;CDF&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">yout</span><span class="p">)))</span>

    <span class="c1"># return the resampled y-values</span>
    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="n">xout</span><span class="p">,</span> <span class="s2">&quot;x_edge_lower&quot;</span><span class="p">:</span> <span class="n">xout_left</span><span class="p">,</span> <span class="s2">&quot;x_edge_upper&quot;</span><span class="p">:</span> <span class="n">xout_right</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="n">yout</span><span class="p">}</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="chromatic.rainbows.get.wavelike.subset"></a>
    <div class="doc doc-contents first">









  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.get.wavelike.subset.bintoR" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">bintoR</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">unc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">R</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">weighting</span><span class="o">=</span><span class="s1">&#39;inversevariance&#39;</span><span class="p">,</span> <span class="n">drop_nans</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.get.wavelike.subset.bintoR" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Bin any x and y array onto a logarithmicly uniform grid.</p>
<h4 id="chromatic.rainbows.get.wavelike.subset.bintoR--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.get.wavelike.subset.bintoR--parameters" title="Permanent link">#</a></h4>
<p>x : array
    The original independent variable.
    (For a spectrum example = wavelength)
y : array
    The original dependent variable (same size as x).
    (For a spectrum example = flux)
unc : array, None, optional
    The unceratinty on the dependent variable
    (For a spectrum example = the flux uncertainty)
R : array, optional
    The spectral resolution R=x/dx for creating a new,
    logarithmically uniform grid that starts at the first
    value of x.
xlim : list, array, optional
    A two-element list indicating the min and max values of
    x for the new logarithmically spaced grid. If None,
    these limits will be created from the data themselves
weighting : str, optional
    How should we weight values when averaging
    them together into one larger bin?
    <code>weighting = 'inversevariance'</code>
        weights = 1/unc**2
     <code>weighting = {literally anything else}</code>
        uniform weights
    This will have no impact if <code>unc == None</code>, or for any
    new bins that effectively overlap less than one original
    unbinned point.
drop_nans : bool, optional
    Should we skip any bins turn out to be nans?
    This most often happens when bins are empty.</p>
<h4 id="chromatic.rainbows.get.wavelike.subset.bintoR--returns">Returns<a class="headerlink" href="#chromatic.rainbows.get.wavelike.subset.bintoR--returns" title="Permanent link">#</a></h4>
<p>result : dict
    A dictionary containing at least...
        <code>x</code> = the center of the output grid
        <code>y</code> = the resampled value on the output grid
        <code>x_edge_lower</code> = the lower edges of the output grid
        <code>x_edge_upper</code> = the upper edges of the output grid
    ...and possibly also
        <code>uncertainty</code> = the calculated uncertainty per bin</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/tools/resampling.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">bintoR</span><span class="p">(</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">unc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">R</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">weighting</span><span class="o">=</span><span class="s2">&quot;inversevariance&quot;</span><span class="p">,</span> <span class="n">drop_nans</span><span class="o">=</span><span class="kc">True</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Bin any x and y array onto a logarithmicly uniform grid.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : array</span>
<span class="sd">        The original independent variable.</span>
<span class="sd">        (For a spectrum example = wavelength)</span>
<span class="sd">    y : array</span>
<span class="sd">        The original dependent variable (same size as x).</span>
<span class="sd">        (For a spectrum example = flux)</span>
<span class="sd">    unc : array, None, optional</span>
<span class="sd">        The unceratinty on the dependent variable</span>
<span class="sd">        (For a spectrum example = the flux uncertainty)</span>
<span class="sd">    R : array, optional</span>
<span class="sd">        The spectral resolution R=x/dx for creating a new,</span>
<span class="sd">        logarithmically uniform grid that starts at the first</span>
<span class="sd">        value of x.</span>
<span class="sd">    xlim : list, array, optional</span>
<span class="sd">        A two-element list indicating the min and max values of</span>
<span class="sd">        x for the new logarithmically spaced grid. If None,</span>
<span class="sd">        these limits will be created from the data themselves</span>
<span class="sd">    weighting : str, optional</span>
<span class="sd">        How should we weight values when averaging</span>
<span class="sd">        them together into one larger bin?</span>
<span class="sd">        `weighting = &#39;inversevariance&#39;`</span>
<span class="sd">            weights = 1/unc**2</span>
<span class="sd">         `weighting = {literally anything else}`</span>
<span class="sd">            uniform weights</span>
<span class="sd">        This will have no impact if `unc == None`, or for any</span>
<span class="sd">        new bins that effectively overlap less than one original</span>
<span class="sd">        unbinned point.</span>
<span class="sd">    drop_nans : bool, optional</span>
<span class="sd">        Should we skip any bins turn out to be nans?</span>
<span class="sd">        This most often happens when bins are empty.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    result : dict</span>
<span class="sd">        A dictionary containing at least...</span>
<span class="sd">            `x` = the center of the output grid</span>
<span class="sd">            `y` = the resampled value on the output grid</span>
<span class="sd">            `x_edge_lower` = the lower edges of the output grid</span>
<span class="sd">            `x_edge_upper` = the upper edges of the output grid</span>
<span class="sd">        ...and possibly also</span>
<span class="sd">            `uncertainty` = the calculated uncertainty per bin</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">x_unit</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">unit</span>
        <span class="n">x_without_unit</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">value</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="n">x_unit</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">x_without_unit</span> <span class="o">=</span> <span class="n">x</span>

    <span class="c1"># create a new grid of x at the given resolution</span>
    <span class="n">lnx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">x_without_unit</span><span class="p">)</span>
    <span class="n">dnewlnx</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">R</span>

    <span class="c1"># set the limits of the new xgrid (in log space)</span>
    <span class="k">if</span> <span class="n">xlim</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># use the input grid to set the limits</span>
        <span class="n">lnxbottom</span><span class="p">,</span> <span class="n">lnxtop</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">lnx</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">lnx</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># use the custom xlim to set the limits</span>
        <span class="n">lnxbottom</span><span class="p">,</span> <span class="n">lnxtop</span> <span class="o">=</span> <span class="n">xlim</span>

    <span class="c1"># create a new, log-uniform grid of x values</span>
    <span class="n">newlnx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">lnxbottom</span><span class="p">,</span> <span class="n">lnxtop</span> <span class="o">+</span> <span class="n">dnewlnx</span><span class="p">,</span> <span class="n">dnewlnx</span><span class="p">)</span>

    <span class="c1"># now do the binning on a uniform grid of lnx</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">bintogrid</span><span class="p">(</span>
        <span class="n">lnx</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">unc</span><span class="p">,</span> <span class="n">newx</span><span class="o">=</span><span class="n">newlnx</span><span class="p">,</span> <span class="n">weighting</span><span class="o">=</span><span class="n">weighting</span><span class="p">,</span> <span class="n">drop_nans</span><span class="o">=</span><span class="n">drop_nans</span>
    <span class="p">)</span>

    <span class="c1"># convert back from log to real values</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;x_edge_lower&quot;</span><span class="p">,</span> <span class="s2">&quot;x_edge_upper&quot;</span><span class="p">]:</span>
        <span class="n">result</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="o">*</span> <span class="n">x_unit</span>

    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.get.wavelike.subset.bintogrid" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">bintogrid</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">unc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">newx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">newx_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">nx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">weighting</span><span class="o">=</span><span class="s1">&#39;inversevariance&#39;</span><span class="p">,</span> <span class="n">drop_nans</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">x_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">visualize</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.get.wavelike.subset.bintogrid" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Bin any x and y array onto a linearly uniform grid.</p>
<h4 id="chromatic.rainbows.get.wavelike.subset.bintogrid--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.get.wavelike.subset.bintogrid--parameters" title="Permanent link">#</a></h4>
<p>x : array
    The original independent variable.
    (For a spectrum example = wavelength)
y : array
    The original dependent variable (same size as x).
    (For a spectrum example = flux)
unc : array, None
    The unceratinty on the dependent variable
    (For a spectrum example = the flux uncertainty)
nx : array
    The number of bins from the original grid to
    bin together into the new one.
dx : array
    The fixed spacing for creating a new, linearly uniform
    grid that start at the first value of x. This will
    be ignored if <code>newx</code> != None.
newx : array
    A new custom grid onto which we should bin.
newx_edges : array
    The edges of the new grid of bins for the independent
    variable, onto which you want to resample the y
    values. The left and right edges of the bins will be,
    respectively, <code>newx_edges[:-1]</code> and <code>newx_edges[1:]</code>,
    so the size of the output array will be
    <code>len(newx_edges) - 1</code>
weighting : str
    How should we weight values when averaging
    them together into one larger bin?
    <code>weighting = 'inversevariance'</code>
        weights = 1/unc**2
     <code>weighting = {literally anything else}</code>
        uniform weights
    This will have no impact if <code>unc == None</code>, or for any
    new bins that effectively overlap less than one original
    unbinned point.
drop_nans : bool
    Should we skip any bins turn out to be nans?
    This most often happens when bins are empty.
x_edges : array
    The edges of the original independent variable bins.
    The left and right edges of the bins are interpreted
    to be <code>x_edges[:-1]</code> and <code>x_edges[1:]</code>,
    respectively, so the associated <code>y</code> should have exactly
    1 fewer element than <code>x_edges</code>. This provides finer
    control over the size of each bin in the input than
    simply supplying <code>x</code>(still a little experimental)</p>
<h4 id="chromatic.rainbows.get.wavelike.subset.bintogrid--returns">Returns<a class="headerlink" href="#chromatic.rainbows.get.wavelike.subset.bintogrid--returns" title="Permanent link">#</a></h4>
<p>result : dict
    A dictionary containing at least...
        <code>x</code> = the center of the output grid
        <code>y</code> = the resampled value on the output grid
        <code>x_edge_lower</code> = the lower edges of the output grid
        <code>x_edge_upper</code> = the upper edges of the output grid
    ...and possibly also
        <code>uncertainty</code> = the calculated uncertainty per bin</p>
<p>The order of precendence for setting the new grid is
[<code>newx_edges</code>, <code>newx</code>, <code>dx</code>, <code>nx</code>]
The first will be used, and others will be ignored.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/tools/resampling.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">bintogrid</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">unc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">newx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">newx_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">dx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">nx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">weighting</span><span class="o">=</span><span class="s2">&quot;inversevariance&quot;</span><span class="p">,</span>
    <span class="n">drop_nans</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">x_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">visualize</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Bin any x and y array onto a linearly uniform grid.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : array</span>
<span class="sd">        The original independent variable.</span>
<span class="sd">        (For a spectrum example = wavelength)</span>
<span class="sd">    y : array</span>
<span class="sd">        The original dependent variable (same size as x).</span>
<span class="sd">        (For a spectrum example = flux)</span>
<span class="sd">    unc : array, None</span>
<span class="sd">        The unceratinty on the dependent variable</span>
<span class="sd">        (For a spectrum example = the flux uncertainty)</span>
<span class="sd">    nx : array</span>
<span class="sd">        The number of bins from the original grid to</span>
<span class="sd">        bin together into the new one.</span>
<span class="sd">    dx : array</span>
<span class="sd">        The fixed spacing for creating a new, linearly uniform</span>
<span class="sd">        grid that start at the first value of x. This will</span>
<span class="sd">        be ignored if `newx` != None.</span>
<span class="sd">    newx : array</span>
<span class="sd">        A new custom grid onto which we should bin.</span>
<span class="sd">    newx_edges : array</span>
<span class="sd">        The edges of the new grid of bins for the independent</span>
<span class="sd">        variable, onto which you want to resample the y</span>
<span class="sd">        values. The left and right edges of the bins will be,</span>
<span class="sd">        respectively, `newx_edges[:-1]` and `newx_edges[1:]`,</span>
<span class="sd">        so the size of the output array will be</span>
<span class="sd">        `len(newx_edges) - 1`</span>
<span class="sd">    weighting : str</span>
<span class="sd">        How should we weight values when averaging</span>
<span class="sd">        them together into one larger bin?</span>
<span class="sd">        `weighting = &#39;inversevariance&#39;`</span>
<span class="sd">            weights = 1/unc**2</span>
<span class="sd">         `weighting = {literally anything else}`</span>
<span class="sd">            uniform weights</span>
<span class="sd">        This will have no impact if `unc == None`, or for any</span>
<span class="sd">        new bins that effectively overlap less than one original</span>
<span class="sd">        unbinned point.</span>
<span class="sd">    drop_nans : bool</span>
<span class="sd">        Should we skip any bins turn out to be nans?</span>
<span class="sd">        This most often happens when bins are empty.</span>
<span class="sd">    x_edges : array</span>
<span class="sd">        The edges of the original independent variable bins.</span>
<span class="sd">        The left and right edges of the bins are interpreted</span>
<span class="sd">        to be `x_edges[:-1]` and `x_edges[1:]`,</span>
<span class="sd">        respectively, so the associated `y` should have exactly</span>
<span class="sd">        1 fewer element than `x_edges`. This provides finer</span>
<span class="sd">        control over the size of each bin in the input than</span>
<span class="sd">        simply supplying `x`(still a little experimental)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    result : dict</span>
<span class="sd">        A dictionary containing at least...</span>
<span class="sd">            `x` = the center of the output grid</span>
<span class="sd">            `y` = the resampled value on the output grid</span>
<span class="sd">            `x_edge_lower` = the lower edges of the output grid</span>
<span class="sd">            `x_edge_upper` = the upper edges of the output grid</span>
<span class="sd">        ...and possibly also</span>
<span class="sd">            `uncertainty` = the calculated uncertainty per bin</span>


<span class="sd">    The order of precendence for setting the new grid is</span>
<span class="sd">    [`newx_edges`, `newx`, `dx`, `nx`]</span>
<span class="sd">    The first will be used, and others will be ignored.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># check that an OK set of inputs has been supplied</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">x_edges</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;🌈 Both `x` and `x_edges` were supplied to `bintogrid`. Confusing!&quot;&quot;&quot;</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">x_edges</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;🌈 At least one of `x` or `x_edges` must be supplied to `bintogrid`.&quot;&quot;&quot;</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="n">y</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;🌈 `y` must be supplied to `bintogrid`.&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="c1"># make sure the edges and the centers are set</span>
    <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">x_left</span><span class="p">,</span> <span class="n">x_right</span> <span class="o">=</span> <span class="n">edges_to_leftright</span><span class="p">(</span><span class="n">x_edges</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">left</span> <span class="o">+</span> <span class="n">right</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">x_left</span><span class="p">,</span> <span class="n">x_right</span> <span class="o">=</span> <span class="n">calculate_bin_leftright</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">x_edges</span> <span class="o">=</span> <span class="n">leftright_to_edges</span><span class="p">(</span><span class="n">x_left</span><span class="p">,</span> <span class="n">x_right</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">x_unit</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">unit</span>
        <span class="n">x_without_unit</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">value</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="n">x_unit</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">x_without_unit</span> <span class="o">=</span> <span class="n">x</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">y_unit</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">unit</span>
        <span class="n">y_without_unit</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">value</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="n">y_unit</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">y_without_unit</span> <span class="o">=</span> <span class="n">y</span>

    <span class="c1"># warn if multiple inputs are provided</span>
    <span class="n">number_of_grid_options</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span><span class="n">z</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="p">[</span><span class="n">newx_edges</span><span class="p">,</span> <span class="n">newx</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">nx</span><span class="p">]])</span>
    <span class="k">if</span> <span class="n">number_of_grid_options</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">cheerfully_suggest</span><span class="p">(</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;More than one output grid sent to `bintogrid`.</span>
<span class="sd">                         The one being used is the first to appear in</span>
<span class="sd">                         [`newx_edges`, `newx`, `dx`, `nx`]</span>
<span class="sd">                         but you might want to choose more carefully.&quot;&quot;&quot;</span>
        <span class="p">)</span>

    <span class="c1"># define inputs based on the following order</span>
    <span class="k">if</span> <span class="n">newx_edges</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># define grid by its edges (and define others from there)</span>
        <span class="n">newx_edges_without_unit</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">newx_edges</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">x_unit</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
        <span class="n">dx_without_unit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">newx_edges_without_unit</span><span class="p">)</span>
        <span class="n">newx_without_unit</span> <span class="o">=</span> <span class="n">newx_edges_without_unit</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">dx_without_unit</span>
        <span class="n">newx_left_without_unit</span> <span class="o">=</span> <span class="n">newx_edges_without_unit</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">newx_right_without_unit</span> <span class="o">=</span> <span class="n">newx_edges_without_unit</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

        <span class="c1"># make sure the final output grid is defined</span>
        <span class="n">final_newx</span><span class="p">,</span> <span class="n">final_newx_left</span><span class="p">,</span> <span class="n">final_newx_right</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">newx_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
            <span class="n">newx_left_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
            <span class="n">newx_right_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="n">newx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># define grid by its centers (and define others from there)</span>
        <span class="n">newx_without_unit</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">newx</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">x_unit</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
        <span class="n">newx_left_without_unit</span><span class="p">,</span> <span class="n">newx_right_without_unit</span> <span class="o">=</span> <span class="n">calculate_bin_leftright</span><span class="p">(</span>
            <span class="n">newx_without_unit</span>
        <span class="p">)</span>
        <span class="n">newx_edges_without_unit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span>
            <span class="p">[</span><span class="n">newx_left_without_unit</span><span class="p">,</span> <span class="n">newx_right_without_unit</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
        <span class="p">)</span>
        <span class="n">dx_without_unit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">newx_edges_without_unit</span><span class="p">)</span>

        <span class="c1"># make sure the final output grid is defined</span>
        <span class="n">final_newx</span><span class="p">,</span> <span class="n">final_newx_left</span><span class="p">,</span> <span class="n">final_newx_right</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">newx_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
            <span class="n">newx_left_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
            <span class="n">newx_right_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="n">dx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># define grid by a bin width (and define others from there)</span>
        <span class="n">dx_without_unit</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">dx</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">x_unit</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
        <span class="n">newx_without_unit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">x_without_unit</span><span class="p">),</span>
            <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">x_without_unit</span><span class="p">)</span> <span class="o">+</span> <span class="n">dx_without_unit</span><span class="p">,</span>
            <span class="n">dx_without_unit</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">newx_left_without_unit</span><span class="p">,</span> <span class="n">newx_right_without_unit</span> <span class="o">=</span> <span class="n">calculate_bin_leftright</span><span class="p">(</span>
            <span class="n">newx_without_unit</span>
        <span class="p">)</span>
        <span class="n">newx_edges_without_unit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span>
            <span class="p">[</span><span class="n">newx_left_without_unit</span><span class="p">,</span> <span class="n">newx_right_without_unit</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
        <span class="p">)</span>

        <span class="c1"># make sure the final output grid is defined</span>
        <span class="n">final_newx</span><span class="p">,</span> <span class="n">final_newx_left</span><span class="p">,</span> <span class="n">final_newx_right</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">newx_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
            <span class="n">newx_left_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
            <span class="n">newx_right_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">elif</span> <span class="n">nx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># keep track of the original input x values</span>
        <span class="n">original_x_without_unit</span> <span class="o">=</span> <span class="n">x_without_unit</span>

        <span class="c1"># redefine the input x to indices, to do interpolation in index space</span>
        <span class="n">x_without_unit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">x_without_unit</span><span class="p">))</span>

        <span class="c1"># define a grid of edges that will enclose the right number of indices</span>
        <span class="n">x_left_i</span><span class="p">,</span> <span class="n">x_right_i</span> <span class="o">=</span> <span class="n">calculate_bin_leftright</span><span class="p">(</span><span class="n">x_without_unit</span><span class="p">)</span>
        <span class="n">newx_edges_without_unit</span> <span class="o">=</span> <span class="n">leftright_to_edges</span><span class="p">(</span><span class="n">x_left_i</span><span class="p">,</span> <span class="n">x_right_i</span><span class="p">)[::</span><span class="n">nx</span><span class="p">]</span>
        <span class="n">newx_without_unit</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span>
            <span class="n">newx_edges_without_unit</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">+</span> <span class="n">newx_edges_without_unit</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="p">)</span>

        <span class="c1"># calculate the actual x values corresponding to the bins</span>
        <span class="n">original_edges</span> <span class="o">=</span> <span class="n">leftright_to_edges</span><span class="p">(</span>
            <span class="o">*</span><span class="n">calculate_bin_leftright</span><span class="p">(</span><span class="n">original_x_without_unit</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">final_edges</span> <span class="o">=</span> <span class="n">original_edges</span><span class="p">[::</span><span class="n">nx</span><span class="p">]</span> <span class="o">*</span> <span class="n">x_unit</span>
        <span class="n">final_newx_left</span><span class="p">,</span> <span class="n">final_newx_right</span> <span class="o">=</span> <span class="n">edges_to_leftright</span><span class="p">(</span><span class="n">final_edges</span><span class="p">)</span>
        <span class="n">final_newx</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">final_newx_left</span> <span class="o">+</span> <span class="n">final_newx_right</span><span class="p">)</span>
        <span class="n">dx_without_unit</span> <span class="o">=</span> <span class="p">(</span><span class="n">final_newx_right</span> <span class="o">-</span> <span class="n">final_newx_left</span><span class="p">)</span> <span class="o">/</span> <span class="n">x_unit</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;No output grid sent to `bintogrid`.</span>
<span class="sd">                              Please choose one of the following:</span>
<span class="sd">                              [`newx_edges`, `newx`, `dx`, `nx`]&quot;&quot;&quot;</span>
        <span class="p">)</span>

    <span class="c1"># don&#39;t complain about zero-divisions in here (to allow infinite uncertainties)</span>
    <span class="k">with</span> <span class="n">np</span><span class="o">.</span><span class="n">errstate</span><span class="p">(</span><span class="n">divide</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">invalid</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">):</span>

        <span class="c1"># calculate weight integrals for the bin array</span>
        <span class="n">ok</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">y_without_unit</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span>

        <span class="c1"># resample the sums onto that new grid</span>
        <span class="k">if</span> <span class="n">unc</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">x_without_unit</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">weighting</span> <span class="o">==</span> <span class="s2">&quot;inversevariance&quot;</span><span class="p">:</span>
                <span class="n">weights</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">unc</span><span class="o">**</span><span class="mi">2</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">x_without_unit</span><span class="p">)</span>

            <span class="c1"># ignore infinite weights (= 0 uncertainties)</span>
            <span class="n">ok</span> <span class="o">*=</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">ok</span><span class="p">):</span>
            <span class="n">numerator</span> <span class="o">=</span> <span class="n">resample_while_conserving_flux</span><span class="p">(</span>
                <span class="n">xin</span><span class="o">=</span><span class="n">x_without_unit</span><span class="p">[</span><span class="n">ok</span><span class="p">],</span>
                <span class="n">yin</span><span class="o">=</span><span class="p">(</span><span class="n">y_without_unit</span> <span class="o">*</span> <span class="n">weights</span><span class="p">)[</span><span class="n">ok</span><span class="p">],</span>
                <span class="n">xout_edges</span><span class="o">=</span><span class="n">newx_edges_without_unit</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">denominator</span> <span class="o">=</span> <span class="n">resample_while_conserving_flux</span><span class="p">(</span>
                <span class="n">xin</span><span class="o">=</span><span class="n">x_without_unit</span><span class="p">[</span><span class="n">ok</span><span class="p">],</span>
                <span class="n">yin</span><span class="o">=</span><span class="n">weights</span><span class="p">[</span><span class="n">ok</span><span class="p">],</span>
                <span class="n">xout_edges</span><span class="o">=</span><span class="n">newx_edges_without_unit</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="c1"># the binned weighted means on the new grid</span>
            <span class="n">newy</span> <span class="o">=</span> <span class="n">numerator</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">denominator</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span>

            <span class="c1"># the standard error on the means, for those bins</span>
            <span class="n">newunc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">denominator</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">])</span>

            <span class="c1"># keep track of the number of original bins going into each new bin</span>
            <span class="n">number_of_original_bins_per_new_bin</span> <span class="o">=</span> <span class="n">resample_while_conserving_flux</span><span class="p">(</span>
                <span class="n">xin</span><span class="o">=</span><span class="n">x_without_unit</span><span class="p">[</span><span class="n">ok</span><span class="p">],</span>
                <span class="n">yin</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">y_without_unit</span><span class="p">)[</span><span class="n">ok</span><span class="p">],</span>
                <span class="n">xout_edges</span><span class="o">=</span><span class="n">newx_edges_without_unit</span><span class="p">,</span>
            <span class="p">)[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">newy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="o">*</span> <span class="n">newx_without_unit</span>
            <span class="n">newunc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="o">*</span> <span class="n">newx_without_unit</span>
            <span class="n">number_of_original_bins_per_new_bin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">newx_without_unit</span><span class="p">)</span>

    <span class="c1"># remove any empty bins</span>
    <span class="k">if</span> <span class="n">drop_nans</span><span class="p">:</span>
        <span class="n">ok</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">newy</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ok</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">newx_without_unit</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>

    <span class="c1"># if no uncertainties were given, don&#39;t return uncertainties</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># populate the new grid centers + edges + values</span>
    <span class="n">result</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">final_newx</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span>
    <span class="n">result</span><span class="p">[</span><span class="s2">&quot;x_edge_lower&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">final_newx_left</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span>
    <span class="n">result</span><span class="p">[</span><span class="s2">&quot;x_edge_upper&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">final_newx_right</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span>

    <span class="c1"># populate the new grid values</span>
    <span class="n">result</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">newy</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span> <span class="o">*</span> <span class="n">y_unit</span>

    <span class="c1"># populate the new grid value uncertainties</span>
    <span class="k">if</span> <span class="n">unc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">result</span><span class="p">[</span><span class="s2">&quot;uncertainty&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">newunc</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span> <span class="o">*</span> <span class="n">y_unit</span>

    <span class="c1"># store how many of the original pixels made it into this new one</span>
    <span class="n">result</span><span class="p">[</span><span class="s2">&quot;N_unbinned/N_binned&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">number_of_original_bins_per_new_bin</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">visualize</span><span class="p">:</span>
        <span class="n">fi</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span>
            <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">gridspec_kw</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">height_ratios</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">])</span>
        <span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">plot_as_boxes</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">xleft</span><span class="o">=</span><span class="n">x_left</span><span class="p">,</span> <span class="n">xright</span><span class="o">=</span><span class="n">x_right</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;silver&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">ekw</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">elinewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">unc</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;silver&quot;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">ekw</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">],</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">],</span>
            <span class="n">yerr</span><span class="o">=</span><span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;uncertainty&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
            <span class="n">xerr</span><span class="o">=</span><span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s2">&quot;x_edge_upper&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;x_edge_lower&quot;</span><span class="p">])</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
            <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
            <span class="n">zorder</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
            <span class="o">**</span><span class="n">ekw</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">plot_as_boxes</span><span class="p">(</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">],</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;N_unbinned/N_binned&quot;</span><span class="p">],</span>
            <span class="n">xleft</span><span class="o">=</span><span class="n">result</span><span class="p">[</span><span class="s2">&quot;x_edge_lower&quot;</span><span class="p">],</span>
            <span class="n">xright</span><span class="o">=</span><span class="n">result</span><span class="p">[</span><span class="s2">&quot;x_edge_upper&quot;</span><span class="p">],</span>
        <span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;$N_</span><span class="si">{unbinned}</span><span class="s2">/N_</span><span class="si">{binned}</span><span class="s2">$&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.get.wavelike.subset.calculate_bin_leftright" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">calculate_bin_leftright</span><span class="p">(</span><span class="n">x</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.get.wavelike.subset.calculate_bin_leftright" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>If x is an array of bin centers, calculate the bin edges.
(assumes outermost bins are same size as their neighbors)</p>
<h4 id="chromatic.rainbows.get.wavelike.subset.calculate_bin_leftright--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.get.wavelike.subset.calculate_bin_leftright--parameters" title="Permanent link">#</a></h4>
<p>x : array
    The array of bin centers.</p>
<h4 id="chromatic.rainbows.get.wavelike.subset.calculate_bin_leftright--returns">Returns<a class="headerlink" href="#chromatic.rainbows.get.wavelike.subset.calculate_bin_leftright--returns" title="Permanent link">#</a></h4>
<p>l : array
    The left edges of the bins.
r : array
    The right edges of the bins.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/tools/resampling.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">calculate_bin_leftright</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    If x is an array of bin centers, calculate the bin edges.</span>
<span class="sd">    (assumes outermost bins are same size as their neighbors)</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : array</span>
<span class="sd">        The array of bin centers.</span>

<span class="sd">    Returns</span>
<span class="sd">    ----------</span>
<span class="sd">    l : array</span>
<span class="sd">        The left edges of the bins.</span>
<span class="sd">    r : array</span>
<span class="sd">        The right edges of the bins.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># what are bin edges (making a guess for those on the ends)</span>
    <span class="c1"># xbinsize = calculate_bin_widths(x)</span>
    <span class="c1"># left = x - xbinsize / 2.0</span>
    <span class="c1"># right = x + xbinsize / 2.0</span>

    <span class="c1"># weird corner case!</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">left</span><span class="p">,</span> <span class="n">right</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">left</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">right</span><span class="p">])</span>

    <span class="n">inner_edges</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="n">x</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">first_edge</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="n">inner_edges</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">last_edge</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">inner_edges</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

    <span class="n">left</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">first_edge</span><span class="p">,</span> <span class="n">inner_edges</span><span class="p">])</span>
    <span class="n">right</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">inner_edges</span><span class="p">,</span> <span class="n">last_edge</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.get.wavelike.subset.edges_to_leftright" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">edges_to_leftright</span><span class="p">(</span><span class="n">edges</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.get.wavelike.subset.edges_to_leftright" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Convert N+1 contiguous edges to two arrays of N left/right edges.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/tools/resampling.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">edges_to_leftright</span><span class="p">(</span><span class="n">edges</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert N+1 contiguous edges to two arrays of N left/right edges.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">left</span><span class="p">,</span> <span class="n">right</span> <span class="o">=</span> <span class="n">edges</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">edges</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="k">return</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.get.wavelike.subset.expand_filenames" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">expand_filenames</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.get.wavelike.subset.expand_filenames" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>A wrapper to expand a string or list into a list of filenames.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/imports.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">expand_filenames</span><span class="p">(</span><span class="n">filepath</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A wrapper to expand a string or list into a list of filenames.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
        <span class="n">filenames</span> <span class="o">=</span> <span class="n">filepath</span>
    <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span> <span class="o">==</span> <span class="n">Column</span><span class="p">:</span>
        <span class="n">filenames</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>
    <span class="k">elif</span> <span class="s2">&quot;*&quot;</span> <span class="ow">in</span> <span class="n">filepath</span><span class="p">:</span>
        <span class="n">filenames</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">filepath</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">filenames</span> <span class="o">=</span> <span class="p">[</span><span class="n">filepath</span><span class="p">]</span>
    <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">filenames</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.get.wavelike.subset.get_for_wavelength" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_for_wavelength</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">quantity</span><span class="o">=</span><span class="s1">&#39;flux&#39;</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.get.wavelike.subset.get_for_wavelength" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Get <code>'quantity'</code> associated with wavelength <code>'i'</code>.</p>
<h4 id="chromatic.rainbows.get.wavelike.subset.get_for_wavelength--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.get.wavelike.subset.get_for_wavelength--parameters" title="Permanent link">#</a></h4>
<p>i : int
    The wavelength index to retrieve.
quantity : string
    The quantity to retrieve. If it is flux-like,
    row 'i' will be returned. If it is time-like,
    the array itself will be returned.</p>
<h4 id="chromatic.rainbows.get.wavelike.subset.get_for_wavelength--returns">Returns<a class="headerlink" href="#chromatic.rainbows.get.wavelike.subset.get_for_wavelength--returns" title="Permanent link">#</a></h4>
<p>quantity : array, Quantity
    The 1D array of 'quantity' corresponding to wavelength 'i'.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/rainbows/get/wavelike/subset.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_for_wavelength</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">quantity</span><span class="o">=</span><span class="s2">&quot;flux&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get `&#39;quantity&#39;` associated with wavelength `&#39;i&#39;`.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    i : int</span>
<span class="sd">        The wavelength index to retrieve.</span>
<span class="sd">    quantity : string</span>
<span class="sd">        The quantity to retrieve. If it is flux-like,</span>
<span class="sd">        row &#39;i&#39; will be returned. If it is time-like,</span>
<span class="sd">        the array itself will be returned.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    quantity : array, Quantity</span>
<span class="sd">        The 1D array of &#39;quantity&#39; corresponding to wavelength &#39;i&#39;.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">quantity</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">z</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">z</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">z</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">ntime</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">z</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        You tried to retrieve wavelength </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2"> from &#39;</span><span class="si">{</span><span class="n">quantity</span><span class="si">}</span><span class="s2">&#39;,</span>
<span class="s2">        but this quantity is neither flux-like nor time-like.</span>
<span class="s2">        It&#39;s not possible to return a time-like array. Sorry!</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.get.wavelike.subset.get_ok_data_for_wavelength" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_ok_data_for_wavelength</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;flux&#39;</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="s1">&#39;uncertainty&#39;</span><span class="p">,</span> <span class="n">minimum_acceptable_ok</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">express_badness_with_uncertainty</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.get.wavelike.subset.get_ok_data_for_wavelength" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>A small wrapper to get the good data from a wavelength.</p>
<p>Extract a slice of data, marking data that are not <code>ok</code> either
by trimming them out entirely or by inflating their
uncertainties to infinity.</p>
<h4 id="chromatic.rainbows.get.wavelike.subset.get_ok_data_for_wavelength--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.get.wavelike.subset.get_ok_data_for_wavelength--parameters" title="Permanent link">#</a></h4>
<p>i : int
    The wavelength index to retrieve.
x : string, optional
    What quantity should be retrieved as 'x'? (default = 'time')
y : string, optional
    What quantity should be retrieved as 'y'? (default = 'flux')
sigma : string, optional
    What quantity should be retrieved as 'sigma'? (default = 'uncertainty')
minimum_acceptable_ok : float, optional
    The smallest value of <code>ok</code> that will still be included.
    (1 for perfect data, 1e-10 for everything but terrible data, 0 for all data)
express_badness_with_uncertainty : bool, optional
    If False, data that don't pass the <code>ok</code> cut will be removed.
    If True, data that don't pass the <code>ok</code> cut will have their
    uncertainties inflated to infinity (np.inf).</p>
<h4 id="chromatic.rainbows.get.wavelike.subset.get_ok_data_for_wavelength--returns">Returns<a class="headerlink" href="#chromatic.rainbows.get.wavelike.subset.get_ok_data_for_wavelength--returns" title="Permanent link">#</a></h4>
<p>x : array
    The time.
y : array
    The desired quantity (default is <code>flux</code>)
sigma : array
    The uncertainty on the desired quantity</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/rainbows/get/wavelike/subset.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_ok_data_for_wavelength</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">i</span><span class="p">,</span>
    <span class="n">x</span><span class="o">=</span><span class="s2">&quot;time&quot;</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s2">&quot;flux&quot;</span><span class="p">,</span>
    <span class="n">sigma</span><span class="o">=</span><span class="s2">&quot;uncertainty&quot;</span><span class="p">,</span>
    <span class="n">minimum_acceptable_ok</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">express_badness_with_uncertainty</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A small wrapper to get the good data from a wavelength.</span>

<span class="sd">    Extract a slice of data, marking data that are not `ok` either</span>
<span class="sd">    by trimming them out entirely or by inflating their</span>
<span class="sd">    uncertainties to infinity.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    i : int</span>
<span class="sd">        The wavelength index to retrieve.</span>
<span class="sd">    x : string, optional</span>
<span class="sd">        What quantity should be retrieved as &#39;x&#39;? (default = &#39;time&#39;)</span>
<span class="sd">    y : string, optional</span>
<span class="sd">        What quantity should be retrieved as &#39;y&#39;? (default = &#39;flux&#39;)</span>
<span class="sd">    sigma : string, optional</span>
<span class="sd">        What quantity should be retrieved as &#39;sigma&#39;? (default = &#39;uncertainty&#39;)</span>
<span class="sd">    minimum_acceptable_ok : float, optional</span>
<span class="sd">        The smallest value of `ok` that will still be included.</span>
<span class="sd">        (1 for perfect data, 1e-10 for everything but terrible data, 0 for all data)</span>
<span class="sd">    express_badness_with_uncertainty : bool, optional</span>
<span class="sd">        If False, data that don&#39;t pass the `ok` cut will be removed.</span>
<span class="sd">        If True, data that don&#39;t pass the `ok` cut will have their</span>
<span class="sd">        uncertainties inflated to infinity (np.inf).</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    x : array</span>
<span class="sd">        The time.</span>
<span class="sd">    y : array</span>
<span class="sd">        The desired quantity (default is `flux`)</span>
<span class="sd">    sigma : array</span>
<span class="sd">        The uncertainty on the desired quantity</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># get 1D independent variable</span>
    <span class="n">x_values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_for_wavelength</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1</span>

    <span class="c1"># get 1D array of what to keep</span>
    <span class="n">ok</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ok</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">&gt;=</span> <span class="n">minimum_acceptable_ok</span>

    <span class="c1"># get 1D array of the quantity</span>
    <span class="n">y_values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_for_wavelength</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1</span>

    <span class="c1"># get 1D array of uncertainty</span>
    <span class="n">sigma_values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_for_wavelength</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">sigma</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1</span>

    <span class="k">if</span> <span class="n">express_badness_with_uncertainty</span><span class="p">:</span>
        <span class="n">sigma_values</span><span class="p">[</span><span class="n">ok</span> <span class="o">==</span> <span class="kc">False</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
        <span class="k">return</span> <span class="n">x_values</span><span class="p">,</span> <span class="n">y_values</span><span class="p">,</span> <span class="n">sigma_values</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">x_values</span><span class="p">[</span><span class="n">ok</span><span class="p">],</span> <span class="n">y_values</span><span class="p">[</span><span class="n">ok</span><span class="p">],</span> <span class="n">sigma_values</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.get.wavelike.subset.leftright_to_edges" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">leftright_to_edges</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.get.wavelike.subset.leftright_to_edges" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Convert two arrays of N left/right edges to N+1 continugous edges.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/tools/resampling.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">leftright_to_edges</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert two arrays of N left/right edges to N+1 continugous edges.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">edges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>
    <span class="k">return</span> <span class="n">edges</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.get.wavelike.subset.name2color" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">name2color</span><span class="p">(</span><span class="n">name</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.get.wavelike.subset.name2color" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Return the 3-element RGB array of a given color name.</p>
<h4 id="chromatic.rainbows.get.wavelike.subset.name2color--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.get.wavelike.subset.name2color--parameters" title="Permanent link">#</a></h4>
<p>name : str
    The name of a color</p>
<h4 id="chromatic.rainbows.get.wavelike.subset.name2color--returns">Returns<a class="headerlink" href="#chromatic.rainbows.get.wavelike.subset.name2color--returns" title="Permanent link">#</a></h4>
<p>rgb : tuple
    3-element RGB color, with numbers from 0.0 to 1.0</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/imports.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">name2color</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return the 3-element RGB array of a given color name.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    name : str</span>
<span class="sd">        The name of a color</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    rgb : tuple</span>
<span class="sd">        3-element RGB color, with numbers from 0.0 to 1.0</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># give a friendly warning if the color name can&#39;t be found</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">color_hex</span> <span class="o">=</span> <span class="n">col</span><span class="o">.</span><span class="n">cnames</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">col</span><span class="o">.</span><span class="n">hex2color</span><span class="p">(</span><span class="n">color_hex</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="n">cheerfully_suggest</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The color </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> can&#39;t be found. (Returning black.)&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.get.wavelike.subset.one2another" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">one2another</span><span class="p">(</span><span class="n">bottom</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">alpha_bottom</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">alpha_top</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">256</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.get.wavelike.subset.one2another" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Create a cmap that goes smoothly (linearly in RGBA) from "bottom" to "top".</p>
<h4 id="chromatic.rainbows.get.wavelike.subset.one2another--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.get.wavelike.subset.one2another--parameters" title="Permanent link">#</a></h4>
<p>bottom : str
    Name of a color for the bottom of cmap (0.0)
top : str
    Name of a color for the top of the cmap (1.0)
alpha_bottom : float
    Opacity at the bottom of the cmap
alpha_top : float
    Opacitiy at the top of the cmap
N : int
    The number of levels in the listed color map</p>
<h4 id="chromatic.rainbows.get.wavelike.subset.one2another--returns">Returns<a class="headerlink" href="#chromatic.rainbows.get.wavelike.subset.one2another--returns" title="Permanent link">#</a></h4>
<p>cmap : Colormap
    A color map that goes linearly from the
    bottom to top color (and alpha).</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/imports.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">one2another</span><span class="p">(</span><span class="n">bottom</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">alpha_bottom</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">alpha_top</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">256</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a cmap that goes smoothly (linearly in RGBA) from &quot;bottom&quot; to &quot;top&quot;.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    bottom : str</span>
<span class="sd">        Name of a color for the bottom of cmap (0.0)</span>
<span class="sd">    top : str</span>
<span class="sd">        Name of a color for the top of the cmap (1.0)</span>
<span class="sd">    alpha_bottom : float</span>
<span class="sd">        Opacity at the bottom of the cmap</span>
<span class="sd">    alpha_top : float</span>
<span class="sd">        Opacitiy at the top of the cmap</span>
<span class="sd">    N : int</span>
<span class="sd">        The number of levels in the listed color map</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    cmap : Colormap</span>
<span class="sd">        A color map that goes linearly from the</span>
<span class="sd">        bottom to top color (and alpha).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># get the RGB values of the bottom and top of the cmap</span>
    <span class="n">rgb_bottom</span><span class="p">,</span> <span class="n">rgb_top</span> <span class="o">=</span> <span class="n">name2color</span><span class="p">(</span><span class="n">bottom</span><span class="p">),</span> <span class="n">name2color</span><span class="p">(</span><span class="n">top</span><span class="p">)</span>

    <span class="c1"># create linear gradients for all four RGBA channels</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">rgb_bottom</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">rgb_top</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">N</span><span class="p">)</span>
    <span class="n">g</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">rgb_bottom</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">rgb_top</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">N</span><span class="p">)</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">rgb_bottom</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">rgb_top</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">N</span><span class="p">)</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">alpha_bottom</span><span class="p">,</span> <span class="n">alpha_top</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>

    <span class="c1"># create (N,4) array + populate a listed colormap</span>
    <span class="n">colors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">]))</span>
    <span class="n">cmap</span> <span class="o">=</span> <span class="n">col</span><span class="o">.</span><span class="n">ListedColormap</span><span class="p">(</span><span class="n">colors</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{bottom}</span><span class="s2">2</span><span class="si">{top}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="nb">locals</span><span class="p">()))</span>

    <span class="c1"># return the colormap</span>
    <span class="k">return</span> <span class="n">cmap</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.get.wavelike.subset.remove_unit" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">remove_unit</span><span class="p">(</span><span class="n">x</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.get.wavelike.subset.remove_unit" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Quick wrapper to remove the unit from a quantity,
but not complain if it doesn't have one.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/imports.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">remove_unit</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Quick wrapper to remove the unit from a quantity,</span>
<span class="sd">    but not complain if it doesn&#39;t have one.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">x</span><span class="o">.</span><span class="n">value</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">x</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.get.wavelike.subset.resample_while_conserving_flux" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">resample_while_conserving_flux</span><span class="p">(</span><span class="n">xin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">yin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xout</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xin_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xout_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">replace_nans</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">visualize</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">pause</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.get.wavelike.subset.resample_while_conserving_flux" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Starting from some initial x and y, resample onto a
different grid (either higher or lower resolution),
while conserving total flux.</p>
<p>When including the entire range of <code>xin</code>,
<code>sum(yout) == sum(yin)</code> should be true.</p>
<p>When including only part of the range of <code>xin</code>,
the integral between any two points should be conserved.</p>
<h4 id="chromatic.rainbows.get.wavelike.subset.resample_while_conserving_flux--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.get.wavelike.subset.resample_while_conserving_flux--parameters" title="Permanent link">#</a></h4>
<p>xin : array
    The original independent variable.
yin : array
    The original dependent variable (same size as x).
xout : array
    The new grid of independent variables onto which
    you want to resample the y values. Refers to the
    center of each bin (use <code>xout_edges</code> for finer
    control over the exact edges of the bins)
xin_edges : array
    The edges of the original independent variable bins.
    The left and right edges of the bins are interpreted
    to be <code>xin_edges[:-1]</code> and <code>xin_edges[1:]</code>,
    respectively, so the associated <code>yin</code> should have exactly
    1 fewer element than <code>xin_edges</code>. This provides finer
    control over the size of each bin in the input than
    simply supplying <code>xin</code>(still a little experimental)
    They should probably be sorted?
xout_edges : array
    The edges of the new grid of bins for the independent
    variable, onto which you want to resample the y
    values. The left and right edges of the bins will be,
    respectively, <code>xout_edges[:-1]</code> and <code>xout_edges[1:]</code>,
    so the size of the output array will be
    <code>len(xout_edges) - 1</code>
replace_nans : float, str
    Replace nan values with this value.
    <code>replace_nans = 0</code>
        will add no flux where nans are
    <code>replace_nans = nan</code>
        will ensure you get nans returned everywhere
        if you try to resample over any nan
    <code>replace_nans = 'interpolate'</code>
        will try to replace nans by linearly interpolating
        from nearby values (not yet implemented)
visualize : bool
    Should we make a plot showing whether it worked?
pause : bool
    Should we pause to wait for a key press?</p>
<h4 id="chromatic.rainbows.get.wavelike.subset.resample_while_conserving_flux--returns">Returns<a class="headerlink" href="#chromatic.rainbows.get.wavelike.subset.resample_while_conserving_flux--returns" title="Permanent link">#</a></h4>
<p>result : dict
    A dictionary containing...
        <code>x</code> = the center of the output grid
        <code>y</code> = the resampled value on the output grid
        <code>edges</code> = the edges of the output grid, which will
            have one more element than x or y</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/tools/resampling.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">resample_while_conserving_flux</span><span class="p">(</span>
    <span class="n">xin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">yin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">xout</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">xin_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">xout_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">replace_nans</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
    <span class="n">visualize</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">pause</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Starting from some initial x and y, resample onto a</span>
<span class="sd">    different grid (either higher or lower resolution),</span>
<span class="sd">    while conserving total flux.</span>

<span class="sd">    When including the entire range of `xin`,</span>
<span class="sd">    `sum(yout) == sum(yin)` should be true.</span>

<span class="sd">    When including only part of the range of `xin`,</span>
<span class="sd">    the integral between any two points should be conserved.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    xin : array</span>
<span class="sd">        The original independent variable.</span>
<span class="sd">    yin : array</span>
<span class="sd">        The original dependent variable (same size as x).</span>
<span class="sd">    xout : array</span>
<span class="sd">        The new grid of independent variables onto which</span>
<span class="sd">        you want to resample the y values. Refers to the</span>
<span class="sd">        center of each bin (use `xout_edges` for finer</span>
<span class="sd">        control over the exact edges of the bins)</span>
<span class="sd">    xin_edges : array</span>
<span class="sd">        The edges of the original independent variable bins.</span>
<span class="sd">        The left and right edges of the bins are interpreted</span>
<span class="sd">        to be `xin_edges[:-1]` and `xin_edges[1:]`,</span>
<span class="sd">        respectively, so the associated `yin` should have exactly</span>
<span class="sd">        1 fewer element than `xin_edges`. This provides finer</span>
<span class="sd">        control over the size of each bin in the input than</span>
<span class="sd">        simply supplying `xin`(still a little experimental)</span>
<span class="sd">        They should probably be sorted?</span>
<span class="sd">    xout_edges : array</span>
<span class="sd">        The edges of the new grid of bins for the independent</span>
<span class="sd">        variable, onto which you want to resample the y</span>
<span class="sd">        values. The left and right edges of the bins will be,</span>
<span class="sd">        respectively, `xout_edges[:-1]` and `xout_edges[1:]`,</span>
<span class="sd">        so the size of the output array will be</span>
<span class="sd">        `len(xout_edges) - 1`</span>
<span class="sd">    replace_nans : float, str</span>
<span class="sd">        Replace nan values with this value.</span>
<span class="sd">        `replace_nans = 0`</span>
<span class="sd">            will add no flux where nans are</span>
<span class="sd">        `replace_nans = nan`</span>
<span class="sd">            will ensure you get nans returned everywhere</span>
<span class="sd">            if you try to resample over any nan</span>
<span class="sd">        `replace_nans = &#39;interpolate&#39;`</span>
<span class="sd">            will try to replace nans by linearly interpolating</span>
<span class="sd">            from nearby values (not yet implemented)</span>
<span class="sd">    visualize : bool</span>
<span class="sd">        Should we make a plot showing whether it worked?</span>
<span class="sd">    pause : bool</span>
<span class="sd">        Should we pause to wait for a key press?</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    result : dict</span>
<span class="sd">        A dictionary containing...</span>
<span class="sd">            `x` = the center of the output grid</span>
<span class="sd">            `y` = the resampled value on the output grid</span>
<span class="sd">            `edges` = the edges of the output grid, which will</span>
<span class="sd">                have one more element than x or y</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># make sure there are some reasonable input options</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">xin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">xin_edges</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">yin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">xout</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">xout_edges</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>

    <span class="c1"># set up the bins, to calculate cumulative distribution of y</span>
    <span class="k">if</span> <span class="n">xin_edges</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># make sure the sizes match up</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">xin</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">yin</span><span class="p">)</span>
        <span class="c1"># sort to make sure x is strictly increasing</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">xin</span><span class="p">)</span>
        <span class="n">xin_sorted</span> <span class="o">=</span> <span class="n">xin</span><span class="p">[</span><span class="n">s</span><span class="p">]</span>
        <span class="n">yin_sorted</span> <span class="o">=</span> <span class="n">yin</span><span class="p">[</span><span class="n">s</span><span class="p">]</span>
        <span class="c1"># estimate some bin edges (might fail for non-uniform grids)</span>
        <span class="n">xin_left</span><span class="p">,</span> <span class="n">xin_right</span> <span class="o">=</span> <span class="n">calculate_bin_leftright</span><span class="p">(</span><span class="n">xin_sorted</span><span class="p">)</span>
        <span class="c1"># define an array of edges</span>
        <span class="n">xin_edges</span> <span class="o">=</span> <span class="n">leftright_to_edges</span><span class="p">(</span><span class="n">xin_left</span><span class="p">,</span> <span class="n">xin_right</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># make sure the sizes match up</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">xin_edges</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">yin</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="c1"># sort to make sure x is strictly increasing</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">xin_edges</span><span class="p">)</span>
        <span class="n">xin_left</span><span class="p">,</span> <span class="n">xin_right</span> <span class="o">=</span> <span class="n">edges_to_leftright</span><span class="p">(</span><span class="n">xin_edges</span><span class="p">[</span><span class="n">s</span><span class="p">])</span>
        <span class="n">xin_sorted</span> <span class="o">=</span> <span class="p">(</span><span class="n">xin_left</span> <span class="o">+</span> <span class="n">xin_right</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">yin_sorted</span> <span class="o">=</span> <span class="n">yin</span><span class="p">[</span><span class="n">s</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>

    <span class="c1"># the first element should be the left edge of the first pixel</span>
    <span class="c1"># last element will be right edge of last pixel</span>
    <span class="n">xin_for_cdf</span> <span class="o">=</span> <span class="n">xin_edges</span>

    <span class="c1"># to the left of the first pixel, assume flux is zero</span>
    <span class="n">yin_for_cdf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">yin_sorted</span><span class="p">])</span>

    <span class="c1"># correct for any non-finite values</span>
    <span class="n">bad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">yin_for_cdf</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">replace_nans</span> <span class="o">==</span> <span class="s2">&quot;interpolate&quot;</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
            <span class="s2">&quot;The `replace_nans=&#39;interpolate&#39;`` option doens&#39;t exist yet!&quot;</span>
        <span class="p">)</span>
    <span class="n">yin_for_cdf</span><span class="p">[</span><span class="n">bad</span><span class="p">]</span> <span class="o">=</span> <span class="n">replace_nans</span>

    <span class="c1"># calculate the CDF of the flux (at pixel edge locations)</span>
    <span class="n">cdfin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">yin_for_cdf</span><span class="p">)</span>

    <span class="c1"># create an interpolator for that CDF</span>
    <span class="n">cdfinterpolator</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span>
        <span class="n">xin_for_cdf</span><span class="p">,</span>
        <span class="n">cdfin</span><span class="p">,</span>
        <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span>
        <span class="n">bounds_error</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">fill_value</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">yin</span><span class="p">)),</span>
    <span class="p">)</span>

    <span class="c1"># calculate bin edges (of size len(xout)+1)</span>
    <span class="k">if</span> <span class="n">xout_edges</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">xout_left</span><span class="p">,</span> <span class="n">xout_right</span> <span class="o">=</span> <span class="n">calculate_bin_leftright</span><span class="p">(</span><span class="n">xout</span><span class="p">)</span>
        <span class="n">xout_edges</span> <span class="o">=</span> <span class="n">leftright_to_edges</span><span class="p">(</span><span class="n">xout_left</span><span class="p">,</span> <span class="n">xout_right</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">xout_left</span><span class="p">,</span> <span class="n">xout_right</span> <span class="o">=</span> <span class="n">edges_to_leftright</span><span class="p">(</span><span class="n">xout_edges</span><span class="p">)</span>
        <span class="n">xout</span> <span class="o">=</span> <span class="p">(</span><span class="n">xout_left</span> <span class="o">+</span> <span class="n">xout_right</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>

    <span class="n">xout_for_cdf</span> <span class="o">=</span> <span class="n">leftright_to_edges</span><span class="p">(</span><span class="n">xout_left</span><span class="p">,</span> <span class="n">xout_right</span><span class="p">)</span>

    <span class="c1"># interpolate the CDF onto those bin edges</span>
    <span class="n">cdfout</span> <span class="o">=</span> <span class="n">cdfinterpolator</span><span class="p">(</span><span class="n">xout_for_cdf</span><span class="p">)</span>

    <span class="c1"># take  derivative of the CDF to get flux per resampled bin</span>
    <span class="c1"># (xout is bin center, and yout is the flux in that bin)</span>
    <span class="n">yout</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">cdfout</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">visualize</span><span class="p">:</span>
        <span class="n">fi</span><span class="p">,</span> <span class="p">(</span><span class="n">ax_cdf</span><span class="p">,</span> <span class="n">ax_pdf</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
        <span class="n">inkw</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
            <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span>
            <span class="n">markeredgecolor</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">outkw</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;darkorange&quot;</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span>
            <span class="n">markersize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
            <span class="n">markeredgecolor</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">legkw</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper left&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">xinbinsize</span> <span class="o">=</span> <span class="n">xin_right</span> <span class="o">-</span> <span class="n">xin_left</span>
        <span class="n">xoutbinsize</span> <span class="o">=</span> <span class="n">xout_right</span> <span class="o">-</span> <span class="n">xout_left</span>
        <span class="c1"># plot the PDFs</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="n">ax_pdf</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Flux per (Original) Pixel&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Pixel&quot;</span><span class="p">)</span>
        <span class="c1"># plot the original pixels (in df/dpixel to compare with resampled)</span>
        <span class="n">plot_as_boxes</span><span class="p">(</span>
            <span class="n">xin_sorted</span><span class="p">,</span> <span class="n">yin_sorted</span> <span class="o">/</span> <span class="n">xinbinsize</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Original Pixels&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">inkw</span>
        <span class="p">)</span>

        <span class="c1"># what would a bad interpolation look like?</span>
        <span class="n">interpolate_badly</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span>
            <span class="n">xin_sorted</span><span class="p">,</span>
            <span class="n">yin_sorted</span> <span class="o">/</span> <span class="n">xinbinsize</span><span class="p">,</span>
            <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span>
            <span class="n">bounds_error</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">fill_value</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
            <span class="n">xout</span><span class="p">,</span>
            <span class="n">interpolate_badly</span><span class="p">(</span><span class="n">xout</span><span class="p">),</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;cornflowerblue&quot;</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span>
            <span class="n">markersize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
            <span class="n">markeredgecolor</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Silly Simple Interpolation&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># plot the flux-conserving resampled data (again, in df/d&quot;pixel&quot;)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
            <span class="n">xout</span><span class="p">,</span> <span class="n">yout</span> <span class="o">/</span> <span class="n">xoutbinsize</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Flux-Conserving Interpolation&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">outkw</span>
        <span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="o">**</span><span class="n">legkw</span><span class="p">)</span>

        <span class="c1"># plot the CDFs</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="n">ax_cdf</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Cumulative Flux (from left)&quot;</span><span class="p">)</span>

        <span class="c1"># plot the original CDF</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xin_for_cdf</span><span class="p">,</span> <span class="n">cdfin</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Original Pixels&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">inkw</span><span class="p">)</span>

        <span class="c1"># plot the interpolated CDF</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xout_for_cdf</span><span class="p">,</span> <span class="n">cdfout</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Flux-Conserved Resample&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">outkw</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">pause</span><span class="p">:</span>
            <span class="n">a</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span>
                <span class="s2">&quot;Pausing a moment to check on interpolation; press return to continue.&quot;</span>
            <span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{:&gt;6}</span><span class="s2"> = </span><span class="si">{:.5f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;Actual&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">yin</span><span class="p">)))</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="s2">&quot;</span><span class="si">{:&gt;6}</span><span class="s2"> = </span><span class="si">{:.5f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="s2">&quot;Silly&quot;</span><span class="p">,</span>
                <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">interpolate_badly</span><span class="p">(</span><span class="n">xout</span><span class="p">)</span> <span class="o">*</span> <span class="n">xoutbinsize</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{:&gt;6}</span><span class="s2"> = </span><span class="si">{:.5f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;CDF&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">yout</span><span class="p">)))</span>

    <span class="c1"># return the resampled y-values</span>
    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="n">xout</span><span class="p">,</span> <span class="s2">&quot;x_edge_lower&quot;</span><span class="p">:</span> <span class="n">xout_left</span><span class="p">,</span> <span class="s2">&quot;x_edge_upper&quot;</span><span class="p">:</span> <span class="n">xout_right</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="n">yout</span><span class="p">}</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><h2 id="visualizations">🌈 Visualizations<a class="headerlink" href="#visualizations" title="Permanent link">#</a></h2>


<div class="doc doc-object doc-module">



<a id="chromatic.rainbows.visualizations.animate"></a>
    <div class="doc doc-contents first">









  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.visualizations.animate.animate_lightcurves" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">animate_lightcurves</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;animated-lightcurves.gif&#39;</span><span class="p">,</span> <span class="n">fps</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">bitrate</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.visualizations.animate.animate_lightcurves" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Create an animation to show how the lightcurve changes
as we flip through every wavelength.</p>
<h4 id="chromatic.rainbows.visualizations.animate.animate_lightcurves--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.visualizations.animate.animate_lightcurves--parameters" title="Permanent link">#</a></h4>
<p>filename : str
    Name of file you'd like to save results in.
    Currently supports only .gif or .html files.
fps : float
    frames/second of animation
ax : Axes
    The axes into which this animated plot should go.
xlim : tuple
    Custom xlimits for the plot
ylim : tuple
    Custom ylimits for the plot
cmap : str,
    The color map to use for expressing wavelength
vmin : Quantity
    The minimum value to use for the wavelength colormap
vmax : Quantity
    The maximum value to use for the wavelength colormap
scatterkw : dict
    A dictionary of keywords to be passed to <code>plt.scatter</code>
    so you can have more detailed control over the plot
    appearance. Common keyword arguments might include:
    <code>[s, c, marker, alpha, linewidths, edgecolors, zorder]</code> (and more)
    More details are available at
    https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.scatter.html
textkw : dict
    A dictionary of keywords passed to <code>plt.text</code>
    so you can have more detailed control over the text
    appearance. Common keyword arguments might include:
    <code>[alpha, backgroundcolor, color, fontfamily, fontsize,
      fontstyle, fontweight, rotation, zorder]</code> (and more)
    More details are available at
    https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.text.html</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/rainbows/visualizations/animate.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">animate_lightcurves</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">filename</span><span class="o">=</span><span class="s2">&quot;animated-lightcurves.gif&quot;</span><span class="p">,</span>
    <span class="n">fps</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
    <span class="n">dpi</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">bitrate</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create an animation to show how the lightcurve changes</span>
<span class="sd">    as we flip through every wavelength.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    filename : str</span>
<span class="sd">        Name of file you&#39;d like to save results in.</span>
<span class="sd">        Currently supports only .gif or .html files.</span>
<span class="sd">    fps : float</span>
<span class="sd">        frames/second of animation</span>
<span class="sd">    ax : Axes</span>
<span class="sd">        The axes into which this animated plot should go.</span>
<span class="sd">    xlim : tuple</span>
<span class="sd">        Custom xlimits for the plot</span>
<span class="sd">    ylim : tuple</span>
<span class="sd">        Custom ylimits for the plot</span>
<span class="sd">    cmap : str,</span>
<span class="sd">        The color map to use for expressing wavelength</span>
<span class="sd">    vmin : Quantity</span>
<span class="sd">        The minimum value to use for the wavelength colormap</span>
<span class="sd">    vmax : Quantity</span>
<span class="sd">        The maximum value to use for the wavelength colormap</span>
<span class="sd">    scatterkw : dict</span>
<span class="sd">        A dictionary of keywords to be passed to `plt.scatter`</span>
<span class="sd">        so you can have more detailed control over the plot</span>
<span class="sd">        appearance. Common keyword arguments might include:</span>
<span class="sd">        `[s, c, marker, alpha, linewidths, edgecolors, zorder]` (and more)</span>
<span class="sd">        More details are available at</span>
<span class="sd">        https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.scatter.html</span>
<span class="sd">    textkw : dict</span>
<span class="sd">        A dictionary of keywords passed to `plt.text`</span>
<span class="sd">        so you can have more detailed control over the text</span>
<span class="sd">        appearance. Common keyword arguments might include:</span>
<span class="sd">        `[alpha, backgroundcolor, color, fontfamily, fontsize,</span>
<span class="sd">          fontstyle, fontweight, rotation, zorder]` (and more)</span>
<span class="sd">        More details are available at</span>
<span class="sd">        https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.text.html</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_setup_animate_lightcurves</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_label_plot_file</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

    <span class="c1"># initialize the animator</span>
    <span class="n">writer</span><span class="p">,</span> <span class="n">displayer</span> <span class="o">=</span> <span class="n">get_animation_writer_and_displayer</span><span class="p">(</span>
        <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span> <span class="n">fps</span><span class="o">=</span><span class="n">fps</span><span class="p">,</span> <span class="n">bitrate</span><span class="o">=</span><span class="n">bitrate</span>
    <span class="p">)</span>

    <span class="c1"># set up to save frames directly into the animation</span>
    <span class="n">figure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_animate_lightcurves_components</span><span class="p">[</span><span class="s2">&quot;fi&quot;</span><span class="p">]</span>
    <span class="k">with</span> <span class="n">writer</span><span class="o">.</span><span class="n">saving</span><span class="p">(</span><span class="n">figure</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">dpi</span> <span class="ow">or</span> <span class="n">figure</span><span class="o">.</span><span class="n">get_dpi</span><span class="p">()):</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nwave</span><span class="p">),</span> <span class="n">leave</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_animate_lightcurves_components</span><span class="p">[</span><span class="s2">&quot;update&quot;</span><span class="p">](</span><span class="n">i</span><span class="p">)</span>
            <span class="n">writer</span><span class="o">.</span><span class="n">grab_frame</span><span class="p">()</span>

    <span class="c1"># close the figure that was created</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">figure</span><span class="p">)</span>

    <span class="c1"># display the animation</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">IPython.display</span><span class="w"> </span><span class="kn">import</span> <span class="n">display</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">display</span><span class="p">(</span><span class="n">displayer</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">embed</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
    <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
        <span class="n">display</span><span class="p">(</span><span class="n">displayer</span><span class="p">(</span><span class="n">filename</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.visualizations.animate.animate_spectra" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">animate_spectra</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;animated-spectra.gif&#39;</span><span class="p">,</span> <span class="n">fps</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">bitrate</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.visualizations.animate.animate_spectra" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Create an animation to show how the spectrum changes
as we flip through every timepoint.</p>
<h4 id="chromatic.rainbows.visualizations.animate.animate_spectra--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.visualizations.animate.animate_spectra--parameters" title="Permanent link">#</a></h4>
<p>filename : str
    Name of file you'd like to save results in.
    Currently supports only .gif files.
ax : Axes
    The axes into which this animated plot should go.
fps : float
    frames/second of animation
xlim : tuple
    Custom xlimits for the plot
ylim : tuple
    Custom ylimits for the plot
cmap : str,
    The color map to use for expressing wavelength
vmin : Quantity
    The minimum value to use for the wavelength colormap
vmax : Quantity
    The maximum value to use for the wavelength colormap
scatterkw : dict
    A dictionary of keywords to be passed to <code>plt.scatter</code>
    so you can have more detailed control over the plot
    appearance. Common keyword arguments might include:
    <code>[s, c, marker, alpha, linewidths, edgecolors, zorder]</code> (and more)
    More details are available at
    https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.scatter.html
textkw : dict
    A dictionary of keywords passed to <code>plt.text</code>
    so you can have more detailed control over the text
    appearance. Common keyword arguments might include:
    <code>[alpha, backgroundcolor, color, fontfamily, fontsize,
      fontstyle, fontweight, rotation, zorder]</code> (and more)
    More details are available at
    https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.text.html</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/rainbows/visualizations/animate.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">animate_spectra</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s2">&quot;animated-spectra.gif&quot;</span><span class="p">,</span> <span class="n">fps</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">bitrate</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create an animation to show how the spectrum changes</span>
<span class="sd">    as we flip through every timepoint.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    filename : str</span>
<span class="sd">        Name of file you&#39;d like to save results in.</span>
<span class="sd">        Currently supports only .gif files.</span>
<span class="sd">    ax : Axes</span>
<span class="sd">        The axes into which this animated plot should go.</span>
<span class="sd">    fps : float</span>
<span class="sd">        frames/second of animation</span>
<span class="sd">    xlim : tuple</span>
<span class="sd">        Custom xlimits for the plot</span>
<span class="sd">    ylim : tuple</span>
<span class="sd">        Custom ylimits for the plot</span>
<span class="sd">    cmap : str,</span>
<span class="sd">        The color map to use for expressing wavelength</span>
<span class="sd">    vmin : Quantity</span>
<span class="sd">        The minimum value to use for the wavelength colormap</span>
<span class="sd">    vmax : Quantity</span>
<span class="sd">        The maximum value to use for the wavelength colormap</span>
<span class="sd">    scatterkw : dict</span>
<span class="sd">        A dictionary of keywords to be passed to `plt.scatter`</span>
<span class="sd">        so you can have more detailed control over the plot</span>
<span class="sd">        appearance. Common keyword arguments might include:</span>
<span class="sd">        `[s, c, marker, alpha, linewidths, edgecolors, zorder]` (and more)</span>
<span class="sd">        More details are available at</span>
<span class="sd">        https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.scatter.html</span>
<span class="sd">    textkw : dict</span>
<span class="sd">        A dictionary of keywords passed to `plt.text`</span>
<span class="sd">        so you can have more detailed control over the text</span>
<span class="sd">        appearance. Common keyword arguments might include:</span>
<span class="sd">        `[alpha, backgroundcolor, color, fontfamily, fontsize,</span>
<span class="sd">          fontstyle, fontweight, rotation, zorder]` (and more)</span>
<span class="sd">        More details are available at</span>
<span class="sd">        https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.text.html</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_setup_animate_spectra</span><span class="p">(</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span>

    <span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_label_plot_file</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    <span class="c1"># initialize the animator</span>
    <span class="n">writer</span><span class="p">,</span> <span class="n">displayer</span> <span class="o">=</span> <span class="n">get_animation_writer_and_displayer</span><span class="p">(</span>
        <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span> <span class="n">fps</span><span class="o">=</span><span class="n">fps</span><span class="p">,</span> <span class="n">bitrate</span><span class="o">=</span><span class="n">bitrate</span>
    <span class="p">)</span>

    <span class="c1"># set up to save frames directly into the animation</span>
    <span class="n">figure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_animate_spectra_components</span><span class="p">[</span><span class="s2">&quot;fi&quot;</span><span class="p">]</span>
    <span class="k">with</span> <span class="n">writer</span><span class="o">.</span><span class="n">saving</span><span class="p">(</span><span class="n">figure</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">dpi</span> <span class="ow">or</span> <span class="n">figure</span><span class="o">.</span><span class="n">get_dpi</span><span class="p">()):</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ntime</span><span class="p">),</span> <span class="n">leave</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_animate_spectra_components</span><span class="p">[</span><span class="s2">&quot;update&quot;</span><span class="p">](</span><span class="n">i</span><span class="p">)</span>
            <span class="n">writer</span><span class="o">.</span><span class="n">grab_frame</span><span class="p">()</span>

    <span class="c1"># close the figure that was created</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">figure</span><span class="p">)</span>

    <span class="c1"># display the animation</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">IPython.display</span><span class="w"> </span><span class="kn">import</span> <span class="n">display</span>

    <span class="n">display</span><span class="p">(</span><span class="n">displayer</span><span class="p">(</span><span class="n">filename</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.visualizations.animate.bintoR" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">bintoR</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">unc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">R</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">weighting</span><span class="o">=</span><span class="s1">&#39;inversevariance&#39;</span><span class="p">,</span> <span class="n">drop_nans</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.visualizations.animate.bintoR" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Bin any x and y array onto a logarithmicly uniform grid.</p>
<h4 id="chromatic.rainbows.visualizations.animate.bintoR--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.visualizations.animate.bintoR--parameters" title="Permanent link">#</a></h4>
<p>x : array
    The original independent variable.
    (For a spectrum example = wavelength)
y : array
    The original dependent variable (same size as x).
    (For a spectrum example = flux)
unc : array, None, optional
    The unceratinty on the dependent variable
    (For a spectrum example = the flux uncertainty)
R : array, optional
    The spectral resolution R=x/dx for creating a new,
    logarithmically uniform grid that starts at the first
    value of x.
xlim : list, array, optional
    A two-element list indicating the min and max values of
    x for the new logarithmically spaced grid. If None,
    these limits will be created from the data themselves
weighting : str, optional
    How should we weight values when averaging
    them together into one larger bin?
    <code>weighting = 'inversevariance'</code>
        weights = 1/unc**2
     <code>weighting = {literally anything else}</code>
        uniform weights
    This will have no impact if <code>unc == None</code>, or for any
    new bins that effectively overlap less than one original
    unbinned point.
drop_nans : bool, optional
    Should we skip any bins turn out to be nans?
    This most often happens when bins are empty.</p>
<h4 id="chromatic.rainbows.visualizations.animate.bintoR--returns">Returns<a class="headerlink" href="#chromatic.rainbows.visualizations.animate.bintoR--returns" title="Permanent link">#</a></h4>
<p>result : dict
    A dictionary containing at least...
        <code>x</code> = the center of the output grid
        <code>y</code> = the resampled value on the output grid
        <code>x_edge_lower</code> = the lower edges of the output grid
        <code>x_edge_upper</code> = the upper edges of the output grid
    ...and possibly also
        <code>uncertainty</code> = the calculated uncertainty per bin</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/tools/resampling.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">bintoR</span><span class="p">(</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">unc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">R</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">weighting</span><span class="o">=</span><span class="s2">&quot;inversevariance&quot;</span><span class="p">,</span> <span class="n">drop_nans</span><span class="o">=</span><span class="kc">True</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Bin any x and y array onto a logarithmicly uniform grid.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : array</span>
<span class="sd">        The original independent variable.</span>
<span class="sd">        (For a spectrum example = wavelength)</span>
<span class="sd">    y : array</span>
<span class="sd">        The original dependent variable (same size as x).</span>
<span class="sd">        (For a spectrum example = flux)</span>
<span class="sd">    unc : array, None, optional</span>
<span class="sd">        The unceratinty on the dependent variable</span>
<span class="sd">        (For a spectrum example = the flux uncertainty)</span>
<span class="sd">    R : array, optional</span>
<span class="sd">        The spectral resolution R=x/dx for creating a new,</span>
<span class="sd">        logarithmically uniform grid that starts at the first</span>
<span class="sd">        value of x.</span>
<span class="sd">    xlim : list, array, optional</span>
<span class="sd">        A two-element list indicating the min and max values of</span>
<span class="sd">        x for the new logarithmically spaced grid. If None,</span>
<span class="sd">        these limits will be created from the data themselves</span>
<span class="sd">    weighting : str, optional</span>
<span class="sd">        How should we weight values when averaging</span>
<span class="sd">        them together into one larger bin?</span>
<span class="sd">        `weighting = &#39;inversevariance&#39;`</span>
<span class="sd">            weights = 1/unc**2</span>
<span class="sd">         `weighting = {literally anything else}`</span>
<span class="sd">            uniform weights</span>
<span class="sd">        This will have no impact if `unc == None`, or for any</span>
<span class="sd">        new bins that effectively overlap less than one original</span>
<span class="sd">        unbinned point.</span>
<span class="sd">    drop_nans : bool, optional</span>
<span class="sd">        Should we skip any bins turn out to be nans?</span>
<span class="sd">        This most often happens when bins are empty.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    result : dict</span>
<span class="sd">        A dictionary containing at least...</span>
<span class="sd">            `x` = the center of the output grid</span>
<span class="sd">            `y` = the resampled value on the output grid</span>
<span class="sd">            `x_edge_lower` = the lower edges of the output grid</span>
<span class="sd">            `x_edge_upper` = the upper edges of the output grid</span>
<span class="sd">        ...and possibly also</span>
<span class="sd">            `uncertainty` = the calculated uncertainty per bin</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">x_unit</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">unit</span>
        <span class="n">x_without_unit</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">value</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="n">x_unit</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">x_without_unit</span> <span class="o">=</span> <span class="n">x</span>

    <span class="c1"># create a new grid of x at the given resolution</span>
    <span class="n">lnx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">x_without_unit</span><span class="p">)</span>
    <span class="n">dnewlnx</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">R</span>

    <span class="c1"># set the limits of the new xgrid (in log space)</span>
    <span class="k">if</span> <span class="n">xlim</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># use the input grid to set the limits</span>
        <span class="n">lnxbottom</span><span class="p">,</span> <span class="n">lnxtop</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">lnx</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">lnx</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># use the custom xlim to set the limits</span>
        <span class="n">lnxbottom</span><span class="p">,</span> <span class="n">lnxtop</span> <span class="o">=</span> <span class="n">xlim</span>

    <span class="c1"># create a new, log-uniform grid of x values</span>
    <span class="n">newlnx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">lnxbottom</span><span class="p">,</span> <span class="n">lnxtop</span> <span class="o">+</span> <span class="n">dnewlnx</span><span class="p">,</span> <span class="n">dnewlnx</span><span class="p">)</span>

    <span class="c1"># now do the binning on a uniform grid of lnx</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">bintogrid</span><span class="p">(</span>
        <span class="n">lnx</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">unc</span><span class="p">,</span> <span class="n">newx</span><span class="o">=</span><span class="n">newlnx</span><span class="p">,</span> <span class="n">weighting</span><span class="o">=</span><span class="n">weighting</span><span class="p">,</span> <span class="n">drop_nans</span><span class="o">=</span><span class="n">drop_nans</span>
    <span class="p">)</span>

    <span class="c1"># convert back from log to real values</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;x_edge_lower&quot;</span><span class="p">,</span> <span class="s2">&quot;x_edge_upper&quot;</span><span class="p">]:</span>
        <span class="n">result</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="o">*</span> <span class="n">x_unit</span>

    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.visualizations.animate.bintogrid" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">bintogrid</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">unc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">newx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">newx_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">nx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">weighting</span><span class="o">=</span><span class="s1">&#39;inversevariance&#39;</span><span class="p">,</span> <span class="n">drop_nans</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">x_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">visualize</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.visualizations.animate.bintogrid" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Bin any x and y array onto a linearly uniform grid.</p>
<h4 id="chromatic.rainbows.visualizations.animate.bintogrid--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.visualizations.animate.bintogrid--parameters" title="Permanent link">#</a></h4>
<p>x : array
    The original independent variable.
    (For a spectrum example = wavelength)
y : array
    The original dependent variable (same size as x).
    (For a spectrum example = flux)
unc : array, None
    The unceratinty on the dependent variable
    (For a spectrum example = the flux uncertainty)
nx : array
    The number of bins from the original grid to
    bin together into the new one.
dx : array
    The fixed spacing for creating a new, linearly uniform
    grid that start at the first value of x. This will
    be ignored if <code>newx</code> != None.
newx : array
    A new custom grid onto which we should bin.
newx_edges : array
    The edges of the new grid of bins for the independent
    variable, onto which you want to resample the y
    values. The left and right edges of the bins will be,
    respectively, <code>newx_edges[:-1]</code> and <code>newx_edges[1:]</code>,
    so the size of the output array will be
    <code>len(newx_edges) - 1</code>
weighting : str
    How should we weight values when averaging
    them together into one larger bin?
    <code>weighting = 'inversevariance'</code>
        weights = 1/unc**2
     <code>weighting = {literally anything else}</code>
        uniform weights
    This will have no impact if <code>unc == None</code>, or for any
    new bins that effectively overlap less than one original
    unbinned point.
drop_nans : bool
    Should we skip any bins turn out to be nans?
    This most often happens when bins are empty.
x_edges : array
    The edges of the original independent variable bins.
    The left and right edges of the bins are interpreted
    to be <code>x_edges[:-1]</code> and <code>x_edges[1:]</code>,
    respectively, so the associated <code>y</code> should have exactly
    1 fewer element than <code>x_edges</code>. This provides finer
    control over the size of each bin in the input than
    simply supplying <code>x</code>(still a little experimental)</p>
<h4 id="chromatic.rainbows.visualizations.animate.bintogrid--returns">Returns<a class="headerlink" href="#chromatic.rainbows.visualizations.animate.bintogrid--returns" title="Permanent link">#</a></h4>
<p>result : dict
    A dictionary containing at least...
        <code>x</code> = the center of the output grid
        <code>y</code> = the resampled value on the output grid
        <code>x_edge_lower</code> = the lower edges of the output grid
        <code>x_edge_upper</code> = the upper edges of the output grid
    ...and possibly also
        <code>uncertainty</code> = the calculated uncertainty per bin</p>
<p>The order of precendence for setting the new grid is
[<code>newx_edges</code>, <code>newx</code>, <code>dx</code>, <code>nx</code>]
The first will be used, and others will be ignored.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/tools/resampling.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">bintogrid</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">unc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">newx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">newx_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">dx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">nx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">weighting</span><span class="o">=</span><span class="s2">&quot;inversevariance&quot;</span><span class="p">,</span>
    <span class="n">drop_nans</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">x_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">visualize</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Bin any x and y array onto a linearly uniform grid.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : array</span>
<span class="sd">        The original independent variable.</span>
<span class="sd">        (For a spectrum example = wavelength)</span>
<span class="sd">    y : array</span>
<span class="sd">        The original dependent variable (same size as x).</span>
<span class="sd">        (For a spectrum example = flux)</span>
<span class="sd">    unc : array, None</span>
<span class="sd">        The unceratinty on the dependent variable</span>
<span class="sd">        (For a spectrum example = the flux uncertainty)</span>
<span class="sd">    nx : array</span>
<span class="sd">        The number of bins from the original grid to</span>
<span class="sd">        bin together into the new one.</span>
<span class="sd">    dx : array</span>
<span class="sd">        The fixed spacing for creating a new, linearly uniform</span>
<span class="sd">        grid that start at the first value of x. This will</span>
<span class="sd">        be ignored if `newx` != None.</span>
<span class="sd">    newx : array</span>
<span class="sd">        A new custom grid onto which we should bin.</span>
<span class="sd">    newx_edges : array</span>
<span class="sd">        The edges of the new grid of bins for the independent</span>
<span class="sd">        variable, onto which you want to resample the y</span>
<span class="sd">        values. The left and right edges of the bins will be,</span>
<span class="sd">        respectively, `newx_edges[:-1]` and `newx_edges[1:]`,</span>
<span class="sd">        so the size of the output array will be</span>
<span class="sd">        `len(newx_edges) - 1`</span>
<span class="sd">    weighting : str</span>
<span class="sd">        How should we weight values when averaging</span>
<span class="sd">        them together into one larger bin?</span>
<span class="sd">        `weighting = &#39;inversevariance&#39;`</span>
<span class="sd">            weights = 1/unc**2</span>
<span class="sd">         `weighting = {literally anything else}`</span>
<span class="sd">            uniform weights</span>
<span class="sd">        This will have no impact if `unc == None`, or for any</span>
<span class="sd">        new bins that effectively overlap less than one original</span>
<span class="sd">        unbinned point.</span>
<span class="sd">    drop_nans : bool</span>
<span class="sd">        Should we skip any bins turn out to be nans?</span>
<span class="sd">        This most often happens when bins are empty.</span>
<span class="sd">    x_edges : array</span>
<span class="sd">        The edges of the original independent variable bins.</span>
<span class="sd">        The left and right edges of the bins are interpreted</span>
<span class="sd">        to be `x_edges[:-1]` and `x_edges[1:]`,</span>
<span class="sd">        respectively, so the associated `y` should have exactly</span>
<span class="sd">        1 fewer element than `x_edges`. This provides finer</span>
<span class="sd">        control over the size of each bin in the input than</span>
<span class="sd">        simply supplying `x`(still a little experimental)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    result : dict</span>
<span class="sd">        A dictionary containing at least...</span>
<span class="sd">            `x` = the center of the output grid</span>
<span class="sd">            `y` = the resampled value on the output grid</span>
<span class="sd">            `x_edge_lower` = the lower edges of the output grid</span>
<span class="sd">            `x_edge_upper` = the upper edges of the output grid</span>
<span class="sd">        ...and possibly also</span>
<span class="sd">            `uncertainty` = the calculated uncertainty per bin</span>


<span class="sd">    The order of precendence for setting the new grid is</span>
<span class="sd">    [`newx_edges`, `newx`, `dx`, `nx`]</span>
<span class="sd">    The first will be used, and others will be ignored.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># check that an OK set of inputs has been supplied</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">x_edges</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;🌈 Both `x` and `x_edges` were supplied to `bintogrid`. Confusing!&quot;&quot;&quot;</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">x_edges</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;🌈 At least one of `x` or `x_edges` must be supplied to `bintogrid`.&quot;&quot;&quot;</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="n">y</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;🌈 `y` must be supplied to `bintogrid`.&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="c1"># make sure the edges and the centers are set</span>
    <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">x_left</span><span class="p">,</span> <span class="n">x_right</span> <span class="o">=</span> <span class="n">edges_to_leftright</span><span class="p">(</span><span class="n">x_edges</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">left</span> <span class="o">+</span> <span class="n">right</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">x_left</span><span class="p">,</span> <span class="n">x_right</span> <span class="o">=</span> <span class="n">calculate_bin_leftright</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">x_edges</span> <span class="o">=</span> <span class="n">leftright_to_edges</span><span class="p">(</span><span class="n">x_left</span><span class="p">,</span> <span class="n">x_right</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">x_unit</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">unit</span>
        <span class="n">x_without_unit</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">value</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="n">x_unit</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">x_without_unit</span> <span class="o">=</span> <span class="n">x</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">y_unit</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">unit</span>
        <span class="n">y_without_unit</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">value</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="n">y_unit</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">y_without_unit</span> <span class="o">=</span> <span class="n">y</span>

    <span class="c1"># warn if multiple inputs are provided</span>
    <span class="n">number_of_grid_options</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span><span class="n">z</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="p">[</span><span class="n">newx_edges</span><span class="p">,</span> <span class="n">newx</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">nx</span><span class="p">]])</span>
    <span class="k">if</span> <span class="n">number_of_grid_options</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">cheerfully_suggest</span><span class="p">(</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;More than one output grid sent to `bintogrid`.</span>
<span class="sd">                         The one being used is the first to appear in</span>
<span class="sd">                         [`newx_edges`, `newx`, `dx`, `nx`]</span>
<span class="sd">                         but you might want to choose more carefully.&quot;&quot;&quot;</span>
        <span class="p">)</span>

    <span class="c1"># define inputs based on the following order</span>
    <span class="k">if</span> <span class="n">newx_edges</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># define grid by its edges (and define others from there)</span>
        <span class="n">newx_edges_without_unit</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">newx_edges</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">x_unit</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
        <span class="n">dx_without_unit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">newx_edges_without_unit</span><span class="p">)</span>
        <span class="n">newx_without_unit</span> <span class="o">=</span> <span class="n">newx_edges_without_unit</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">dx_without_unit</span>
        <span class="n">newx_left_without_unit</span> <span class="o">=</span> <span class="n">newx_edges_without_unit</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">newx_right_without_unit</span> <span class="o">=</span> <span class="n">newx_edges_without_unit</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

        <span class="c1"># make sure the final output grid is defined</span>
        <span class="n">final_newx</span><span class="p">,</span> <span class="n">final_newx_left</span><span class="p">,</span> <span class="n">final_newx_right</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">newx_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
            <span class="n">newx_left_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
            <span class="n">newx_right_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="n">newx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># define grid by its centers (and define others from there)</span>
        <span class="n">newx_without_unit</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">newx</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">x_unit</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
        <span class="n">newx_left_without_unit</span><span class="p">,</span> <span class="n">newx_right_without_unit</span> <span class="o">=</span> <span class="n">calculate_bin_leftright</span><span class="p">(</span>
            <span class="n">newx_without_unit</span>
        <span class="p">)</span>
        <span class="n">newx_edges_without_unit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span>
            <span class="p">[</span><span class="n">newx_left_without_unit</span><span class="p">,</span> <span class="n">newx_right_without_unit</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
        <span class="p">)</span>
        <span class="n">dx_without_unit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">newx_edges_without_unit</span><span class="p">)</span>

        <span class="c1"># make sure the final output grid is defined</span>
        <span class="n">final_newx</span><span class="p">,</span> <span class="n">final_newx_left</span><span class="p">,</span> <span class="n">final_newx_right</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">newx_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
            <span class="n">newx_left_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
            <span class="n">newx_right_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="n">dx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># define grid by a bin width (and define others from there)</span>
        <span class="n">dx_without_unit</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">dx</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">x_unit</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
        <span class="n">newx_without_unit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">x_without_unit</span><span class="p">),</span>
            <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">x_without_unit</span><span class="p">)</span> <span class="o">+</span> <span class="n">dx_without_unit</span><span class="p">,</span>
            <span class="n">dx_without_unit</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">newx_left_without_unit</span><span class="p">,</span> <span class="n">newx_right_without_unit</span> <span class="o">=</span> <span class="n">calculate_bin_leftright</span><span class="p">(</span>
            <span class="n">newx_without_unit</span>
        <span class="p">)</span>
        <span class="n">newx_edges_without_unit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span>
            <span class="p">[</span><span class="n">newx_left_without_unit</span><span class="p">,</span> <span class="n">newx_right_without_unit</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
        <span class="p">)</span>

        <span class="c1"># make sure the final output grid is defined</span>
        <span class="n">final_newx</span><span class="p">,</span> <span class="n">final_newx_left</span><span class="p">,</span> <span class="n">final_newx_right</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">newx_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
            <span class="n">newx_left_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
            <span class="n">newx_right_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">elif</span> <span class="n">nx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># keep track of the original input x values</span>
        <span class="n">original_x_without_unit</span> <span class="o">=</span> <span class="n">x_without_unit</span>

        <span class="c1"># redefine the input x to indices, to do interpolation in index space</span>
        <span class="n">x_without_unit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">x_without_unit</span><span class="p">))</span>

        <span class="c1"># define a grid of edges that will enclose the right number of indices</span>
        <span class="n">x_left_i</span><span class="p">,</span> <span class="n">x_right_i</span> <span class="o">=</span> <span class="n">calculate_bin_leftright</span><span class="p">(</span><span class="n">x_without_unit</span><span class="p">)</span>
        <span class="n">newx_edges_without_unit</span> <span class="o">=</span> <span class="n">leftright_to_edges</span><span class="p">(</span><span class="n">x_left_i</span><span class="p">,</span> <span class="n">x_right_i</span><span class="p">)[::</span><span class="n">nx</span><span class="p">]</span>
        <span class="n">newx_without_unit</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span>
            <span class="n">newx_edges_without_unit</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">+</span> <span class="n">newx_edges_without_unit</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="p">)</span>

        <span class="c1"># calculate the actual x values corresponding to the bins</span>
        <span class="n">original_edges</span> <span class="o">=</span> <span class="n">leftright_to_edges</span><span class="p">(</span>
            <span class="o">*</span><span class="n">calculate_bin_leftright</span><span class="p">(</span><span class="n">original_x_without_unit</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">final_edges</span> <span class="o">=</span> <span class="n">original_edges</span><span class="p">[::</span><span class="n">nx</span><span class="p">]</span> <span class="o">*</span> <span class="n">x_unit</span>
        <span class="n">final_newx_left</span><span class="p">,</span> <span class="n">final_newx_right</span> <span class="o">=</span> <span class="n">edges_to_leftright</span><span class="p">(</span><span class="n">final_edges</span><span class="p">)</span>
        <span class="n">final_newx</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">final_newx_left</span> <span class="o">+</span> <span class="n">final_newx_right</span><span class="p">)</span>
        <span class="n">dx_without_unit</span> <span class="o">=</span> <span class="p">(</span><span class="n">final_newx_right</span> <span class="o">-</span> <span class="n">final_newx_left</span><span class="p">)</span> <span class="o">/</span> <span class="n">x_unit</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;No output grid sent to `bintogrid`.</span>
<span class="sd">                              Please choose one of the following:</span>
<span class="sd">                              [`newx_edges`, `newx`, `dx`, `nx`]&quot;&quot;&quot;</span>
        <span class="p">)</span>

    <span class="c1"># don&#39;t complain about zero-divisions in here (to allow infinite uncertainties)</span>
    <span class="k">with</span> <span class="n">np</span><span class="o">.</span><span class="n">errstate</span><span class="p">(</span><span class="n">divide</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">invalid</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">):</span>

        <span class="c1"># calculate weight integrals for the bin array</span>
        <span class="n">ok</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">y_without_unit</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span>

        <span class="c1"># resample the sums onto that new grid</span>
        <span class="k">if</span> <span class="n">unc</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">x_without_unit</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">weighting</span> <span class="o">==</span> <span class="s2">&quot;inversevariance&quot;</span><span class="p">:</span>
                <span class="n">weights</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">unc</span><span class="o">**</span><span class="mi">2</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">x_without_unit</span><span class="p">)</span>

            <span class="c1"># ignore infinite weights (= 0 uncertainties)</span>
            <span class="n">ok</span> <span class="o">*=</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">ok</span><span class="p">):</span>
            <span class="n">numerator</span> <span class="o">=</span> <span class="n">resample_while_conserving_flux</span><span class="p">(</span>
                <span class="n">xin</span><span class="o">=</span><span class="n">x_without_unit</span><span class="p">[</span><span class="n">ok</span><span class="p">],</span>
                <span class="n">yin</span><span class="o">=</span><span class="p">(</span><span class="n">y_without_unit</span> <span class="o">*</span> <span class="n">weights</span><span class="p">)[</span><span class="n">ok</span><span class="p">],</span>
                <span class="n">xout_edges</span><span class="o">=</span><span class="n">newx_edges_without_unit</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">denominator</span> <span class="o">=</span> <span class="n">resample_while_conserving_flux</span><span class="p">(</span>
                <span class="n">xin</span><span class="o">=</span><span class="n">x_without_unit</span><span class="p">[</span><span class="n">ok</span><span class="p">],</span>
                <span class="n">yin</span><span class="o">=</span><span class="n">weights</span><span class="p">[</span><span class="n">ok</span><span class="p">],</span>
                <span class="n">xout_edges</span><span class="o">=</span><span class="n">newx_edges_without_unit</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="c1"># the binned weighted means on the new grid</span>
            <span class="n">newy</span> <span class="o">=</span> <span class="n">numerator</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">denominator</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span>

            <span class="c1"># the standard error on the means, for those bins</span>
            <span class="n">newunc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">denominator</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">])</span>

            <span class="c1"># keep track of the number of original bins going into each new bin</span>
            <span class="n">number_of_original_bins_per_new_bin</span> <span class="o">=</span> <span class="n">resample_while_conserving_flux</span><span class="p">(</span>
                <span class="n">xin</span><span class="o">=</span><span class="n">x_without_unit</span><span class="p">[</span><span class="n">ok</span><span class="p">],</span>
                <span class="n">yin</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">y_without_unit</span><span class="p">)[</span><span class="n">ok</span><span class="p">],</span>
                <span class="n">xout_edges</span><span class="o">=</span><span class="n">newx_edges_without_unit</span><span class="p">,</span>
            <span class="p">)[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">newy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="o">*</span> <span class="n">newx_without_unit</span>
            <span class="n">newunc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="o">*</span> <span class="n">newx_without_unit</span>
            <span class="n">number_of_original_bins_per_new_bin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">newx_without_unit</span><span class="p">)</span>

    <span class="c1"># remove any empty bins</span>
    <span class="k">if</span> <span class="n">drop_nans</span><span class="p">:</span>
        <span class="n">ok</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">newy</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ok</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">newx_without_unit</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>

    <span class="c1"># if no uncertainties were given, don&#39;t return uncertainties</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># populate the new grid centers + edges + values</span>
    <span class="n">result</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">final_newx</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span>
    <span class="n">result</span><span class="p">[</span><span class="s2">&quot;x_edge_lower&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">final_newx_left</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span>
    <span class="n">result</span><span class="p">[</span><span class="s2">&quot;x_edge_upper&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">final_newx_right</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span>

    <span class="c1"># populate the new grid values</span>
    <span class="n">result</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">newy</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span> <span class="o">*</span> <span class="n">y_unit</span>

    <span class="c1"># populate the new grid value uncertainties</span>
    <span class="k">if</span> <span class="n">unc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">result</span><span class="p">[</span><span class="s2">&quot;uncertainty&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">newunc</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span> <span class="o">*</span> <span class="n">y_unit</span>

    <span class="c1"># store how many of the original pixels made it into this new one</span>
    <span class="n">result</span><span class="p">[</span><span class="s2">&quot;N_unbinned/N_binned&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">number_of_original_bins_per_new_bin</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">visualize</span><span class="p">:</span>
        <span class="n">fi</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span>
            <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">gridspec_kw</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">height_ratios</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">])</span>
        <span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">plot_as_boxes</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">xleft</span><span class="o">=</span><span class="n">x_left</span><span class="p">,</span> <span class="n">xright</span><span class="o">=</span><span class="n">x_right</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;silver&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">ekw</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">elinewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">unc</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;silver&quot;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">ekw</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">],</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">],</span>
            <span class="n">yerr</span><span class="o">=</span><span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;uncertainty&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
            <span class="n">xerr</span><span class="o">=</span><span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s2">&quot;x_edge_upper&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;x_edge_lower&quot;</span><span class="p">])</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
            <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
            <span class="n">zorder</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
            <span class="o">**</span><span class="n">ekw</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">plot_as_boxes</span><span class="p">(</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">],</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;N_unbinned/N_binned&quot;</span><span class="p">],</span>
            <span class="n">xleft</span><span class="o">=</span><span class="n">result</span><span class="p">[</span><span class="s2">&quot;x_edge_lower&quot;</span><span class="p">],</span>
            <span class="n">xright</span><span class="o">=</span><span class="n">result</span><span class="p">[</span><span class="s2">&quot;x_edge_upper&quot;</span><span class="p">],</span>
        <span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;$N_</span><span class="si">{unbinned}</span><span class="s2">/N_</span><span class="si">{binned}</span><span class="s2">$&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.visualizations.animate.calculate_bin_leftright" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">calculate_bin_leftright</span><span class="p">(</span><span class="n">x</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.visualizations.animate.calculate_bin_leftright" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>If x is an array of bin centers, calculate the bin edges.
(assumes outermost bins are same size as their neighbors)</p>
<h4 id="chromatic.rainbows.visualizations.animate.calculate_bin_leftright--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.visualizations.animate.calculate_bin_leftright--parameters" title="Permanent link">#</a></h4>
<p>x : array
    The array of bin centers.</p>
<h4 id="chromatic.rainbows.visualizations.animate.calculate_bin_leftright--returns">Returns<a class="headerlink" href="#chromatic.rainbows.visualizations.animate.calculate_bin_leftright--returns" title="Permanent link">#</a></h4>
<p>l : array
    The left edges of the bins.
r : array
    The right edges of the bins.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/tools/resampling.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">calculate_bin_leftright</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    If x is an array of bin centers, calculate the bin edges.</span>
<span class="sd">    (assumes outermost bins are same size as their neighbors)</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : array</span>
<span class="sd">        The array of bin centers.</span>

<span class="sd">    Returns</span>
<span class="sd">    ----------</span>
<span class="sd">    l : array</span>
<span class="sd">        The left edges of the bins.</span>
<span class="sd">    r : array</span>
<span class="sd">        The right edges of the bins.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># what are bin edges (making a guess for those on the ends)</span>
    <span class="c1"># xbinsize = calculate_bin_widths(x)</span>
    <span class="c1"># left = x - xbinsize / 2.0</span>
    <span class="c1"># right = x + xbinsize / 2.0</span>

    <span class="c1"># weird corner case!</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">left</span><span class="p">,</span> <span class="n">right</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">left</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">right</span><span class="p">])</span>

    <span class="n">inner_edges</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="n">x</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">first_edge</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="n">inner_edges</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">last_edge</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">inner_edges</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

    <span class="n">left</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">first_edge</span><span class="p">,</span> <span class="n">inner_edges</span><span class="p">])</span>
    <span class="n">right</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">inner_edges</span><span class="p">,</span> <span class="n">last_edge</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.visualizations.animate.edges_to_leftright" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">edges_to_leftright</span><span class="p">(</span><span class="n">edges</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.visualizations.animate.edges_to_leftright" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Convert N+1 contiguous edges to two arrays of N left/right edges.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/tools/resampling.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">edges_to_leftright</span><span class="p">(</span><span class="n">edges</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert N+1 contiguous edges to two arrays of N left/right edges.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">left</span><span class="p">,</span> <span class="n">right</span> <span class="o">=</span> <span class="n">edges</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">edges</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="k">return</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.visualizations.animate.expand_filenames" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">expand_filenames</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.visualizations.animate.expand_filenames" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>A wrapper to expand a string or list into a list of filenames.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/imports.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">expand_filenames</span><span class="p">(</span><span class="n">filepath</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A wrapper to expand a string or list into a list of filenames.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
        <span class="n">filenames</span> <span class="o">=</span> <span class="n">filepath</span>
    <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span> <span class="o">==</span> <span class="n">Column</span><span class="p">:</span>
        <span class="n">filenames</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>
    <span class="k">elif</span> <span class="s2">&quot;*&quot;</span> <span class="ow">in</span> <span class="n">filepath</span><span class="p">:</span>
        <span class="n">filenames</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">filepath</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">filenames</span> <span class="o">=</span> <span class="p">[</span><span class="n">filepath</span><span class="p">]</span>
    <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">filenames</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.visualizations.animate.get_animation_writer_and_displayer" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_animation_writer_and_displayer</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="s1">&#39;animation.html&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.visualizations.animate.get_animation_writer_and_displayer" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Create the right animation writer based on filename.</p>
<h4 id="chromatic.rainbows.visualizations.animate.get_animation_writer_and_displayer--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.visualizations.animate.get_animation_writer_and_displayer--parameters" title="Permanent link">#</a></h4>
<p>filename : str
    The filename of the movie to create.</p>
<h4 id="chromatic.rainbows.visualizations.animate.get_animation_writer_and_displayer--returns">Returns<a class="headerlink" href="#chromatic.rainbows.visualizations.animate.get_animation_writer_and_displayer--returns" title="Permanent link">#</a></h4>
<p>writer : MovieWriter
    The matplotlib writer object.
displayer : ?
    The</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/rainbows/visualizations/utilities.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_animation_writer_and_displayer</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="s2">&quot;animation.html&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create the right animation writer based on filename.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    filename : str</span>
<span class="sd">        The filename of the movie to create.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    writer : MovieWriter</span>
<span class="sd">        The matplotlib writer object.</span>
<span class="sd">    displayer : ?</span>
<span class="sd">        The</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># define the options</span>
    <span class="n">writers</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;html&quot;</span><span class="p">:</span> <span class="n">ani</span><span class="o">.</span><span class="n">HTMLWriter</span><span class="p">,</span> <span class="s2">&quot;mp4&quot;</span><span class="p">:</span> <span class="n">ani</span><span class="o">.</span><span class="n">FFMpegWriter</span><span class="p">,</span> <span class="s2">&quot;gif&quot;</span><span class="p">:</span> <span class="n">ani</span><span class="o">.</span><span class="n">PillowWriter</span><span class="p">}</span>
    <span class="n">warnings</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;html&quot;</span><span class="p">:</span> <span class="s2">&quot;Please try `pip insall matplotlib --upgrade` and rerunning?&quot;</span><span class="p">,</span>
        <span class="s2">&quot;mp4&quot;</span><span class="p">:</span> <span class="s2">&quot;Please try `conda install ffmpeg` and rerunning?&quot;</span><span class="p">,</span>
        <span class="s2">&quot;gif&quot;</span><span class="p">:</span> <span class="s2">&quot;Please try `pip insall matplotlib --upgrade` and rerunning?&quot;</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">IPython.display</span><span class="w"> </span><span class="kn">import</span> <span class="n">HTML</span><span class="p">,</span> <span class="n">Video</span><span class="p">,</span> <span class="n">Image</span>

    <span class="n">displayers</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;html&quot;</span><span class="p">:</span> <span class="n">HTML</span><span class="p">,</span> <span class="s2">&quot;mp4&quot;</span><span class="p">:</span> <span class="n">Video</span><span class="p">,</span> <span class="s2">&quot;gif&quot;</span><span class="p">:</span> <span class="n">Image</span><span class="p">}</span>

    <span class="c1"># get the writer object</span>
    <span class="n">suffix</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">writer</span> <span class="o">=</span> <span class="n">writers</span><span class="p">[</span><span class="n">suffix</span><span class="p">](</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span>
    <span class="n">displayer</span> <span class="o">=</span> <span class="n">displayers</span><span class="p">[</span><span class="n">suffix</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">writer</span><span class="o">.</span><span class="n">isAvailable</span><span class="p">():</span>
        <span class="k">return</span> <span class="n">writer</span><span class="p">,</span> <span class="n">displayer</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        The writer </span><span class="si">{</span><span class="n">writer</span><span class="si">}</span><span class="s2"> needed for your `.</span><span class="si">{</span><span class="n">suffix</span><span class="si">}</span><span class="s2">` file is not available.</span>
<span class="s2">        </span><span class="si">{</span><span class="n">warnings</span><span class="p">[</span><span class="n">suffix</span><span class="p">]</span><span class="si">}</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.visualizations.animate.leftright_to_edges" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">leftright_to_edges</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.visualizations.animate.leftright_to_edges" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Convert two arrays of N left/right edges to N+1 continugous edges.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/tools/resampling.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">leftright_to_edges</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert two arrays of N left/right edges to N+1 continugous edges.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">edges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>
    <span class="k">return</span> <span class="n">edges</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.visualizations.animate.name2color" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">name2color</span><span class="p">(</span><span class="n">name</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.visualizations.animate.name2color" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Return the 3-element RGB array of a given color name.</p>
<h4 id="chromatic.rainbows.visualizations.animate.name2color--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.visualizations.animate.name2color--parameters" title="Permanent link">#</a></h4>
<p>name : str
    The name of a color</p>
<h4 id="chromatic.rainbows.visualizations.animate.name2color--returns">Returns<a class="headerlink" href="#chromatic.rainbows.visualizations.animate.name2color--returns" title="Permanent link">#</a></h4>
<p>rgb : tuple
    3-element RGB color, with numbers from 0.0 to 1.0</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/imports.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">name2color</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return the 3-element RGB array of a given color name.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    name : str</span>
<span class="sd">        The name of a color</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    rgb : tuple</span>
<span class="sd">        3-element RGB color, with numbers from 0.0 to 1.0</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># give a friendly warning if the color name can&#39;t be found</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">color_hex</span> <span class="o">=</span> <span class="n">col</span><span class="o">.</span><span class="n">cnames</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">col</span><span class="o">.</span><span class="n">hex2color</span><span class="p">(</span><span class="n">color_hex</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="n">cheerfully_suggest</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The color </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> can&#39;t be found. (Returning black.)&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.visualizations.animate.one2another" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">one2another</span><span class="p">(</span><span class="n">bottom</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">alpha_bottom</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">alpha_top</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">256</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.visualizations.animate.one2another" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Create a cmap that goes smoothly (linearly in RGBA) from "bottom" to "top".</p>
<h4 id="chromatic.rainbows.visualizations.animate.one2another--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.visualizations.animate.one2another--parameters" title="Permanent link">#</a></h4>
<p>bottom : str
    Name of a color for the bottom of cmap (0.0)
top : str
    Name of a color for the top of the cmap (1.0)
alpha_bottom : float
    Opacity at the bottom of the cmap
alpha_top : float
    Opacitiy at the top of the cmap
N : int
    The number of levels in the listed color map</p>
<h4 id="chromatic.rainbows.visualizations.animate.one2another--returns">Returns<a class="headerlink" href="#chromatic.rainbows.visualizations.animate.one2another--returns" title="Permanent link">#</a></h4>
<p>cmap : Colormap
    A color map that goes linearly from the
    bottom to top color (and alpha).</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/imports.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">one2another</span><span class="p">(</span><span class="n">bottom</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">alpha_bottom</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">alpha_top</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">256</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a cmap that goes smoothly (linearly in RGBA) from &quot;bottom&quot; to &quot;top&quot;.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    bottom : str</span>
<span class="sd">        Name of a color for the bottom of cmap (0.0)</span>
<span class="sd">    top : str</span>
<span class="sd">        Name of a color for the top of the cmap (1.0)</span>
<span class="sd">    alpha_bottom : float</span>
<span class="sd">        Opacity at the bottom of the cmap</span>
<span class="sd">    alpha_top : float</span>
<span class="sd">        Opacitiy at the top of the cmap</span>
<span class="sd">    N : int</span>
<span class="sd">        The number of levels in the listed color map</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    cmap : Colormap</span>
<span class="sd">        A color map that goes linearly from the</span>
<span class="sd">        bottom to top color (and alpha).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># get the RGB values of the bottom and top of the cmap</span>
    <span class="n">rgb_bottom</span><span class="p">,</span> <span class="n">rgb_top</span> <span class="o">=</span> <span class="n">name2color</span><span class="p">(</span><span class="n">bottom</span><span class="p">),</span> <span class="n">name2color</span><span class="p">(</span><span class="n">top</span><span class="p">)</span>

    <span class="c1"># create linear gradients for all four RGBA channels</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">rgb_bottom</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">rgb_top</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">N</span><span class="p">)</span>
    <span class="n">g</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">rgb_bottom</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">rgb_top</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">N</span><span class="p">)</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">rgb_bottom</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">rgb_top</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">N</span><span class="p">)</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">alpha_bottom</span><span class="p">,</span> <span class="n">alpha_top</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>

    <span class="c1"># create (N,4) array + populate a listed colormap</span>
    <span class="n">colors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">]))</span>
    <span class="n">cmap</span> <span class="o">=</span> <span class="n">col</span><span class="o">.</span><span class="n">ListedColormap</span><span class="p">(</span><span class="n">colors</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{bottom}</span><span class="s2">2</span><span class="si">{top}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="nb">locals</span><span class="p">()))</span>

    <span class="c1"># return the colormap</span>
    <span class="k">return</span> <span class="n">cmap</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.visualizations.animate.remove_unit" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">remove_unit</span><span class="p">(</span><span class="n">x</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.visualizations.animate.remove_unit" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Quick wrapper to remove the unit from a quantity,
but not complain if it doesn't have one.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/imports.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">remove_unit</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Quick wrapper to remove the unit from a quantity,</span>
<span class="sd">    but not complain if it doesn&#39;t have one.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">x</span><span class="o">.</span><span class="n">value</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">x</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.visualizations.animate.resample_while_conserving_flux" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">resample_while_conserving_flux</span><span class="p">(</span><span class="n">xin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">yin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xout</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xin_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xout_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">replace_nans</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">visualize</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">pause</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.visualizations.animate.resample_while_conserving_flux" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Starting from some initial x and y, resample onto a
different grid (either higher or lower resolution),
while conserving total flux.</p>
<p>When including the entire range of <code>xin</code>,
<code>sum(yout) == sum(yin)</code> should be true.</p>
<p>When including only part of the range of <code>xin</code>,
the integral between any two points should be conserved.</p>
<h4 id="chromatic.rainbows.visualizations.animate.resample_while_conserving_flux--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.visualizations.animate.resample_while_conserving_flux--parameters" title="Permanent link">#</a></h4>
<p>xin : array
    The original independent variable.
yin : array
    The original dependent variable (same size as x).
xout : array
    The new grid of independent variables onto which
    you want to resample the y values. Refers to the
    center of each bin (use <code>xout_edges</code> for finer
    control over the exact edges of the bins)
xin_edges : array
    The edges of the original independent variable bins.
    The left and right edges of the bins are interpreted
    to be <code>xin_edges[:-1]</code> and <code>xin_edges[1:]</code>,
    respectively, so the associated <code>yin</code> should have exactly
    1 fewer element than <code>xin_edges</code>. This provides finer
    control over the size of each bin in the input than
    simply supplying <code>xin</code>(still a little experimental)
    They should probably be sorted?
xout_edges : array
    The edges of the new grid of bins for the independent
    variable, onto which you want to resample the y
    values. The left and right edges of the bins will be,
    respectively, <code>xout_edges[:-1]</code> and <code>xout_edges[1:]</code>,
    so the size of the output array will be
    <code>len(xout_edges) - 1</code>
replace_nans : float, str
    Replace nan values with this value.
    <code>replace_nans = 0</code>
        will add no flux where nans are
    <code>replace_nans = nan</code>
        will ensure you get nans returned everywhere
        if you try to resample over any nan
    <code>replace_nans = 'interpolate'</code>
        will try to replace nans by linearly interpolating
        from nearby values (not yet implemented)
visualize : bool
    Should we make a plot showing whether it worked?
pause : bool
    Should we pause to wait for a key press?</p>
<h4 id="chromatic.rainbows.visualizations.animate.resample_while_conserving_flux--returns">Returns<a class="headerlink" href="#chromatic.rainbows.visualizations.animate.resample_while_conserving_flux--returns" title="Permanent link">#</a></h4>
<p>result : dict
    A dictionary containing...
        <code>x</code> = the center of the output grid
        <code>y</code> = the resampled value on the output grid
        <code>edges</code> = the edges of the output grid, which will
            have one more element than x or y</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/tools/resampling.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">resample_while_conserving_flux</span><span class="p">(</span>
    <span class="n">xin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">yin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">xout</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">xin_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">xout_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">replace_nans</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
    <span class="n">visualize</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">pause</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Starting from some initial x and y, resample onto a</span>
<span class="sd">    different grid (either higher or lower resolution),</span>
<span class="sd">    while conserving total flux.</span>

<span class="sd">    When including the entire range of `xin`,</span>
<span class="sd">    `sum(yout) == sum(yin)` should be true.</span>

<span class="sd">    When including only part of the range of `xin`,</span>
<span class="sd">    the integral between any two points should be conserved.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    xin : array</span>
<span class="sd">        The original independent variable.</span>
<span class="sd">    yin : array</span>
<span class="sd">        The original dependent variable (same size as x).</span>
<span class="sd">    xout : array</span>
<span class="sd">        The new grid of independent variables onto which</span>
<span class="sd">        you want to resample the y values. Refers to the</span>
<span class="sd">        center of each bin (use `xout_edges` for finer</span>
<span class="sd">        control over the exact edges of the bins)</span>
<span class="sd">    xin_edges : array</span>
<span class="sd">        The edges of the original independent variable bins.</span>
<span class="sd">        The left and right edges of the bins are interpreted</span>
<span class="sd">        to be `xin_edges[:-1]` and `xin_edges[1:]`,</span>
<span class="sd">        respectively, so the associated `yin` should have exactly</span>
<span class="sd">        1 fewer element than `xin_edges`. This provides finer</span>
<span class="sd">        control over the size of each bin in the input than</span>
<span class="sd">        simply supplying `xin`(still a little experimental)</span>
<span class="sd">        They should probably be sorted?</span>
<span class="sd">    xout_edges : array</span>
<span class="sd">        The edges of the new grid of bins for the independent</span>
<span class="sd">        variable, onto which you want to resample the y</span>
<span class="sd">        values. The left and right edges of the bins will be,</span>
<span class="sd">        respectively, `xout_edges[:-1]` and `xout_edges[1:]`,</span>
<span class="sd">        so the size of the output array will be</span>
<span class="sd">        `len(xout_edges) - 1`</span>
<span class="sd">    replace_nans : float, str</span>
<span class="sd">        Replace nan values with this value.</span>
<span class="sd">        `replace_nans = 0`</span>
<span class="sd">            will add no flux where nans are</span>
<span class="sd">        `replace_nans = nan`</span>
<span class="sd">            will ensure you get nans returned everywhere</span>
<span class="sd">            if you try to resample over any nan</span>
<span class="sd">        `replace_nans = &#39;interpolate&#39;`</span>
<span class="sd">            will try to replace nans by linearly interpolating</span>
<span class="sd">            from nearby values (not yet implemented)</span>
<span class="sd">    visualize : bool</span>
<span class="sd">        Should we make a plot showing whether it worked?</span>
<span class="sd">    pause : bool</span>
<span class="sd">        Should we pause to wait for a key press?</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    result : dict</span>
<span class="sd">        A dictionary containing...</span>
<span class="sd">            `x` = the center of the output grid</span>
<span class="sd">            `y` = the resampled value on the output grid</span>
<span class="sd">            `edges` = the edges of the output grid, which will</span>
<span class="sd">                have one more element than x or y</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># make sure there are some reasonable input options</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">xin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">xin_edges</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">yin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">xout</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">xout_edges</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>

    <span class="c1"># set up the bins, to calculate cumulative distribution of y</span>
    <span class="k">if</span> <span class="n">xin_edges</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># make sure the sizes match up</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">xin</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">yin</span><span class="p">)</span>
        <span class="c1"># sort to make sure x is strictly increasing</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">xin</span><span class="p">)</span>
        <span class="n">xin_sorted</span> <span class="o">=</span> <span class="n">xin</span><span class="p">[</span><span class="n">s</span><span class="p">]</span>
        <span class="n">yin_sorted</span> <span class="o">=</span> <span class="n">yin</span><span class="p">[</span><span class="n">s</span><span class="p">]</span>
        <span class="c1"># estimate some bin edges (might fail for non-uniform grids)</span>
        <span class="n">xin_left</span><span class="p">,</span> <span class="n">xin_right</span> <span class="o">=</span> <span class="n">calculate_bin_leftright</span><span class="p">(</span><span class="n">xin_sorted</span><span class="p">)</span>
        <span class="c1"># define an array of edges</span>
        <span class="n">xin_edges</span> <span class="o">=</span> <span class="n">leftright_to_edges</span><span class="p">(</span><span class="n">xin_left</span><span class="p">,</span> <span class="n">xin_right</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># make sure the sizes match up</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">xin_edges</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">yin</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="c1"># sort to make sure x is strictly increasing</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">xin_edges</span><span class="p">)</span>
        <span class="n">xin_left</span><span class="p">,</span> <span class="n">xin_right</span> <span class="o">=</span> <span class="n">edges_to_leftright</span><span class="p">(</span><span class="n">xin_edges</span><span class="p">[</span><span class="n">s</span><span class="p">])</span>
        <span class="n">xin_sorted</span> <span class="o">=</span> <span class="p">(</span><span class="n">xin_left</span> <span class="o">+</span> <span class="n">xin_right</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">yin_sorted</span> <span class="o">=</span> <span class="n">yin</span><span class="p">[</span><span class="n">s</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>

    <span class="c1"># the first element should be the left edge of the first pixel</span>
    <span class="c1"># last element will be right edge of last pixel</span>
    <span class="n">xin_for_cdf</span> <span class="o">=</span> <span class="n">xin_edges</span>

    <span class="c1"># to the left of the first pixel, assume flux is zero</span>
    <span class="n">yin_for_cdf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">yin_sorted</span><span class="p">])</span>

    <span class="c1"># correct for any non-finite values</span>
    <span class="n">bad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">yin_for_cdf</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">replace_nans</span> <span class="o">==</span> <span class="s2">&quot;interpolate&quot;</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
            <span class="s2">&quot;The `replace_nans=&#39;interpolate&#39;`` option doens&#39;t exist yet!&quot;</span>
        <span class="p">)</span>
    <span class="n">yin_for_cdf</span><span class="p">[</span><span class="n">bad</span><span class="p">]</span> <span class="o">=</span> <span class="n">replace_nans</span>

    <span class="c1"># calculate the CDF of the flux (at pixel edge locations)</span>
    <span class="n">cdfin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">yin_for_cdf</span><span class="p">)</span>

    <span class="c1"># create an interpolator for that CDF</span>
    <span class="n">cdfinterpolator</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span>
        <span class="n">xin_for_cdf</span><span class="p">,</span>
        <span class="n">cdfin</span><span class="p">,</span>
        <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span>
        <span class="n">bounds_error</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">fill_value</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">yin</span><span class="p">)),</span>
    <span class="p">)</span>

    <span class="c1"># calculate bin edges (of size len(xout)+1)</span>
    <span class="k">if</span> <span class="n">xout_edges</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">xout_left</span><span class="p">,</span> <span class="n">xout_right</span> <span class="o">=</span> <span class="n">calculate_bin_leftright</span><span class="p">(</span><span class="n">xout</span><span class="p">)</span>
        <span class="n">xout_edges</span> <span class="o">=</span> <span class="n">leftright_to_edges</span><span class="p">(</span><span class="n">xout_left</span><span class="p">,</span> <span class="n">xout_right</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">xout_left</span><span class="p">,</span> <span class="n">xout_right</span> <span class="o">=</span> <span class="n">edges_to_leftright</span><span class="p">(</span><span class="n">xout_edges</span><span class="p">)</span>
        <span class="n">xout</span> <span class="o">=</span> <span class="p">(</span><span class="n">xout_left</span> <span class="o">+</span> <span class="n">xout_right</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>

    <span class="n">xout_for_cdf</span> <span class="o">=</span> <span class="n">leftright_to_edges</span><span class="p">(</span><span class="n">xout_left</span><span class="p">,</span> <span class="n">xout_right</span><span class="p">)</span>

    <span class="c1"># interpolate the CDF onto those bin edges</span>
    <span class="n">cdfout</span> <span class="o">=</span> <span class="n">cdfinterpolator</span><span class="p">(</span><span class="n">xout_for_cdf</span><span class="p">)</span>

    <span class="c1"># take  derivative of the CDF to get flux per resampled bin</span>
    <span class="c1"># (xout is bin center, and yout is the flux in that bin)</span>
    <span class="n">yout</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">cdfout</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">visualize</span><span class="p">:</span>
        <span class="n">fi</span><span class="p">,</span> <span class="p">(</span><span class="n">ax_cdf</span><span class="p">,</span> <span class="n">ax_pdf</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
        <span class="n">inkw</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
            <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span>
            <span class="n">markeredgecolor</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">outkw</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;darkorange&quot;</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span>
            <span class="n">markersize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
            <span class="n">markeredgecolor</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">legkw</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper left&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">xinbinsize</span> <span class="o">=</span> <span class="n">xin_right</span> <span class="o">-</span> <span class="n">xin_left</span>
        <span class="n">xoutbinsize</span> <span class="o">=</span> <span class="n">xout_right</span> <span class="o">-</span> <span class="n">xout_left</span>
        <span class="c1"># plot the PDFs</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="n">ax_pdf</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Flux per (Original) Pixel&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Pixel&quot;</span><span class="p">)</span>
        <span class="c1"># plot the original pixels (in df/dpixel to compare with resampled)</span>
        <span class="n">plot_as_boxes</span><span class="p">(</span>
            <span class="n">xin_sorted</span><span class="p">,</span> <span class="n">yin_sorted</span> <span class="o">/</span> <span class="n">xinbinsize</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Original Pixels&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">inkw</span>
        <span class="p">)</span>

        <span class="c1"># what would a bad interpolation look like?</span>
        <span class="n">interpolate_badly</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span>
            <span class="n">xin_sorted</span><span class="p">,</span>
            <span class="n">yin_sorted</span> <span class="o">/</span> <span class="n">xinbinsize</span><span class="p">,</span>
            <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span>
            <span class="n">bounds_error</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">fill_value</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
            <span class="n">xout</span><span class="p">,</span>
            <span class="n">interpolate_badly</span><span class="p">(</span><span class="n">xout</span><span class="p">),</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;cornflowerblue&quot;</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span>
            <span class="n">markersize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
            <span class="n">markeredgecolor</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Silly Simple Interpolation&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># plot the flux-conserving resampled data (again, in df/d&quot;pixel&quot;)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
            <span class="n">xout</span><span class="p">,</span> <span class="n">yout</span> <span class="o">/</span> <span class="n">xoutbinsize</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Flux-Conserving Interpolation&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">outkw</span>
        <span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="o">**</span><span class="n">legkw</span><span class="p">)</span>

        <span class="c1"># plot the CDFs</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="n">ax_cdf</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Cumulative Flux (from left)&quot;</span><span class="p">)</span>

        <span class="c1"># plot the original CDF</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xin_for_cdf</span><span class="p">,</span> <span class="n">cdfin</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Original Pixels&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">inkw</span><span class="p">)</span>

        <span class="c1"># plot the interpolated CDF</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xout_for_cdf</span><span class="p">,</span> <span class="n">cdfout</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Flux-Conserved Resample&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">outkw</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">pause</span><span class="p">:</span>
            <span class="n">a</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span>
                <span class="s2">&quot;Pausing a moment to check on interpolation; press return to continue.&quot;</span>
            <span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{:&gt;6}</span><span class="s2"> = </span><span class="si">{:.5f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;Actual&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">yin</span><span class="p">)))</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="s2">&quot;</span><span class="si">{:&gt;6}</span><span class="s2"> = </span><span class="si">{:.5f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="s2">&quot;Silly&quot;</span><span class="p">,</span>
                <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">interpolate_badly</span><span class="p">(</span><span class="n">xout</span><span class="p">)</span> <span class="o">*</span> <span class="n">xoutbinsize</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{:&gt;6}</span><span class="s2"> = </span><span class="si">{:.5f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;CDF&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">yout</span><span class="p">)))</span>

    <span class="c1"># return the resampled y-values</span>
    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="n">xout</span><span class="p">,</span> <span class="s2">&quot;x_edge_lower&quot;</span><span class="p">:</span> <span class="n">xout_left</span><span class="p">,</span> <span class="s2">&quot;x_edge_upper&quot;</span><span class="p">:</span> <span class="n">xout_right</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="n">yout</span><span class="p">}</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="chromatic.rainbows.visualizations.colors"></a>
    <div class="doc doc-contents first">









  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.visualizations.colors.bintoR" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">bintoR</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">unc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">R</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">weighting</span><span class="o">=</span><span class="s1">&#39;inversevariance&#39;</span><span class="p">,</span> <span class="n">drop_nans</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.visualizations.colors.bintoR" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Bin any x and y array onto a logarithmicly uniform grid.</p>
<h4 id="chromatic.rainbows.visualizations.colors.bintoR--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.visualizations.colors.bintoR--parameters" title="Permanent link">#</a></h4>
<p>x : array
    The original independent variable.
    (For a spectrum example = wavelength)
y : array
    The original dependent variable (same size as x).
    (For a spectrum example = flux)
unc : array, None, optional
    The unceratinty on the dependent variable
    (For a spectrum example = the flux uncertainty)
R : array, optional
    The spectral resolution R=x/dx for creating a new,
    logarithmically uniform grid that starts at the first
    value of x.
xlim : list, array, optional
    A two-element list indicating the min and max values of
    x for the new logarithmically spaced grid. If None,
    these limits will be created from the data themselves
weighting : str, optional
    How should we weight values when averaging
    them together into one larger bin?
    <code>weighting = 'inversevariance'</code>
        weights = 1/unc**2
     <code>weighting = {literally anything else}</code>
        uniform weights
    This will have no impact if <code>unc == None</code>, or for any
    new bins that effectively overlap less than one original
    unbinned point.
drop_nans : bool, optional
    Should we skip any bins turn out to be nans?
    This most often happens when bins are empty.</p>
<h4 id="chromatic.rainbows.visualizations.colors.bintoR--returns">Returns<a class="headerlink" href="#chromatic.rainbows.visualizations.colors.bintoR--returns" title="Permanent link">#</a></h4>
<p>result : dict
    A dictionary containing at least...
        <code>x</code> = the center of the output grid
        <code>y</code> = the resampled value on the output grid
        <code>x_edge_lower</code> = the lower edges of the output grid
        <code>x_edge_upper</code> = the upper edges of the output grid
    ...and possibly also
        <code>uncertainty</code> = the calculated uncertainty per bin</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/tools/resampling.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">bintoR</span><span class="p">(</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">unc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">R</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">weighting</span><span class="o">=</span><span class="s2">&quot;inversevariance&quot;</span><span class="p">,</span> <span class="n">drop_nans</span><span class="o">=</span><span class="kc">True</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Bin any x and y array onto a logarithmicly uniform grid.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : array</span>
<span class="sd">        The original independent variable.</span>
<span class="sd">        (For a spectrum example = wavelength)</span>
<span class="sd">    y : array</span>
<span class="sd">        The original dependent variable (same size as x).</span>
<span class="sd">        (For a spectrum example = flux)</span>
<span class="sd">    unc : array, None, optional</span>
<span class="sd">        The unceratinty on the dependent variable</span>
<span class="sd">        (For a spectrum example = the flux uncertainty)</span>
<span class="sd">    R : array, optional</span>
<span class="sd">        The spectral resolution R=x/dx for creating a new,</span>
<span class="sd">        logarithmically uniform grid that starts at the first</span>
<span class="sd">        value of x.</span>
<span class="sd">    xlim : list, array, optional</span>
<span class="sd">        A two-element list indicating the min and max values of</span>
<span class="sd">        x for the new logarithmically spaced grid. If None,</span>
<span class="sd">        these limits will be created from the data themselves</span>
<span class="sd">    weighting : str, optional</span>
<span class="sd">        How should we weight values when averaging</span>
<span class="sd">        them together into one larger bin?</span>
<span class="sd">        `weighting = &#39;inversevariance&#39;`</span>
<span class="sd">            weights = 1/unc**2</span>
<span class="sd">         `weighting = {literally anything else}`</span>
<span class="sd">            uniform weights</span>
<span class="sd">        This will have no impact if `unc == None`, or for any</span>
<span class="sd">        new bins that effectively overlap less than one original</span>
<span class="sd">        unbinned point.</span>
<span class="sd">    drop_nans : bool, optional</span>
<span class="sd">        Should we skip any bins turn out to be nans?</span>
<span class="sd">        This most often happens when bins are empty.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    result : dict</span>
<span class="sd">        A dictionary containing at least...</span>
<span class="sd">            `x` = the center of the output grid</span>
<span class="sd">            `y` = the resampled value on the output grid</span>
<span class="sd">            `x_edge_lower` = the lower edges of the output grid</span>
<span class="sd">            `x_edge_upper` = the upper edges of the output grid</span>
<span class="sd">        ...and possibly also</span>
<span class="sd">            `uncertainty` = the calculated uncertainty per bin</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">x_unit</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">unit</span>
        <span class="n">x_without_unit</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">value</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="n">x_unit</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">x_without_unit</span> <span class="o">=</span> <span class="n">x</span>

    <span class="c1"># create a new grid of x at the given resolution</span>
    <span class="n">lnx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">x_without_unit</span><span class="p">)</span>
    <span class="n">dnewlnx</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">R</span>

    <span class="c1"># set the limits of the new xgrid (in log space)</span>
    <span class="k">if</span> <span class="n">xlim</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># use the input grid to set the limits</span>
        <span class="n">lnxbottom</span><span class="p">,</span> <span class="n">lnxtop</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">lnx</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">lnx</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># use the custom xlim to set the limits</span>
        <span class="n">lnxbottom</span><span class="p">,</span> <span class="n">lnxtop</span> <span class="o">=</span> <span class="n">xlim</span>

    <span class="c1"># create a new, log-uniform grid of x values</span>
    <span class="n">newlnx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">lnxbottom</span><span class="p">,</span> <span class="n">lnxtop</span> <span class="o">+</span> <span class="n">dnewlnx</span><span class="p">,</span> <span class="n">dnewlnx</span><span class="p">)</span>

    <span class="c1"># now do the binning on a uniform grid of lnx</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">bintogrid</span><span class="p">(</span>
        <span class="n">lnx</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">unc</span><span class="p">,</span> <span class="n">newx</span><span class="o">=</span><span class="n">newlnx</span><span class="p">,</span> <span class="n">weighting</span><span class="o">=</span><span class="n">weighting</span><span class="p">,</span> <span class="n">drop_nans</span><span class="o">=</span><span class="n">drop_nans</span>
    <span class="p">)</span>

    <span class="c1"># convert back from log to real values</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;x_edge_lower&quot;</span><span class="p">,</span> <span class="s2">&quot;x_edge_upper&quot;</span><span class="p">]:</span>
        <span class="n">result</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="o">*</span> <span class="n">x_unit</span>

    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.visualizations.colors.bintogrid" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">bintogrid</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">unc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">newx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">newx_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">nx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">weighting</span><span class="o">=</span><span class="s1">&#39;inversevariance&#39;</span><span class="p">,</span> <span class="n">drop_nans</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">x_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">visualize</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.visualizations.colors.bintogrid" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Bin any x and y array onto a linearly uniform grid.</p>
<h4 id="chromatic.rainbows.visualizations.colors.bintogrid--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.visualizations.colors.bintogrid--parameters" title="Permanent link">#</a></h4>
<p>x : array
    The original independent variable.
    (For a spectrum example = wavelength)
y : array
    The original dependent variable (same size as x).
    (For a spectrum example = flux)
unc : array, None
    The unceratinty on the dependent variable
    (For a spectrum example = the flux uncertainty)
nx : array
    The number of bins from the original grid to
    bin together into the new one.
dx : array
    The fixed spacing for creating a new, linearly uniform
    grid that start at the first value of x. This will
    be ignored if <code>newx</code> != None.
newx : array
    A new custom grid onto which we should bin.
newx_edges : array
    The edges of the new grid of bins for the independent
    variable, onto which you want to resample the y
    values. The left and right edges of the bins will be,
    respectively, <code>newx_edges[:-1]</code> and <code>newx_edges[1:]</code>,
    so the size of the output array will be
    <code>len(newx_edges) - 1</code>
weighting : str
    How should we weight values when averaging
    them together into one larger bin?
    <code>weighting = 'inversevariance'</code>
        weights = 1/unc**2
     <code>weighting = {literally anything else}</code>
        uniform weights
    This will have no impact if <code>unc == None</code>, or for any
    new bins that effectively overlap less than one original
    unbinned point.
drop_nans : bool
    Should we skip any bins turn out to be nans?
    This most often happens when bins are empty.
x_edges : array
    The edges of the original independent variable bins.
    The left and right edges of the bins are interpreted
    to be <code>x_edges[:-1]</code> and <code>x_edges[1:]</code>,
    respectively, so the associated <code>y</code> should have exactly
    1 fewer element than <code>x_edges</code>. This provides finer
    control over the size of each bin in the input than
    simply supplying <code>x</code>(still a little experimental)</p>
<h4 id="chromatic.rainbows.visualizations.colors.bintogrid--returns">Returns<a class="headerlink" href="#chromatic.rainbows.visualizations.colors.bintogrid--returns" title="Permanent link">#</a></h4>
<p>result : dict
    A dictionary containing at least...
        <code>x</code> = the center of the output grid
        <code>y</code> = the resampled value on the output grid
        <code>x_edge_lower</code> = the lower edges of the output grid
        <code>x_edge_upper</code> = the upper edges of the output grid
    ...and possibly also
        <code>uncertainty</code> = the calculated uncertainty per bin</p>
<p>The order of precendence for setting the new grid is
[<code>newx_edges</code>, <code>newx</code>, <code>dx</code>, <code>nx</code>]
The first will be used, and others will be ignored.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/tools/resampling.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">bintogrid</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">unc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">newx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">newx_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">dx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">nx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">weighting</span><span class="o">=</span><span class="s2">&quot;inversevariance&quot;</span><span class="p">,</span>
    <span class="n">drop_nans</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">x_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">visualize</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Bin any x and y array onto a linearly uniform grid.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : array</span>
<span class="sd">        The original independent variable.</span>
<span class="sd">        (For a spectrum example = wavelength)</span>
<span class="sd">    y : array</span>
<span class="sd">        The original dependent variable (same size as x).</span>
<span class="sd">        (For a spectrum example = flux)</span>
<span class="sd">    unc : array, None</span>
<span class="sd">        The unceratinty on the dependent variable</span>
<span class="sd">        (For a spectrum example = the flux uncertainty)</span>
<span class="sd">    nx : array</span>
<span class="sd">        The number of bins from the original grid to</span>
<span class="sd">        bin together into the new one.</span>
<span class="sd">    dx : array</span>
<span class="sd">        The fixed spacing for creating a new, linearly uniform</span>
<span class="sd">        grid that start at the first value of x. This will</span>
<span class="sd">        be ignored if `newx` != None.</span>
<span class="sd">    newx : array</span>
<span class="sd">        A new custom grid onto which we should bin.</span>
<span class="sd">    newx_edges : array</span>
<span class="sd">        The edges of the new grid of bins for the independent</span>
<span class="sd">        variable, onto which you want to resample the y</span>
<span class="sd">        values. The left and right edges of the bins will be,</span>
<span class="sd">        respectively, `newx_edges[:-1]` and `newx_edges[1:]`,</span>
<span class="sd">        so the size of the output array will be</span>
<span class="sd">        `len(newx_edges) - 1`</span>
<span class="sd">    weighting : str</span>
<span class="sd">        How should we weight values when averaging</span>
<span class="sd">        them together into one larger bin?</span>
<span class="sd">        `weighting = &#39;inversevariance&#39;`</span>
<span class="sd">            weights = 1/unc**2</span>
<span class="sd">         `weighting = {literally anything else}`</span>
<span class="sd">            uniform weights</span>
<span class="sd">        This will have no impact if `unc == None`, or for any</span>
<span class="sd">        new bins that effectively overlap less than one original</span>
<span class="sd">        unbinned point.</span>
<span class="sd">    drop_nans : bool</span>
<span class="sd">        Should we skip any bins turn out to be nans?</span>
<span class="sd">        This most often happens when bins are empty.</span>
<span class="sd">    x_edges : array</span>
<span class="sd">        The edges of the original independent variable bins.</span>
<span class="sd">        The left and right edges of the bins are interpreted</span>
<span class="sd">        to be `x_edges[:-1]` and `x_edges[1:]`,</span>
<span class="sd">        respectively, so the associated `y` should have exactly</span>
<span class="sd">        1 fewer element than `x_edges`. This provides finer</span>
<span class="sd">        control over the size of each bin in the input than</span>
<span class="sd">        simply supplying `x`(still a little experimental)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    result : dict</span>
<span class="sd">        A dictionary containing at least...</span>
<span class="sd">            `x` = the center of the output grid</span>
<span class="sd">            `y` = the resampled value on the output grid</span>
<span class="sd">            `x_edge_lower` = the lower edges of the output grid</span>
<span class="sd">            `x_edge_upper` = the upper edges of the output grid</span>
<span class="sd">        ...and possibly also</span>
<span class="sd">            `uncertainty` = the calculated uncertainty per bin</span>


<span class="sd">    The order of precendence for setting the new grid is</span>
<span class="sd">    [`newx_edges`, `newx`, `dx`, `nx`]</span>
<span class="sd">    The first will be used, and others will be ignored.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># check that an OK set of inputs has been supplied</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">x_edges</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;🌈 Both `x` and `x_edges` were supplied to `bintogrid`. Confusing!&quot;&quot;&quot;</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">x_edges</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;🌈 At least one of `x` or `x_edges` must be supplied to `bintogrid`.&quot;&quot;&quot;</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="n">y</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;🌈 `y` must be supplied to `bintogrid`.&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="c1"># make sure the edges and the centers are set</span>
    <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">x_left</span><span class="p">,</span> <span class="n">x_right</span> <span class="o">=</span> <span class="n">edges_to_leftright</span><span class="p">(</span><span class="n">x_edges</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">left</span> <span class="o">+</span> <span class="n">right</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">x_left</span><span class="p">,</span> <span class="n">x_right</span> <span class="o">=</span> <span class="n">calculate_bin_leftright</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">x_edges</span> <span class="o">=</span> <span class="n">leftright_to_edges</span><span class="p">(</span><span class="n">x_left</span><span class="p">,</span> <span class="n">x_right</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">x_unit</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">unit</span>
        <span class="n">x_without_unit</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">value</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="n">x_unit</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">x_without_unit</span> <span class="o">=</span> <span class="n">x</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">y_unit</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">unit</span>
        <span class="n">y_without_unit</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">value</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="n">y_unit</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">y_without_unit</span> <span class="o">=</span> <span class="n">y</span>

    <span class="c1"># warn if multiple inputs are provided</span>
    <span class="n">number_of_grid_options</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span><span class="n">z</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="p">[</span><span class="n">newx_edges</span><span class="p">,</span> <span class="n">newx</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">nx</span><span class="p">]])</span>
    <span class="k">if</span> <span class="n">number_of_grid_options</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">cheerfully_suggest</span><span class="p">(</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;More than one output grid sent to `bintogrid`.</span>
<span class="sd">                         The one being used is the first to appear in</span>
<span class="sd">                         [`newx_edges`, `newx`, `dx`, `nx`]</span>
<span class="sd">                         but you might want to choose more carefully.&quot;&quot;&quot;</span>
        <span class="p">)</span>

    <span class="c1"># define inputs based on the following order</span>
    <span class="k">if</span> <span class="n">newx_edges</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># define grid by its edges (and define others from there)</span>
        <span class="n">newx_edges_without_unit</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">newx_edges</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">x_unit</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
        <span class="n">dx_without_unit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">newx_edges_without_unit</span><span class="p">)</span>
        <span class="n">newx_without_unit</span> <span class="o">=</span> <span class="n">newx_edges_without_unit</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">dx_without_unit</span>
        <span class="n">newx_left_without_unit</span> <span class="o">=</span> <span class="n">newx_edges_without_unit</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">newx_right_without_unit</span> <span class="o">=</span> <span class="n">newx_edges_without_unit</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

        <span class="c1"># make sure the final output grid is defined</span>
        <span class="n">final_newx</span><span class="p">,</span> <span class="n">final_newx_left</span><span class="p">,</span> <span class="n">final_newx_right</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">newx_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
            <span class="n">newx_left_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
            <span class="n">newx_right_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="n">newx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># define grid by its centers (and define others from there)</span>
        <span class="n">newx_without_unit</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">newx</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">x_unit</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
        <span class="n">newx_left_without_unit</span><span class="p">,</span> <span class="n">newx_right_without_unit</span> <span class="o">=</span> <span class="n">calculate_bin_leftright</span><span class="p">(</span>
            <span class="n">newx_without_unit</span>
        <span class="p">)</span>
        <span class="n">newx_edges_without_unit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span>
            <span class="p">[</span><span class="n">newx_left_without_unit</span><span class="p">,</span> <span class="n">newx_right_without_unit</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
        <span class="p">)</span>
        <span class="n">dx_without_unit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">newx_edges_without_unit</span><span class="p">)</span>

        <span class="c1"># make sure the final output grid is defined</span>
        <span class="n">final_newx</span><span class="p">,</span> <span class="n">final_newx_left</span><span class="p">,</span> <span class="n">final_newx_right</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">newx_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
            <span class="n">newx_left_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
            <span class="n">newx_right_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="n">dx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># define grid by a bin width (and define others from there)</span>
        <span class="n">dx_without_unit</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">dx</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">x_unit</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
        <span class="n">newx_without_unit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">x_without_unit</span><span class="p">),</span>
            <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">x_without_unit</span><span class="p">)</span> <span class="o">+</span> <span class="n">dx_without_unit</span><span class="p">,</span>
            <span class="n">dx_without_unit</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">newx_left_without_unit</span><span class="p">,</span> <span class="n">newx_right_without_unit</span> <span class="o">=</span> <span class="n">calculate_bin_leftright</span><span class="p">(</span>
            <span class="n">newx_without_unit</span>
        <span class="p">)</span>
        <span class="n">newx_edges_without_unit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span>
            <span class="p">[</span><span class="n">newx_left_without_unit</span><span class="p">,</span> <span class="n">newx_right_without_unit</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
        <span class="p">)</span>

        <span class="c1"># make sure the final output grid is defined</span>
        <span class="n">final_newx</span><span class="p">,</span> <span class="n">final_newx_left</span><span class="p">,</span> <span class="n">final_newx_right</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">newx_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
            <span class="n">newx_left_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
            <span class="n">newx_right_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">elif</span> <span class="n">nx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># keep track of the original input x values</span>
        <span class="n">original_x_without_unit</span> <span class="o">=</span> <span class="n">x_without_unit</span>

        <span class="c1"># redefine the input x to indices, to do interpolation in index space</span>
        <span class="n">x_without_unit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">x_without_unit</span><span class="p">))</span>

        <span class="c1"># define a grid of edges that will enclose the right number of indices</span>
        <span class="n">x_left_i</span><span class="p">,</span> <span class="n">x_right_i</span> <span class="o">=</span> <span class="n">calculate_bin_leftright</span><span class="p">(</span><span class="n">x_without_unit</span><span class="p">)</span>
        <span class="n">newx_edges_without_unit</span> <span class="o">=</span> <span class="n">leftright_to_edges</span><span class="p">(</span><span class="n">x_left_i</span><span class="p">,</span> <span class="n">x_right_i</span><span class="p">)[::</span><span class="n">nx</span><span class="p">]</span>
        <span class="n">newx_without_unit</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span>
            <span class="n">newx_edges_without_unit</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">+</span> <span class="n">newx_edges_without_unit</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="p">)</span>

        <span class="c1"># calculate the actual x values corresponding to the bins</span>
        <span class="n">original_edges</span> <span class="o">=</span> <span class="n">leftright_to_edges</span><span class="p">(</span>
            <span class="o">*</span><span class="n">calculate_bin_leftright</span><span class="p">(</span><span class="n">original_x_without_unit</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">final_edges</span> <span class="o">=</span> <span class="n">original_edges</span><span class="p">[::</span><span class="n">nx</span><span class="p">]</span> <span class="o">*</span> <span class="n">x_unit</span>
        <span class="n">final_newx_left</span><span class="p">,</span> <span class="n">final_newx_right</span> <span class="o">=</span> <span class="n">edges_to_leftright</span><span class="p">(</span><span class="n">final_edges</span><span class="p">)</span>
        <span class="n">final_newx</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">final_newx_left</span> <span class="o">+</span> <span class="n">final_newx_right</span><span class="p">)</span>
        <span class="n">dx_without_unit</span> <span class="o">=</span> <span class="p">(</span><span class="n">final_newx_right</span> <span class="o">-</span> <span class="n">final_newx_left</span><span class="p">)</span> <span class="o">/</span> <span class="n">x_unit</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;No output grid sent to `bintogrid`.</span>
<span class="sd">                              Please choose one of the following:</span>
<span class="sd">                              [`newx_edges`, `newx`, `dx`, `nx`]&quot;&quot;&quot;</span>
        <span class="p">)</span>

    <span class="c1"># don&#39;t complain about zero-divisions in here (to allow infinite uncertainties)</span>
    <span class="k">with</span> <span class="n">np</span><span class="o">.</span><span class="n">errstate</span><span class="p">(</span><span class="n">divide</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">invalid</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">):</span>

        <span class="c1"># calculate weight integrals for the bin array</span>
        <span class="n">ok</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">y_without_unit</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span>

        <span class="c1"># resample the sums onto that new grid</span>
        <span class="k">if</span> <span class="n">unc</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">x_without_unit</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">weighting</span> <span class="o">==</span> <span class="s2">&quot;inversevariance&quot;</span><span class="p">:</span>
                <span class="n">weights</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">unc</span><span class="o">**</span><span class="mi">2</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">x_without_unit</span><span class="p">)</span>

            <span class="c1"># ignore infinite weights (= 0 uncertainties)</span>
            <span class="n">ok</span> <span class="o">*=</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">ok</span><span class="p">):</span>
            <span class="n">numerator</span> <span class="o">=</span> <span class="n">resample_while_conserving_flux</span><span class="p">(</span>
                <span class="n">xin</span><span class="o">=</span><span class="n">x_without_unit</span><span class="p">[</span><span class="n">ok</span><span class="p">],</span>
                <span class="n">yin</span><span class="o">=</span><span class="p">(</span><span class="n">y_without_unit</span> <span class="o">*</span> <span class="n">weights</span><span class="p">)[</span><span class="n">ok</span><span class="p">],</span>
                <span class="n">xout_edges</span><span class="o">=</span><span class="n">newx_edges_without_unit</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">denominator</span> <span class="o">=</span> <span class="n">resample_while_conserving_flux</span><span class="p">(</span>
                <span class="n">xin</span><span class="o">=</span><span class="n">x_without_unit</span><span class="p">[</span><span class="n">ok</span><span class="p">],</span>
                <span class="n">yin</span><span class="o">=</span><span class="n">weights</span><span class="p">[</span><span class="n">ok</span><span class="p">],</span>
                <span class="n">xout_edges</span><span class="o">=</span><span class="n">newx_edges_without_unit</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="c1"># the binned weighted means on the new grid</span>
            <span class="n">newy</span> <span class="o">=</span> <span class="n">numerator</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">denominator</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span>

            <span class="c1"># the standard error on the means, for those bins</span>
            <span class="n">newunc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">denominator</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">])</span>

            <span class="c1"># keep track of the number of original bins going into each new bin</span>
            <span class="n">number_of_original_bins_per_new_bin</span> <span class="o">=</span> <span class="n">resample_while_conserving_flux</span><span class="p">(</span>
                <span class="n">xin</span><span class="o">=</span><span class="n">x_without_unit</span><span class="p">[</span><span class="n">ok</span><span class="p">],</span>
                <span class="n">yin</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">y_without_unit</span><span class="p">)[</span><span class="n">ok</span><span class="p">],</span>
                <span class="n">xout_edges</span><span class="o">=</span><span class="n">newx_edges_without_unit</span><span class="p">,</span>
            <span class="p">)[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">newy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="o">*</span> <span class="n">newx_without_unit</span>
            <span class="n">newunc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="o">*</span> <span class="n">newx_without_unit</span>
            <span class="n">number_of_original_bins_per_new_bin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">newx_without_unit</span><span class="p">)</span>

    <span class="c1"># remove any empty bins</span>
    <span class="k">if</span> <span class="n">drop_nans</span><span class="p">:</span>
        <span class="n">ok</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">newy</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ok</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">newx_without_unit</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>

    <span class="c1"># if no uncertainties were given, don&#39;t return uncertainties</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># populate the new grid centers + edges + values</span>
    <span class="n">result</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">final_newx</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span>
    <span class="n">result</span><span class="p">[</span><span class="s2">&quot;x_edge_lower&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">final_newx_left</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span>
    <span class="n">result</span><span class="p">[</span><span class="s2">&quot;x_edge_upper&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">final_newx_right</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span>

    <span class="c1"># populate the new grid values</span>
    <span class="n">result</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">newy</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span> <span class="o">*</span> <span class="n">y_unit</span>

    <span class="c1"># populate the new grid value uncertainties</span>
    <span class="k">if</span> <span class="n">unc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">result</span><span class="p">[</span><span class="s2">&quot;uncertainty&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">newunc</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span> <span class="o">*</span> <span class="n">y_unit</span>

    <span class="c1"># store how many of the original pixels made it into this new one</span>
    <span class="n">result</span><span class="p">[</span><span class="s2">&quot;N_unbinned/N_binned&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">number_of_original_bins_per_new_bin</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">visualize</span><span class="p">:</span>
        <span class="n">fi</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span>
            <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">gridspec_kw</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">height_ratios</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">])</span>
        <span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">plot_as_boxes</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">xleft</span><span class="o">=</span><span class="n">x_left</span><span class="p">,</span> <span class="n">xright</span><span class="o">=</span><span class="n">x_right</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;silver&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">ekw</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">elinewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">unc</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;silver&quot;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">ekw</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">],</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">],</span>
            <span class="n">yerr</span><span class="o">=</span><span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;uncertainty&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
            <span class="n">xerr</span><span class="o">=</span><span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s2">&quot;x_edge_upper&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;x_edge_lower&quot;</span><span class="p">])</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
            <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
            <span class="n">zorder</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
            <span class="o">**</span><span class="n">ekw</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">plot_as_boxes</span><span class="p">(</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">],</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;N_unbinned/N_binned&quot;</span><span class="p">],</span>
            <span class="n">xleft</span><span class="o">=</span><span class="n">result</span><span class="p">[</span><span class="s2">&quot;x_edge_lower&quot;</span><span class="p">],</span>
            <span class="n">xright</span><span class="o">=</span><span class="n">result</span><span class="p">[</span><span class="s2">&quot;x_edge_upper&quot;</span><span class="p">],</span>
        <span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;$N_</span><span class="si">{unbinned}</span><span class="s2">/N_</span><span class="si">{binned}</span><span class="s2">$&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.visualizations.colors.calculate_bin_leftright" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">calculate_bin_leftright</span><span class="p">(</span><span class="n">x</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.visualizations.colors.calculate_bin_leftright" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>If x is an array of bin centers, calculate the bin edges.
(assumes outermost bins are same size as their neighbors)</p>
<h4 id="chromatic.rainbows.visualizations.colors.calculate_bin_leftright--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.visualizations.colors.calculate_bin_leftright--parameters" title="Permanent link">#</a></h4>
<p>x : array
    The array of bin centers.</p>
<h4 id="chromatic.rainbows.visualizations.colors.calculate_bin_leftright--returns">Returns<a class="headerlink" href="#chromatic.rainbows.visualizations.colors.calculate_bin_leftright--returns" title="Permanent link">#</a></h4>
<p>l : array
    The left edges of the bins.
r : array
    The right edges of the bins.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/tools/resampling.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">calculate_bin_leftright</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    If x is an array of bin centers, calculate the bin edges.</span>
<span class="sd">    (assumes outermost bins are same size as their neighbors)</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : array</span>
<span class="sd">        The array of bin centers.</span>

<span class="sd">    Returns</span>
<span class="sd">    ----------</span>
<span class="sd">    l : array</span>
<span class="sd">        The left edges of the bins.</span>
<span class="sd">    r : array</span>
<span class="sd">        The right edges of the bins.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># what are bin edges (making a guess for those on the ends)</span>
    <span class="c1"># xbinsize = calculate_bin_widths(x)</span>
    <span class="c1"># left = x - xbinsize / 2.0</span>
    <span class="c1"># right = x + xbinsize / 2.0</span>

    <span class="c1"># weird corner case!</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">left</span><span class="p">,</span> <span class="n">right</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">left</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">right</span><span class="p">])</span>

    <span class="n">inner_edges</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="n">x</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">first_edge</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="n">inner_edges</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">last_edge</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">inner_edges</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

    <span class="n">left</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">first_edge</span><span class="p">,</span> <span class="n">inner_edges</span><span class="p">])</span>
    <span class="n">right</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">inner_edges</span><span class="p">,</span> <span class="n">last_edge</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.visualizations.colors.edges_to_leftright" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">edges_to_leftright</span><span class="p">(</span><span class="n">edges</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.visualizations.colors.edges_to_leftright" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Convert N+1 contiguous edges to two arrays of N left/right edges.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/tools/resampling.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">edges_to_leftright</span><span class="p">(</span><span class="n">edges</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert N+1 contiguous edges to two arrays of N left/right edges.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">left</span><span class="p">,</span> <span class="n">right</span> <span class="o">=</span> <span class="n">edges</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">edges</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="k">return</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.visualizations.colors.expand_filenames" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">expand_filenames</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.visualizations.colors.expand_filenames" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>A wrapper to expand a string or list into a list of filenames.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/imports.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">expand_filenames</span><span class="p">(</span><span class="n">filepath</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A wrapper to expand a string or list into a list of filenames.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
        <span class="n">filenames</span> <span class="o">=</span> <span class="n">filepath</span>
    <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span> <span class="o">==</span> <span class="n">Column</span><span class="p">:</span>
        <span class="n">filenames</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>
    <span class="k">elif</span> <span class="s2">&quot;*&quot;</span> <span class="ow">in</span> <span class="n">filepath</span><span class="p">:</span>
        <span class="n">filenames</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">filepath</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">filenames</span> <span class="o">=</span> <span class="p">[</span><span class="n">filepath</span><span class="p">]</span>
    <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">filenames</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.visualizations.colors.get_wavelength_color" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_wavelength_color</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wavelength</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.visualizations.colors.get_wavelength_color" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Determine the color corresponding to one or more wavelengths.</p>
<h4 id="chromatic.rainbows.visualizations.colors.get_wavelength_color--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.visualizations.colors.get_wavelength_color--parameters" title="Permanent link">#</a></h4>
<p>wavelength : Quantity
    The wavelength value(s), either an individual
    wavelength or an array of N wavelengths.</p>
<h4 id="chromatic.rainbows.visualizations.colors.get_wavelength_color--returns">Returns<a class="headerlink" href="#chromatic.rainbows.visualizations.colors.get_wavelength_color--returns" title="Permanent link">#</a></h4>
<p>colors : array
    An array of RGBA colors [or an (N,4) array].</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/rainbows/visualizations/colors.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_wavelength_color</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wavelength</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Determine the color corresponding to one or more wavelengths.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    wavelength : Quantity</span>
<span class="sd">        The wavelength value(s), either an individual</span>
<span class="sd">        wavelength or an array of N wavelengths.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    colors : array</span>
<span class="sd">        An array of RGBA colors [or an (N,4) array].</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">w_unitless</span> <span class="o">=</span> <span class="n">wavelength</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s2">&quot;micron&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
    <span class="n">normalized_w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">w_unitless</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cmap</span><span class="p">(</span><span class="n">normalized_w</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.visualizations.colors.leftright_to_edges" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">leftright_to_edges</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.visualizations.colors.leftright_to_edges" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Convert two arrays of N left/right edges to N+1 continugous edges.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/tools/resampling.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">leftright_to_edges</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert two arrays of N left/right edges to N+1 continugous edges.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">edges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>
    <span class="k">return</span> <span class="n">edges</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.visualizations.colors.name2color" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">name2color</span><span class="p">(</span><span class="n">name</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.visualizations.colors.name2color" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Return the 3-element RGB array of a given color name.</p>
<h4 id="chromatic.rainbows.visualizations.colors.name2color--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.visualizations.colors.name2color--parameters" title="Permanent link">#</a></h4>
<p>name : str
    The name of a color</p>
<h4 id="chromatic.rainbows.visualizations.colors.name2color--returns">Returns<a class="headerlink" href="#chromatic.rainbows.visualizations.colors.name2color--returns" title="Permanent link">#</a></h4>
<p>rgb : tuple
    3-element RGB color, with numbers from 0.0 to 1.0</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/imports.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">name2color</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return the 3-element RGB array of a given color name.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    name : str</span>
<span class="sd">        The name of a color</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    rgb : tuple</span>
<span class="sd">        3-element RGB color, with numbers from 0.0 to 1.0</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># give a friendly warning if the color name can&#39;t be found</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">color_hex</span> <span class="o">=</span> <span class="n">col</span><span class="o">.</span><span class="n">cnames</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">col</span><span class="o">.</span><span class="n">hex2color</span><span class="p">(</span><span class="n">color_hex</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="n">cheerfully_suggest</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The color </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> can&#39;t be found. (Returning black.)&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.visualizations.colors.one2another" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">one2another</span><span class="p">(</span><span class="n">bottom</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">alpha_bottom</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">alpha_top</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">256</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.visualizations.colors.one2another" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Create a cmap that goes smoothly (linearly in RGBA) from "bottom" to "top".</p>
<h4 id="chromatic.rainbows.visualizations.colors.one2another--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.visualizations.colors.one2another--parameters" title="Permanent link">#</a></h4>
<p>bottom : str
    Name of a color for the bottom of cmap (0.0)
top : str
    Name of a color for the top of the cmap (1.0)
alpha_bottom : float
    Opacity at the bottom of the cmap
alpha_top : float
    Opacitiy at the top of the cmap
N : int
    The number of levels in the listed color map</p>
<h4 id="chromatic.rainbows.visualizations.colors.one2another--returns">Returns<a class="headerlink" href="#chromatic.rainbows.visualizations.colors.one2another--returns" title="Permanent link">#</a></h4>
<p>cmap : Colormap
    A color map that goes linearly from the
    bottom to top color (and alpha).</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/imports.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">one2another</span><span class="p">(</span><span class="n">bottom</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">alpha_bottom</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">alpha_top</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">256</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a cmap that goes smoothly (linearly in RGBA) from &quot;bottom&quot; to &quot;top&quot;.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    bottom : str</span>
<span class="sd">        Name of a color for the bottom of cmap (0.0)</span>
<span class="sd">    top : str</span>
<span class="sd">        Name of a color for the top of the cmap (1.0)</span>
<span class="sd">    alpha_bottom : float</span>
<span class="sd">        Opacity at the bottom of the cmap</span>
<span class="sd">    alpha_top : float</span>
<span class="sd">        Opacitiy at the top of the cmap</span>
<span class="sd">    N : int</span>
<span class="sd">        The number of levels in the listed color map</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    cmap : Colormap</span>
<span class="sd">        A color map that goes linearly from the</span>
<span class="sd">        bottom to top color (and alpha).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># get the RGB values of the bottom and top of the cmap</span>
    <span class="n">rgb_bottom</span><span class="p">,</span> <span class="n">rgb_top</span> <span class="o">=</span> <span class="n">name2color</span><span class="p">(</span><span class="n">bottom</span><span class="p">),</span> <span class="n">name2color</span><span class="p">(</span><span class="n">top</span><span class="p">)</span>

    <span class="c1"># create linear gradients for all four RGBA channels</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">rgb_bottom</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">rgb_top</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">N</span><span class="p">)</span>
    <span class="n">g</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">rgb_bottom</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">rgb_top</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">N</span><span class="p">)</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">rgb_bottom</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">rgb_top</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">N</span><span class="p">)</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">alpha_bottom</span><span class="p">,</span> <span class="n">alpha_top</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>

    <span class="c1"># create (N,4) array + populate a listed colormap</span>
    <span class="n">colors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">]))</span>
    <span class="n">cmap</span> <span class="o">=</span> <span class="n">col</span><span class="o">.</span><span class="n">ListedColormap</span><span class="p">(</span><span class="n">colors</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{bottom}</span><span class="s2">2</span><span class="si">{top}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="nb">locals</span><span class="p">()))</span>

    <span class="c1"># return the colormap</span>
    <span class="k">return</span> <span class="n">cmap</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.visualizations.colors.remove_unit" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">remove_unit</span><span class="p">(</span><span class="n">x</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.visualizations.colors.remove_unit" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Quick wrapper to remove the unit from a quantity,
but not complain if it doesn't have one.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/imports.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">remove_unit</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Quick wrapper to remove the unit from a quantity,</span>
<span class="sd">    but not complain if it doesn&#39;t have one.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">x</span><span class="o">.</span><span class="n">value</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">x</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.visualizations.colors.resample_while_conserving_flux" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">resample_while_conserving_flux</span><span class="p">(</span><span class="n">xin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">yin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xout</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xin_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xout_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">replace_nans</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">visualize</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">pause</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.visualizations.colors.resample_while_conserving_flux" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Starting from some initial x and y, resample onto a
different grid (either higher or lower resolution),
while conserving total flux.</p>
<p>When including the entire range of <code>xin</code>,
<code>sum(yout) == sum(yin)</code> should be true.</p>
<p>When including only part of the range of <code>xin</code>,
the integral between any two points should be conserved.</p>
<h4 id="chromatic.rainbows.visualizations.colors.resample_while_conserving_flux--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.visualizations.colors.resample_while_conserving_flux--parameters" title="Permanent link">#</a></h4>
<p>xin : array
    The original independent variable.
yin : array
    The original dependent variable (same size as x).
xout : array
    The new grid of independent variables onto which
    you want to resample the y values. Refers to the
    center of each bin (use <code>xout_edges</code> for finer
    control over the exact edges of the bins)
xin_edges : array
    The edges of the original independent variable bins.
    The left and right edges of the bins are interpreted
    to be <code>xin_edges[:-1]</code> and <code>xin_edges[1:]</code>,
    respectively, so the associated <code>yin</code> should have exactly
    1 fewer element than <code>xin_edges</code>. This provides finer
    control over the size of each bin in the input than
    simply supplying <code>xin</code>(still a little experimental)
    They should probably be sorted?
xout_edges : array
    The edges of the new grid of bins for the independent
    variable, onto which you want to resample the y
    values. The left and right edges of the bins will be,
    respectively, <code>xout_edges[:-1]</code> and <code>xout_edges[1:]</code>,
    so the size of the output array will be
    <code>len(xout_edges) - 1</code>
replace_nans : float, str
    Replace nan values with this value.
    <code>replace_nans = 0</code>
        will add no flux where nans are
    <code>replace_nans = nan</code>
        will ensure you get nans returned everywhere
        if you try to resample over any nan
    <code>replace_nans = 'interpolate'</code>
        will try to replace nans by linearly interpolating
        from nearby values (not yet implemented)
visualize : bool
    Should we make a plot showing whether it worked?
pause : bool
    Should we pause to wait for a key press?</p>
<h4 id="chromatic.rainbows.visualizations.colors.resample_while_conserving_flux--returns">Returns<a class="headerlink" href="#chromatic.rainbows.visualizations.colors.resample_while_conserving_flux--returns" title="Permanent link">#</a></h4>
<p>result : dict
    A dictionary containing...
        <code>x</code> = the center of the output grid
        <code>y</code> = the resampled value on the output grid
        <code>edges</code> = the edges of the output grid, which will
            have one more element than x or y</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/tools/resampling.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">resample_while_conserving_flux</span><span class="p">(</span>
    <span class="n">xin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">yin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">xout</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">xin_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">xout_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">replace_nans</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
    <span class="n">visualize</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">pause</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Starting from some initial x and y, resample onto a</span>
<span class="sd">    different grid (either higher or lower resolution),</span>
<span class="sd">    while conserving total flux.</span>

<span class="sd">    When including the entire range of `xin`,</span>
<span class="sd">    `sum(yout) == sum(yin)` should be true.</span>

<span class="sd">    When including only part of the range of `xin`,</span>
<span class="sd">    the integral between any two points should be conserved.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    xin : array</span>
<span class="sd">        The original independent variable.</span>
<span class="sd">    yin : array</span>
<span class="sd">        The original dependent variable (same size as x).</span>
<span class="sd">    xout : array</span>
<span class="sd">        The new grid of independent variables onto which</span>
<span class="sd">        you want to resample the y values. Refers to the</span>
<span class="sd">        center of each bin (use `xout_edges` for finer</span>
<span class="sd">        control over the exact edges of the bins)</span>
<span class="sd">    xin_edges : array</span>
<span class="sd">        The edges of the original independent variable bins.</span>
<span class="sd">        The left and right edges of the bins are interpreted</span>
<span class="sd">        to be `xin_edges[:-1]` and `xin_edges[1:]`,</span>
<span class="sd">        respectively, so the associated `yin` should have exactly</span>
<span class="sd">        1 fewer element than `xin_edges`. This provides finer</span>
<span class="sd">        control over the size of each bin in the input than</span>
<span class="sd">        simply supplying `xin`(still a little experimental)</span>
<span class="sd">        They should probably be sorted?</span>
<span class="sd">    xout_edges : array</span>
<span class="sd">        The edges of the new grid of bins for the independent</span>
<span class="sd">        variable, onto which you want to resample the y</span>
<span class="sd">        values. The left and right edges of the bins will be,</span>
<span class="sd">        respectively, `xout_edges[:-1]` and `xout_edges[1:]`,</span>
<span class="sd">        so the size of the output array will be</span>
<span class="sd">        `len(xout_edges) - 1`</span>
<span class="sd">    replace_nans : float, str</span>
<span class="sd">        Replace nan values with this value.</span>
<span class="sd">        `replace_nans = 0`</span>
<span class="sd">            will add no flux where nans are</span>
<span class="sd">        `replace_nans = nan`</span>
<span class="sd">            will ensure you get nans returned everywhere</span>
<span class="sd">            if you try to resample over any nan</span>
<span class="sd">        `replace_nans = &#39;interpolate&#39;`</span>
<span class="sd">            will try to replace nans by linearly interpolating</span>
<span class="sd">            from nearby values (not yet implemented)</span>
<span class="sd">    visualize : bool</span>
<span class="sd">        Should we make a plot showing whether it worked?</span>
<span class="sd">    pause : bool</span>
<span class="sd">        Should we pause to wait for a key press?</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    result : dict</span>
<span class="sd">        A dictionary containing...</span>
<span class="sd">            `x` = the center of the output grid</span>
<span class="sd">            `y` = the resampled value on the output grid</span>
<span class="sd">            `edges` = the edges of the output grid, which will</span>
<span class="sd">                have one more element than x or y</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># make sure there are some reasonable input options</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">xin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">xin_edges</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">yin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">xout</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">xout_edges</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>

    <span class="c1"># set up the bins, to calculate cumulative distribution of y</span>
    <span class="k">if</span> <span class="n">xin_edges</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># make sure the sizes match up</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">xin</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">yin</span><span class="p">)</span>
        <span class="c1"># sort to make sure x is strictly increasing</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">xin</span><span class="p">)</span>
        <span class="n">xin_sorted</span> <span class="o">=</span> <span class="n">xin</span><span class="p">[</span><span class="n">s</span><span class="p">]</span>
        <span class="n">yin_sorted</span> <span class="o">=</span> <span class="n">yin</span><span class="p">[</span><span class="n">s</span><span class="p">]</span>
        <span class="c1"># estimate some bin edges (might fail for non-uniform grids)</span>
        <span class="n">xin_left</span><span class="p">,</span> <span class="n">xin_right</span> <span class="o">=</span> <span class="n">calculate_bin_leftright</span><span class="p">(</span><span class="n">xin_sorted</span><span class="p">)</span>
        <span class="c1"># define an array of edges</span>
        <span class="n">xin_edges</span> <span class="o">=</span> <span class="n">leftright_to_edges</span><span class="p">(</span><span class="n">xin_left</span><span class="p">,</span> <span class="n">xin_right</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># make sure the sizes match up</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">xin_edges</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">yin</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="c1"># sort to make sure x is strictly increasing</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">xin_edges</span><span class="p">)</span>
        <span class="n">xin_left</span><span class="p">,</span> <span class="n">xin_right</span> <span class="o">=</span> <span class="n">edges_to_leftright</span><span class="p">(</span><span class="n">xin_edges</span><span class="p">[</span><span class="n">s</span><span class="p">])</span>
        <span class="n">xin_sorted</span> <span class="o">=</span> <span class="p">(</span><span class="n">xin_left</span> <span class="o">+</span> <span class="n">xin_right</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">yin_sorted</span> <span class="o">=</span> <span class="n">yin</span><span class="p">[</span><span class="n">s</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>

    <span class="c1"># the first element should be the left edge of the first pixel</span>
    <span class="c1"># last element will be right edge of last pixel</span>
    <span class="n">xin_for_cdf</span> <span class="o">=</span> <span class="n">xin_edges</span>

    <span class="c1"># to the left of the first pixel, assume flux is zero</span>
    <span class="n">yin_for_cdf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">yin_sorted</span><span class="p">])</span>

    <span class="c1"># correct for any non-finite values</span>
    <span class="n">bad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">yin_for_cdf</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">replace_nans</span> <span class="o">==</span> <span class="s2">&quot;interpolate&quot;</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
            <span class="s2">&quot;The `replace_nans=&#39;interpolate&#39;`` option doens&#39;t exist yet!&quot;</span>
        <span class="p">)</span>
    <span class="n">yin_for_cdf</span><span class="p">[</span><span class="n">bad</span><span class="p">]</span> <span class="o">=</span> <span class="n">replace_nans</span>

    <span class="c1"># calculate the CDF of the flux (at pixel edge locations)</span>
    <span class="n">cdfin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">yin_for_cdf</span><span class="p">)</span>

    <span class="c1"># create an interpolator for that CDF</span>
    <span class="n">cdfinterpolator</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span>
        <span class="n">xin_for_cdf</span><span class="p">,</span>
        <span class="n">cdfin</span><span class="p">,</span>
        <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span>
        <span class="n">bounds_error</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">fill_value</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">yin</span><span class="p">)),</span>
    <span class="p">)</span>

    <span class="c1"># calculate bin edges (of size len(xout)+1)</span>
    <span class="k">if</span> <span class="n">xout_edges</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">xout_left</span><span class="p">,</span> <span class="n">xout_right</span> <span class="o">=</span> <span class="n">calculate_bin_leftright</span><span class="p">(</span><span class="n">xout</span><span class="p">)</span>
        <span class="n">xout_edges</span> <span class="o">=</span> <span class="n">leftright_to_edges</span><span class="p">(</span><span class="n">xout_left</span><span class="p">,</span> <span class="n">xout_right</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">xout_left</span><span class="p">,</span> <span class="n">xout_right</span> <span class="o">=</span> <span class="n">edges_to_leftright</span><span class="p">(</span><span class="n">xout_edges</span><span class="p">)</span>
        <span class="n">xout</span> <span class="o">=</span> <span class="p">(</span><span class="n">xout_left</span> <span class="o">+</span> <span class="n">xout_right</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>

    <span class="n">xout_for_cdf</span> <span class="o">=</span> <span class="n">leftright_to_edges</span><span class="p">(</span><span class="n">xout_left</span><span class="p">,</span> <span class="n">xout_right</span><span class="p">)</span>

    <span class="c1"># interpolate the CDF onto those bin edges</span>
    <span class="n">cdfout</span> <span class="o">=</span> <span class="n">cdfinterpolator</span><span class="p">(</span><span class="n">xout_for_cdf</span><span class="p">)</span>

    <span class="c1"># take  derivative of the CDF to get flux per resampled bin</span>
    <span class="c1"># (xout is bin center, and yout is the flux in that bin)</span>
    <span class="n">yout</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">cdfout</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">visualize</span><span class="p">:</span>
        <span class="n">fi</span><span class="p">,</span> <span class="p">(</span><span class="n">ax_cdf</span><span class="p">,</span> <span class="n">ax_pdf</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
        <span class="n">inkw</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
            <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span>
            <span class="n">markeredgecolor</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">outkw</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;darkorange&quot;</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span>
            <span class="n">markersize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
            <span class="n">markeredgecolor</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">legkw</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper left&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">xinbinsize</span> <span class="o">=</span> <span class="n">xin_right</span> <span class="o">-</span> <span class="n">xin_left</span>
        <span class="n">xoutbinsize</span> <span class="o">=</span> <span class="n">xout_right</span> <span class="o">-</span> <span class="n">xout_left</span>
        <span class="c1"># plot the PDFs</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="n">ax_pdf</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Flux per (Original) Pixel&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Pixel&quot;</span><span class="p">)</span>
        <span class="c1"># plot the original pixels (in df/dpixel to compare with resampled)</span>
        <span class="n">plot_as_boxes</span><span class="p">(</span>
            <span class="n">xin_sorted</span><span class="p">,</span> <span class="n">yin_sorted</span> <span class="o">/</span> <span class="n">xinbinsize</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Original Pixels&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">inkw</span>
        <span class="p">)</span>

        <span class="c1"># what would a bad interpolation look like?</span>
        <span class="n">interpolate_badly</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span>
            <span class="n">xin_sorted</span><span class="p">,</span>
            <span class="n">yin_sorted</span> <span class="o">/</span> <span class="n">xinbinsize</span><span class="p">,</span>
            <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span>
            <span class="n">bounds_error</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">fill_value</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
            <span class="n">xout</span><span class="p">,</span>
            <span class="n">interpolate_badly</span><span class="p">(</span><span class="n">xout</span><span class="p">),</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;cornflowerblue&quot;</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span>
            <span class="n">markersize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
            <span class="n">markeredgecolor</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Silly Simple Interpolation&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># plot the flux-conserving resampled data (again, in df/d&quot;pixel&quot;)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
            <span class="n">xout</span><span class="p">,</span> <span class="n">yout</span> <span class="o">/</span> <span class="n">xoutbinsize</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Flux-Conserving Interpolation&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">outkw</span>
        <span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="o">**</span><span class="n">legkw</span><span class="p">)</span>

        <span class="c1"># plot the CDFs</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="n">ax_cdf</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Cumulative Flux (from left)&quot;</span><span class="p">)</span>

        <span class="c1"># plot the original CDF</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xin_for_cdf</span><span class="p">,</span> <span class="n">cdfin</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Original Pixels&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">inkw</span><span class="p">)</span>

        <span class="c1"># plot the interpolated CDF</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xout_for_cdf</span><span class="p">,</span> <span class="n">cdfout</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Flux-Conserved Resample&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">outkw</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">pause</span><span class="p">:</span>
            <span class="n">a</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span>
                <span class="s2">&quot;Pausing a moment to check on interpolation; press return to continue.&quot;</span>
            <span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{:&gt;6}</span><span class="s2"> = </span><span class="si">{:.5f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;Actual&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">yin</span><span class="p">)))</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="s2">&quot;</span><span class="si">{:&gt;6}</span><span class="s2"> = </span><span class="si">{:.5f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="s2">&quot;Silly&quot;</span><span class="p">,</span>
                <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">interpolate_badly</span><span class="p">(</span><span class="n">xout</span><span class="p">)</span> <span class="o">*</span> <span class="n">xoutbinsize</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{:&gt;6}</span><span class="s2"> = </span><span class="si">{:.5f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;CDF&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">yout</span><span class="p">)))</span>

    <span class="c1"># return the resampled y-values</span>
    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="n">xout</span><span class="p">,</span> <span class="s2">&quot;x_edge_lower&quot;</span><span class="p">:</span> <span class="n">xout_left</span><span class="p">,</span> <span class="s2">&quot;x_edge_upper&quot;</span><span class="p">:</span> <span class="n">xout_right</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="n">yout</span><span class="p">}</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.visualizations.colors.setup_wavelength_colors" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">setup_wavelength_colors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.visualizations.colors.setup_wavelength_colors" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Set up a color map and normalization function for
colors datapoints by their wavelengths.</p>
<h4 id="chromatic.rainbows.visualizations.colors.setup_wavelength_colors--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.visualizations.colors.setup_wavelength_colors--parameters" title="Permanent link">#</a></h4>
<p>cmap : str, Colormap
    The color map to use.
vmin : Quantity
    The wavelength at the bottom of the cmap.
vmax : Quantity
    The wavelength at the top of the cmap.
log : bool
    If True, colors will scale with log(wavelength).
    If False, colors will scale with wavelength.
    If None, the scale will be guessed from the internal wscale.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/rainbows/visualizations/colors.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">setup_wavelength_colors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Set up a color map and normalization function for</span>
<span class="sd">    colors datapoints by their wavelengths.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    cmap : str, Colormap</span>
<span class="sd">        The color map to use.</span>
<span class="sd">    vmin : Quantity</span>
<span class="sd">        The wavelength at the bottom of the cmap.</span>
<span class="sd">    vmax : Quantity</span>
<span class="sd">        The wavelength at the top of the cmap.</span>
<span class="sd">    log : bool</span>
<span class="sd">        If True, colors will scale with log(wavelength).</span>
<span class="sd">        If False, colors will scale with wavelength.</span>
<span class="sd">        If None, the scale will be guessed from the internal wscale.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># populate the cmap object</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">cmap</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colormaps</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="n">cmap</span><span class="p">)</span>

    <span class="n">vmin</span> <span class="o">=</span> <span class="n">vmin</span>
    <span class="k">if</span> <span class="n">vmin</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">vmin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wavelength</span><span class="p">)</span>
    <span class="n">vmax</span> <span class="o">=</span> <span class="n">vmax</span>
    <span class="k">if</span> <span class="n">vmax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">vmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wavelength</span><span class="p">)</span>

    <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wscale</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;log&quot;</span><span class="p">])</span> <span class="ow">or</span> <span class="p">(</span><span class="n">log</span> <span class="o">==</span> <span class="kc">True</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">norm</span> <span class="o">=</span> <span class="n">col</span><span class="o">.</span><span class="n">LogNorm</span><span class="p">(</span>
            <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s2">&quot;micron&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s2">&quot;micron&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wscale</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;?&quot;</span><span class="p">,</span> <span class="s2">&quot;linear&quot;</span><span class="p">])</span> <span class="ow">or</span> <span class="p">(</span><span class="n">log</span> <span class="o">==</span> <span class="kc">False</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">norm</span> <span class="o">=</span> <span class="n">col</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span>
            <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s2">&quot;micron&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s2">&quot;micron&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-function">



<a id="chromatic.rainbows.visualizations.imshow"></a>
    <div class="doc doc-contents first">

        <p>Paint a 2D image of flux as a function of time and wavelength,
using <code>plt.imshow</code> where pixels will have constant size.</p>
<p>By using <code>.imshow()</code>, pixels must have constant size, so non-uniform
axes will be displayed and labeled by index, rather than actual value.
This is faster than <code>.pcolormesh()</code> but less flexible.  <code>.paint()</code> will
try to choose the best between <code>.imshow()</code> and <code>.pcolormesh()</code>.</p>
<h3 id="chromatic.rainbows.visualizations.imshow--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.visualizations.imshow--parameters" title="Permanent link">#</a></h3>
<p>ax : Axes, optional
    The axes into which to make this plot.
quantity : str, optional
    The fluxlike quantity to imshow.
    (Must be a key of <code>rainbow.fluxlike</code>).
xaxis : str
    What to use as the horizontal axis, 'time' or 'wavelength'.
w_unit : str, Unit, optional
    The unit for plotting wavelengths.
t_unit : str, Unit, optional
    The unit for plotting times.
colorbar : bool, optional
    Should we include a colorbar?
mask_ok : bool, optional
    Should we mark which data are not OK?
color_ok : str, optional
    The color to be used for masking data points that are not OK.
alpha_ok : float, optional
    The transparency to be used for masking data points that are not OK.
**kw : dict, optional
    All other keywords will be passed on to <code>plt.imshow</code>,
    so you can have more detailed control over the plot
    appearance. Common keyword arguments might include:
    <code>[cmap, norm, interpolation, alpha, vmin, vmax]</code> (and more)
    More details are available at
    https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.imshow.html</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/rainbows/visualizations/imshow.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">  6</span>
<span class="normal">  7</span>
<span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">imshow</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">quantity</span><span class="o">=</span><span class="s2">&quot;flux&quot;</span><span class="p">,</span>
    <span class="n">xaxis</span><span class="o">=</span><span class="s2">&quot;time&quot;</span><span class="p">,</span>
    <span class="n">w_unit</span><span class="o">=</span><span class="s2">&quot;micron&quot;</span><span class="p">,</span>
    <span class="n">t_unit</span><span class="o">=</span><span class="s2">&quot;day&quot;</span><span class="p">,</span>
    <span class="n">colorbar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">mask_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">color_ok</span><span class="o">=</span><span class="s2">&quot;tomato&quot;</span><span class="p">,</span>
    <span class="n">alpha_ok</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>
    <span class="n">vmin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">vmax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kw</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Paint a 2D image of flux as a function of time and wavelength,</span>
<span class="sd">    using `plt.imshow` where pixels will have constant size.</span>

<span class="sd">    By using `.imshow()`, pixels must have constant size, so non-uniform</span>
<span class="sd">    axes will be displayed and labeled by index, rather than actual value.</span>
<span class="sd">    This is faster than `.pcolormesh()` but less flexible.  `.paint()` will</span>
<span class="sd">    try to choose the best between `.imshow()` and `.pcolormesh()`.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    ax : Axes, optional</span>
<span class="sd">        The axes into which to make this plot.</span>
<span class="sd">    quantity : str, optional</span>
<span class="sd">        The fluxlike quantity to imshow.</span>
<span class="sd">        (Must be a key of `rainbow.fluxlike`).</span>
<span class="sd">    xaxis : str</span>
<span class="sd">        What to use as the horizontal axis, &#39;time&#39; or &#39;wavelength&#39;.</span>
<span class="sd">    w_unit : str, Unit, optional</span>
<span class="sd">        The unit for plotting wavelengths.</span>
<span class="sd">    t_unit : str, Unit, optional</span>
<span class="sd">        The unit for plotting times.</span>
<span class="sd">    colorbar : bool, optional</span>
<span class="sd">        Should we include a colorbar?</span>
<span class="sd">    mask_ok : bool, optional</span>
<span class="sd">        Should we mark which data are not OK?</span>
<span class="sd">    color_ok : str, optional</span>
<span class="sd">        The color to be used for masking data points that are not OK.</span>
<span class="sd">    alpha_ok : float, optional</span>
<span class="sd">        The transparency to be used for masking data points that are not OK.</span>
<span class="sd">    **kw : dict, optional</span>
<span class="sd">        All other keywords will be passed on to `plt.imshow`,</span>
<span class="sd">        so you can have more detailed control over the plot</span>
<span class="sd">        appearance. Common keyword arguments might include:</span>
<span class="sd">        `[cmap, norm, interpolation, alpha, vmin, vmax]` (and more)</span>
<span class="sd">        More details are available at</span>
<span class="sd">        https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.imshow.html</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># self.speak(f&#39;imshowing&#39;)</span>
    <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">()</span>

    <span class="c1"># get units</span>
    <span class="n">w_unit</span><span class="p">,</span> <span class="n">t_unit</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Unit</span><span class="p">(</span><span class="n">w_unit</span><span class="p">),</span> <span class="n">u</span><span class="o">.</span><span class="n">Unit</span><span class="p">(</span><span class="n">t_unit</span><span class="p">)</span>

    <span class="c1"># make sure some wavelength and time edges are defined</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_make_sure_wavelength_edges_are_defined</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_make_sure_time_edges_are_defined</span><span class="p">()</span>

    <span class="c1"># set up the wavelength extent</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">wmin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wavelength_lower</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">to_value</span><span class="p">(</span><span class="n">w_unit</span><span class="p">)</span>
        <span class="n">wmax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wavelength_upper</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">to_value</span><span class="p">(</span><span class="n">w_unit</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="n">wmin</span><span class="p">,</span> <span class="n">wmax</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wscale</span> <span class="o">==</span> <span class="s2">&quot;linear&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">wmin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">wmax</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
        <span class="n">wlower</span><span class="p">,</span> <span class="n">wupper</span> <span class="o">=</span> <span class="n">wmin</span><span class="p">,</span> <span class="n">wmax</span>
        <span class="n">wlabel</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_wave_label</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">w_unit</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="s1">&#39;latex_inline&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span>
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">wscale</span> <span class="o">==</span> <span class="s2">&quot;log&quot;</span> <span class="ow">and</span> <span class="p">(</span><span class="n">wmin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">wmax</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
        <span class="n">wlower</span><span class="p">,</span> <span class="n">wupper</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">wmin</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">wmax</span><span class="p">)</span>
        <span class="n">wlabel</span> <span class="o">=</span> <span class="p">(</span>
            <span class="sa">r</span><span class="s2">&quot;log$_</span><span class="si">{10}</span><span class="s2">$&quot;</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_wave_label</span><span class="si">}</span><span class="s2">/(</span><span class="si">{</span><span class="n">w_unit</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="s1">&#39;latex_inline&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">)]&quot;</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">message</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        The wavelength scale for this rainbow is &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">wscale</span><span class="si">}</span><span class="s2">&#39;,</span>
<span class="s2">        and there are </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">nwave</span><span class="si">}</span><span class="s2"> wavelength centers and</span>
<span class="s2">        </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wavelike</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;wavelength_lower&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">[]))</span><span class="si">}</span><span class="s2"> wavelength edges defined.</span>

<span class="s2">        It&#39;s hard to imshow something with a wavelength axis</span>
<span class="s2">        that isn&#39;t linearly or logarithmically uniform, or doesn&#39;t</span>
<span class="s2">        at least have its wavelength edges defined. We&#39;re giving up</span>
<span class="s2">        and just using the wavelength index as the wavelength axis.</span>

<span class="s2">        If you want a real wavelength axis, one solution would be</span>
<span class="s2">        to use `rainbow.pcolormesh()` instead of `rainbow.imshow()`.</span>
<span class="s2">        It takes basically the same inputs but can handle non-uniform</span>
<span class="s2">        grids.</span>

<span class="s2">        Or, you could bin your wavelengths to a more uniform grid with</span>
<span class="s2">        `binned = rainbow.bin(R=...)` (for logarithmic wavelengths)</span>
<span class="s2">        or `binned = rainbow.bin(dw=...)` (for linear wavelengths)</span>
<span class="s2">        and then `binned.imshow()` will give more informative axes.</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="n">cheerfully_suggest</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
        <span class="n">wlower</span><span class="p">,</span> <span class="n">wupper</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nwave</span> <span class="o">-</span> <span class="mf">0.5</span>
        <span class="n">wlabel</span> <span class="o">=</span> <span class="s2">&quot;Wavelength Index&quot;</span>

    <span class="c1"># set up the time extent</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">tmin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_lower</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">to_value</span><span class="p">(</span><span class="n">t_unit</span><span class="p">)</span>
        <span class="n">tmax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_upper</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">to_value</span><span class="p">(</span><span class="n">t_unit</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="n">tmin</span><span class="p">,</span> <span class="n">tmax</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tscale</span> <span class="o">==</span> <span class="s2">&quot;linear&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">tmin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">tmax</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
        <span class="n">tlower</span><span class="p">,</span> <span class="n">tupper</span> <span class="o">=</span> <span class="n">tmin</span><span class="p">,</span> <span class="n">tmax</span>
        <span class="n">tlabel</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_time_label</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">t_unit</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="s1">&#39;latex_inline&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span>
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">tscale</span> <span class="o">==</span> <span class="s2">&quot;log&quot;</span> <span class="ow">and</span> <span class="p">(</span><span class="n">tmin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">tmax</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
        <span class="n">tlower</span><span class="p">,</span> <span class="n">tupper</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">tmin</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">tmax</span><span class="p">)</span>
        <span class="n">tlabel</span> <span class="o">=</span> <span class="p">(</span>
            <span class="sa">r</span><span class="s2">&quot;log$_</span><span class="si">{10}</span><span class="s2">$&quot;</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_time_label</span><span class="si">}</span><span class="s2">/(</span><span class="si">{</span><span class="n">t_unit</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="s1">&#39;latex_inline&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">)]&quot;</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">message</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        The time scale for this rainbow is &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">tscale</span><span class="si">}</span><span class="s2">&#39;,</span>
<span class="s2">        and there are </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ntime</span><span class="si">}</span><span class="s2"> time centers and</span>
<span class="s2">        </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timelike</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;time_lower&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">[]))</span><span class="si">}</span><span class="s2"> time edges defined.</span>

<span class="s2">        It&#39;s hard to imshow something with a time axis</span>
<span class="s2">        that isn&#39;t linearly or logarithmically uniform, or doesn&#39;t</span>
<span class="s2">        at least have its time edges defined. We&#39;re giving up</span>
<span class="s2">        and just using the time index as the time axis.</span>

<span class="s2">        If you want a real time axis, one solution would be</span>
<span class="s2">        to use `rainbow.pcolormesh()` instead of `rainbow.imshow()`.</span>
<span class="s2">        It takes basically the same inputs but can handle non-uniform</span>
<span class="s2">        grids.</span>

<span class="s2">        Or, you could bin your times to a more uniform grid with</span>
<span class="s2">        `binned = rainbow.bin(dt=...)` (for linear times) and then</span>
<span class="s2">        `binned.imshow()` will give more informative axes.</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="n">cheerfully_suggest</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
        <span class="n">tlower</span><span class="p">,</span> <span class="n">tupper</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ntime</span> <span class="o">-</span> <span class="mf">0.5</span>
        <span class="n">tlabel</span> <span class="o">=</span> <span class="s2">&quot;Time Index&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_2D</span><span class="p">(</span><span class="n">k</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A small helper to get a 2D quantity. This is a bit of</span>
<span class="sd">        a kludge to help with weird cases of duplicate keys</span>
<span class="sd">        (for example where &#39;wavelength&#39; might appear in both</span>
<span class="sd">        `wavelike` and `fluxlike`).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">z</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">z</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fluxlike</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="c1"># choose between time and wavelength on the x-axis</span>
    <span class="k">if</span> <span class="n">xaxis</span><span class="o">.</span><span class="n">lower</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;t&quot;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;_imshow_extent&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">tlower</span><span class="p">,</span> <span class="n">tupper</span><span class="p">,</span> <span class="n">wupper</span><span class="p">,</span> <span class="n">wlower</span><span class="p">]</span>
        <span class="n">xlabel</span><span class="p">,</span> <span class="n">ylabel</span> <span class="o">=</span> <span class="n">tlabel</span><span class="p">,</span> <span class="n">wlabel</span>
        <span class="n">z</span> <span class="o">=</span> <span class="n">get_2D</span><span class="p">(</span><span class="n">quantity</span><span class="p">)</span>
        <span class="n">ok</span> <span class="o">=</span> <span class="n">get_2D</span><span class="p">(</span><span class="s2">&quot;ok&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">xaxis</span><span class="o">.</span><span class="n">lower</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;w&quot;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;_imshow_extent&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">wlower</span><span class="p">,</span> <span class="n">wupper</span><span class="p">,</span> <span class="n">tupper</span><span class="p">,</span> <span class="n">tlower</span><span class="p">]</span>
        <span class="n">xlabel</span><span class="p">,</span> <span class="n">ylabel</span> <span class="o">=</span> <span class="n">wlabel</span><span class="p">,</span> <span class="n">tlabel</span>
        <span class="n">z</span> <span class="o">=</span> <span class="n">get_2D</span><span class="p">(</span><span class="n">quantity</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="n">ok</span> <span class="o">=</span> <span class="n">get_2D</span><span class="p">(</span><span class="s2">&quot;ok&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">cheerfully_suggest</span><span class="p">(</span>
            <span class="s2">&quot;Please specify either `xaxis=&#39;time&#39;` or `xaxis=&#39;wavelength&#39;` for `.plot()`&quot;</span>
        <span class="p">)</span>

    <span class="c1"># figure out a good shared color limits (unless already supplied)</span>
    <span class="n">vmin</span> <span class="o">=</span> <span class="n">vmin</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">nanpercentile</span><span class="p">(</span><span class="n">remove_unit</span><span class="p">(</span><span class="n">z</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span> <span class="o">*</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">vmax</span> <span class="o">=</span> <span class="n">vmax</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">nanpercentile</span><span class="p">(</span><span class="n">remove_unit</span><span class="p">(</span><span class="n">z</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span> <span class="o">*</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mi">99</span><span class="p">)</span>

    <span class="c1"># define some default keywords</span>
    <span class="n">imshow_kw</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">interpolation</span><span class="o">=</span><span class="s2">&quot;antialiased&quot;</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">)</span>
    <span class="n">imshow_kw</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">quantity_support</span><span class="p">():</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>

        <span class="c1"># create an overlaying mask of which data are OK or not</span>
        <span class="k">if</span> <span class="n">mask_ok</span><span class="p">:</span>
            <span class="n">okimshow_kw</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="o">**</span><span class="n">imshow_kw</span><span class="p">)</span>
            <span class="n">okimshow_kw</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                <span class="n">cmap</span><span class="o">=</span><span class="n">one2another</span><span class="p">(</span>
                    <span class="n">bottom</span><span class="o">=</span><span class="n">color_ok</span><span class="p">,</span>
                    <span class="n">top</span><span class="o">=</span><span class="n">color_ok</span><span class="p">,</span>
                    <span class="n">alpha_bottom</span><span class="o">=</span><span class="n">alpha_ok</span><span class="p">,</span>
                    <span class="n">alpha_top</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="p">),</span>
                <span class="n">zorder</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="n">vmax</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span>
                <span class="n">remove_unit</span><span class="p">(</span><span class="n">ok</span><span class="p">),</span>
                <span class="n">extent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;_imshow_extent&quot;</span><span class="p">],</span>
                <span class="n">origin</span><span class="o">=</span><span class="s2">&quot;upper&quot;</span><span class="p">,</span>
                <span class="o">**</span><span class="n">okimshow_kw</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span>
            <span class="n">remove_unit</span><span class="p">(</span><span class="n">z</span><span class="p">),</span>
            <span class="n">extent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;_imshow_extent&quot;</span><span class="p">],</span>
            <span class="n">origin</span><span class="o">=</span><span class="s2">&quot;upper&quot;</span><span class="p">,</span>
            <span class="o">**</span><span class="n">imshow_kw</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">colorbar</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span>
                <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
                <span class="n">label</span><span class="o">=</span><span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">z</span><span class="p">)</span><span class="o">.</span><span class="n">unit</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="s2">&quot;latex_inline&quot;</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ax</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-module">



<a id="chromatic.rainbows.visualizations.interactive"></a>
    <div class="doc doc-contents first">









  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.visualizations.interactive.bintoR" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">bintoR</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">unc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">R</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">weighting</span><span class="o">=</span><span class="s1">&#39;inversevariance&#39;</span><span class="p">,</span> <span class="n">drop_nans</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.visualizations.interactive.bintoR" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Bin any x and y array onto a logarithmicly uniform grid.</p>
<h4 id="chromatic.rainbows.visualizations.interactive.bintoR--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.visualizations.interactive.bintoR--parameters" title="Permanent link">#</a></h4>
<p>x : array
    The original independent variable.
    (For a spectrum example = wavelength)
y : array
    The original dependent variable (same size as x).
    (For a spectrum example = flux)
unc : array, None, optional
    The unceratinty on the dependent variable
    (For a spectrum example = the flux uncertainty)
R : array, optional
    The spectral resolution R=x/dx for creating a new,
    logarithmically uniform grid that starts at the first
    value of x.
xlim : list, array, optional
    A two-element list indicating the min and max values of
    x for the new logarithmically spaced grid. If None,
    these limits will be created from the data themselves
weighting : str, optional
    How should we weight values when averaging
    them together into one larger bin?
    <code>weighting = 'inversevariance'</code>
        weights = 1/unc**2
     <code>weighting = {literally anything else}</code>
        uniform weights
    This will have no impact if <code>unc == None</code>, or for any
    new bins that effectively overlap less than one original
    unbinned point.
drop_nans : bool, optional
    Should we skip any bins turn out to be nans?
    This most often happens when bins are empty.</p>
<h4 id="chromatic.rainbows.visualizations.interactive.bintoR--returns">Returns<a class="headerlink" href="#chromatic.rainbows.visualizations.interactive.bintoR--returns" title="Permanent link">#</a></h4>
<p>result : dict
    A dictionary containing at least...
        <code>x</code> = the center of the output grid
        <code>y</code> = the resampled value on the output grid
        <code>x_edge_lower</code> = the lower edges of the output grid
        <code>x_edge_upper</code> = the upper edges of the output grid
    ...and possibly also
        <code>uncertainty</code> = the calculated uncertainty per bin</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/tools/resampling.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">bintoR</span><span class="p">(</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">unc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">R</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">weighting</span><span class="o">=</span><span class="s2">&quot;inversevariance&quot;</span><span class="p">,</span> <span class="n">drop_nans</span><span class="o">=</span><span class="kc">True</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Bin any x and y array onto a logarithmicly uniform grid.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : array</span>
<span class="sd">        The original independent variable.</span>
<span class="sd">        (For a spectrum example = wavelength)</span>
<span class="sd">    y : array</span>
<span class="sd">        The original dependent variable (same size as x).</span>
<span class="sd">        (For a spectrum example = flux)</span>
<span class="sd">    unc : array, None, optional</span>
<span class="sd">        The unceratinty on the dependent variable</span>
<span class="sd">        (For a spectrum example = the flux uncertainty)</span>
<span class="sd">    R : array, optional</span>
<span class="sd">        The spectral resolution R=x/dx for creating a new,</span>
<span class="sd">        logarithmically uniform grid that starts at the first</span>
<span class="sd">        value of x.</span>
<span class="sd">    xlim : list, array, optional</span>
<span class="sd">        A two-element list indicating the min and max values of</span>
<span class="sd">        x for the new logarithmically spaced grid. If None,</span>
<span class="sd">        these limits will be created from the data themselves</span>
<span class="sd">    weighting : str, optional</span>
<span class="sd">        How should we weight values when averaging</span>
<span class="sd">        them together into one larger bin?</span>
<span class="sd">        `weighting = &#39;inversevariance&#39;`</span>
<span class="sd">            weights = 1/unc**2</span>
<span class="sd">         `weighting = {literally anything else}`</span>
<span class="sd">            uniform weights</span>
<span class="sd">        This will have no impact if `unc == None`, or for any</span>
<span class="sd">        new bins that effectively overlap less than one original</span>
<span class="sd">        unbinned point.</span>
<span class="sd">    drop_nans : bool, optional</span>
<span class="sd">        Should we skip any bins turn out to be nans?</span>
<span class="sd">        This most often happens when bins are empty.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    result : dict</span>
<span class="sd">        A dictionary containing at least...</span>
<span class="sd">            `x` = the center of the output grid</span>
<span class="sd">            `y` = the resampled value on the output grid</span>
<span class="sd">            `x_edge_lower` = the lower edges of the output grid</span>
<span class="sd">            `x_edge_upper` = the upper edges of the output grid</span>
<span class="sd">        ...and possibly also</span>
<span class="sd">            `uncertainty` = the calculated uncertainty per bin</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">x_unit</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">unit</span>
        <span class="n">x_without_unit</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">value</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="n">x_unit</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">x_without_unit</span> <span class="o">=</span> <span class="n">x</span>

    <span class="c1"># create a new grid of x at the given resolution</span>
    <span class="n">lnx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">x_without_unit</span><span class="p">)</span>
    <span class="n">dnewlnx</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">R</span>

    <span class="c1"># set the limits of the new xgrid (in log space)</span>
    <span class="k">if</span> <span class="n">xlim</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># use the input grid to set the limits</span>
        <span class="n">lnxbottom</span><span class="p">,</span> <span class="n">lnxtop</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">lnx</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">lnx</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># use the custom xlim to set the limits</span>
        <span class="n">lnxbottom</span><span class="p">,</span> <span class="n">lnxtop</span> <span class="o">=</span> <span class="n">xlim</span>

    <span class="c1"># create a new, log-uniform grid of x values</span>
    <span class="n">newlnx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">lnxbottom</span><span class="p">,</span> <span class="n">lnxtop</span> <span class="o">+</span> <span class="n">dnewlnx</span><span class="p">,</span> <span class="n">dnewlnx</span><span class="p">)</span>

    <span class="c1"># now do the binning on a uniform grid of lnx</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">bintogrid</span><span class="p">(</span>
        <span class="n">lnx</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">unc</span><span class="p">,</span> <span class="n">newx</span><span class="o">=</span><span class="n">newlnx</span><span class="p">,</span> <span class="n">weighting</span><span class="o">=</span><span class="n">weighting</span><span class="p">,</span> <span class="n">drop_nans</span><span class="o">=</span><span class="n">drop_nans</span>
    <span class="p">)</span>

    <span class="c1"># convert back from log to real values</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;x_edge_lower&quot;</span><span class="p">,</span> <span class="s2">&quot;x_edge_upper&quot;</span><span class="p">]:</span>
        <span class="n">result</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="o">*</span> <span class="n">x_unit</span>

    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.visualizations.interactive.bintogrid" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">bintogrid</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">unc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">newx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">newx_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">nx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">weighting</span><span class="o">=</span><span class="s1">&#39;inversevariance&#39;</span><span class="p">,</span> <span class="n">drop_nans</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">x_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">visualize</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.visualizations.interactive.bintogrid" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Bin any x and y array onto a linearly uniform grid.</p>
<h4 id="chromatic.rainbows.visualizations.interactive.bintogrid--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.visualizations.interactive.bintogrid--parameters" title="Permanent link">#</a></h4>
<p>x : array
    The original independent variable.
    (For a spectrum example = wavelength)
y : array
    The original dependent variable (same size as x).
    (For a spectrum example = flux)
unc : array, None
    The unceratinty on the dependent variable
    (For a spectrum example = the flux uncertainty)
nx : array
    The number of bins from the original grid to
    bin together into the new one.
dx : array
    The fixed spacing for creating a new, linearly uniform
    grid that start at the first value of x. This will
    be ignored if <code>newx</code> != None.
newx : array
    A new custom grid onto which we should bin.
newx_edges : array
    The edges of the new grid of bins for the independent
    variable, onto which you want to resample the y
    values. The left and right edges of the bins will be,
    respectively, <code>newx_edges[:-1]</code> and <code>newx_edges[1:]</code>,
    so the size of the output array will be
    <code>len(newx_edges) - 1</code>
weighting : str
    How should we weight values when averaging
    them together into one larger bin?
    <code>weighting = 'inversevariance'</code>
        weights = 1/unc**2
     <code>weighting = {literally anything else}</code>
        uniform weights
    This will have no impact if <code>unc == None</code>, or for any
    new bins that effectively overlap less than one original
    unbinned point.
drop_nans : bool
    Should we skip any bins turn out to be nans?
    This most often happens when bins are empty.
x_edges : array
    The edges of the original independent variable bins.
    The left and right edges of the bins are interpreted
    to be <code>x_edges[:-1]</code> and <code>x_edges[1:]</code>,
    respectively, so the associated <code>y</code> should have exactly
    1 fewer element than <code>x_edges</code>. This provides finer
    control over the size of each bin in the input than
    simply supplying <code>x</code>(still a little experimental)</p>
<h4 id="chromatic.rainbows.visualizations.interactive.bintogrid--returns">Returns<a class="headerlink" href="#chromatic.rainbows.visualizations.interactive.bintogrid--returns" title="Permanent link">#</a></h4>
<p>result : dict
    A dictionary containing at least...
        <code>x</code> = the center of the output grid
        <code>y</code> = the resampled value on the output grid
        <code>x_edge_lower</code> = the lower edges of the output grid
        <code>x_edge_upper</code> = the upper edges of the output grid
    ...and possibly also
        <code>uncertainty</code> = the calculated uncertainty per bin</p>
<p>The order of precendence for setting the new grid is
[<code>newx_edges</code>, <code>newx</code>, <code>dx</code>, <code>nx</code>]
The first will be used, and others will be ignored.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/tools/resampling.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">bintogrid</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">unc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">newx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">newx_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">dx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">nx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">weighting</span><span class="o">=</span><span class="s2">&quot;inversevariance&quot;</span><span class="p">,</span>
    <span class="n">drop_nans</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">x_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">visualize</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Bin any x and y array onto a linearly uniform grid.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : array</span>
<span class="sd">        The original independent variable.</span>
<span class="sd">        (For a spectrum example = wavelength)</span>
<span class="sd">    y : array</span>
<span class="sd">        The original dependent variable (same size as x).</span>
<span class="sd">        (For a spectrum example = flux)</span>
<span class="sd">    unc : array, None</span>
<span class="sd">        The unceratinty on the dependent variable</span>
<span class="sd">        (For a spectrum example = the flux uncertainty)</span>
<span class="sd">    nx : array</span>
<span class="sd">        The number of bins from the original grid to</span>
<span class="sd">        bin together into the new one.</span>
<span class="sd">    dx : array</span>
<span class="sd">        The fixed spacing for creating a new, linearly uniform</span>
<span class="sd">        grid that start at the first value of x. This will</span>
<span class="sd">        be ignored if `newx` != None.</span>
<span class="sd">    newx : array</span>
<span class="sd">        A new custom grid onto which we should bin.</span>
<span class="sd">    newx_edges : array</span>
<span class="sd">        The edges of the new grid of bins for the independent</span>
<span class="sd">        variable, onto which you want to resample the y</span>
<span class="sd">        values. The left and right edges of the bins will be,</span>
<span class="sd">        respectively, `newx_edges[:-1]` and `newx_edges[1:]`,</span>
<span class="sd">        so the size of the output array will be</span>
<span class="sd">        `len(newx_edges) - 1`</span>
<span class="sd">    weighting : str</span>
<span class="sd">        How should we weight values when averaging</span>
<span class="sd">        them together into one larger bin?</span>
<span class="sd">        `weighting = &#39;inversevariance&#39;`</span>
<span class="sd">            weights = 1/unc**2</span>
<span class="sd">         `weighting = {literally anything else}`</span>
<span class="sd">            uniform weights</span>
<span class="sd">        This will have no impact if `unc == None`, or for any</span>
<span class="sd">        new bins that effectively overlap less than one original</span>
<span class="sd">        unbinned point.</span>
<span class="sd">    drop_nans : bool</span>
<span class="sd">        Should we skip any bins turn out to be nans?</span>
<span class="sd">        This most often happens when bins are empty.</span>
<span class="sd">    x_edges : array</span>
<span class="sd">        The edges of the original independent variable bins.</span>
<span class="sd">        The left and right edges of the bins are interpreted</span>
<span class="sd">        to be `x_edges[:-1]` and `x_edges[1:]`,</span>
<span class="sd">        respectively, so the associated `y` should have exactly</span>
<span class="sd">        1 fewer element than `x_edges`. This provides finer</span>
<span class="sd">        control over the size of each bin in the input than</span>
<span class="sd">        simply supplying `x`(still a little experimental)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    result : dict</span>
<span class="sd">        A dictionary containing at least...</span>
<span class="sd">            `x` = the center of the output grid</span>
<span class="sd">            `y` = the resampled value on the output grid</span>
<span class="sd">            `x_edge_lower` = the lower edges of the output grid</span>
<span class="sd">            `x_edge_upper` = the upper edges of the output grid</span>
<span class="sd">        ...and possibly also</span>
<span class="sd">            `uncertainty` = the calculated uncertainty per bin</span>


<span class="sd">    The order of precendence for setting the new grid is</span>
<span class="sd">    [`newx_edges`, `newx`, `dx`, `nx`]</span>
<span class="sd">    The first will be used, and others will be ignored.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># check that an OK set of inputs has been supplied</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">x_edges</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;🌈 Both `x` and `x_edges` were supplied to `bintogrid`. Confusing!&quot;&quot;&quot;</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">x_edges</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;🌈 At least one of `x` or `x_edges` must be supplied to `bintogrid`.&quot;&quot;&quot;</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="n">y</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;🌈 `y` must be supplied to `bintogrid`.&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="c1"># make sure the edges and the centers are set</span>
    <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">x_left</span><span class="p">,</span> <span class="n">x_right</span> <span class="o">=</span> <span class="n">edges_to_leftright</span><span class="p">(</span><span class="n">x_edges</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">left</span> <span class="o">+</span> <span class="n">right</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">x_left</span><span class="p">,</span> <span class="n">x_right</span> <span class="o">=</span> <span class="n">calculate_bin_leftright</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">x_edges</span> <span class="o">=</span> <span class="n">leftright_to_edges</span><span class="p">(</span><span class="n">x_left</span><span class="p">,</span> <span class="n">x_right</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">x_unit</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">unit</span>
        <span class="n">x_without_unit</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">value</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="n">x_unit</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">x_without_unit</span> <span class="o">=</span> <span class="n">x</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">y_unit</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">unit</span>
        <span class="n">y_without_unit</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">value</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="n">y_unit</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">y_without_unit</span> <span class="o">=</span> <span class="n">y</span>

    <span class="c1"># warn if multiple inputs are provided</span>
    <span class="n">number_of_grid_options</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span><span class="n">z</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="p">[</span><span class="n">newx_edges</span><span class="p">,</span> <span class="n">newx</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">nx</span><span class="p">]])</span>
    <span class="k">if</span> <span class="n">number_of_grid_options</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">cheerfully_suggest</span><span class="p">(</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;More than one output grid sent to `bintogrid`.</span>
<span class="sd">                         The one being used is the first to appear in</span>
<span class="sd">                         [`newx_edges`, `newx`, `dx`, `nx`]</span>
<span class="sd">                         but you might want to choose more carefully.&quot;&quot;&quot;</span>
        <span class="p">)</span>

    <span class="c1"># define inputs based on the following order</span>
    <span class="k">if</span> <span class="n">newx_edges</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># define grid by its edges (and define others from there)</span>
        <span class="n">newx_edges_without_unit</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">newx_edges</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">x_unit</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
        <span class="n">dx_without_unit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">newx_edges_without_unit</span><span class="p">)</span>
        <span class="n">newx_without_unit</span> <span class="o">=</span> <span class="n">newx_edges_without_unit</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">dx_without_unit</span>
        <span class="n">newx_left_without_unit</span> <span class="o">=</span> <span class="n">newx_edges_without_unit</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">newx_right_without_unit</span> <span class="o">=</span> <span class="n">newx_edges_without_unit</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

        <span class="c1"># make sure the final output grid is defined</span>
        <span class="n">final_newx</span><span class="p">,</span> <span class="n">final_newx_left</span><span class="p">,</span> <span class="n">final_newx_right</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">newx_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
            <span class="n">newx_left_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
            <span class="n">newx_right_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="n">newx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># define grid by its centers (and define others from there)</span>
        <span class="n">newx_without_unit</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">newx</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">x_unit</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
        <span class="n">newx_left_without_unit</span><span class="p">,</span> <span class="n">newx_right_without_unit</span> <span class="o">=</span> <span class="n">calculate_bin_leftright</span><span class="p">(</span>
            <span class="n">newx_without_unit</span>
        <span class="p">)</span>
        <span class="n">newx_edges_without_unit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span>
            <span class="p">[</span><span class="n">newx_left_without_unit</span><span class="p">,</span> <span class="n">newx_right_without_unit</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
        <span class="p">)</span>
        <span class="n">dx_without_unit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">newx_edges_without_unit</span><span class="p">)</span>

        <span class="c1"># make sure the final output grid is defined</span>
        <span class="n">final_newx</span><span class="p">,</span> <span class="n">final_newx_left</span><span class="p">,</span> <span class="n">final_newx_right</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">newx_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
            <span class="n">newx_left_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
            <span class="n">newx_right_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="n">dx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># define grid by a bin width (and define others from there)</span>
        <span class="n">dx_without_unit</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">dx</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">x_unit</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
        <span class="n">newx_without_unit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">x_without_unit</span><span class="p">),</span>
            <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">x_without_unit</span><span class="p">)</span> <span class="o">+</span> <span class="n">dx_without_unit</span><span class="p">,</span>
            <span class="n">dx_without_unit</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">newx_left_without_unit</span><span class="p">,</span> <span class="n">newx_right_without_unit</span> <span class="o">=</span> <span class="n">calculate_bin_leftright</span><span class="p">(</span>
            <span class="n">newx_without_unit</span>
        <span class="p">)</span>
        <span class="n">newx_edges_without_unit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span>
            <span class="p">[</span><span class="n">newx_left_without_unit</span><span class="p">,</span> <span class="n">newx_right_without_unit</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
        <span class="p">)</span>

        <span class="c1"># make sure the final output grid is defined</span>
        <span class="n">final_newx</span><span class="p">,</span> <span class="n">final_newx_left</span><span class="p">,</span> <span class="n">final_newx_right</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">newx_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
            <span class="n">newx_left_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
            <span class="n">newx_right_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">elif</span> <span class="n">nx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># keep track of the original input x values</span>
        <span class="n">original_x_without_unit</span> <span class="o">=</span> <span class="n">x_without_unit</span>

        <span class="c1"># redefine the input x to indices, to do interpolation in index space</span>
        <span class="n">x_without_unit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">x_without_unit</span><span class="p">))</span>

        <span class="c1"># define a grid of edges that will enclose the right number of indices</span>
        <span class="n">x_left_i</span><span class="p">,</span> <span class="n">x_right_i</span> <span class="o">=</span> <span class="n">calculate_bin_leftright</span><span class="p">(</span><span class="n">x_without_unit</span><span class="p">)</span>
        <span class="n">newx_edges_without_unit</span> <span class="o">=</span> <span class="n">leftright_to_edges</span><span class="p">(</span><span class="n">x_left_i</span><span class="p">,</span> <span class="n">x_right_i</span><span class="p">)[::</span><span class="n">nx</span><span class="p">]</span>
        <span class="n">newx_without_unit</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span>
            <span class="n">newx_edges_without_unit</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">+</span> <span class="n">newx_edges_without_unit</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="p">)</span>

        <span class="c1"># calculate the actual x values corresponding to the bins</span>
        <span class="n">original_edges</span> <span class="o">=</span> <span class="n">leftright_to_edges</span><span class="p">(</span>
            <span class="o">*</span><span class="n">calculate_bin_leftright</span><span class="p">(</span><span class="n">original_x_without_unit</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">final_edges</span> <span class="o">=</span> <span class="n">original_edges</span><span class="p">[::</span><span class="n">nx</span><span class="p">]</span> <span class="o">*</span> <span class="n">x_unit</span>
        <span class="n">final_newx_left</span><span class="p">,</span> <span class="n">final_newx_right</span> <span class="o">=</span> <span class="n">edges_to_leftright</span><span class="p">(</span><span class="n">final_edges</span><span class="p">)</span>
        <span class="n">final_newx</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">final_newx_left</span> <span class="o">+</span> <span class="n">final_newx_right</span><span class="p">)</span>
        <span class="n">dx_without_unit</span> <span class="o">=</span> <span class="p">(</span><span class="n">final_newx_right</span> <span class="o">-</span> <span class="n">final_newx_left</span><span class="p">)</span> <span class="o">/</span> <span class="n">x_unit</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;No output grid sent to `bintogrid`.</span>
<span class="sd">                              Please choose one of the following:</span>
<span class="sd">                              [`newx_edges`, `newx`, `dx`, `nx`]&quot;&quot;&quot;</span>
        <span class="p">)</span>

    <span class="c1"># don&#39;t complain about zero-divisions in here (to allow infinite uncertainties)</span>
    <span class="k">with</span> <span class="n">np</span><span class="o">.</span><span class="n">errstate</span><span class="p">(</span><span class="n">divide</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">invalid</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">):</span>

        <span class="c1"># calculate weight integrals for the bin array</span>
        <span class="n">ok</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">y_without_unit</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span>

        <span class="c1"># resample the sums onto that new grid</span>
        <span class="k">if</span> <span class="n">unc</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">x_without_unit</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">weighting</span> <span class="o">==</span> <span class="s2">&quot;inversevariance&quot;</span><span class="p">:</span>
                <span class="n">weights</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">unc</span><span class="o">**</span><span class="mi">2</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">x_without_unit</span><span class="p">)</span>

            <span class="c1"># ignore infinite weights (= 0 uncertainties)</span>
            <span class="n">ok</span> <span class="o">*=</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">ok</span><span class="p">):</span>
            <span class="n">numerator</span> <span class="o">=</span> <span class="n">resample_while_conserving_flux</span><span class="p">(</span>
                <span class="n">xin</span><span class="o">=</span><span class="n">x_without_unit</span><span class="p">[</span><span class="n">ok</span><span class="p">],</span>
                <span class="n">yin</span><span class="o">=</span><span class="p">(</span><span class="n">y_without_unit</span> <span class="o">*</span> <span class="n">weights</span><span class="p">)[</span><span class="n">ok</span><span class="p">],</span>
                <span class="n">xout_edges</span><span class="o">=</span><span class="n">newx_edges_without_unit</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">denominator</span> <span class="o">=</span> <span class="n">resample_while_conserving_flux</span><span class="p">(</span>
                <span class="n">xin</span><span class="o">=</span><span class="n">x_without_unit</span><span class="p">[</span><span class="n">ok</span><span class="p">],</span>
                <span class="n">yin</span><span class="o">=</span><span class="n">weights</span><span class="p">[</span><span class="n">ok</span><span class="p">],</span>
                <span class="n">xout_edges</span><span class="o">=</span><span class="n">newx_edges_without_unit</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="c1"># the binned weighted means on the new grid</span>
            <span class="n">newy</span> <span class="o">=</span> <span class="n">numerator</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">denominator</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span>

            <span class="c1"># the standard error on the means, for those bins</span>
            <span class="n">newunc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">denominator</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">])</span>

            <span class="c1"># keep track of the number of original bins going into each new bin</span>
            <span class="n">number_of_original_bins_per_new_bin</span> <span class="o">=</span> <span class="n">resample_while_conserving_flux</span><span class="p">(</span>
                <span class="n">xin</span><span class="o">=</span><span class="n">x_without_unit</span><span class="p">[</span><span class="n">ok</span><span class="p">],</span>
                <span class="n">yin</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">y_without_unit</span><span class="p">)[</span><span class="n">ok</span><span class="p">],</span>
                <span class="n">xout_edges</span><span class="o">=</span><span class="n">newx_edges_without_unit</span><span class="p">,</span>
            <span class="p">)[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">newy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="o">*</span> <span class="n">newx_without_unit</span>
            <span class="n">newunc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="o">*</span> <span class="n">newx_without_unit</span>
            <span class="n">number_of_original_bins_per_new_bin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">newx_without_unit</span><span class="p">)</span>

    <span class="c1"># remove any empty bins</span>
    <span class="k">if</span> <span class="n">drop_nans</span><span class="p">:</span>
        <span class="n">ok</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">newy</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ok</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">newx_without_unit</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>

    <span class="c1"># if no uncertainties were given, don&#39;t return uncertainties</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># populate the new grid centers + edges + values</span>
    <span class="n">result</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">final_newx</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span>
    <span class="n">result</span><span class="p">[</span><span class="s2">&quot;x_edge_lower&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">final_newx_left</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span>
    <span class="n">result</span><span class="p">[</span><span class="s2">&quot;x_edge_upper&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">final_newx_right</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span>

    <span class="c1"># populate the new grid values</span>
    <span class="n">result</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">newy</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span> <span class="o">*</span> <span class="n">y_unit</span>

    <span class="c1"># populate the new grid value uncertainties</span>
    <span class="k">if</span> <span class="n">unc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">result</span><span class="p">[</span><span class="s2">&quot;uncertainty&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">newunc</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span> <span class="o">*</span> <span class="n">y_unit</span>

    <span class="c1"># store how many of the original pixels made it into this new one</span>
    <span class="n">result</span><span class="p">[</span><span class="s2">&quot;N_unbinned/N_binned&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">number_of_original_bins_per_new_bin</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">visualize</span><span class="p">:</span>
        <span class="n">fi</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span>
            <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">gridspec_kw</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">height_ratios</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">])</span>
        <span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">plot_as_boxes</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">xleft</span><span class="o">=</span><span class="n">x_left</span><span class="p">,</span> <span class="n">xright</span><span class="o">=</span><span class="n">x_right</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;silver&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">ekw</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">elinewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">unc</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;silver&quot;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">ekw</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">],</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">],</span>
            <span class="n">yerr</span><span class="o">=</span><span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;uncertainty&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
            <span class="n">xerr</span><span class="o">=</span><span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s2">&quot;x_edge_upper&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;x_edge_lower&quot;</span><span class="p">])</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
            <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
            <span class="n">zorder</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
            <span class="o">**</span><span class="n">ekw</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">plot_as_boxes</span><span class="p">(</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">],</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;N_unbinned/N_binned&quot;</span><span class="p">],</span>
            <span class="n">xleft</span><span class="o">=</span><span class="n">result</span><span class="p">[</span><span class="s2">&quot;x_edge_lower&quot;</span><span class="p">],</span>
            <span class="n">xright</span><span class="o">=</span><span class="n">result</span><span class="p">[</span><span class="s2">&quot;x_edge_upper&quot;</span><span class="p">],</span>
        <span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;$N_</span><span class="si">{unbinned}</span><span class="s2">/N_</span><span class="si">{binned}</span><span class="s2">$&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.visualizations.interactive.calculate_bin_leftright" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">calculate_bin_leftright</span><span class="p">(</span><span class="n">x</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.visualizations.interactive.calculate_bin_leftright" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>If x is an array of bin centers, calculate the bin edges.
(assumes outermost bins are same size as their neighbors)</p>
<h4 id="chromatic.rainbows.visualizations.interactive.calculate_bin_leftright--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.visualizations.interactive.calculate_bin_leftright--parameters" title="Permanent link">#</a></h4>
<p>x : array
    The array of bin centers.</p>
<h4 id="chromatic.rainbows.visualizations.interactive.calculate_bin_leftright--returns">Returns<a class="headerlink" href="#chromatic.rainbows.visualizations.interactive.calculate_bin_leftright--returns" title="Permanent link">#</a></h4>
<p>l : array
    The left edges of the bins.
r : array
    The right edges of the bins.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/tools/resampling.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">calculate_bin_leftright</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    If x is an array of bin centers, calculate the bin edges.</span>
<span class="sd">    (assumes outermost bins are same size as their neighbors)</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : array</span>
<span class="sd">        The array of bin centers.</span>

<span class="sd">    Returns</span>
<span class="sd">    ----------</span>
<span class="sd">    l : array</span>
<span class="sd">        The left edges of the bins.</span>
<span class="sd">    r : array</span>
<span class="sd">        The right edges of the bins.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># what are bin edges (making a guess for those on the ends)</span>
    <span class="c1"># xbinsize = calculate_bin_widths(x)</span>
    <span class="c1"># left = x - xbinsize / 2.0</span>
    <span class="c1"># right = x + xbinsize / 2.0</span>

    <span class="c1"># weird corner case!</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">left</span><span class="p">,</span> <span class="n">right</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">left</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">right</span><span class="p">])</span>

    <span class="n">inner_edges</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="n">x</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">first_edge</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="n">inner_edges</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">last_edge</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">inner_edges</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

    <span class="n">left</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">first_edge</span><span class="p">,</span> <span class="n">inner_edges</span><span class="p">])</span>
    <span class="n">right</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">inner_edges</span><span class="p">,</span> <span class="n">last_edge</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.visualizations.interactive.edges_to_leftright" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">edges_to_leftright</span><span class="p">(</span><span class="n">edges</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.visualizations.interactive.edges_to_leftright" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Convert N+1 contiguous edges to two arrays of N left/right edges.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/tools/resampling.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">edges_to_leftright</span><span class="p">(</span><span class="n">edges</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert N+1 contiguous edges to two arrays of N left/right edges.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">left</span><span class="p">,</span> <span class="n">right</span> <span class="o">=</span> <span class="n">edges</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">edges</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="k">return</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.visualizations.interactive.expand_filenames" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">expand_filenames</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.visualizations.interactive.expand_filenames" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>A wrapper to expand a string or list into a list of filenames.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/imports.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">expand_filenames</span><span class="p">(</span><span class="n">filepath</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A wrapper to expand a string or list into a list of filenames.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
        <span class="n">filenames</span> <span class="o">=</span> <span class="n">filepath</span>
    <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span> <span class="o">==</span> <span class="n">Column</span><span class="p">:</span>
        <span class="n">filenames</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>
    <span class="k">elif</span> <span class="s2">&quot;*&quot;</span> <span class="ow">in</span> <span class="n">filepath</span><span class="p">:</span>
        <span class="n">filenames</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">filepath</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">filenames</span> <span class="o">=</span> <span class="p">[</span><span class="n">filepath</span><span class="p">]</span>
    <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">filenames</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.visualizations.interactive.imshow_interact" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">imshow_interact</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">quantity</span><span class="o">=</span><span class="s1">&#39;Flux&#39;</span><span class="p">,</span> <span class="n">t_unit</span><span class="o">=</span><span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="n">w_unit</span><span class="o">=</span><span class="s1">&#39;micron&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="p">[],</span> <span class="n">ylim</span><span class="o">=</span><span class="p">[],</span> <span class="n">ylog</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xbuffer</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">ybuffer</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.visualizations.interactive.imshow_interact" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Display interactive spectrum plot for chromatic Rainbow with a
wavelength-averaged 2D quantity defined by the user. The user
can interact with the 3D spectrum to choose the wavelength range
over which the average is calculated.</p>
<h4 id="chromatic.rainbows.visualizations.interactive.imshow_interact--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.visualizations.interactive.imshow_interact--parameters" title="Permanent link">#</a></h4>
<p>self : Rainbow object
    chromatic Rainbow object to plot
quantity : str
    (optional, default='flux')
    The quantity to imshow, currently either <code>flux</code> or <code>uncertainty</code>
ylog : boolean
    (optional, default=None)
    Boolean for whether to take log10 of the y-axis data.
    If None, will be guessed from the data.
t_unit : str
    (optional, default='d')
    The time unit to use (seconds, minutes, hours, days etc.)
w_unit : str
    (optional, default='micron')
    The wavelength unit to use
cmap : str
    (optional, default='viridis')
    The color scheme to use from Vega documentation
ylim : list
    (optional, default=[])
    If the user wants to define their own ylimits on the lightcurve plot
xlim : list
    (optional, default=[])
    If the user wants to define their own xlimits on the lightcurve plot
xbuffer : float
    (optional, default=0.01)
    X-axis (time) buffer for plotting, xlims=[min(x)-xbuffer, max(x)+xbuffer]
ybuffer : float
    (optional, default=0.01)
    Y-axis (quantity) buffer for plotting, ylims=[min(y)-ybuffer, max(y)+ybuffer]</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/rainbows/visualizations/interactive.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">imshow_interact</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">quantity</span><span class="o">=</span><span class="s2">&quot;Flux&quot;</span><span class="p">,</span>
    <span class="n">t_unit</span><span class="o">=</span><span class="s2">&quot;d&quot;</span><span class="p">,</span>
    <span class="n">w_unit</span><span class="o">=</span><span class="s2">&quot;micron&quot;</span><span class="p">,</span>
    <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;viridis&quot;</span><span class="p">,</span>
    <span class="n">xlim</span><span class="o">=</span><span class="p">[],</span>
    <span class="n">ylim</span><span class="o">=</span><span class="p">[],</span>
    <span class="n">ylog</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">xbuffer</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>
    <span class="n">ybuffer</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>
    <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Display interactive spectrum plot for chromatic Rainbow with a</span>
<span class="sd">    wavelength-averaged 2D quantity defined by the user. The user</span>
<span class="sd">    can interact with the 3D spectrum to choose the wavelength range</span>
<span class="sd">    over which the average is calculated.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    self : Rainbow object</span>
<span class="sd">        chromatic Rainbow object to plot</span>
<span class="sd">    quantity : str</span>
<span class="sd">        (optional, default=&#39;flux&#39;)</span>
<span class="sd">        The quantity to imshow, currently either `flux` or `uncertainty`</span>
<span class="sd">    ylog : boolean</span>
<span class="sd">        (optional, default=None)</span>
<span class="sd">        Boolean for whether to take log10 of the y-axis data.</span>
<span class="sd">        If None, will be guessed from the data.</span>
<span class="sd">    t_unit : str</span>
<span class="sd">        (optional, default=&#39;d&#39;)</span>
<span class="sd">        The time unit to use (seconds, minutes, hours, days etc.)</span>
<span class="sd">    w_unit : str</span>
<span class="sd">        (optional, default=&#39;micron&#39;)</span>
<span class="sd">        The wavelength unit to use</span>
<span class="sd">    cmap : str</span>
<span class="sd">        (optional, default=&#39;viridis&#39;)</span>
<span class="sd">        The color scheme to use from Vega documentation</span>
<span class="sd">    ylim : list</span>
<span class="sd">        (optional, default=[])</span>
<span class="sd">        If the user wants to define their own ylimits on the lightcurve plot</span>
<span class="sd">    xlim : list</span>
<span class="sd">        (optional, default=[])</span>
<span class="sd">        If the user wants to define their own xlimits on the lightcurve plot</span>
<span class="sd">    xbuffer : float</span>
<span class="sd">        (optional, default=0.01)</span>
<span class="sd">        X-axis (time) buffer for plotting, xlims=[min(x)-xbuffer, max(x)+xbuffer]</span>
<span class="sd">    ybuffer : float</span>
<span class="sd">        (optional, default=0.01)</span>
<span class="sd">        Y-axis (quantity) buffer for plotting, ylims=[min(y)-ybuffer, max(y)+ybuffer]</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># preset the x and y axes as Time (in units defined by the user) and Wavelength</span>
    <span class="n">xlabel</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Time (</span><span class="si">{</span><span class="n">t_unit</span><span class="si">}</span><span class="s2">)&quot;</span>
    <span class="n">ylabel</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Wavelength (</span><span class="si">{</span><span class="n">w_unit</span><span class="si">}</span><span class="s2">)&quot;</span>

    <span class="c1"># allow the user to plot flux or uncertainty</span>
    <span class="k">if</span> <span class="n">quantity</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;flux&quot;</span><span class="p">:</span>
        <span class="n">z</span> <span class="o">=</span> <span class="s2">&quot;Flux&quot;</span>
    <span class="k">elif</span> <span class="n">quantity</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;uncertainty&quot;</span><span class="p">:</span>
        <span class="n">z</span> <span class="o">=</span> <span class="s2">&quot;Flux Uncertainty&quot;</span>
    <span class="k">elif</span> <span class="n">quantity</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;error&quot;</span><span class="p">:</span>
        <span class="n">z</span> <span class="o">=</span> <span class="s2">&quot;Flux Uncertainty&quot;</span>
    <span class="k">elif</span> <span class="n">quantity</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;flux_error&quot;</span><span class="p">:</span>
        <span class="n">z</span> <span class="o">=</span> <span class="s2">&quot;Flux Uncertainty&quot;</span>
    <span class="k">elif</span> <span class="n">quantity</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;flux_uncertainty&quot;</span><span class="p">:</span>
        <span class="n">z</span> <span class="o">=</span> <span class="s2">&quot;Flux Uncertainty&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># if the quantity is not one of the predefined values:</span>
        <span class="n">cheerfully_suggest</span><span class="p">(</span><span class="s2">&quot;Unrecognised Quantity!&quot;</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="c1"># convert rainbow object to pandas dataframe</span>
    <span class="n">source</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_df</span><span class="p">(</span><span class="n">t_unit</span><span class="o">=</span><span class="n">t_unit</span><span class="p">,</span> <span class="n">w_unit</span><span class="o">=</span><span class="n">w_unit</span><span class="p">)[[</span><span class="n">xlabel</span><span class="p">,</span> <span class="n">ylabel</span><span class="p">,</span> <span class="n">z</span><span class="p">]]</span>
    <span class="c1"># source[xlabel] = source[xlabel] - source[xlabel][0]</span>

    <span class="c1"># if there are &gt;10,000 data points Altair will be very laggy/slow. This is probably unbinned, therefore</span>
    <span class="c1"># encourage the user to bin the Rainbow before calling this function in future/</span>
    <span class="n">N_warning</span> <span class="o">=</span> <span class="mi">100000</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">source</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">N_warning</span><span class="p">:</span>
        <span class="n">cheerfully_suggest</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        The dataset </span><span class="si">{</span><span class="bp">self</span><span class="si">}</span><span class="s2"> has &gt;</span><span class="si">{</span><span class="n">N_warning</span><span class="si">}</span><span class="s2"> data points.</span>
<span class="s2">        The interactive plot may lag. Try binning first!</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_is_probably_normalized</span><span class="p">()</span> <span class="o">==</span> <span class="kc">False</span><span class="p">)</span> <span class="ow">and</span> <span class="s2">&quot;model&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fluxlike</span><span class="p">:</span>
        <span class="n">cheerfully_suggest</span><span class="p">(</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        It looks like you might be trying to use `imshow_interact` with an</span>
<span class="sd">        unnormalized Rainbow object. You might consider normalizing first</span>
<span class="sd">        with `rainbow.normalize().imshow_interact()`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="p">)</span>

    <span class="c1"># The unbinned Rainbow is sometimes in log scale, therefore plotting will be ugly with uniform axis spacing</span>
    <span class="c1"># ylog tells the function to take the log10 of the y-axis data</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">ylog</span> <span class="o">=</span> <span class="n">ylog</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wscale</span> <span class="o">==</span> <span class="s2">&quot;log&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="n">ylog</span> <span class="o">=</span> <span class="n">ylog</span> <span class="ow">or</span> <span class="kc">False</span>

    <span class="c1"># print([np.min(source[xlabel]), np.max(source[xlabel])])</span>

    <span class="k">if</span> <span class="n">ylog</span><span class="p">:</span>
        <span class="n">source</span><span class="p">[</span><span class="n">ylabel</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">source</span><span class="p">[</span><span class="n">ylabel</span><span class="p">])</span>
        <span class="n">source</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="n">ylabel</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;log10(</span><span class="si">{</span><span class="n">ylabel</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">})</span>
        <span class="n">ylabel</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;log10(</span><span class="si">{</span><span class="n">ylabel</span><span class="si">}</span><span class="s2">)&quot;</span>

    <span class="n">wave</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wavelike</span><span class="p">[</span><span class="s2">&quot;wavelength&quot;</span><span class="p">]</span>
    <span class="n">time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timelike</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ylim</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">domainy</span> <span class="o">=</span> <span class="n">ylim</span>
        <span class="n">ywidth</span> <span class="o">=</span> <span class="mi">230</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">wave</span><span class="p">[(</span><span class="n">wave</span><span class="o">.</span><span class="n">value</span> <span class="o">&gt;=</span> <span class="n">ylim</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">wave</span><span class="o">.</span><span class="n">value</span> <span class="o">&lt;=</span> <span class="n">ylim</span><span class="p">[</span><span class="mi">1</span><span class="p">])])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">domainy</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">source</span><span class="p">[</span><span class="n">z</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="n">ybuffer</span><span class="p">,</span>
            <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">source</span><span class="p">[</span><span class="n">z</span><span class="p">],</span> <span class="mi">98</span><span class="p">)</span> <span class="o">+</span> <span class="n">ybuffer</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="n">ywidth</span> <span class="o">=</span> <span class="mi">230</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">wave</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">xlim</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">domainx</span> <span class="o">=</span> <span class="n">xlim</span>
        <span class="n">xwidth</span> <span class="o">=</span> <span class="mi">230</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">time</span><span class="p">[(</span><span class="n">time</span><span class="o">.</span><span class="n">value</span> <span class="o">&gt;=</span> <span class="n">xlim</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">value</span> <span class="o">&lt;=</span> <span class="n">xlim</span><span class="p">[</span><span class="mi">1</span><span class="p">])])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">domainx</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">source</span><span class="p">[</span><span class="n">xlabel</span><span class="p">])</span> <span class="o">-</span> <span class="n">xbuffer</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">source</span><span class="p">[</span><span class="n">xlabel</span><span class="p">])</span> <span class="o">+</span> <span class="n">xbuffer</span><span class="p">]</span>
        <span class="n">xwidth</span> <span class="o">=</span> <span class="mi">280</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">time</span><span class="p">)</span>

    <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>

        <span class="c1"># Add interactive part</span>
        <span class="n">brush</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">selection</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s2">&quot;interval&quot;</span><span class="p">,</span> <span class="n">encodings</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">])</span>

        <span class="c1"># Define the 3D spectrum plot</span>
        <span class="n">spectrum</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">280</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">230</span><span class="p">)</span>
            <span class="o">.</span><span class="n">mark_rect</span><span class="p">(</span>
                <span class="n">clip</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">width</span><span class="o">=</span><span class="n">xwidth</span><span class="p">,</span>
                <span class="n">height</span><span class="o">=</span><span class="n">ywidth</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="o">.</span><span class="n">encode</span><span class="p">(</span>
                <span class="n">x</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">X</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">xlabel</span><span class="si">}</span><span class="s2">:Q&quot;</span><span class="p">,</span>
                    <span class="n">scale</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Scale</span><span class="p">(</span><span class="n">zero</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">nice</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">domainx</span><span class="p">),</span>
                <span class="p">),</span>
                <span class="n">y</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ylabel</span><span class="si">}</span><span class="s2">:Q&quot;</span><span class="p">,</span>
                    <span class="n">scale</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Scale</span><span class="p">(</span>
                        <span class="n">zero</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                        <span class="n">nice</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                        <span class="n">domain</span><span class="o">=</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">source</span><span class="p">[</span><span class="n">ylabel</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">source</span><span class="p">[</span><span class="n">ylabel</span><span class="p">])],</span>
                    <span class="p">),</span>
                <span class="p">),</span>
                <span class="n">fill</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Color</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">z</span><span class="si">}</span><span class="s2">:Q&quot;</span><span class="p">,</span>
                    <span class="n">scale</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Scale</span><span class="p">(</span>
                        <span class="n">scheme</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span>
                        <span class="n">zero</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                        <span class="n">domain</span><span class="o">=</span><span class="n">domainy</span><span class="p">,</span>
                    <span class="p">),</span>
                <span class="p">),</span>
                <span class="n">tooltip</span><span class="o">=</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">xlabel</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ylabel</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">z</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">],</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="c1"># gray out the background with selection</span>
        <span class="n">background</span> <span class="o">=</span> <span class="n">spectrum</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="s2">&quot;#ddd&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">add_selection</span><span class="p">(</span><span class="n">brush</span><span class="p">)</span>

        <span class="c1"># highlights on the transformed data</span>
        <span class="n">highlight</span> <span class="o">=</span> <span class="n">spectrum</span><span class="o">.</span><span class="n">transform_filter</span><span class="p">(</span><span class="n">brush</span><span class="p">)</span>

        <span class="c1"># Layer the various plotting parts</span>
        <span class="n">spectrum_int</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">layer</span><span class="p">(</span><span class="n">background</span><span class="p">,</span> <span class="n">highlight</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">source</span><span class="p">)</span>

        <span class="c1"># axis=alt.Axis(title=f&quot;{xlabel} - First Obs&quot;),</span>
        <span class="c1"># Add the 2D averaged lightcurve (or uncertainty)</span>
        <span class="n">lightcurve</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span>
                <span class="n">source</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">280</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">230</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Mean </span><span class="si">{</span><span class="n">z</span><span class="si">}</span><span class="s2"> for Wavelength Range&quot;</span>
            <span class="p">)</span>
            <span class="o">.</span><span class="n">mark_point</span><span class="p">(</span><span class="n">filled</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">clip</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">)</span>
            <span class="o">.</span><span class="n">encode</span><span class="p">(</span>
                <span class="n">x</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">X</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">xlabel</span><span class="si">}</span><span class="s2">:Q&quot;</span><span class="p">,</span>
                    <span class="n">scale</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Scale</span><span class="p">(</span>
                        <span class="n">zero</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                        <span class="n">nice</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                        <span class="n">domain</span><span class="o">=</span><span class="n">domainx</span><span class="p">,</span>
                    <span class="p">),</span>
                <span class="p">),</span>
                <span class="n">y</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;mean(</span><span class="si">{</span><span class="n">z</span><span class="si">}</span><span class="s2">):Q&quot;</span><span class="p">,</span>
                    <span class="n">scale</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Scale</span><span class="p">(</span><span class="n">zero</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">domainy</span><span class="p">),</span>
                    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Mean &quot;</span> <span class="o">+</span> <span class="n">z</span><span class="p">,</span>
                <span class="p">),</span>
            <span class="p">)</span>
            <span class="o">.</span><span class="n">transform_filter</span><span class="p">(</span><span class="n">brush</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="c1"># display the interactive Altair plot</span>
        <span class="p">(</span><span class="n">spectrum_int</span> <span class="o">|</span> <span class="n">lightcurve</span><span class="p">)</span><span class="o">.</span><span class="n">display</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="p">(</span><span class="n">spectrum_int</span> <span class="o">|</span> <span class="n">lightcurve</span><span class="p">)</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_label_plot_file</span><span class="p">(</span><span class="n">filename</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.visualizations.interactive.leftright_to_edges" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">leftright_to_edges</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.visualizations.interactive.leftright_to_edges" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Convert two arrays of N left/right edges to N+1 continugous edges.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/tools/resampling.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">leftright_to_edges</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert two arrays of N left/right edges to N+1 continugous edges.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">edges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>
    <span class="k">return</span> <span class="n">edges</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.visualizations.interactive.name2color" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">name2color</span><span class="p">(</span><span class="n">name</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.visualizations.interactive.name2color" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Return the 3-element RGB array of a given color name.</p>
<h4 id="chromatic.rainbows.visualizations.interactive.name2color--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.visualizations.interactive.name2color--parameters" title="Permanent link">#</a></h4>
<p>name : str
    The name of a color</p>
<h4 id="chromatic.rainbows.visualizations.interactive.name2color--returns">Returns<a class="headerlink" href="#chromatic.rainbows.visualizations.interactive.name2color--returns" title="Permanent link">#</a></h4>
<p>rgb : tuple
    3-element RGB color, with numbers from 0.0 to 1.0</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/imports.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">name2color</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return the 3-element RGB array of a given color name.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    name : str</span>
<span class="sd">        The name of a color</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    rgb : tuple</span>
<span class="sd">        3-element RGB color, with numbers from 0.0 to 1.0</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># give a friendly warning if the color name can&#39;t be found</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">color_hex</span> <span class="o">=</span> <span class="n">col</span><span class="o">.</span><span class="n">cnames</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">col</span><span class="o">.</span><span class="n">hex2color</span><span class="p">(</span><span class="n">color_hex</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="n">cheerfully_suggest</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The color </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> can&#39;t be found. (Returning black.)&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.visualizations.interactive.one2another" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">one2another</span><span class="p">(</span><span class="n">bottom</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">alpha_bottom</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">alpha_top</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">256</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.visualizations.interactive.one2another" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Create a cmap that goes smoothly (linearly in RGBA) from "bottom" to "top".</p>
<h4 id="chromatic.rainbows.visualizations.interactive.one2another--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.visualizations.interactive.one2another--parameters" title="Permanent link">#</a></h4>
<p>bottom : str
    Name of a color for the bottom of cmap (0.0)
top : str
    Name of a color for the top of the cmap (1.0)
alpha_bottom : float
    Opacity at the bottom of the cmap
alpha_top : float
    Opacitiy at the top of the cmap
N : int
    The number of levels in the listed color map</p>
<h4 id="chromatic.rainbows.visualizations.interactive.one2another--returns">Returns<a class="headerlink" href="#chromatic.rainbows.visualizations.interactive.one2another--returns" title="Permanent link">#</a></h4>
<p>cmap : Colormap
    A color map that goes linearly from the
    bottom to top color (and alpha).</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/imports.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">one2another</span><span class="p">(</span><span class="n">bottom</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">alpha_bottom</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">alpha_top</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">256</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a cmap that goes smoothly (linearly in RGBA) from &quot;bottom&quot; to &quot;top&quot;.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    bottom : str</span>
<span class="sd">        Name of a color for the bottom of cmap (0.0)</span>
<span class="sd">    top : str</span>
<span class="sd">        Name of a color for the top of the cmap (1.0)</span>
<span class="sd">    alpha_bottom : float</span>
<span class="sd">        Opacity at the bottom of the cmap</span>
<span class="sd">    alpha_top : float</span>
<span class="sd">        Opacitiy at the top of the cmap</span>
<span class="sd">    N : int</span>
<span class="sd">        The number of levels in the listed color map</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    cmap : Colormap</span>
<span class="sd">        A color map that goes linearly from the</span>
<span class="sd">        bottom to top color (and alpha).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># get the RGB values of the bottom and top of the cmap</span>
    <span class="n">rgb_bottom</span><span class="p">,</span> <span class="n">rgb_top</span> <span class="o">=</span> <span class="n">name2color</span><span class="p">(</span><span class="n">bottom</span><span class="p">),</span> <span class="n">name2color</span><span class="p">(</span><span class="n">top</span><span class="p">)</span>

    <span class="c1"># create linear gradients for all four RGBA channels</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">rgb_bottom</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">rgb_top</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">N</span><span class="p">)</span>
    <span class="n">g</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">rgb_bottom</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">rgb_top</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">N</span><span class="p">)</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">rgb_bottom</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">rgb_top</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">N</span><span class="p">)</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">alpha_bottom</span><span class="p">,</span> <span class="n">alpha_top</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>

    <span class="c1"># create (N,4) array + populate a listed colormap</span>
    <span class="n">colors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">]))</span>
    <span class="n">cmap</span> <span class="o">=</span> <span class="n">col</span><span class="o">.</span><span class="n">ListedColormap</span><span class="p">(</span><span class="n">colors</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{bottom}</span><span class="s2">2</span><span class="si">{top}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="nb">locals</span><span class="p">()))</span>

    <span class="c1"># return the colormap</span>
    <span class="k">return</span> <span class="n">cmap</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.visualizations.interactive.remove_unit" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">remove_unit</span><span class="p">(</span><span class="n">x</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.visualizations.interactive.remove_unit" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Quick wrapper to remove the unit from a quantity,
but not complain if it doesn't have one.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/imports.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">remove_unit</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Quick wrapper to remove the unit from a quantity,</span>
<span class="sd">    but not complain if it doesn&#39;t have one.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">x</span><span class="o">.</span><span class="n">value</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">x</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.rainbows.visualizations.interactive.resample_while_conserving_flux" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">resample_while_conserving_flux</span><span class="p">(</span><span class="n">xin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">yin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xout</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xin_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xout_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">replace_nans</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">visualize</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">pause</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#chromatic.rainbows.visualizations.interactive.resample_while_conserving_flux" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Starting from some initial x and y, resample onto a
different grid (either higher or lower resolution),
while conserving total flux.</p>
<p>When including the entire range of <code>xin</code>,
<code>sum(yout) == sum(yin)</code> should be true.</p>
<p>When including only part of the range of <code>xin</code>,
the integral between any two points should be conserved.</p>
<h4 id="chromatic.rainbows.visualizations.interactive.resample_while_conserving_flux--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.visualizations.interactive.resample_while_conserving_flux--parameters" title="Permanent link">#</a></h4>
<p>xin : array
    The original independent variable.
yin : array
    The original dependent variable (same size as x).
xout : array
    The new grid of independent variables onto which
    you want to resample the y values. Refers to the
    center of each bin (use <code>xout_edges</code> for finer
    control over the exact edges of the bins)
xin_edges : array
    The edges of the original independent variable bins.
    The left and right edges of the bins are interpreted
    to be <code>xin_edges[:-1]</code> and <code>xin_edges[1:]</code>,
    respectively, so the associated <code>yin</code> should have exactly
    1 fewer element than <code>xin_edges</code>. This provides finer
    control over the size of each bin in the input than
    simply supplying <code>xin</code>(still a little experimental)
    They should probably be sorted?
xout_edges : array
    The edges of the new grid of bins for the independent
    variable, onto which you want to resample the y
    values. The left and right edges of the bins will be,
    respectively, <code>xout_edges[:-1]</code> and <code>xout_edges[1:]</code>,
    so the size of the output array will be
    <code>len(xout_edges) - 1</code>
replace_nans : float, str
    Replace nan values with this value.
    <code>replace_nans = 0</code>
        will add no flux where nans are
    <code>replace_nans = nan</code>
        will ensure you get nans returned everywhere
        if you try to resample over any nan
    <code>replace_nans = 'interpolate'</code>
        will try to replace nans by linearly interpolating
        from nearby values (not yet implemented)
visualize : bool
    Should we make a plot showing whether it worked?
pause : bool
    Should we pause to wait for a key press?</p>
<h4 id="chromatic.rainbows.visualizations.interactive.resample_while_conserving_flux--returns">Returns<a class="headerlink" href="#chromatic.rainbows.visualizations.interactive.resample_while_conserving_flux--returns" title="Permanent link">#</a></h4>
<p>result : dict
    A dictionary containing...
        <code>x</code> = the center of the output grid
        <code>y</code> = the resampled value on the output grid
        <code>edges</code> = the edges of the output grid, which will
            have one more element than x or y</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/tools/resampling.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">resample_while_conserving_flux</span><span class="p">(</span>
    <span class="n">xin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">yin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">xout</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">xin_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">xout_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">replace_nans</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
    <span class="n">visualize</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">pause</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Starting from some initial x and y, resample onto a</span>
<span class="sd">    different grid (either higher or lower resolution),</span>
<span class="sd">    while conserving total flux.</span>

<span class="sd">    When including the entire range of `xin`,</span>
<span class="sd">    `sum(yout) == sum(yin)` should be true.</span>

<span class="sd">    When including only part of the range of `xin`,</span>
<span class="sd">    the integral between any two points should be conserved.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    xin : array</span>
<span class="sd">        The original independent variable.</span>
<span class="sd">    yin : array</span>
<span class="sd">        The original dependent variable (same size as x).</span>
<span class="sd">    xout : array</span>
<span class="sd">        The new grid of independent variables onto which</span>
<span class="sd">        you want to resample the y values. Refers to the</span>
<span class="sd">        center of each bin (use `xout_edges` for finer</span>
<span class="sd">        control over the exact edges of the bins)</span>
<span class="sd">    xin_edges : array</span>
<span class="sd">        The edges of the original independent variable bins.</span>
<span class="sd">        The left and right edges of the bins are interpreted</span>
<span class="sd">        to be `xin_edges[:-1]` and `xin_edges[1:]`,</span>
<span class="sd">        respectively, so the associated `yin` should have exactly</span>
<span class="sd">        1 fewer element than `xin_edges`. This provides finer</span>
<span class="sd">        control over the size of each bin in the input than</span>
<span class="sd">        simply supplying `xin`(still a little experimental)</span>
<span class="sd">        They should probably be sorted?</span>
<span class="sd">    xout_edges : array</span>
<span class="sd">        The edges of the new grid of bins for the independent</span>
<span class="sd">        variable, onto which you want to resample the y</span>
<span class="sd">        values. The left and right edges of the bins will be,</span>
<span class="sd">        respectively, `xout_edges[:-1]` and `xout_edges[1:]`,</span>
<span class="sd">        so the size of the output array will be</span>
<span class="sd">        `len(xout_edges) - 1`</span>
<span class="sd">    replace_nans : float, str</span>
<span class="sd">        Replace nan values with this value.</span>
<span class="sd">        `replace_nans = 0`</span>
<span class="sd">            will add no flux where nans are</span>
<span class="sd">        `replace_nans = nan`</span>
<span class="sd">            will ensure you get nans returned everywhere</span>
<span class="sd">            if you try to resample over any nan</span>
<span class="sd">        `replace_nans = &#39;interpolate&#39;`</span>
<span class="sd">            will try to replace nans by linearly interpolating</span>
<span class="sd">            from nearby values (not yet implemented)</span>
<span class="sd">    visualize : bool</span>
<span class="sd">        Should we make a plot showing whether it worked?</span>
<span class="sd">    pause : bool</span>
<span class="sd">        Should we pause to wait for a key press?</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    result : dict</span>
<span class="sd">        A dictionary containing...</span>
<span class="sd">            `x` = the center of the output grid</span>
<span class="sd">            `y` = the resampled value on the output grid</span>
<span class="sd">            `edges` = the edges of the output grid, which will</span>
<span class="sd">                have one more element than x or y</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># make sure there are some reasonable input options</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">xin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">xin_edges</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">yin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">xout</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">xout_edges</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>

    <span class="c1"># set up the bins, to calculate cumulative distribution of y</span>
    <span class="k">if</span> <span class="n">xin_edges</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># make sure the sizes match up</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">xin</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">yin</span><span class="p">)</span>
        <span class="c1"># sort to make sure x is strictly increasing</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">xin</span><span class="p">)</span>
        <span class="n">xin_sorted</span> <span class="o">=</span> <span class="n">xin</span><span class="p">[</span><span class="n">s</span><span class="p">]</span>
        <span class="n">yin_sorted</span> <span class="o">=</span> <span class="n">yin</span><span class="p">[</span><span class="n">s</span><span class="p">]</span>
        <span class="c1"># estimate some bin edges (might fail for non-uniform grids)</span>
        <span class="n">xin_left</span><span class="p">,</span> <span class="n">xin_right</span> <span class="o">=</span> <span class="n">calculate_bin_leftright</span><span class="p">(</span><span class="n">xin_sorted</span><span class="p">)</span>
        <span class="c1"># define an array of edges</span>
        <span class="n">xin_edges</span> <span class="o">=</span> <span class="n">leftright_to_edges</span><span class="p">(</span><span class="n">xin_left</span><span class="p">,</span> <span class="n">xin_right</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># make sure the sizes match up</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">xin_edges</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">yin</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="c1"># sort to make sure x is strictly increasing</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">xin_edges</span><span class="p">)</span>
        <span class="n">xin_left</span><span class="p">,</span> <span class="n">xin_right</span> <span class="o">=</span> <span class="n">edges_to_leftright</span><span class="p">(</span><span class="n">xin_edges</span><span class="p">[</span><span class="n">s</span><span class="p">])</span>
        <span class="n">xin_sorted</span> <span class="o">=</span> <span class="p">(</span><span class="n">xin_left</span> <span class="o">+</span> <span class="n">xin_right</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">yin_sorted</span> <span class="o">=</span> <span class="n">yin</span><span class="p">[</span><span class="n">s</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>

    <span class="c1"># the first element should be the left edge of the first pixel</span>
    <span class="c1"># last element will be right edge of last pixel</span>
    <span class="n">xin_for_cdf</span> <span class="o">=</span> <span class="n">xin_edges</span>

    <span class="c1"># to the left of the first pixel, assume flux is zero</span>
    <span class="n">yin_for_cdf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">yin_sorted</span><span class="p">])</span>

    <span class="c1"># correct for any non-finite values</span>
    <span class="n">bad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">yin_for_cdf</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">replace_nans</span> <span class="o">==</span> <span class="s2">&quot;interpolate&quot;</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
            <span class="s2">&quot;The `replace_nans=&#39;interpolate&#39;`` option doens&#39;t exist yet!&quot;</span>
        <span class="p">)</span>
    <span class="n">yin_for_cdf</span><span class="p">[</span><span class="n">bad</span><span class="p">]</span> <span class="o">=</span> <span class="n">replace_nans</span>

    <span class="c1"># calculate the CDF of the flux (at pixel edge locations)</span>
    <span class="n">cdfin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">yin_for_cdf</span><span class="p">)</span>

    <span class="c1"># create an interpolator for that CDF</span>
    <span class="n">cdfinterpolator</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span>
        <span class="n">xin_for_cdf</span><span class="p">,</span>
        <span class="n">cdfin</span><span class="p">,</span>
        <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span>
        <span class="n">bounds_error</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">fill_value</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">yin</span><span class="p">)),</span>
    <span class="p">)</span>

    <span class="c1"># calculate bin edges (of size len(xout)+1)</span>
    <span class="k">if</span> <span class="n">xout_edges</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">xout_left</span><span class="p">,</span> <span class="n">xout_right</span> <span class="o">=</span> <span class="n">calculate_bin_leftright</span><span class="p">(</span><span class="n">xout</span><span class="p">)</span>
        <span class="n">xout_edges</span> <span class="o">=</span> <span class="n">leftright_to_edges</span><span class="p">(</span><span class="n">xout_left</span><span class="p">,</span> <span class="n">xout_right</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">xout_left</span><span class="p">,</span> <span class="n">xout_right</span> <span class="o">=</span> <span class="n">edges_to_leftright</span><span class="p">(</span><span class="n">xout_edges</span><span class="p">)</span>
        <span class="n">xout</span> <span class="o">=</span> <span class="p">(</span><span class="n">xout_left</span> <span class="o">+</span> <span class="n">xout_right</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>

    <span class="n">xout_for_cdf</span> <span class="o">=</span> <span class="n">leftright_to_edges</span><span class="p">(</span><span class="n">xout_left</span><span class="p">,</span> <span class="n">xout_right</span><span class="p">)</span>

    <span class="c1"># interpolate the CDF onto those bin edges</span>
    <span class="n">cdfout</span> <span class="o">=</span> <span class="n">cdfinterpolator</span><span class="p">(</span><span class="n">xout_for_cdf</span><span class="p">)</span>

    <span class="c1"># take  derivative of the CDF to get flux per resampled bin</span>
    <span class="c1"># (xout is bin center, and yout is the flux in that bin)</span>
    <span class="n">yout</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">cdfout</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">visualize</span><span class="p">:</span>
        <span class="n">fi</span><span class="p">,</span> <span class="p">(</span><span class="n">ax_cdf</span><span class="p">,</span> <span class="n">ax_pdf</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
        <span class="n">inkw</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
            <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span>
            <span class="n">markeredgecolor</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">outkw</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;darkorange&quot;</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span>
            <span class="n">markersize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
            <span class="n">markeredgecolor</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">legkw</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper left&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">xinbinsize</span> <span class="o">=</span> <span class="n">xin_right</span> <span class="o">-</span> <span class="n">xin_left</span>
        <span class="n">xoutbinsize</span> <span class="o">=</span> <span class="n">xout_right</span> <span class="o">-</span> <span class="n">xout_left</span>
        <span class="c1"># plot the PDFs</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="n">ax_pdf</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Flux per (Original) Pixel&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Pixel&quot;</span><span class="p">)</span>
        <span class="c1"># plot the original pixels (in df/dpixel to compare with resampled)</span>
        <span class="n">plot_as_boxes</span><span class="p">(</span>
            <span class="n">xin_sorted</span><span class="p">,</span> <span class="n">yin_sorted</span> <span class="o">/</span> <span class="n">xinbinsize</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Original Pixels&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">inkw</span>
        <span class="p">)</span>

        <span class="c1"># what would a bad interpolation look like?</span>
        <span class="n">interpolate_badly</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span>
            <span class="n">xin_sorted</span><span class="p">,</span>
            <span class="n">yin_sorted</span> <span class="o">/</span> <span class="n">xinbinsize</span><span class="p">,</span>
            <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span>
            <span class="n">bounds_error</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">fill_value</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
            <span class="n">xout</span><span class="p">,</span>
            <span class="n">interpolate_badly</span><span class="p">(</span><span class="n">xout</span><span class="p">),</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;cornflowerblue&quot;</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span>
            <span class="n">markersize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
            <span class="n">markeredgecolor</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Silly Simple Interpolation&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># plot the flux-conserving resampled data (again, in df/d&quot;pixel&quot;)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
            <span class="n">xout</span><span class="p">,</span> <span class="n">yout</span> <span class="o">/</span> <span class="n">xoutbinsize</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Flux-Conserving Interpolation&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">outkw</span>
        <span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="o">**</span><span class="n">legkw</span><span class="p">)</span>

        <span class="c1"># plot the CDFs</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="n">ax_cdf</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Cumulative Flux (from left)&quot;</span><span class="p">)</span>

        <span class="c1"># plot the original CDF</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xin_for_cdf</span><span class="p">,</span> <span class="n">cdfin</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Original Pixels&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">inkw</span><span class="p">)</span>

        <span class="c1"># plot the interpolated CDF</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xout_for_cdf</span><span class="p">,</span> <span class="n">cdfout</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Flux-Conserved Resample&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">outkw</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">pause</span><span class="p">:</span>
            <span class="n">a</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span>
                <span class="s2">&quot;Pausing a moment to check on interpolation; press return to continue.&quot;</span>
            <span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{:&gt;6}</span><span class="s2"> = </span><span class="si">{:.5f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;Actual&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">yin</span><span class="p">)))</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="s2">&quot;</span><span class="si">{:&gt;6}</span><span class="s2"> = </span><span class="si">{:.5f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="s2">&quot;Silly&quot;</span><span class="p">,</span>
                <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">interpolate_badly</span><span class="p">(</span><span class="n">xout</span><span class="p">)</span> <span class="o">*</span> <span class="n">xoutbinsize</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{:&gt;6}</span><span class="s2"> = </span><span class="si">{:.5f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;CDF&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">yout</span><span class="p">)))</span>

    <span class="c1"># return the resampled y-values</span>
    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="n">xout</span><span class="p">,</span> <span class="s2">&quot;x_edge_lower&quot;</span><span class="p">:</span> <span class="n">xout_left</span><span class="p">,</span> <span class="s2">&quot;x_edge_upper&quot;</span><span class="p">:</span> <span class="n">xout_right</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="n">yout</span><span class="p">}</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-function">



<a id="chromatic.rainbows.visualizations.pcolormesh"></a>
    <div class="doc doc-contents first">

        <p>Paint a 2D image of flux as a function of time and wavelength.</p>
<p>By using <code>.pcolormesh()</code>, pixels can transform based on their edges,
so non-uniform axes are allowed. This is a tiny bit slower than
<code>.imshow()</code>, but otherwise very similar. <code>.paint()</code> will try to
choose the best between <code>.imshow()</code> and <code>.pcolormesh()</code>.</p>
<h3 id="chromatic.rainbows.visualizations.pcolormesh--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.visualizations.pcolormesh--parameters" title="Permanent link">#</a></h3>
<p>ax : Axes, optional
    The axes into which to make this plot.
quantity : str, optional
    The fluxlike quantity to imshow.
    (Must be a key of <code>rainbow.fluxlike</code>).
xaxis : str
    What to use as the horizontal axis, 'time' or 'wavelength'.
w_unit : str, Unit, optional
    The unit for plotting wavelengths.
t_unit : str, Unit, optional
    The unit for plotting times.
colorbar : bool, optional
    Should we include a colorbar?
mask_ok : bool, optional
    Should we mark which data are not OK?
color_ok : str, optional
    The color to be used for masking data points that are not OK.
alpha_ok : float, optional
    The transparency to be used for masking data points that are not OK.
**kw : dict, optional
    All other keywords will be passed on to <code>plt.pcolormesh</code>,
    so you can have more detailed control over the plot
    appearance. Common keyword argumentsvli might include:
    <code>[cmap, norm, alpha, vmin, vmax]</code> (and more)
    More details are available at
    https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.pcolormesh.html</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/rainbows/visualizations/pcolormesh.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">  7</span>
<span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">pcolormesh</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">quantity</span><span class="o">=</span><span class="s2">&quot;flux&quot;</span><span class="p">,</span>
    <span class="n">xaxis</span><span class="o">=</span><span class="s2">&quot;time&quot;</span><span class="p">,</span>
    <span class="n">w_unit</span><span class="o">=</span><span class="s2">&quot;micron&quot;</span><span class="p">,</span>
    <span class="n">t_unit</span><span class="o">=</span><span class="s2">&quot;day&quot;</span><span class="p">,</span>
    <span class="n">colorbar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">mask_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">color_ok</span><span class="o">=</span><span class="s2">&quot;tomato&quot;</span><span class="p">,</span>
    <span class="n">alpha_ok</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>
    <span class="n">vmin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">vmax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kw</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Paint a 2D image of flux as a function of time and wavelength.</span>

<span class="sd">    By using `.pcolormesh()`, pixels can transform based on their edges,</span>
<span class="sd">    so non-uniform axes are allowed. This is a tiny bit slower than</span>
<span class="sd">    `.imshow()`, but otherwise very similar. `.paint()` will try to</span>
<span class="sd">    choose the best between `.imshow()` and `.pcolormesh()`.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    ax : Axes, optional</span>
<span class="sd">        The axes into which to make this plot.</span>
<span class="sd">    quantity : str, optional</span>
<span class="sd">        The fluxlike quantity to imshow.</span>
<span class="sd">        (Must be a key of `rainbow.fluxlike`).</span>
<span class="sd">    xaxis : str</span>
<span class="sd">        What to use as the horizontal axis, &#39;time&#39; or &#39;wavelength&#39;.</span>
<span class="sd">    w_unit : str, Unit, optional</span>
<span class="sd">        The unit for plotting wavelengths.</span>
<span class="sd">    t_unit : str, Unit, optional</span>
<span class="sd">        The unit for plotting times.</span>
<span class="sd">    colorbar : bool, optional</span>
<span class="sd">        Should we include a colorbar?</span>
<span class="sd">    mask_ok : bool, optional</span>
<span class="sd">        Should we mark which data are not OK?</span>
<span class="sd">    color_ok : str, optional</span>
<span class="sd">        The color to be used for masking data points that are not OK.</span>
<span class="sd">    alpha_ok : float, optional</span>
<span class="sd">        The transparency to be used for masking data points that are not OK.</span>
<span class="sd">    **kw : dict, optional</span>
<span class="sd">        All other keywords will be passed on to `plt.pcolormesh`,</span>
<span class="sd">        so you can have more detailed control over the plot</span>
<span class="sd">        appearance. Common keyword argumentsvli might include:</span>
<span class="sd">        `[cmap, norm, alpha, vmin, vmax]` (and more)</span>
<span class="sd">        More details are available at</span>
<span class="sd">        https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.pcolormesh.html</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># self.speak(f&#39;imshowing&#39;)</span>
    <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">()</span>

    <span class="c1"># get units</span>
    <span class="n">w_unit</span><span class="p">,</span> <span class="n">t_unit</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Unit</span><span class="p">(</span><span class="n">w_unit</span><span class="p">),</span> <span class="n">u</span><span class="o">.</span><span class="n">Unit</span><span class="p">(</span><span class="n">t_unit</span><span class="p">)</span>

    <span class="c1"># make sure some wavelength and time edges are defined</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_make_sure_wavelength_edges_are_defined</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_make_sure_time_edges_are_defined</span><span class="p">()</span>

    <span class="c1"># set up the wavelength and time edges</span>
    <span class="n">w_edges</span> <span class="o">=</span> <span class="n">leftright_to_edges</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wavelength_lower</span><span class="o">.</span><span class="n">to_value</span><span class="p">(</span><span class="n">w_unit</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">wavelength_upper</span><span class="o">.</span><span class="n">to_value</span><span class="p">(</span><span class="n">w_unit</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">t_edges</span> <span class="o">=</span> <span class="n">leftright_to_edges</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time_lower</span><span class="o">.</span><span class="n">to_value</span><span class="p">(</span><span class="n">t_unit</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_upper</span><span class="o">.</span><span class="n">to_value</span><span class="p">(</span><span class="n">t_unit</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="n">wlabel</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_wave_label</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">w_unit</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="s1">&#39;latex_inline&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span>
    <span class="n">tlabel</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_time_label</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">t_unit</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="s1">&#39;latex_inline&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_2D</span><span class="p">(</span><span class="n">k</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A small helper to get a 2D quantity. This is a bit of</span>
<span class="sd">        a kludge to help with weird cases of duplicate keys</span>
<span class="sd">        (for example where &#39;wavelength&#39; might appear in both</span>
<span class="sd">        `wavelike` and `fluxlike`).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">z</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">z</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fluxlike</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">xaxis</span><span class="o">.</span><span class="n">lower</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;t&quot;</span><span class="p">:</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">t_edges</span><span class="p">,</span> <span class="n">w_edges</span>
        <span class="n">xlabel</span><span class="p">,</span> <span class="n">ylabel</span> <span class="o">=</span> <span class="n">tlabel</span><span class="p">,</span> <span class="n">wlabel</span>
        <span class="n">z</span> <span class="o">=</span> <span class="n">get_2D</span><span class="p">(</span><span class="n">quantity</span><span class="p">)</span>
        <span class="n">ok</span> <span class="o">=</span> <span class="n">get_2D</span><span class="p">(</span><span class="s2">&quot;ok&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">xaxis</span><span class="o">.</span><span class="n">lower</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;w&quot;</span><span class="p">:</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">w_edges</span><span class="p">,</span> <span class="n">t_edges</span>
        <span class="n">xlabel</span><span class="p">,</span> <span class="n">ylabel</span> <span class="o">=</span> <span class="n">wlabel</span><span class="p">,</span> <span class="n">tlabel</span>
        <span class="n">z</span> <span class="o">=</span> <span class="n">get_2D</span><span class="p">(</span><span class="n">quantity</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="n">ok</span> <span class="o">=</span> <span class="n">get_2D</span><span class="p">(</span><span class="s2">&quot;ok&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">cheerfully_suggest</span><span class="p">(</span>
            <span class="s2">&quot;Please specify either `xaxis=&#39;time&#39;` or `xaxis=&#39;wavelength&#39;` for `.plot()`&quot;</span>
        <span class="p">)</span>

    <span class="c1"># figure out a good shared color limits (unless already supplied)</span>
    <span class="n">vmin</span> <span class="o">=</span> <span class="n">vmin</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">nanpercentile</span><span class="p">(</span><span class="n">remove_unit</span><span class="p">(</span><span class="n">z</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">vmax</span> <span class="o">=</span> <span class="n">vmax</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">nanpercentile</span><span class="p">(</span><span class="n">remove_unit</span><span class="p">(</span><span class="n">z</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="mi">99</span><span class="p">)</span>

    <span class="c1"># define some default keywords</span>
    <span class="n">pcolormesh_kw</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">shading</span><span class="o">=</span><span class="s2">&quot;flat&quot;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">)</span>
    <span class="c1"># I want to include `antialiased=True` to render nicely whether the plotting</span>
    <span class="c1"># pixels super- or sub-sample the data pixels, but it appears not to have</span>
    <span class="c1"># an effect in `pcolormesh`, so we just warn the user instead.</span>

    <span class="n">pcolormesh_kw</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">quantity_support</span><span class="p">():</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">mask_ok</span><span class="p">:</span>
            <span class="n">okpcolormesh_kw</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="o">**</span><span class="n">pcolormesh_kw</span><span class="p">)</span>
            <span class="n">okpcolormesh_kw</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                <span class="n">cmap</span><span class="o">=</span><span class="n">one2another</span><span class="p">(</span>
                    <span class="n">bottom</span><span class="o">=</span><span class="n">color_ok</span><span class="p">,</span>
                    <span class="n">top</span><span class="o">=</span><span class="n">color_ok</span><span class="p">,</span>
                    <span class="n">alpha_bottom</span><span class="o">=</span><span class="n">alpha_ok</span><span class="p">,</span>
                    <span class="n">alpha_top</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="p">),</span>
                <span class="n">zorder</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="n">vmax</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span>
                <span class="n">remove_unit</span><span class="p">(</span><span class="n">x</span><span class="p">),</span>
                <span class="n">remove_unit</span><span class="p">(</span><span class="n">y</span><span class="p">),</span>
                <span class="n">remove_unit</span><span class="p">(</span><span class="n">ok</span><span class="p">),</span>
                <span class="o">**</span><span class="n">okpcolormesh_kw</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="n">pcolormeshed</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span>
            <span class="n">remove_unit</span><span class="p">(</span><span class="n">x</span><span class="p">),</span>
            <span class="n">remove_unit</span><span class="p">(</span><span class="n">y</span><span class="p">),</span>
            <span class="n">remove_unit</span><span class="p">(</span><span class="n">z</span><span class="p">),</span>
            <span class="o">**</span><span class="n">pcolormesh_kw</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">colorbar</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span>
                <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
                <span class="n">label</span><span class="o">=</span><span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">z</span><span class="p">)</span><span class="o">.</span><span class="n">unit</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="s2">&quot;latex_inline&quot;</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="c1"># emulate origin = upper for imshow (y starts at top)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">))</span>

        <span class="c1"># offer warning if aliasing might be a problem</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
        <span class="n">bbox</span> <span class="o">=</span> <span class="n">pcolormeshed</span><span class="o">.</span><span class="n">get_window_extent</span><span class="p">()</span>
        <span class="n">render_pixels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">([</span><span class="n">bbox</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="n">bbox</span><span class="o">.</span><span class="n">height</span><span class="p">])</span>
        <span class="n">data_pixels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">z</span><span class="o">.</span><span class="n">shape</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">ratios</span> <span class="o">=</span> <span class="n">render_pixels</span> <span class="o">/</span> <span class="n">data_pixels</span>
        <span class="n">aliasing_warning_threshold</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">ratios</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">aliasing_warning_threshold</span><span class="p">:</span>
            <span class="n">cheerfully_suggest</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            In using`.pcolormesh`, [display pixels] / [data pixels] =</span>
<span class="s2">            </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">render_pixels</span><span class="p">)</span><span class="si">}</span><span class="s2"> / </span><span class="si">{</span><span class="n">data_pixels</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="n">ratios</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="p">(</span><span class="n">xlabel</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="n">ylabel</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span><span class="si">}</span>
<span class="s2">            Is less than the suggested threshold of </span><span class="si">{</span><span class="n">aliasing_warning_threshold</span><span class="si">}</span><span class="s2">.</span>

<span class="s2">            This suggests that aliasing/moiré might be a problem, where too many</span>
<span class="s2">            data pixels are trying to be displayed with too few pixels, and the</span>
<span class="s2">            choices `matplotlib` makes for how to do that might not be intuitive.</span>

<span class="s2">            Here are possible solutions:</span>
<span class="s2">                - Use `.bin()` to decrease the number of data pixels in wavelength</span>
<span class="s2">                and/or time, effectively averaging before displaying, rather than</span>
<span class="s2">                asking `matplotlib` to decide how to visually average adjacent data.</span>
<span class="s2">                - Increase the `dpi` of the figure in which this appears, so there are</span>
<span class="s2">                enough display pixels to represent all the data pixels being shown.</span>
<span class="s2">                - Use `.imshow()` instead of `.pcolormesh`, which can do better</span>
<span class="s2">                built-in handling of antialiasing for large data arrays. Since `.imshow()`</span>
<span class="s2">                can only show uniform wavelength and time grids, non-uniform grids will</span>
<span class="s2">                be labeled via index instead of actual value.</span>
<span class="s2">            &quot;&quot;&quot;</span>
            <span class="p">)</span>
    <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ax</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">



<a id="chromatic.rainbows.visualizations.plot_lightcurves"></a>
    <div class="doc doc-contents first">

        <p>Plot flux as sequence of offset light curves.</p>
<h3 id="chromatic.rainbows.visualizations.plot_lightcurves--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.visualizations.plot_lightcurves--parameters" title="Permanent link">#</a></h3>
<p>ax : Axes, optional
    The axes into which to make this plot.
spacing : None, float, optional
    The spacing between light curves.
    (Might still change how this works.)
    None uses half the standard dev of entire flux data.
w_unit : str, Unit, optional
    The unit for plotting wavelengths.
t_unit : str, Unit, optional
    The unit for plotting times.
cmap : str, Colormap, optional
    The color map to use for expressing wavelength.
vmin : Quantity, optional
    The minimum value to use for the wavelength colormap.
vmax : Quantity, optional
    The maximum value to use for the wavelength colormap.
errorbar : boolean, optional
    Should we plot errorbars?
text : boolean, optional
    Should we label each lightcurve?
minimum_acceptable_ok : float
    The smallest value of <code>ok</code> that will still be included.
    (1 for perfect data, 1e-10 for everything but terrible data, 0 for all data)
plotkw : dict, optional
    A dictionary of keywords passed to <code>plt.plot</code>
    so you can have more detailed control over the plot
    appearance. Common keyword arguments might include:
    <code>[alpha, clip_on, zorder, marker, markersize,
      linewidth, linestyle, zorder]</code> (and more)
    More details are available at
    https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.plot.html
errorbarkw : dict, optional
    A dictionary of keywords passed to <code>plt.errorbar</code>
    so you can have more detailed control over the plot
    appearance. Common keyword arguments might include:
    <code>[alpha, elinewidth, color, zorder]</code> (and more)
    More details are available at
    https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.errorbar.html
textkw : dict, optional
    A dictionary of keywords passed to <code>plt.text</code>
    so you can have more detailed control over the text
    appearance. Common keyword arguments might include:
    <code>[alpha, backgroundcolor, color, fontfamily, fontsize,
      fontstyle, fontweight, rotation, zorder]</code> (and more)
    More details are available at
    https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.text.html
**kw : dict, optional
    Any additional keywords will be stored as <code>kw</code>.
    Nothing will happen with them.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/rainbows/visualizations/plot_lightcurves.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">  6</span>
<span class="normal">  7</span>
<span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">plot_lightcurves</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">quantity</span><span class="o">=</span><span class="s2">&quot;flux&quot;</span><span class="p">,</span>
    <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">spacing</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">w_unit</span><span class="o">=</span><span class="s2">&quot;micron&quot;</span><span class="p">,</span>
    <span class="n">t_unit</span><span class="o">=</span><span class="s2">&quot;day&quot;</span><span class="p">,</span>
    <span class="n">cmap</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">vmin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">vmax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">errorbar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">minimum_acceptable_ok</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>
    <span class="n">plotkw</span><span class="o">=</span><span class="p">{},</span>
    <span class="n">errorbarkw</span><span class="o">=</span><span class="p">{},</span>
    <span class="n">textkw</span><span class="o">=</span><span class="p">{},</span>
    <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">scaling</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">label_scatter</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kw</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot flux as sequence of offset light curves.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    ax : Axes, optional</span>
<span class="sd">        The axes into which to make this plot.</span>
<span class="sd">    spacing : None, float, optional</span>
<span class="sd">        The spacing between light curves.</span>
<span class="sd">        (Might still change how this works.)</span>
<span class="sd">        None uses half the standard dev of entire flux data.</span>
<span class="sd">    w_unit : str, Unit, optional</span>
<span class="sd">        The unit for plotting wavelengths.</span>
<span class="sd">    t_unit : str, Unit, optional</span>
<span class="sd">        The unit for plotting times.</span>
<span class="sd">    cmap : str, Colormap, optional</span>
<span class="sd">        The color map to use for expressing wavelength.</span>
<span class="sd">    vmin : Quantity, optional</span>
<span class="sd">        The minimum value to use for the wavelength colormap.</span>
<span class="sd">    vmax : Quantity, optional</span>
<span class="sd">        The maximum value to use for the wavelength colormap.</span>
<span class="sd">    errorbar : boolean, optional</span>
<span class="sd">        Should we plot errorbars?</span>
<span class="sd">    text : boolean, optional</span>
<span class="sd">        Should we label each lightcurve?</span>
<span class="sd">    minimum_acceptable_ok : float</span>
<span class="sd">        The smallest value of `ok` that will still be included.</span>
<span class="sd">        (1 for perfect data, 1e-10 for everything but terrible data, 0 for all data)</span>
<span class="sd">    plotkw : dict, optional</span>
<span class="sd">        A dictionary of keywords passed to `plt.plot`</span>
<span class="sd">        so you can have more detailed control over the plot</span>
<span class="sd">        appearance. Common keyword arguments might include:</span>
<span class="sd">        `[alpha, clip_on, zorder, marker, markersize,</span>
<span class="sd">          linewidth, linestyle, zorder]` (and more)</span>
<span class="sd">        More details are available at</span>
<span class="sd">        https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.plot.html</span>
<span class="sd">    errorbarkw : dict, optional</span>
<span class="sd">        A dictionary of keywords passed to `plt.errorbar`</span>
<span class="sd">        so you can have more detailed control over the plot</span>
<span class="sd">        appearance. Common keyword arguments might include:</span>
<span class="sd">        `[alpha, elinewidth, color, zorder]` (and more)</span>
<span class="sd">        More details are available at</span>
<span class="sd">        https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.errorbar.html</span>
<span class="sd">    textkw : dict, optional</span>
<span class="sd">        A dictionary of keywords passed to `plt.text`</span>
<span class="sd">        so you can have more detailed control over the text</span>
<span class="sd">        appearance. Common keyword arguments might include:</span>
<span class="sd">        `[alpha, backgroundcolor, color, fontfamily, fontsize,</span>
<span class="sd">          fontstyle, fontweight, rotation, zorder]` (and more)</span>
<span class="sd">        More details are available at</span>
<span class="sd">        https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.text.html</span>
<span class="sd">    **kw : dict, optional</span>
<span class="sd">        Any additional keywords will be stored as `kw`.</span>
<span class="sd">        Nothing will happen with them.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">kw</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">message</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        You provided the keyword argument(s)</span>
<span class="s2">        </span><span class="si">{</span><span class="n">kw</span><span class="si">}</span>
<span class="s2">        but this function doesn&#39;t know how to</span>
<span class="s2">        use them. Sorry!</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="n">cheerfully_suggest</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>

    <span class="c1"># make sure that the wavelength-based colormap is defined</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_make_sure_cmap_is_defined</span><span class="p">(</span><span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">)</span>

    <span class="n">w_unit</span><span class="p">,</span> <span class="n">t_unit</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Unit</span><span class="p">(</span><span class="n">w_unit</span><span class="p">),</span> <span class="n">u</span><span class="o">.</span><span class="n">Unit</span><span class="p">(</span><span class="n">t_unit</span><span class="p">)</span>

    <span class="n">min_time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">to_value</span><span class="p">(</span><span class="n">t_unit</span><span class="p">))</span>
    <span class="n">max_time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">to_value</span><span class="p">(</span><span class="n">t_unit</span><span class="p">))</span>

    <span class="c1"># make sure ax is set up</span>
    <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fi</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span>
            <span class="n">figsize</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;figure.figsize&quot;</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
            <span class="n">constrained_layout</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>

    <span class="c1"># figure out the spacing to use</span>
    <span class="k">if</span> <span class="n">spacing</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">spacing</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">_most_recent_chromatic_plot_spacing</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="n">spacing</span> <span class="o">=</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">nanstd</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">quantity</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">_most_recent_chromatic_plot_spacing</span> <span class="o">=</span> <span class="n">spacing</span>

    <span class="c1"># TO-DO: check if this Rainbow has been normalized</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_probably_normalized</span><span class="p">()</span> <span class="ow">or</span> <span class="s2">&quot;model&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fluxlike</span><span class="p">:</span>
        <span class="n">label_y</span> <span class="o">=</span> <span class="s2">&quot;1 - (0.5 + i) * spacing&quot;</span>
        <span class="n">ylim</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">nwave</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="n">spacing</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">label_y</span> <span class="o">=</span> <span class="s2">&quot;np.median(plot_y) - 0.5 * spacing&quot;</span>
        <span class="n">cheerfully_suggest</span><span class="p">(</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            It&#39;s not clear if/how this object has been normalized.</span>
<span class="sd">            Be aware that the baseline flux levels may therefore</span>
<span class="sd">            be a little bit funny in .plot().&quot;&quot;&quot;</span>
        <span class="p">)</span>
        <span class="n">ylim</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">with</span> <span class="n">quantity_support</span><span class="p">():</span>

        <span class="k">if</span> <span class="n">label_scatter</span><span class="p">:</span>
            <span class="n">measured_rms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_measured_scatter</span><span class="p">(</span><span class="n">quantity</span><span class="o">=</span><span class="s2">&quot;residuals&quot;</span><span class="p">)</span>
            <span class="n">expected_rms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_expected_uncertainty</span><span class="p">()</span>

        <span class="c1">#  loop through wavelengths</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">w</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wavelength</span><span class="p">):</span>

            <span class="c1"># grab the quantity and yerr for this particular wavelength</span>
            <span class="n">t</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">sigma</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_ok_data_for_wavelength</span><span class="p">(</span>
                <span class="n">i</span><span class="p">,</span> <span class="n">minimum_acceptable_ok</span><span class="o">=</span><span class="n">minimum_acceptable_ok</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">quantity</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">y</span><span class="p">)):</span>

                <span class="n">plot_x</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">to_value</span><span class="p">(</span><span class="n">t_unit</span><span class="p">)</span>

                <span class="c1"># add an offset to this quantity</span>
                <span class="n">plot_y</span> <span class="o">=</span> <span class="o">-</span><span class="n">i</span> <span class="o">*</span> <span class="n">spacing</span> <span class="o">+</span> <span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">value</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">scaling</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="n">plot_sigma</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">sigma</span><span class="p">)</span><span class="o">.</span><span class="n">value</span> <span class="o">*</span> <span class="n">scaling</span>

                <span class="c1"># get the color for this quantity</span>
                <span class="n">color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_wavelength_color</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>

                <span class="c1"># plot the data points (with offsets)</span>
                <span class="n">this_plotkw</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">marker</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
                <span class="n">this_plotkw</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="n">plotkw</span><span class="p">)</span>

                <span class="c1"># set default for error bar lines</span>
                <span class="n">this_errorbarkw</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
                    <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">elinewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=-</span><span class="mi">1</span>
                <span class="p">)</span>
                <span class="n">this_errorbarkw</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="n">errorbarkw</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">errorbar</span><span class="p">:</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span>
                        <span class="n">plot_x</span><span class="p">,</span>
                        <span class="n">plot_y</span><span class="p">,</span>
                        <span class="n">yerr</span><span class="o">=</span><span class="n">plot_sigma</span><span class="p">,</span>
                        <span class="o">**</span><span class="n">this_errorbarkw</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">plot_x</span><span class="p">,</span> <span class="n">plot_y</span><span class="p">,</span> <span class="o">**</span><span class="n">this_plotkw</span><span class="p">)</span>

                <span class="c1"># add text labels next to each quantity plot</span>
                <span class="n">this_textkw</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">va</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
                <span class="n">this_textkw</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="n">textkw</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">text</span><span class="p">:</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
                        <span class="n">min_time</span><span class="p">,</span>
                        <span class="nb">eval</span><span class="p">(</span><span class="n">label_y</span><span class="p">),</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">w</span><span class="o">.</span><span class="n">to_value</span><span class="p">(</span><span class="n">w_unit</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">w_unit</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="s1">&#39;latex_inline&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                        <span class="o">**</span><span class="n">this_textkw</span><span class="p">,</span>
                    <span class="p">)</span>

                <span class="k">if</span> <span class="n">label_scatter</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">:</span>
                    <span class="n">this_textkw</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">ha</span><span class="o">=</span><span class="s2">&quot;right&quot;</span><span class="p">)</span>
                    <span class="n">measured</span> <span class="o">=</span> <span class="n">measured_rms</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="n">expected</span> <span class="o">=</span> <span class="n">expected_rms</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="n">cadence</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dt</span>
                    <span class="k">if</span> <span class="n">text</span><span class="p">:</span>
                        <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
                            <span class="n">max_time</span><span class="p">,</span>
                            <span class="nb">eval</span><span class="p">(</span><span class="n">label_y</span><span class="p">),</span>
                            <span class="nb">eval</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;f&quot;</span><span class="si">{</span><span class="n">label_scatter</span><span class="si">}</span><span class="s1">&quot;&#39;</span><span class="p">),</span>
                            <span class="o">**</span><span class="n">this_textkw</span><span class="p">,</span>
                        <span class="p">)</span>

        <span class="c1"># add text labels to the plot</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_time_label</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">t_unit</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="s1">&#39;latex_inline&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Relative Flux (+ offsets)&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ylim</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ylim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="n">ylim</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="o">*</span><span class="n">ylim</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ax</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">



<a id="chromatic.rainbows.visualizations.plot_spectra"></a>
    <div class="doc doc-contents first">

        <p>Plot flux as sequence of offset spectrum.</p>
<h3 id="chromatic.rainbows.visualizations.plot_spectra--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.visualizations.plot_spectra--parameters" title="Permanent link">#</a></h3>
<p>ax : Axes
    The axes into which to make this plot.
spacing : None, float
    The spacing between light curves.
    (Might still change how this works.)
    None uses half the standard dev of entire flux data.
w_unit : str, Unit
    The unit for plotting wavelengths.
t_unit : str, Unit
    The unit for plotting times.
cmap : str, Colormap
    The color map to use for expressing wavelength.
vmin : Quantity
    The minimum value to use for the wavelength colormap.
vmax : Quantity
    The maximum value to use for the wavelength colormap.
errorbar : boolean
    Should we plot errorbars?
text : boolean
    Should we label each spectrum?
minimum_acceptable_ok : float
    The smallest value of <code>ok</code> that will still be included.
    (1 for perfect data, 1e-10 for everything but terrible data, 0 for all data)
scatterkw : dict
    A dictionary of keywords passed to <code>plt.scatter</code>
    so you can have more detailed control over the text
    appearance. Common keyword arguments might include:
    <code>[alpha, color, s, m, edgecolor, facecolor]</code> (and more)
    More details are available at
    https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.scatter.html
errorbarkw : dict
    A dictionary of keywords passed to <code>plt.errorbar</code>
    so you can have more detailed control over the plot
    appearance. Common keyword arguments might include:
    <code>[alpha, elinewidth, color, zorder]</code> (and more)
    More details are available at
    https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.errorbar.html
plotkw : dict
    A dictionary of keywords passed to <code>plt.plot</code>
    so you can have more detailed control over the plot
    appearance. Common keyword arguments might include:
    <code>[alpha, clip_on, zorder, marker, markersize,
      linewidth, linestyle, zorder]</code> (and more)
    More details are available at
    https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.plot.html
textkw : dict
    A dictionary of keywords passed to <code>plt.text</code>
    so you can have more detailed control over the text
    appearance. Common keyword arguments might include:
    <code>[alpha, backgroundcolor, color, fontfamily, fontsize,
      fontstyle, fontweight, rotation, zorder]</code> (and more)
    More details are available at
    https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.text.html
**kw : dict
    Any additional keywords will be stored as <code>kw</code>.
    Nothing will happen with them.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/rainbows/visualizations/plot_spectra.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">  6</span>
<span class="normal">  7</span>
<span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">plot_spectra</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">quantity</span><span class="o">=</span><span class="s2">&quot;flux&quot;</span><span class="p">,</span>
    <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">spacing</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
    <span class="n">w_unit</span><span class="o">=</span><span class="s2">&quot;micron&quot;</span><span class="p">,</span>
    <span class="n">t_unit</span><span class="o">=</span><span class="s2">&quot;day&quot;</span><span class="p">,</span>
    <span class="n">cmap</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">vmin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">vmax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">errorbar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">minimum_acceptable_ok</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">scatterkw</span><span class="o">=</span><span class="p">{},</span>
    <span class="n">errorbarkw</span><span class="o">=</span><span class="p">{},</span>
    <span class="n">plotkw</span><span class="o">=</span><span class="p">{},</span>
    <span class="n">textkw</span><span class="o">=</span><span class="p">{},</span>
    <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kw</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot flux as sequence of offset spectrum.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    ax : Axes</span>
<span class="sd">        The axes into which to make this plot.</span>
<span class="sd">    spacing : None, float</span>
<span class="sd">        The spacing between light curves.</span>
<span class="sd">        (Might still change how this works.)</span>
<span class="sd">        None uses half the standard dev of entire flux data.</span>
<span class="sd">    w_unit : str, Unit</span>
<span class="sd">        The unit for plotting wavelengths.</span>
<span class="sd">    t_unit : str, Unit</span>
<span class="sd">        The unit for plotting times.</span>
<span class="sd">    cmap : str, Colormap</span>
<span class="sd">        The color map to use for expressing wavelength.</span>
<span class="sd">    vmin : Quantity</span>
<span class="sd">        The minimum value to use for the wavelength colormap.</span>
<span class="sd">    vmax : Quantity</span>
<span class="sd">        The maximum value to use for the wavelength colormap.</span>
<span class="sd">    errorbar : boolean</span>
<span class="sd">        Should we plot errorbars?</span>
<span class="sd">    text : boolean</span>
<span class="sd">        Should we label each spectrum?</span>
<span class="sd">    minimum_acceptable_ok : float</span>
<span class="sd">        The smallest value of `ok` that will still be included.</span>
<span class="sd">        (1 for perfect data, 1e-10 for everything but terrible data, 0 for all data)</span>
<span class="sd">    scatterkw : dict</span>
<span class="sd">        A dictionary of keywords passed to `plt.scatter`</span>
<span class="sd">        so you can have more detailed control over the text</span>
<span class="sd">        appearance. Common keyword arguments might include:</span>
<span class="sd">        `[alpha, color, s, m, edgecolor, facecolor]` (and more)</span>
<span class="sd">        More details are available at</span>
<span class="sd">        https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.scatter.html</span>
<span class="sd">    errorbarkw : dict</span>
<span class="sd">        A dictionary of keywords passed to `plt.errorbar`</span>
<span class="sd">        so you can have more detailed control over the plot</span>
<span class="sd">        appearance. Common keyword arguments might include:</span>
<span class="sd">        `[alpha, elinewidth, color, zorder]` (and more)</span>
<span class="sd">        More details are available at</span>
<span class="sd">        https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.errorbar.html</span>
<span class="sd">    plotkw : dict</span>
<span class="sd">        A dictionary of keywords passed to `plt.plot`</span>
<span class="sd">        so you can have more detailed control over the plot</span>
<span class="sd">        appearance. Common keyword arguments might include:</span>
<span class="sd">        `[alpha, clip_on, zorder, marker, markersize,</span>
<span class="sd">          linewidth, linestyle, zorder]` (and more)</span>
<span class="sd">        More details are available at</span>
<span class="sd">        https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.plot.html</span>
<span class="sd">    textkw : dict</span>
<span class="sd">        A dictionary of keywords passed to `plt.text`</span>
<span class="sd">        so you can have more detailed control over the text</span>
<span class="sd">        appearance. Common keyword arguments might include:</span>
<span class="sd">        `[alpha, backgroundcolor, color, fontfamily, fontsize,</span>
<span class="sd">          fontstyle, fontweight, rotation, zorder]` (and more)</span>
<span class="sd">        More details are available at</span>
<span class="sd">        https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.text.html</span>
<span class="sd">    **kw : dict</span>
<span class="sd">        Any additional keywords will be stored as `kw`.</span>
<span class="sd">        Nothing will happen with them.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">kw</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">message</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        You provided the keyword argument(s)</span>
<span class="s2">        </span><span class="si">{</span><span class="n">kw</span><span class="si">}</span>
<span class="s2">        but this function doesn&#39;t know how to</span>
<span class="s2">        use them. Sorry!</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="n">cheerfully_suggest</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>

    <span class="c1"># make sure that the wavelength-based colormap is defined</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_make_sure_cmap_is_defined</span><span class="p">(</span><span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">)</span>

    <span class="n">w_unit</span><span class="p">,</span> <span class="n">t_unit</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Unit</span><span class="p">(</span><span class="n">w_unit</span><span class="p">),</span> <span class="n">u</span><span class="o">.</span><span class="n">Unit</span><span class="p">(</span><span class="n">t_unit</span><span class="p">)</span>

    <span class="n">min_wave</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wavelength</span><span class="o">.</span><span class="n">to_value</span><span class="p">(</span><span class="n">w_unit</span><span class="p">))</span>

    <span class="c1"># make sure ax is set up</span>
    <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fi</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span>
            <span class="n">figsize</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;figure.figsize&quot;</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
            <span class="n">constrained_layout</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>

    <span class="c1"># figure out the spacing to use</span>
    <span class="k">if</span> <span class="n">spacing</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">spacing</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">_most_recent_chromatic_plot_spacing</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="n">spacing</span> <span class="o">=</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">nanstd</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">quantity</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">_most_recent_chromatic_plot_spacing</span> <span class="o">=</span> <span class="n">spacing</span>

    <span class="c1"># TO-DO: check if this Rainbow has been normalized</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;cheerfully_suggest(</span>
<span class="sd">        &quot;&quot;&quot;</span>
<span class="sd">    It&#39;s not clear if/how this object has been normalized.</span>
<span class="sd">    Be aware that the baseline flux levels may therefore</span>
<span class="sd">    be a little bit funny in .plot().&quot;&quot;&quot;</span>
<span class="sd">    )&#39;&#39;&#39;</span>
    <span class="k">with</span> <span class="n">quantity_support</span><span class="p">():</span>

        <span class="c1">#  loop through times</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">):</span>
            <span class="c1"># grab the spectrum for this particular time</span>
            <span class="n">w</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">sigma</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_ok_data_for_time</span><span class="p">(</span>
                <span class="n">i</span><span class="p">,</span> <span class="n">minimum_acceptable_ok</span><span class="o">=</span><span class="n">minimum_acceptable_ok</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">quantity</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">y</span><span class="p">)):</span>

                <span class="n">plot_x</span> <span class="o">=</span> <span class="n">w</span><span class="o">.</span><span class="n">to_value</span><span class="p">(</span><span class="n">w_unit</span><span class="p">)</span>

                <span class="c1"># add an offset to this spectrum</span>
                <span class="n">plot_y</span> <span class="o">=</span> <span class="o">-</span><span class="n">i</span> <span class="o">*</span> <span class="n">spacing</span> <span class="o">+</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
                <span class="n">plot_sigma</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">sigma</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>

                <span class="n">default_color</span> <span class="o">=</span> <span class="s2">&quot;black&quot;</span>

                <span class="c1"># set default for background line plot</span>
                <span class="n">this_plotkw</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">default_color</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">this_plotkw</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="n">plotkw</span><span class="p">)</span>

                <span class="c1"># set default for scatter plot with points</span>
                <span class="n">this_scatterkw</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
                    <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">,</span>
                    <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span>
                    <span class="n">c</span><span class="o">=</span><span class="n">plot_x</span><span class="p">,</span>
                    <span class="n">cmap</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cmap</span><span class="p">,</span>
                    <span class="n">norm</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">norm</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">this_scatterkw</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="n">scatterkw</span><span class="p">)</span>

                <span class="c1"># set default for error bar lines</span>
                <span class="n">this_errorbarkw</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
                    <span class="n">color</span><span class="o">=</span><span class="n">default_color</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">elinewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=-</span><span class="mi">1</span>
                <span class="p">)</span>
                <span class="n">this_errorbarkw</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="n">errorbarkw</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">errorbar</span><span class="p">:</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span>
                        <span class="n">plot_x</span><span class="p">,</span>
                        <span class="n">plot_y</span><span class="p">,</span>
                        <span class="n">yerr</span><span class="o">=</span><span class="n">plot_sigma</span><span class="p">,</span>
                        <span class="o">**</span><span class="n">this_errorbarkw</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">plot_x</span><span class="p">,</span> <span class="n">plot_y</span><span class="p">,</span> <span class="o">**</span><span class="n">this_plotkw</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">plot_x</span><span class="p">,</span> <span class="n">plot_y</span><span class="p">,</span> <span class="o">**</span><span class="n">this_scatterkw</span><span class="p">)</span>

                <span class="c1"># add text labels next to each spectrum</span>
                <span class="n">this_textkw</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">va</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">default_color</span><span class="p">)</span>
                <span class="n">this_textkw</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="n">textkw</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">text</span><span class="p">:</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
                        <span class="n">min_wave</span><span class="p">,</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">plot_y</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">spacing</span><span class="p">,</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">t</span><span class="o">.</span><span class="n">to_value</span><span class="p">(</span><span class="n">t_unit</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">t_unit</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="s1">&#39;latex_inline&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                        <span class="o">**</span><span class="n">this_textkw</span><span class="p">,</span>
                    <span class="p">)</span>

        <span class="c1"># add text labels to the plot</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Wavelength (</span><span class="si">{</span><span class="n">w_unit</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="s1">&#39;latex_inline&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Relative Flux (+ offsets)&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;wscale&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;log&quot;</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ax</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">



<a id="chromatic.rainbows.visualizations.plot"></a>
    <div class="doc doc-contents first">

        <p>Plot flux either as a sequence of offset lightcurves (default)
or as a sequence of offset spectra.</p>
<h3 id="chromatic.rainbows.visualizations.plot--parameters">Parameters<a class="headerlink" href="#chromatic.rainbows.visualizations.plot--parameters" title="Permanent link">#</a></h3>
<p>xaxis : string
    What should be plotted on the x-axis of the plot?
    'time' will plot a different light curve for each wavelength
    'wavelength' will plot a different spectrum for each timepoint
**kw : dict
    All other keywords will be passed along to either
    <code>.plot_lightcurves</code> or <code>.plot_spectra</code> as appropriate.
    Please see the docstrings for either of those functions
    to figure out what keyword arguments you might want to
    provide here.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/rainbows/visualizations/plot.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xaxis</span><span class="o">=</span><span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot flux either as a sequence of offset lightcurves (default)</span>
<span class="sd">    or as a sequence of offset spectra.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    xaxis : string</span>
<span class="sd">        What should be plotted on the x-axis of the plot?</span>
<span class="sd">        &#39;time&#39; will plot a different light curve for each wavelength</span>
<span class="sd">        &#39;wavelength&#39; will plot a different spectrum for each timepoint</span>
<span class="sd">    **kw : dict</span>
<span class="sd">        All other keywords will be passed along to either</span>
<span class="sd">        `.plot_lightcurves` or `.plot_spectra` as appropriate.</span>
<span class="sd">        Please see the docstrings for either of those functions</span>
<span class="sd">        to figure out what keyword arguments you might want to</span>
<span class="sd">        provide here.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">xaxis</span><span class="o">.</span><span class="n">lower</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;t&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_lightcurves</span><span class="p">(</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">xaxis</span><span class="o">.</span><span class="n">lower</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;w&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_spectra</span><span class="p">(</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">cheerfully_suggest</span><span class="p">(</span><span class="s2">&quot;Please specify either &#39;time&#39; or &#39;wavelength&#39; for `.plot()`&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div><h2 id="tools">🔨 Tools<a class="headerlink" href="#tools" title="Permanent link">#</a></h2>


<div class="doc doc-object doc-function">



<a id="chromatic.spectra.planck.get_planck_photons"></a>
    <div class="doc doc-contents first">

        <p>Calculate the surface flux from a thermally emitted surface,
according to Planck function, in units of photons/(s * m**2 * nm).</p>
<h3 id="chromatic.spectra.planck.get_planck_photons--parameters">Parameters<a class="headerlink" href="#chromatic.spectra.planck.get_planck_photons--parameters" title="Permanent link">#</a></h3>
<p>temperature : Quantity
    The temperature of the thermal emitter,
    with units of K.
wavelength : Quantity, optional
    The wavelengths at which to calculate,
    with units of wavelength.
R : float, optional
    The spectroscopic resolution for creating a log-uniform
    grid that spans the limits set by <code>wlim</code>, only if
    <code>wavelength</code> is not defined.
wlim : Quantity, optional
    The two-element [lower, upper] limits of a wavelength
    grid that would be populated with resolution <code>R</code>, only if
    <code>wavelength</code> is not defined.
**kw : dict, optional
    Other keyword arguments will be ignored.</p>
<h3 id="chromatic.spectra.planck.get_planck_photons--returns">Returns<a class="headerlink" href="#chromatic.spectra.planck.get_planck_photons--returns" title="Permanent link">#</a></h3>
<p>photons : Quantity
    The surface flux in photon units</p>
<p>This evaluates the Planck function at the exact
wavelength values; it doesn't do anything fancy to integrate
over binwidths, so if you're using very wide (R~a few) bins
your integrated fluxes will be messed up.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/spectra/planck.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_planck_photons</span><span class="p">(</span>
    <span class="n">temperature</span><span class="o">=</span><span class="mi">3000</span><span class="p">,</span> <span class="n">wavelength</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">R</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">wlim</span><span class="o">=</span><span class="p">[</span><span class="mf">0.04</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">micron</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the surface flux from a thermally emitted surface,</span>
<span class="sd">    according to Planck function, in units of photons/(s * m**2 * nm).</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    temperature : Quantity</span>
<span class="sd">        The temperature of the thermal emitter,</span>
<span class="sd">        with units of K.</span>
<span class="sd">    wavelength : Quantity, optional</span>
<span class="sd">        The wavelengths at which to calculate,</span>
<span class="sd">        with units of wavelength.</span>
<span class="sd">    R : float, optional</span>
<span class="sd">        The spectroscopic resolution for creating a log-uniform</span>
<span class="sd">        grid that spans the limits set by `wlim`, only if</span>
<span class="sd">        `wavelength` is not defined.</span>
<span class="sd">    wlim : Quantity, optional</span>
<span class="sd">        The two-element [lower, upper] limits of a wavelength</span>
<span class="sd">        grid that would be populated with resolution `R`, only if</span>
<span class="sd">        `wavelength` is not defined.</span>
<span class="sd">    **kw : dict, optional</span>
<span class="sd">        Other keyword arguments will be ignored.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    photons : Quantity</span>
<span class="sd">        The surface flux in photon units</span>

<span class="sd">    This evaluates the Planck function at the exact</span>
<span class="sd">    wavelength values; it doesn&#39;t do anything fancy to integrate</span>
<span class="sd">    over binwidths, so if you&#39;re using very wide (R~a few) bins</span>
<span class="sd">    your integrated fluxes will be messed up.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># make sure the temperature unit is good (whether or not it&#39;s supplied)</span>
    <span class="n">temperature_unit</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">temperature</span><span class="p">)</span><span class="o">.</span><span class="n">unit</span>
    <span class="k">if</span> <span class="n">temperature_unit</span> <span class="o">==</span> <span class="n">u</span><span class="o">.</span><span class="n">K</span><span class="p">:</span>
        <span class="n">temperature_with_unit</span> <span class="o">=</span> <span class="n">temperature</span>
    <span class="k">elif</span> <span class="n">temperature_unit</span> <span class="o">==</span> <span class="n">u</span><span class="o">.</span><span class="n">Unit</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
        <span class="n">temperature_with_unit</span> <span class="o">=</span> <span class="n">temperature</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">K</span>

    <span class="c1"># create a wavelength grid if one isn&#39;t supplied</span>
    <span class="k">if</span> <span class="n">wavelength</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">wavelength_unit</span> <span class="o">=</span> <span class="n">wlim</span><span class="o">.</span><span class="n">unit</span>
        <span class="n">wavelength</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">wlim</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">wlim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">),</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">R</span><span class="p">))</span>
            <span class="o">*</span> <span class="n">wavelength_unit</span>
        <span class="p">)</span>

    <span class="n">energy</span> <span class="o">=</span> <span class="n">calculate_planck_flux</span><span class="p">(</span>
        <span class="n">wavelength</span><span class="o">=</span><span class="n">wavelength</span><span class="p">,</span> <span class="n">temperature</span><span class="o">=</span><span class="n">temperature_with_unit</span>
    <span class="p">)</span>
    <span class="n">photon_energy</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">h</span> <span class="o">*</span> <span class="n">con</span><span class="o">.</span><span class="n">c</span> <span class="o">/</span> <span class="n">wavelength</span> <span class="o">/</span> <span class="n">u</span><span class="o">.</span><span class="n">ph</span>

    <span class="k">return</span> <span class="n">wavelength</span><span class="p">,</span> <span class="p">(</span><span class="n">energy</span> <span class="o">/</span> <span class="n">photon_energy</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">ph</span> <span class="o">/</span> <span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">s</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">m</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">nm</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">



<a id="chromatic.spectra.phoenix.get_phoenix_photons"></a>
    <div class="doc doc-contents first">

        <p>Get a PHOENIX model spectrum for an arbitrary temperature, logg, metallicity.</p>
<p>Calculate the surface flux from a thermally emitted surface,
according to PHOENIX model spectra, in units of photons/(s * m**2 * nm).</p>
<h3 id="chromatic.spectra.phoenix.get_phoenix_photons--parameters">Parameters<a class="headerlink" href="#chromatic.spectra.phoenix.get_phoenix_photons--parameters" title="Permanent link">#</a></h3>
<p>temperature : float, optional
    Temperature, in K (with no astropy units attached).
logg : float, optional
    Surface gravity log10[g/(cm/s**2)] (with no astropy units attached).
metallicity : float, optional
    Metallicity log10[metals/solar] (with no astropy units attached).
R : float, optional
    Spectroscopic resolution (lambda/dlambda). Currently, this must
    be in one of [3,10,30,100,300,1000,3000,10000,30000,100000], but
    check back soon for custom wavelength grids. There is extra
    overhead associated with switching resolutions, so if you're
    going to retrieve many spectra, try to group by resolution.
    (If you're using the <code>wavelength</code> or <code>wavelength_edges</code> option
    below, please be ensure your requested R exceeds that needed
    to support your wavelengths.)
wavelength : Quantity, optional
    A grid of wavelengths on which you would like your spectrum.
    If this is None, the complete wavelength array will be returned
    at your desired resolution. Otherwise, the spectrum will be
    returned exactly at those wavelengths. Grid points will be
    cached for this new wavelength grid to speed up applications
    that need to retreive lots of similar spectra for the same
    wavelength (like many optimization or sampling problems).
wavelength_edges : Quantity, optional
    Same as <code>wavelength</code> (see above!) but defining the wavelength
    grid by its edges instead of its centers. The returned spectrum
    will have 1 fewer element than <code>wavelength_edges</code>.</p>
<h3 id="chromatic.spectra.phoenix.get_phoenix_photons--returns">Returns<a class="headerlink" href="#chromatic.spectra.phoenix.get_phoenix_photons--returns" title="Permanent link">#</a></h3>
<p>wavelength : Quantity
    The wavelengths, at the specified resolution.
photons : Quantity
    The surface flux in photon units</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/spectra/phoenix.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_phoenix_photons</span><span class="p">(</span>
    <span class="n">temperature</span><span class="o">=</span><span class="mi">5780</span><span class="p">,</span>
    <span class="n">logg</span><span class="o">=</span><span class="mf">4.43</span><span class="p">,</span>
    <span class="n">metallicity</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
    <span class="n">R</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
    <span class="n">wavelength</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">wavelength_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">visualize</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get a PHOENIX model spectrum for an arbitrary temperature, logg, metallicity.</span>

<span class="sd">    Calculate the surface flux from a thermally emitted surface,</span>
<span class="sd">    according to PHOENIX model spectra, in units of photons/(s * m**2 * nm).</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    temperature : float, optional</span>
<span class="sd">        Temperature, in K (with no astropy units attached).</span>
<span class="sd">    logg : float, optional</span>
<span class="sd">        Surface gravity log10[g/(cm/s**2)] (with no astropy units attached).</span>
<span class="sd">    metallicity : float, optional</span>
<span class="sd">        Metallicity log10[metals/solar] (with no astropy units attached).</span>
<span class="sd">    R : float, optional</span>
<span class="sd">        Spectroscopic resolution (lambda/dlambda). Currently, this must</span>
<span class="sd">        be in one of [3,10,30,100,300,1000,3000,10000,30000,100000], but</span>
<span class="sd">        check back soon for custom wavelength grids. There is extra</span>
<span class="sd">        overhead associated with switching resolutions, so if you&#39;re</span>
<span class="sd">        going to retrieve many spectra, try to group by resolution.</span>
<span class="sd">        (If you&#39;re using the `wavelength` or `wavelength_edges` option</span>
<span class="sd">        below, please be ensure your requested R exceeds that needed</span>
<span class="sd">        to support your wavelengths.)</span>
<span class="sd">    wavelength : Quantity, optional</span>
<span class="sd">        A grid of wavelengths on which you would like your spectrum.</span>
<span class="sd">        If this is None, the complete wavelength array will be returned</span>
<span class="sd">        at your desired resolution. Otherwise, the spectrum will be</span>
<span class="sd">        returned exactly at those wavelengths. Grid points will be</span>
<span class="sd">        cached for this new wavelength grid to speed up applications</span>
<span class="sd">        that need to retreive lots of similar spectra for the same</span>
<span class="sd">        wavelength (like many optimization or sampling problems).</span>
<span class="sd">    wavelength_edges : Quantity, optional</span>
<span class="sd">        Same as `wavelength` (see above!) but defining the wavelength</span>
<span class="sd">        grid by its edges instead of its centers. The returned spectrum</span>
<span class="sd">        will have 1 fewer element than `wavelength_edges`.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    wavelength : Quantity</span>
<span class="sd">        The wavelengths, at the specified resolution.</span>
<span class="sd">    photons : Quantity</span>
<span class="sd">        The surface flux in photon units</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">phoenix_library</span><span class="o">.</span><span class="n">get_spectrum</span><span class="p">(</span>
        <span class="n">temperature</span><span class="o">=</span><span class="n">temperature</span><span class="p">,</span>
        <span class="n">logg</span><span class="o">=</span><span class="n">logg</span><span class="p">,</span>
        <span class="n">metallicity</span><span class="o">=</span><span class="n">metallicity</span><span class="p">,</span>
        <span class="n">R</span><span class="o">=</span><span class="n">R</span><span class="p">,</span>
        <span class="n">wavelength</span><span class="o">=</span><span class="n">wavelength</span><span class="p">,</span>
        <span class="n">wavelength_edges</span><span class="o">=</span><span class="n">wavelength_edges</span><span class="p">,</span>
        <span class="n">visualize</span><span class="o">=</span><span class="n">visualize</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-module">



<a id="chromatic.tools.resampling"></a>
    <div class="doc doc-contents first">

        <p>Tools for resampling array from one grid
of independent variables to another.</p>









  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="chromatic.tools.resampling.bintoR" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">bintoR</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">unc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">R</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">weighting</span><span class="o">=</span><span class="s1">&#39;inversevariance&#39;</span><span class="p">,</span> <span class="n">drop_nans</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

<a href="#chromatic.tools.resampling.bintoR" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Bin any x and y array onto a logarithmicly uniform grid.</p>
<h4 id="chromatic.tools.resampling.bintoR--parameters">Parameters<a class="headerlink" href="#chromatic.tools.resampling.bintoR--parameters" title="Permanent link">#</a></h4>
<p>x : array
    The original independent variable.
    (For a spectrum example = wavelength)
y : array
    The original dependent variable (same size as x).
    (For a spectrum example = flux)
unc : array, None, optional
    The unceratinty on the dependent variable
    (For a spectrum example = the flux uncertainty)
R : array, optional
    The spectral resolution R=x/dx for creating a new,
    logarithmically uniform grid that starts at the first
    value of x.
xlim : list, array, optional
    A two-element list indicating the min and max values of
    x for the new logarithmically spaced grid. If None,
    these limits will be created from the data themselves
weighting : str, optional
    How should we weight values when averaging
    them together into one larger bin?
    <code>weighting = 'inversevariance'</code>
        weights = 1/unc**2
     <code>weighting = {literally anything else}</code>
        uniform weights
    This will have no impact if <code>unc == None</code>, or for any
    new bins that effectively overlap less than one original
    unbinned point.
drop_nans : bool, optional
    Should we skip any bins turn out to be nans?
    This most often happens when bins are empty.</p>
<h4 id="chromatic.tools.resampling.bintoR--returns">Returns<a class="headerlink" href="#chromatic.tools.resampling.bintoR--returns" title="Permanent link">#</a></h4>
<p>result : dict
    A dictionary containing at least...
        <code>x</code> = the center of the output grid
        <code>y</code> = the resampled value on the output grid
        <code>x_edge_lower</code> = the lower edges of the output grid
        <code>x_edge_upper</code> = the upper edges of the output grid
    ...and possibly also
        <code>uncertainty</code> = the calculated uncertainty per bin</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/tools/resampling.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">bintoR</span><span class="p">(</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">unc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">R</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">weighting</span><span class="o">=</span><span class="s2">&quot;inversevariance&quot;</span><span class="p">,</span> <span class="n">drop_nans</span><span class="o">=</span><span class="kc">True</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Bin any x and y array onto a logarithmicly uniform grid.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : array</span>
<span class="sd">        The original independent variable.</span>
<span class="sd">        (For a spectrum example = wavelength)</span>
<span class="sd">    y : array</span>
<span class="sd">        The original dependent variable (same size as x).</span>
<span class="sd">        (For a spectrum example = flux)</span>
<span class="sd">    unc : array, None, optional</span>
<span class="sd">        The unceratinty on the dependent variable</span>
<span class="sd">        (For a spectrum example = the flux uncertainty)</span>
<span class="sd">    R : array, optional</span>
<span class="sd">        The spectral resolution R=x/dx for creating a new,</span>
<span class="sd">        logarithmically uniform grid that starts at the first</span>
<span class="sd">        value of x.</span>
<span class="sd">    xlim : list, array, optional</span>
<span class="sd">        A two-element list indicating the min and max values of</span>
<span class="sd">        x for the new logarithmically spaced grid. If None,</span>
<span class="sd">        these limits will be created from the data themselves</span>
<span class="sd">    weighting : str, optional</span>
<span class="sd">        How should we weight values when averaging</span>
<span class="sd">        them together into one larger bin?</span>
<span class="sd">        `weighting = &#39;inversevariance&#39;`</span>
<span class="sd">            weights = 1/unc**2</span>
<span class="sd">         `weighting = {literally anything else}`</span>
<span class="sd">            uniform weights</span>
<span class="sd">        This will have no impact if `unc == None`, or for any</span>
<span class="sd">        new bins that effectively overlap less than one original</span>
<span class="sd">        unbinned point.</span>
<span class="sd">    drop_nans : bool, optional</span>
<span class="sd">        Should we skip any bins turn out to be nans?</span>
<span class="sd">        This most often happens when bins are empty.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    result : dict</span>
<span class="sd">        A dictionary containing at least...</span>
<span class="sd">            `x` = the center of the output grid</span>
<span class="sd">            `y` = the resampled value on the output grid</span>
<span class="sd">            `x_edge_lower` = the lower edges of the output grid</span>
<span class="sd">            `x_edge_upper` = the upper edges of the output grid</span>
<span class="sd">        ...and possibly also</span>
<span class="sd">            `uncertainty` = the calculated uncertainty per bin</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">x_unit</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">unit</span>
        <span class="n">x_without_unit</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">value</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="n">x_unit</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">x_without_unit</span> <span class="o">=</span> <span class="n">x</span>

    <span class="c1"># create a new grid of x at the given resolution</span>
    <span class="n">lnx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">x_without_unit</span><span class="p">)</span>
    <span class="n">dnewlnx</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">R</span>

    <span class="c1"># set the limits of the new xgrid (in log space)</span>
    <span class="k">if</span> <span class="n">xlim</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># use the input grid to set the limits</span>
        <span class="n">lnxbottom</span><span class="p">,</span> <span class="n">lnxtop</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">lnx</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">lnx</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># use the custom xlim to set the limits</span>
        <span class="n">lnxbottom</span><span class="p">,</span> <span class="n">lnxtop</span> <span class="o">=</span> <span class="n">xlim</span>

    <span class="c1"># create a new, log-uniform grid of x values</span>
    <span class="n">newlnx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">lnxbottom</span><span class="p">,</span> <span class="n">lnxtop</span> <span class="o">+</span> <span class="n">dnewlnx</span><span class="p">,</span> <span class="n">dnewlnx</span><span class="p">)</span>

    <span class="c1"># now do the binning on a uniform grid of lnx</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">bintogrid</span><span class="p">(</span>
        <span class="n">lnx</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">unc</span><span class="p">,</span> <span class="n">newx</span><span class="o">=</span><span class="n">newlnx</span><span class="p">,</span> <span class="n">weighting</span><span class="o">=</span><span class="n">weighting</span><span class="p">,</span> <span class="n">drop_nans</span><span class="o">=</span><span class="n">drop_nans</span>
    <span class="p">)</span>

    <span class="c1"># convert back from log to real values</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;x_edge_lower&quot;</span><span class="p">,</span> <span class="s2">&quot;x_edge_upper&quot;</span><span class="p">]:</span>
        <span class="n">result</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="o">*</span> <span class="n">x_unit</span>

    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.tools.resampling.bintogrid" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">bintogrid</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">unc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">newx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">newx_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">nx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">weighting</span><span class="o">=</span><span class="s1">&#39;inversevariance&#39;</span><span class="p">,</span> <span class="n">drop_nans</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">x_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">visualize</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#chromatic.tools.resampling.bintogrid" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Bin any x and y array onto a linearly uniform grid.</p>
<h4 id="chromatic.tools.resampling.bintogrid--parameters">Parameters<a class="headerlink" href="#chromatic.tools.resampling.bintogrid--parameters" title="Permanent link">#</a></h4>
<p>x : array
    The original independent variable.
    (For a spectrum example = wavelength)
y : array
    The original dependent variable (same size as x).
    (For a spectrum example = flux)
unc : array, None
    The unceratinty on the dependent variable
    (For a spectrum example = the flux uncertainty)
nx : array
    The number of bins from the original grid to
    bin together into the new one.
dx : array
    The fixed spacing for creating a new, linearly uniform
    grid that start at the first value of x. This will
    be ignored if <code>newx</code> != None.
newx : array
    A new custom grid onto which we should bin.
newx_edges : array
    The edges of the new grid of bins for the independent
    variable, onto which you want to resample the y
    values. The left and right edges of the bins will be,
    respectively, <code>newx_edges[:-1]</code> and <code>newx_edges[1:]</code>,
    so the size of the output array will be
    <code>len(newx_edges) - 1</code>
weighting : str
    How should we weight values when averaging
    them together into one larger bin?
    <code>weighting = 'inversevariance'</code>
        weights = 1/unc**2
     <code>weighting = {literally anything else}</code>
        uniform weights
    This will have no impact if <code>unc == None</code>, or for any
    new bins that effectively overlap less than one original
    unbinned point.
drop_nans : bool
    Should we skip any bins turn out to be nans?
    This most often happens when bins are empty.
x_edges : array
    The edges of the original independent variable bins.
    The left and right edges of the bins are interpreted
    to be <code>x_edges[:-1]</code> and <code>x_edges[1:]</code>,
    respectively, so the associated <code>y</code> should have exactly
    1 fewer element than <code>x_edges</code>. This provides finer
    control over the size of each bin in the input than
    simply supplying <code>x</code>(still a little experimental)</p>
<h4 id="chromatic.tools.resampling.bintogrid--returns">Returns<a class="headerlink" href="#chromatic.tools.resampling.bintogrid--returns" title="Permanent link">#</a></h4>
<p>result : dict
    A dictionary containing at least...
        <code>x</code> = the center of the output grid
        <code>y</code> = the resampled value on the output grid
        <code>x_edge_lower</code> = the lower edges of the output grid
        <code>x_edge_upper</code> = the upper edges of the output grid
    ...and possibly also
        <code>uncertainty</code> = the calculated uncertainty per bin</p>
<p>The order of precendence for setting the new grid is
[<code>newx_edges</code>, <code>newx</code>, <code>dx</code>, <code>nx</code>]
The first will be used, and others will be ignored.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/tools/resampling.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">bintogrid</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">unc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">newx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">newx_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">dx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">nx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">weighting</span><span class="o">=</span><span class="s2">&quot;inversevariance&quot;</span><span class="p">,</span>
    <span class="n">drop_nans</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">x_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">visualize</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Bin any x and y array onto a linearly uniform grid.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : array</span>
<span class="sd">        The original independent variable.</span>
<span class="sd">        (For a spectrum example = wavelength)</span>
<span class="sd">    y : array</span>
<span class="sd">        The original dependent variable (same size as x).</span>
<span class="sd">        (For a spectrum example = flux)</span>
<span class="sd">    unc : array, None</span>
<span class="sd">        The unceratinty on the dependent variable</span>
<span class="sd">        (For a spectrum example = the flux uncertainty)</span>
<span class="sd">    nx : array</span>
<span class="sd">        The number of bins from the original grid to</span>
<span class="sd">        bin together into the new one.</span>
<span class="sd">    dx : array</span>
<span class="sd">        The fixed spacing for creating a new, linearly uniform</span>
<span class="sd">        grid that start at the first value of x. This will</span>
<span class="sd">        be ignored if `newx` != None.</span>
<span class="sd">    newx : array</span>
<span class="sd">        A new custom grid onto which we should bin.</span>
<span class="sd">    newx_edges : array</span>
<span class="sd">        The edges of the new grid of bins for the independent</span>
<span class="sd">        variable, onto which you want to resample the y</span>
<span class="sd">        values. The left and right edges of the bins will be,</span>
<span class="sd">        respectively, `newx_edges[:-1]` and `newx_edges[1:]`,</span>
<span class="sd">        so the size of the output array will be</span>
<span class="sd">        `len(newx_edges) - 1`</span>
<span class="sd">    weighting : str</span>
<span class="sd">        How should we weight values when averaging</span>
<span class="sd">        them together into one larger bin?</span>
<span class="sd">        `weighting = &#39;inversevariance&#39;`</span>
<span class="sd">            weights = 1/unc**2</span>
<span class="sd">         `weighting = {literally anything else}`</span>
<span class="sd">            uniform weights</span>
<span class="sd">        This will have no impact if `unc == None`, or for any</span>
<span class="sd">        new bins that effectively overlap less than one original</span>
<span class="sd">        unbinned point.</span>
<span class="sd">    drop_nans : bool</span>
<span class="sd">        Should we skip any bins turn out to be nans?</span>
<span class="sd">        This most often happens when bins are empty.</span>
<span class="sd">    x_edges : array</span>
<span class="sd">        The edges of the original independent variable bins.</span>
<span class="sd">        The left and right edges of the bins are interpreted</span>
<span class="sd">        to be `x_edges[:-1]` and `x_edges[1:]`,</span>
<span class="sd">        respectively, so the associated `y` should have exactly</span>
<span class="sd">        1 fewer element than `x_edges`. This provides finer</span>
<span class="sd">        control over the size of each bin in the input than</span>
<span class="sd">        simply supplying `x`(still a little experimental)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    result : dict</span>
<span class="sd">        A dictionary containing at least...</span>
<span class="sd">            `x` = the center of the output grid</span>
<span class="sd">            `y` = the resampled value on the output grid</span>
<span class="sd">            `x_edge_lower` = the lower edges of the output grid</span>
<span class="sd">            `x_edge_upper` = the upper edges of the output grid</span>
<span class="sd">        ...and possibly also</span>
<span class="sd">            `uncertainty` = the calculated uncertainty per bin</span>


<span class="sd">    The order of precendence for setting the new grid is</span>
<span class="sd">    [`newx_edges`, `newx`, `dx`, `nx`]</span>
<span class="sd">    The first will be used, and others will be ignored.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># check that an OK set of inputs has been supplied</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">x_edges</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;🌈 Both `x` and `x_edges` were supplied to `bintogrid`. Confusing!&quot;&quot;&quot;</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">x_edges</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;🌈 At least one of `x` or `x_edges` must be supplied to `bintogrid`.&quot;&quot;&quot;</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="n">y</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;🌈 `y` must be supplied to `bintogrid`.&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="c1"># make sure the edges and the centers are set</span>
    <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">x_left</span><span class="p">,</span> <span class="n">x_right</span> <span class="o">=</span> <span class="n">edges_to_leftright</span><span class="p">(</span><span class="n">x_edges</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">left</span> <span class="o">+</span> <span class="n">right</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">x_left</span><span class="p">,</span> <span class="n">x_right</span> <span class="o">=</span> <span class="n">calculate_bin_leftright</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">x_edges</span> <span class="o">=</span> <span class="n">leftright_to_edges</span><span class="p">(</span><span class="n">x_left</span><span class="p">,</span> <span class="n">x_right</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">x_unit</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">unit</span>
        <span class="n">x_without_unit</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">value</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="n">x_unit</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">x_without_unit</span> <span class="o">=</span> <span class="n">x</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">y_unit</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">unit</span>
        <span class="n">y_without_unit</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">value</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="n">y_unit</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">y_without_unit</span> <span class="o">=</span> <span class="n">y</span>

    <span class="c1"># warn if multiple inputs are provided</span>
    <span class="n">number_of_grid_options</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span><span class="n">z</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="p">[</span><span class="n">newx_edges</span><span class="p">,</span> <span class="n">newx</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">nx</span><span class="p">]])</span>
    <span class="k">if</span> <span class="n">number_of_grid_options</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">cheerfully_suggest</span><span class="p">(</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;More than one output grid sent to `bintogrid`.</span>
<span class="sd">                         The one being used is the first to appear in</span>
<span class="sd">                         [`newx_edges`, `newx`, `dx`, `nx`]</span>
<span class="sd">                         but you might want to choose more carefully.&quot;&quot;&quot;</span>
        <span class="p">)</span>

    <span class="c1"># define inputs based on the following order</span>
    <span class="k">if</span> <span class="n">newx_edges</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># define grid by its edges (and define others from there)</span>
        <span class="n">newx_edges_without_unit</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">newx_edges</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">x_unit</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
        <span class="n">dx_without_unit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">newx_edges_without_unit</span><span class="p">)</span>
        <span class="n">newx_without_unit</span> <span class="o">=</span> <span class="n">newx_edges_without_unit</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">dx_without_unit</span>
        <span class="n">newx_left_without_unit</span> <span class="o">=</span> <span class="n">newx_edges_without_unit</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">newx_right_without_unit</span> <span class="o">=</span> <span class="n">newx_edges_without_unit</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

        <span class="c1"># make sure the final output grid is defined</span>
        <span class="n">final_newx</span><span class="p">,</span> <span class="n">final_newx_left</span><span class="p">,</span> <span class="n">final_newx_right</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">newx_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
            <span class="n">newx_left_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
            <span class="n">newx_right_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="n">newx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># define grid by its centers (and define others from there)</span>
        <span class="n">newx_without_unit</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">newx</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">x_unit</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
        <span class="n">newx_left_without_unit</span><span class="p">,</span> <span class="n">newx_right_without_unit</span> <span class="o">=</span> <span class="n">calculate_bin_leftright</span><span class="p">(</span>
            <span class="n">newx_without_unit</span>
        <span class="p">)</span>
        <span class="n">newx_edges_without_unit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span>
            <span class="p">[</span><span class="n">newx_left_without_unit</span><span class="p">,</span> <span class="n">newx_right_without_unit</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
        <span class="p">)</span>
        <span class="n">dx_without_unit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">newx_edges_without_unit</span><span class="p">)</span>

        <span class="c1"># make sure the final output grid is defined</span>
        <span class="n">final_newx</span><span class="p">,</span> <span class="n">final_newx_left</span><span class="p">,</span> <span class="n">final_newx_right</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">newx_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
            <span class="n">newx_left_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
            <span class="n">newx_right_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="n">dx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># define grid by a bin width (and define others from there)</span>
        <span class="n">dx_without_unit</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">dx</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">x_unit</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
        <span class="n">newx_without_unit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">x_without_unit</span><span class="p">),</span>
            <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">x_without_unit</span><span class="p">)</span> <span class="o">+</span> <span class="n">dx_without_unit</span><span class="p">,</span>
            <span class="n">dx_without_unit</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">newx_left_without_unit</span><span class="p">,</span> <span class="n">newx_right_without_unit</span> <span class="o">=</span> <span class="n">calculate_bin_leftright</span><span class="p">(</span>
            <span class="n">newx_without_unit</span>
        <span class="p">)</span>
        <span class="n">newx_edges_without_unit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span>
            <span class="p">[</span><span class="n">newx_left_without_unit</span><span class="p">,</span> <span class="n">newx_right_without_unit</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
        <span class="p">)</span>

        <span class="c1"># make sure the final output grid is defined</span>
        <span class="n">final_newx</span><span class="p">,</span> <span class="n">final_newx_left</span><span class="p">,</span> <span class="n">final_newx_right</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">newx_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
            <span class="n">newx_left_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
            <span class="n">newx_right_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">elif</span> <span class="n">nx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># keep track of the original input x values</span>
        <span class="n">original_x_without_unit</span> <span class="o">=</span> <span class="n">x_without_unit</span>

        <span class="c1"># redefine the input x to indices, to do interpolation in index space</span>
        <span class="n">x_without_unit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">x_without_unit</span><span class="p">))</span>

        <span class="c1"># define a grid of edges that will enclose the right number of indices</span>
        <span class="n">x_left_i</span><span class="p">,</span> <span class="n">x_right_i</span> <span class="o">=</span> <span class="n">calculate_bin_leftright</span><span class="p">(</span><span class="n">x_without_unit</span><span class="p">)</span>
        <span class="n">newx_edges_without_unit</span> <span class="o">=</span> <span class="n">leftright_to_edges</span><span class="p">(</span><span class="n">x_left_i</span><span class="p">,</span> <span class="n">x_right_i</span><span class="p">)[::</span><span class="n">nx</span><span class="p">]</span>
        <span class="n">newx_without_unit</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span>
            <span class="n">newx_edges_without_unit</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">+</span> <span class="n">newx_edges_without_unit</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="p">)</span>

        <span class="c1"># calculate the actual x values corresponding to the bins</span>
        <span class="n">original_edges</span> <span class="o">=</span> <span class="n">leftright_to_edges</span><span class="p">(</span>
            <span class="o">*</span><span class="n">calculate_bin_leftright</span><span class="p">(</span><span class="n">original_x_without_unit</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">final_edges</span> <span class="o">=</span> <span class="n">original_edges</span><span class="p">[::</span><span class="n">nx</span><span class="p">]</span> <span class="o">*</span> <span class="n">x_unit</span>
        <span class="n">final_newx_left</span><span class="p">,</span> <span class="n">final_newx_right</span> <span class="o">=</span> <span class="n">edges_to_leftright</span><span class="p">(</span><span class="n">final_edges</span><span class="p">)</span>
        <span class="n">final_newx</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">final_newx_left</span> <span class="o">+</span> <span class="n">final_newx_right</span><span class="p">)</span>
        <span class="n">dx_without_unit</span> <span class="o">=</span> <span class="p">(</span><span class="n">final_newx_right</span> <span class="o">-</span> <span class="n">final_newx_left</span><span class="p">)</span> <span class="o">/</span> <span class="n">x_unit</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;No output grid sent to `bintogrid`.</span>
<span class="sd">                              Please choose one of the following:</span>
<span class="sd">                              [`newx_edges`, `newx`, `dx`, `nx`]&quot;&quot;&quot;</span>
        <span class="p">)</span>

    <span class="c1"># don&#39;t complain about zero-divisions in here (to allow infinite uncertainties)</span>
    <span class="k">with</span> <span class="n">np</span><span class="o">.</span><span class="n">errstate</span><span class="p">(</span><span class="n">divide</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">invalid</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">):</span>

        <span class="c1"># calculate weight integrals for the bin array</span>
        <span class="n">ok</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">y_without_unit</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span>

        <span class="c1"># resample the sums onto that new grid</span>
        <span class="k">if</span> <span class="n">unc</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">x_without_unit</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">weighting</span> <span class="o">==</span> <span class="s2">&quot;inversevariance&quot;</span><span class="p">:</span>
                <span class="n">weights</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">unc</span><span class="o">**</span><span class="mi">2</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">x_without_unit</span><span class="p">)</span>

            <span class="c1"># ignore infinite weights (= 0 uncertainties)</span>
            <span class="n">ok</span> <span class="o">*=</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">ok</span><span class="p">):</span>
            <span class="n">numerator</span> <span class="o">=</span> <span class="n">resample_while_conserving_flux</span><span class="p">(</span>
                <span class="n">xin</span><span class="o">=</span><span class="n">x_without_unit</span><span class="p">[</span><span class="n">ok</span><span class="p">],</span>
                <span class="n">yin</span><span class="o">=</span><span class="p">(</span><span class="n">y_without_unit</span> <span class="o">*</span> <span class="n">weights</span><span class="p">)[</span><span class="n">ok</span><span class="p">],</span>
                <span class="n">xout_edges</span><span class="o">=</span><span class="n">newx_edges_without_unit</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">denominator</span> <span class="o">=</span> <span class="n">resample_while_conserving_flux</span><span class="p">(</span>
                <span class="n">xin</span><span class="o">=</span><span class="n">x_without_unit</span><span class="p">[</span><span class="n">ok</span><span class="p">],</span>
                <span class="n">yin</span><span class="o">=</span><span class="n">weights</span><span class="p">[</span><span class="n">ok</span><span class="p">],</span>
                <span class="n">xout_edges</span><span class="o">=</span><span class="n">newx_edges_without_unit</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="c1"># the binned weighted means on the new grid</span>
            <span class="n">newy</span> <span class="o">=</span> <span class="n">numerator</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">denominator</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span>

            <span class="c1"># the standard error on the means, for those bins</span>
            <span class="n">newunc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">denominator</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">])</span>

            <span class="c1"># keep track of the number of original bins going into each new bin</span>
            <span class="n">number_of_original_bins_per_new_bin</span> <span class="o">=</span> <span class="n">resample_while_conserving_flux</span><span class="p">(</span>
                <span class="n">xin</span><span class="o">=</span><span class="n">x_without_unit</span><span class="p">[</span><span class="n">ok</span><span class="p">],</span>
                <span class="n">yin</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">y_without_unit</span><span class="p">)[</span><span class="n">ok</span><span class="p">],</span>
                <span class="n">xout_edges</span><span class="o">=</span><span class="n">newx_edges_without_unit</span><span class="p">,</span>
            <span class="p">)[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">newy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="o">*</span> <span class="n">newx_without_unit</span>
            <span class="n">newunc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="o">*</span> <span class="n">newx_without_unit</span>
            <span class="n">number_of_original_bins_per_new_bin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">newx_without_unit</span><span class="p">)</span>

    <span class="c1"># remove any empty bins</span>
    <span class="k">if</span> <span class="n">drop_nans</span><span class="p">:</span>
        <span class="n">ok</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">newy</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ok</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">newx_without_unit</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>

    <span class="c1"># if no uncertainties were given, don&#39;t return uncertainties</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># populate the new grid centers + edges + values</span>
    <span class="n">result</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">final_newx</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span>
    <span class="n">result</span><span class="p">[</span><span class="s2">&quot;x_edge_lower&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">final_newx_left</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span>
    <span class="n">result</span><span class="p">[</span><span class="s2">&quot;x_edge_upper&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">final_newx_right</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span>

    <span class="c1"># populate the new grid values</span>
    <span class="n">result</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">newy</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span> <span class="o">*</span> <span class="n">y_unit</span>

    <span class="c1"># populate the new grid value uncertainties</span>
    <span class="k">if</span> <span class="n">unc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">result</span><span class="p">[</span><span class="s2">&quot;uncertainty&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">newunc</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span> <span class="o">*</span> <span class="n">y_unit</span>

    <span class="c1"># store how many of the original pixels made it into this new one</span>
    <span class="n">result</span><span class="p">[</span><span class="s2">&quot;N_unbinned/N_binned&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">number_of_original_bins_per_new_bin</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">visualize</span><span class="p">:</span>
        <span class="n">fi</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span>
            <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">gridspec_kw</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">height_ratios</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">])</span>
        <span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">plot_as_boxes</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">xleft</span><span class="o">=</span><span class="n">x_left</span><span class="p">,</span> <span class="n">xright</span><span class="o">=</span><span class="n">x_right</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;silver&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">ekw</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">elinewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">unc</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;silver&quot;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">ekw</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">],</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">],</span>
            <span class="n">yerr</span><span class="o">=</span><span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;uncertainty&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
            <span class="n">xerr</span><span class="o">=</span><span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s2">&quot;x_edge_upper&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;x_edge_lower&quot;</span><span class="p">])</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
            <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
            <span class="n">zorder</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
            <span class="o">**</span><span class="n">ekw</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">plot_as_boxes</span><span class="p">(</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">],</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;N_unbinned/N_binned&quot;</span><span class="p">],</span>
            <span class="n">xleft</span><span class="o">=</span><span class="n">result</span><span class="p">[</span><span class="s2">&quot;x_edge_lower&quot;</span><span class="p">],</span>
            <span class="n">xright</span><span class="o">=</span><span class="n">result</span><span class="p">[</span><span class="s2">&quot;x_edge_upper&quot;</span><span class="p">],</span>
        <span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;$N_</span><span class="si">{unbinned}</span><span class="s2">/N_</span><span class="si">{binned}</span><span class="s2">$&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.tools.resampling.calculate_bin_leftright" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">calculate_bin_leftright</span><span class="p">(</span><span class="n">x</span><span class="p">)</span></code>

<a href="#chromatic.tools.resampling.calculate_bin_leftright" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>If x is an array of bin centers, calculate the bin edges.
(assumes outermost bins are same size as their neighbors)</p>
<h4 id="chromatic.tools.resampling.calculate_bin_leftright--parameters">Parameters<a class="headerlink" href="#chromatic.tools.resampling.calculate_bin_leftright--parameters" title="Permanent link">#</a></h4>
<p>x : array
    The array of bin centers.</p>
<h4 id="chromatic.tools.resampling.calculate_bin_leftright--returns">Returns<a class="headerlink" href="#chromatic.tools.resampling.calculate_bin_leftright--returns" title="Permanent link">#</a></h4>
<p>l : array
    The left edges of the bins.
r : array
    The right edges of the bins.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/tools/resampling.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">calculate_bin_leftright</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    If x is an array of bin centers, calculate the bin edges.</span>
<span class="sd">    (assumes outermost bins are same size as their neighbors)</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : array</span>
<span class="sd">        The array of bin centers.</span>

<span class="sd">    Returns</span>
<span class="sd">    ----------</span>
<span class="sd">    l : array</span>
<span class="sd">        The left edges of the bins.</span>
<span class="sd">    r : array</span>
<span class="sd">        The right edges of the bins.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># what are bin edges (making a guess for those on the ends)</span>
    <span class="c1"># xbinsize = calculate_bin_widths(x)</span>
    <span class="c1"># left = x - xbinsize / 2.0</span>
    <span class="c1"># right = x + xbinsize / 2.0</span>

    <span class="c1"># weird corner case!</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">left</span><span class="p">,</span> <span class="n">right</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">left</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">right</span><span class="p">])</span>

    <span class="n">inner_edges</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="n">x</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">first_edge</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="n">inner_edges</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">last_edge</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">inner_edges</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

    <span class="n">left</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">first_edge</span><span class="p">,</span> <span class="n">inner_edges</span><span class="p">])</span>
    <span class="n">right</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">inner_edges</span><span class="p">,</span> <span class="n">last_edge</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.tools.resampling.calculate_bin_widths" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">calculate_bin_widths</span><span class="p">(</span><span class="n">x</span><span class="p">)</span></code>

<a href="#chromatic.tools.resampling.calculate_bin_widths" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>If x is an array of bin centers, calculate the bin sizes.
(assumes outermost bins are same size as their neighbors)</p>
<h4 id="chromatic.tools.resampling.calculate_bin_widths--parameters">Parameters<a class="headerlink" href="#chromatic.tools.resampling.calculate_bin_widths--parameters" title="Permanent link">#</a></h4>
<p>x : array
    The array of bin centers.</p>
<h4 id="chromatic.tools.resampling.calculate_bin_widths--returns">Returns<a class="headerlink" href="#chromatic.tools.resampling.calculate_bin_widths--returns" title="Permanent link">#</a></h4>
<p>s : array
    The array of bin sizes (total size, from left to right).</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/tools/resampling.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">calculate_bin_widths</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    If x is an array of bin centers, calculate the bin sizes.</span>
<span class="sd">    (assumes outermost bins are same size as their neighbors)</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : array</span>
<span class="sd">        The array of bin centers.</span>

<span class="sd">    Returns</span>
<span class="sd">    ----------</span>
<span class="sd">    s : array</span>
<span class="sd">        The array of bin sizes (total size, from left to right).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># OLD VERSION</span>
    <span class="c1"># binsize = np.zeros_like(x)</span>
    <span class="c1"># binsize[0:-1] = x[1:] - x[0:-1]</span>
    <span class="c1"># binsize[-1] = binsize[-2]</span>
    <span class="n">left</span><span class="p">,</span> <span class="n">right</span> <span class="o">=</span> <span class="n">calculate_bin_leftright</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">binsize</span> <span class="o">=</span> <span class="n">right</span> <span class="o">-</span> <span class="n">left</span>
    <span class="k">return</span> <span class="n">binsize</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.tools.resampling.edges_to_leftright" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">edges_to_leftright</span><span class="p">(</span><span class="n">edges</span><span class="p">)</span></code>

<a href="#chromatic.tools.resampling.edges_to_leftright" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Convert N+1 contiguous edges to two arrays of N left/right edges.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/tools/resampling.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">edges_to_leftright</span><span class="p">(</span><span class="n">edges</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert N+1 contiguous edges to two arrays of N left/right edges.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">left</span><span class="p">,</span> <span class="n">right</span> <span class="o">=</span> <span class="n">edges</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">edges</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="k">return</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.tools.resampling.leftright_to_edges" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">leftright_to_edges</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">)</span></code>

<a href="#chromatic.tools.resampling.leftright_to_edges" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Convert two arrays of N left/right edges to N+1 continugous edges.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/tools/resampling.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">leftright_to_edges</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert two arrays of N left/right edges to N+1 continugous edges.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">edges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>
    <span class="k">return</span> <span class="n">edges</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.tools.resampling.plot_as_boxes" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">plot_as_boxes</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">xleft</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xright</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

<a href="#chromatic.tools.resampling.plot_as_boxes" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Plot with boxes, to show the left and right edges of a box.
This is useful, or example, to plot flux associated with
pixels, in case you are trying to do a sub-pixel resample
or interpolation or shift.</p>
<h4 id="chromatic.tools.resampling.plot_as_boxes--parameters">Parameters<a class="headerlink" href="#chromatic.tools.resampling.plot_as_boxes--parameters" title="Permanent link">#</a></h4>
<p>x : array
    The original independent variable.
y : array
    The original dependent variable (same size as x).
**kwargs : dict
    All additional keywords will be passed to plt.plot</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/tools/resampling.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">plot_as_boxes</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">xleft</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xright</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot with boxes, to show the left and right edges of a box.</span>
<span class="sd">    This is useful, or example, to plot flux associated with</span>
<span class="sd">    pixels, in case you are trying to do a sub-pixel resample</span>
<span class="sd">    or interpolation or shift.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : array</span>
<span class="sd">        The original independent variable.</span>
<span class="sd">    y : array</span>
<span class="sd">        The original dependent variable (same size as x).</span>
<span class="sd">    **kwargs : dict</span>
<span class="sd">        All additional keywords will be passed to plt.plot</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># what are bin edges (making a guess for those on the ends)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">xleft</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">xright</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
        <span class="n">xleft</span><span class="p">,</span> <span class="n">xright</span> <span class="o">=</span> <span class="n">calculate_bin_leftright</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

    <span class="c1"># create a array doubling up the y values and interleaving the edges</span>
    <span class="n">plot_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">xleft</span><span class="p">,</span> <span class="n">xright</span><span class="p">))</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,),</span> <span class="n">order</span><span class="o">=</span><span class="s2">&quot;F&quot;</span><span class="p">)</span>
    <span class="n">plot_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">y</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,),</span> <span class="n">order</span><span class="o">=</span><span class="s2">&quot;F&quot;</span><span class="p">)</span>

    <span class="c1"># plot those constructed arrays</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">plot_x</span><span class="p">,</span> <span class="n">plot_y</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.tools.resampling.resample_while_conserving_flux" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">resample_while_conserving_flux</span><span class="p">(</span><span class="n">xin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">yin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xout</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xin_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xout_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">replace_nans</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">visualize</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">pause</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#chromatic.tools.resampling.resample_while_conserving_flux" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Starting from some initial x and y, resample onto a
different grid (either higher or lower resolution),
while conserving total flux.</p>
<p>When including the entire range of <code>xin</code>,
<code>sum(yout) == sum(yin)</code> should be true.</p>
<p>When including only part of the range of <code>xin</code>,
the integral between any two points should be conserved.</p>
<h4 id="chromatic.tools.resampling.resample_while_conserving_flux--parameters">Parameters<a class="headerlink" href="#chromatic.tools.resampling.resample_while_conserving_flux--parameters" title="Permanent link">#</a></h4>
<p>xin : array
    The original independent variable.
yin : array
    The original dependent variable (same size as x).
xout : array
    The new grid of independent variables onto which
    you want to resample the y values. Refers to the
    center of each bin (use <code>xout_edges</code> for finer
    control over the exact edges of the bins)
xin_edges : array
    The edges of the original independent variable bins.
    The left and right edges of the bins are interpreted
    to be <code>xin_edges[:-1]</code> and <code>xin_edges[1:]</code>,
    respectively, so the associated <code>yin</code> should have exactly
    1 fewer element than <code>xin_edges</code>. This provides finer
    control over the size of each bin in the input than
    simply supplying <code>xin</code>(still a little experimental)
    They should probably be sorted?
xout_edges : array
    The edges of the new grid of bins for the independent
    variable, onto which you want to resample the y
    values. The left and right edges of the bins will be,
    respectively, <code>xout_edges[:-1]</code> and <code>xout_edges[1:]</code>,
    so the size of the output array will be
    <code>len(xout_edges) - 1</code>
replace_nans : float, str
    Replace nan values with this value.
    <code>replace_nans = 0</code>
        will add no flux where nans are
    <code>replace_nans = nan</code>
        will ensure you get nans returned everywhere
        if you try to resample over any nan
    <code>replace_nans = 'interpolate'</code>
        will try to replace nans by linearly interpolating
        from nearby values (not yet implemented)
visualize : bool
    Should we make a plot showing whether it worked?
pause : bool
    Should we pause to wait for a key press?</p>
<h4 id="chromatic.tools.resampling.resample_while_conserving_flux--returns">Returns<a class="headerlink" href="#chromatic.tools.resampling.resample_while_conserving_flux--returns" title="Permanent link">#</a></h4>
<p>result : dict
    A dictionary containing...
        <code>x</code> = the center of the output grid
        <code>y</code> = the resampled value on the output grid
        <code>edges</code> = the edges of the output grid, which will
            have one more element than x or y</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/tools/resampling.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">resample_while_conserving_flux</span><span class="p">(</span>
    <span class="n">xin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">yin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">xout</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">xin_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">xout_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">replace_nans</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
    <span class="n">visualize</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">pause</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Starting from some initial x and y, resample onto a</span>
<span class="sd">    different grid (either higher or lower resolution),</span>
<span class="sd">    while conserving total flux.</span>

<span class="sd">    When including the entire range of `xin`,</span>
<span class="sd">    `sum(yout) == sum(yin)` should be true.</span>

<span class="sd">    When including only part of the range of `xin`,</span>
<span class="sd">    the integral between any two points should be conserved.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    xin : array</span>
<span class="sd">        The original independent variable.</span>
<span class="sd">    yin : array</span>
<span class="sd">        The original dependent variable (same size as x).</span>
<span class="sd">    xout : array</span>
<span class="sd">        The new grid of independent variables onto which</span>
<span class="sd">        you want to resample the y values. Refers to the</span>
<span class="sd">        center of each bin (use `xout_edges` for finer</span>
<span class="sd">        control over the exact edges of the bins)</span>
<span class="sd">    xin_edges : array</span>
<span class="sd">        The edges of the original independent variable bins.</span>
<span class="sd">        The left and right edges of the bins are interpreted</span>
<span class="sd">        to be `xin_edges[:-1]` and `xin_edges[1:]`,</span>
<span class="sd">        respectively, so the associated `yin` should have exactly</span>
<span class="sd">        1 fewer element than `xin_edges`. This provides finer</span>
<span class="sd">        control over the size of each bin in the input than</span>
<span class="sd">        simply supplying `xin`(still a little experimental)</span>
<span class="sd">        They should probably be sorted?</span>
<span class="sd">    xout_edges : array</span>
<span class="sd">        The edges of the new grid of bins for the independent</span>
<span class="sd">        variable, onto which you want to resample the y</span>
<span class="sd">        values. The left and right edges of the bins will be,</span>
<span class="sd">        respectively, `xout_edges[:-1]` and `xout_edges[1:]`,</span>
<span class="sd">        so the size of the output array will be</span>
<span class="sd">        `len(xout_edges) - 1`</span>
<span class="sd">    replace_nans : float, str</span>
<span class="sd">        Replace nan values with this value.</span>
<span class="sd">        `replace_nans = 0`</span>
<span class="sd">            will add no flux where nans are</span>
<span class="sd">        `replace_nans = nan`</span>
<span class="sd">            will ensure you get nans returned everywhere</span>
<span class="sd">            if you try to resample over any nan</span>
<span class="sd">        `replace_nans = &#39;interpolate&#39;`</span>
<span class="sd">            will try to replace nans by linearly interpolating</span>
<span class="sd">            from nearby values (not yet implemented)</span>
<span class="sd">    visualize : bool</span>
<span class="sd">        Should we make a plot showing whether it worked?</span>
<span class="sd">    pause : bool</span>
<span class="sd">        Should we pause to wait for a key press?</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    result : dict</span>
<span class="sd">        A dictionary containing...</span>
<span class="sd">            `x` = the center of the output grid</span>
<span class="sd">            `y` = the resampled value on the output grid</span>
<span class="sd">            `edges` = the edges of the output grid, which will</span>
<span class="sd">                have one more element than x or y</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># make sure there are some reasonable input options</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">xin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">xin_edges</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">yin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">xout</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">xout_edges</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>

    <span class="c1"># set up the bins, to calculate cumulative distribution of y</span>
    <span class="k">if</span> <span class="n">xin_edges</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># make sure the sizes match up</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">xin</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">yin</span><span class="p">)</span>
        <span class="c1"># sort to make sure x is strictly increasing</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">xin</span><span class="p">)</span>
        <span class="n">xin_sorted</span> <span class="o">=</span> <span class="n">xin</span><span class="p">[</span><span class="n">s</span><span class="p">]</span>
        <span class="n">yin_sorted</span> <span class="o">=</span> <span class="n">yin</span><span class="p">[</span><span class="n">s</span><span class="p">]</span>
        <span class="c1"># estimate some bin edges (might fail for non-uniform grids)</span>
        <span class="n">xin_left</span><span class="p">,</span> <span class="n">xin_right</span> <span class="o">=</span> <span class="n">calculate_bin_leftright</span><span class="p">(</span><span class="n">xin_sorted</span><span class="p">)</span>
        <span class="c1"># define an array of edges</span>
        <span class="n">xin_edges</span> <span class="o">=</span> <span class="n">leftright_to_edges</span><span class="p">(</span><span class="n">xin_left</span><span class="p">,</span> <span class="n">xin_right</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># make sure the sizes match up</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">xin_edges</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">yin</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="c1"># sort to make sure x is strictly increasing</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">xin_edges</span><span class="p">)</span>
        <span class="n">xin_left</span><span class="p">,</span> <span class="n">xin_right</span> <span class="o">=</span> <span class="n">edges_to_leftright</span><span class="p">(</span><span class="n">xin_edges</span><span class="p">[</span><span class="n">s</span><span class="p">])</span>
        <span class="n">xin_sorted</span> <span class="o">=</span> <span class="p">(</span><span class="n">xin_left</span> <span class="o">+</span> <span class="n">xin_right</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">yin_sorted</span> <span class="o">=</span> <span class="n">yin</span><span class="p">[</span><span class="n">s</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>

    <span class="c1"># the first element should be the left edge of the first pixel</span>
    <span class="c1"># last element will be right edge of last pixel</span>
    <span class="n">xin_for_cdf</span> <span class="o">=</span> <span class="n">xin_edges</span>

    <span class="c1"># to the left of the first pixel, assume flux is zero</span>
    <span class="n">yin_for_cdf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">yin_sorted</span><span class="p">])</span>

    <span class="c1"># correct for any non-finite values</span>
    <span class="n">bad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">yin_for_cdf</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">replace_nans</span> <span class="o">==</span> <span class="s2">&quot;interpolate&quot;</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
            <span class="s2">&quot;The `replace_nans=&#39;interpolate&#39;`` option doens&#39;t exist yet!&quot;</span>
        <span class="p">)</span>
    <span class="n">yin_for_cdf</span><span class="p">[</span><span class="n">bad</span><span class="p">]</span> <span class="o">=</span> <span class="n">replace_nans</span>

    <span class="c1"># calculate the CDF of the flux (at pixel edge locations)</span>
    <span class="n">cdfin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">yin_for_cdf</span><span class="p">)</span>

    <span class="c1"># create an interpolator for that CDF</span>
    <span class="n">cdfinterpolator</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span>
        <span class="n">xin_for_cdf</span><span class="p">,</span>
        <span class="n">cdfin</span><span class="p">,</span>
        <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span>
        <span class="n">bounds_error</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">fill_value</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">yin</span><span class="p">)),</span>
    <span class="p">)</span>

    <span class="c1"># calculate bin edges (of size len(xout)+1)</span>
    <span class="k">if</span> <span class="n">xout_edges</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">xout_left</span><span class="p">,</span> <span class="n">xout_right</span> <span class="o">=</span> <span class="n">calculate_bin_leftright</span><span class="p">(</span><span class="n">xout</span><span class="p">)</span>
        <span class="n">xout_edges</span> <span class="o">=</span> <span class="n">leftright_to_edges</span><span class="p">(</span><span class="n">xout_left</span><span class="p">,</span> <span class="n">xout_right</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">xout_left</span><span class="p">,</span> <span class="n">xout_right</span> <span class="o">=</span> <span class="n">edges_to_leftright</span><span class="p">(</span><span class="n">xout_edges</span><span class="p">)</span>
        <span class="n">xout</span> <span class="o">=</span> <span class="p">(</span><span class="n">xout_left</span> <span class="o">+</span> <span class="n">xout_right</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>

    <span class="n">xout_for_cdf</span> <span class="o">=</span> <span class="n">leftright_to_edges</span><span class="p">(</span><span class="n">xout_left</span><span class="p">,</span> <span class="n">xout_right</span><span class="p">)</span>

    <span class="c1"># interpolate the CDF onto those bin edges</span>
    <span class="n">cdfout</span> <span class="o">=</span> <span class="n">cdfinterpolator</span><span class="p">(</span><span class="n">xout_for_cdf</span><span class="p">)</span>

    <span class="c1"># take  derivative of the CDF to get flux per resampled bin</span>
    <span class="c1"># (xout is bin center, and yout is the flux in that bin)</span>
    <span class="n">yout</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">cdfout</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">visualize</span><span class="p">:</span>
        <span class="n">fi</span><span class="p">,</span> <span class="p">(</span><span class="n">ax_cdf</span><span class="p">,</span> <span class="n">ax_pdf</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
        <span class="n">inkw</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
            <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span>
            <span class="n">markeredgecolor</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">outkw</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;darkorange&quot;</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span>
            <span class="n">markersize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
            <span class="n">markeredgecolor</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">legkw</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper left&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">xinbinsize</span> <span class="o">=</span> <span class="n">xin_right</span> <span class="o">-</span> <span class="n">xin_left</span>
        <span class="n">xoutbinsize</span> <span class="o">=</span> <span class="n">xout_right</span> <span class="o">-</span> <span class="n">xout_left</span>
        <span class="c1"># plot the PDFs</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="n">ax_pdf</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Flux per (Original) Pixel&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Pixel&quot;</span><span class="p">)</span>
        <span class="c1"># plot the original pixels (in df/dpixel to compare with resampled)</span>
        <span class="n">plot_as_boxes</span><span class="p">(</span>
            <span class="n">xin_sorted</span><span class="p">,</span> <span class="n">yin_sorted</span> <span class="o">/</span> <span class="n">xinbinsize</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Original Pixels&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">inkw</span>
        <span class="p">)</span>

        <span class="c1"># what would a bad interpolation look like?</span>
        <span class="n">interpolate_badly</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span>
            <span class="n">xin_sorted</span><span class="p">,</span>
            <span class="n">yin_sorted</span> <span class="o">/</span> <span class="n">xinbinsize</span><span class="p">,</span>
            <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span>
            <span class="n">bounds_error</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">fill_value</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
            <span class="n">xout</span><span class="p">,</span>
            <span class="n">interpolate_badly</span><span class="p">(</span><span class="n">xout</span><span class="p">),</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;cornflowerblue&quot;</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span>
            <span class="n">markersize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
            <span class="n">markeredgecolor</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Silly Simple Interpolation&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># plot the flux-conserving resampled data (again, in df/d&quot;pixel&quot;)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
            <span class="n">xout</span><span class="p">,</span> <span class="n">yout</span> <span class="o">/</span> <span class="n">xoutbinsize</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Flux-Conserving Interpolation&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">outkw</span>
        <span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="o">**</span><span class="n">legkw</span><span class="p">)</span>

        <span class="c1"># plot the CDFs</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="n">ax_cdf</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Cumulative Flux (from left)&quot;</span><span class="p">)</span>

        <span class="c1"># plot the original CDF</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xin_for_cdf</span><span class="p">,</span> <span class="n">cdfin</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Original Pixels&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">inkw</span><span class="p">)</span>

        <span class="c1"># plot the interpolated CDF</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xout_for_cdf</span><span class="p">,</span> <span class="n">cdfout</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Flux-Conserved Resample&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">outkw</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">pause</span><span class="p">:</span>
            <span class="n">a</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span>
                <span class="s2">&quot;Pausing a moment to check on interpolation; press return to continue.&quot;</span>
            <span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{:&gt;6}</span><span class="s2"> = </span><span class="si">{:.5f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;Actual&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">yin</span><span class="p">)))</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="s2">&quot;</span><span class="si">{:&gt;6}</span><span class="s2"> = </span><span class="si">{:.5f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="s2">&quot;Silly&quot;</span><span class="p">,</span>
                <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">interpolate_badly</span><span class="p">(</span><span class="n">xout</span><span class="p">)</span> <span class="o">*</span> <span class="n">xoutbinsize</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{:&gt;6}</span><span class="s2"> = </span><span class="si">{:.5f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;CDF&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">yout</span><span class="p">)))</span>

    <span class="c1"># return the resampled y-values</span>
    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="n">xout</span><span class="p">,</span> <span class="s2">&quot;x_edge_lower&quot;</span><span class="p">:</span> <span class="n">xout_left</span><span class="p">,</span> <span class="s2">&quot;x_edge_upper&quot;</span><span class="p">:</span> <span class="n">xout_right</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="n">yout</span><span class="p">}</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="chromatic.imports"></a>
    <div class="doc doc-contents first">









  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="chromatic.imports.bintoR" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">bintoR</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">unc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">R</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">weighting</span><span class="o">=</span><span class="s1">&#39;inversevariance&#39;</span><span class="p">,</span> <span class="n">drop_nans</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

<a href="#chromatic.imports.bintoR" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Bin any x and y array onto a logarithmicly uniform grid.</p>
<h4 id="chromatic.imports.bintoR--parameters">Parameters<a class="headerlink" href="#chromatic.imports.bintoR--parameters" title="Permanent link">#</a></h4>
<p>x : array
    The original independent variable.
    (For a spectrum example = wavelength)
y : array
    The original dependent variable (same size as x).
    (For a spectrum example = flux)
unc : array, None, optional
    The unceratinty on the dependent variable
    (For a spectrum example = the flux uncertainty)
R : array, optional
    The spectral resolution R=x/dx for creating a new,
    logarithmically uniform grid that starts at the first
    value of x.
xlim : list, array, optional
    A two-element list indicating the min and max values of
    x for the new logarithmically spaced grid. If None,
    these limits will be created from the data themselves
weighting : str, optional
    How should we weight values when averaging
    them together into one larger bin?
    <code>weighting = 'inversevariance'</code>
        weights = 1/unc**2
     <code>weighting = {literally anything else}</code>
        uniform weights
    This will have no impact if <code>unc == None</code>, or for any
    new bins that effectively overlap less than one original
    unbinned point.
drop_nans : bool, optional
    Should we skip any bins turn out to be nans?
    This most often happens when bins are empty.</p>
<h4 id="chromatic.imports.bintoR--returns">Returns<a class="headerlink" href="#chromatic.imports.bintoR--returns" title="Permanent link">#</a></h4>
<p>result : dict
    A dictionary containing at least...
        <code>x</code> = the center of the output grid
        <code>y</code> = the resampled value on the output grid
        <code>x_edge_lower</code> = the lower edges of the output grid
        <code>x_edge_upper</code> = the upper edges of the output grid
    ...and possibly also
        <code>uncertainty</code> = the calculated uncertainty per bin</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/tools/resampling.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">bintoR</span><span class="p">(</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">unc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">R</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">weighting</span><span class="o">=</span><span class="s2">&quot;inversevariance&quot;</span><span class="p">,</span> <span class="n">drop_nans</span><span class="o">=</span><span class="kc">True</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Bin any x and y array onto a logarithmicly uniform grid.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : array</span>
<span class="sd">        The original independent variable.</span>
<span class="sd">        (For a spectrum example = wavelength)</span>
<span class="sd">    y : array</span>
<span class="sd">        The original dependent variable (same size as x).</span>
<span class="sd">        (For a spectrum example = flux)</span>
<span class="sd">    unc : array, None, optional</span>
<span class="sd">        The unceratinty on the dependent variable</span>
<span class="sd">        (For a spectrum example = the flux uncertainty)</span>
<span class="sd">    R : array, optional</span>
<span class="sd">        The spectral resolution R=x/dx for creating a new,</span>
<span class="sd">        logarithmically uniform grid that starts at the first</span>
<span class="sd">        value of x.</span>
<span class="sd">    xlim : list, array, optional</span>
<span class="sd">        A two-element list indicating the min and max values of</span>
<span class="sd">        x for the new logarithmically spaced grid. If None,</span>
<span class="sd">        these limits will be created from the data themselves</span>
<span class="sd">    weighting : str, optional</span>
<span class="sd">        How should we weight values when averaging</span>
<span class="sd">        them together into one larger bin?</span>
<span class="sd">        `weighting = &#39;inversevariance&#39;`</span>
<span class="sd">            weights = 1/unc**2</span>
<span class="sd">         `weighting = {literally anything else}`</span>
<span class="sd">            uniform weights</span>
<span class="sd">        This will have no impact if `unc == None`, or for any</span>
<span class="sd">        new bins that effectively overlap less than one original</span>
<span class="sd">        unbinned point.</span>
<span class="sd">    drop_nans : bool, optional</span>
<span class="sd">        Should we skip any bins turn out to be nans?</span>
<span class="sd">        This most often happens when bins are empty.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    result : dict</span>
<span class="sd">        A dictionary containing at least...</span>
<span class="sd">            `x` = the center of the output grid</span>
<span class="sd">            `y` = the resampled value on the output grid</span>
<span class="sd">            `x_edge_lower` = the lower edges of the output grid</span>
<span class="sd">            `x_edge_upper` = the upper edges of the output grid</span>
<span class="sd">        ...and possibly also</span>
<span class="sd">            `uncertainty` = the calculated uncertainty per bin</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">x_unit</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">unit</span>
        <span class="n">x_without_unit</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">value</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="n">x_unit</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">x_without_unit</span> <span class="o">=</span> <span class="n">x</span>

    <span class="c1"># create a new grid of x at the given resolution</span>
    <span class="n">lnx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">x_without_unit</span><span class="p">)</span>
    <span class="n">dnewlnx</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">R</span>

    <span class="c1"># set the limits of the new xgrid (in log space)</span>
    <span class="k">if</span> <span class="n">xlim</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># use the input grid to set the limits</span>
        <span class="n">lnxbottom</span><span class="p">,</span> <span class="n">lnxtop</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">lnx</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">lnx</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># use the custom xlim to set the limits</span>
        <span class="n">lnxbottom</span><span class="p">,</span> <span class="n">lnxtop</span> <span class="o">=</span> <span class="n">xlim</span>

    <span class="c1"># create a new, log-uniform grid of x values</span>
    <span class="n">newlnx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">lnxbottom</span><span class="p">,</span> <span class="n">lnxtop</span> <span class="o">+</span> <span class="n">dnewlnx</span><span class="p">,</span> <span class="n">dnewlnx</span><span class="p">)</span>

    <span class="c1"># now do the binning on a uniform grid of lnx</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">bintogrid</span><span class="p">(</span>
        <span class="n">lnx</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">unc</span><span class="p">,</span> <span class="n">newx</span><span class="o">=</span><span class="n">newlnx</span><span class="p">,</span> <span class="n">weighting</span><span class="o">=</span><span class="n">weighting</span><span class="p">,</span> <span class="n">drop_nans</span><span class="o">=</span><span class="n">drop_nans</span>
    <span class="p">)</span>

    <span class="c1"># convert back from log to real values</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;x_edge_lower&quot;</span><span class="p">,</span> <span class="s2">&quot;x_edge_upper&quot;</span><span class="p">]:</span>
        <span class="n">result</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="o">*</span> <span class="n">x_unit</span>

    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.imports.bintogrid" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">bintogrid</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">unc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">newx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">newx_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">nx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">weighting</span><span class="o">=</span><span class="s1">&#39;inversevariance&#39;</span><span class="p">,</span> <span class="n">drop_nans</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">x_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">visualize</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#chromatic.imports.bintogrid" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Bin any x and y array onto a linearly uniform grid.</p>
<h4 id="chromatic.imports.bintogrid--parameters">Parameters<a class="headerlink" href="#chromatic.imports.bintogrid--parameters" title="Permanent link">#</a></h4>
<p>x : array
    The original independent variable.
    (For a spectrum example = wavelength)
y : array
    The original dependent variable (same size as x).
    (For a spectrum example = flux)
unc : array, None
    The unceratinty on the dependent variable
    (For a spectrum example = the flux uncertainty)
nx : array
    The number of bins from the original grid to
    bin together into the new one.
dx : array
    The fixed spacing for creating a new, linearly uniform
    grid that start at the first value of x. This will
    be ignored if <code>newx</code> != None.
newx : array
    A new custom grid onto which we should bin.
newx_edges : array
    The edges of the new grid of bins for the independent
    variable, onto which you want to resample the y
    values. The left and right edges of the bins will be,
    respectively, <code>newx_edges[:-1]</code> and <code>newx_edges[1:]</code>,
    so the size of the output array will be
    <code>len(newx_edges) - 1</code>
weighting : str
    How should we weight values when averaging
    them together into one larger bin?
    <code>weighting = 'inversevariance'</code>
        weights = 1/unc**2
     <code>weighting = {literally anything else}</code>
        uniform weights
    This will have no impact if <code>unc == None</code>, or for any
    new bins that effectively overlap less than one original
    unbinned point.
drop_nans : bool
    Should we skip any bins turn out to be nans?
    This most often happens when bins are empty.
x_edges : array
    The edges of the original independent variable bins.
    The left and right edges of the bins are interpreted
    to be <code>x_edges[:-1]</code> and <code>x_edges[1:]</code>,
    respectively, so the associated <code>y</code> should have exactly
    1 fewer element than <code>x_edges</code>. This provides finer
    control over the size of each bin in the input than
    simply supplying <code>x</code>(still a little experimental)</p>
<h4 id="chromatic.imports.bintogrid--returns">Returns<a class="headerlink" href="#chromatic.imports.bintogrid--returns" title="Permanent link">#</a></h4>
<p>result : dict
    A dictionary containing at least...
        <code>x</code> = the center of the output grid
        <code>y</code> = the resampled value on the output grid
        <code>x_edge_lower</code> = the lower edges of the output grid
        <code>x_edge_upper</code> = the upper edges of the output grid
    ...and possibly also
        <code>uncertainty</code> = the calculated uncertainty per bin</p>
<p>The order of precendence for setting the new grid is
[<code>newx_edges</code>, <code>newx</code>, <code>dx</code>, <code>nx</code>]
The first will be used, and others will be ignored.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/tools/resampling.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">bintogrid</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">unc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">newx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">newx_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">dx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">nx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">weighting</span><span class="o">=</span><span class="s2">&quot;inversevariance&quot;</span><span class="p">,</span>
    <span class="n">drop_nans</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">x_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">visualize</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Bin any x and y array onto a linearly uniform grid.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : array</span>
<span class="sd">        The original independent variable.</span>
<span class="sd">        (For a spectrum example = wavelength)</span>
<span class="sd">    y : array</span>
<span class="sd">        The original dependent variable (same size as x).</span>
<span class="sd">        (For a spectrum example = flux)</span>
<span class="sd">    unc : array, None</span>
<span class="sd">        The unceratinty on the dependent variable</span>
<span class="sd">        (For a spectrum example = the flux uncertainty)</span>
<span class="sd">    nx : array</span>
<span class="sd">        The number of bins from the original grid to</span>
<span class="sd">        bin together into the new one.</span>
<span class="sd">    dx : array</span>
<span class="sd">        The fixed spacing for creating a new, linearly uniform</span>
<span class="sd">        grid that start at the first value of x. This will</span>
<span class="sd">        be ignored if `newx` != None.</span>
<span class="sd">    newx : array</span>
<span class="sd">        A new custom grid onto which we should bin.</span>
<span class="sd">    newx_edges : array</span>
<span class="sd">        The edges of the new grid of bins for the independent</span>
<span class="sd">        variable, onto which you want to resample the y</span>
<span class="sd">        values. The left and right edges of the bins will be,</span>
<span class="sd">        respectively, `newx_edges[:-1]` and `newx_edges[1:]`,</span>
<span class="sd">        so the size of the output array will be</span>
<span class="sd">        `len(newx_edges) - 1`</span>
<span class="sd">    weighting : str</span>
<span class="sd">        How should we weight values when averaging</span>
<span class="sd">        them together into one larger bin?</span>
<span class="sd">        `weighting = &#39;inversevariance&#39;`</span>
<span class="sd">            weights = 1/unc**2</span>
<span class="sd">         `weighting = {literally anything else}`</span>
<span class="sd">            uniform weights</span>
<span class="sd">        This will have no impact if `unc == None`, or for any</span>
<span class="sd">        new bins that effectively overlap less than one original</span>
<span class="sd">        unbinned point.</span>
<span class="sd">    drop_nans : bool</span>
<span class="sd">        Should we skip any bins turn out to be nans?</span>
<span class="sd">        This most often happens when bins are empty.</span>
<span class="sd">    x_edges : array</span>
<span class="sd">        The edges of the original independent variable bins.</span>
<span class="sd">        The left and right edges of the bins are interpreted</span>
<span class="sd">        to be `x_edges[:-1]` and `x_edges[1:]`,</span>
<span class="sd">        respectively, so the associated `y` should have exactly</span>
<span class="sd">        1 fewer element than `x_edges`. This provides finer</span>
<span class="sd">        control over the size of each bin in the input than</span>
<span class="sd">        simply supplying `x`(still a little experimental)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    result : dict</span>
<span class="sd">        A dictionary containing at least...</span>
<span class="sd">            `x` = the center of the output grid</span>
<span class="sd">            `y` = the resampled value on the output grid</span>
<span class="sd">            `x_edge_lower` = the lower edges of the output grid</span>
<span class="sd">            `x_edge_upper` = the upper edges of the output grid</span>
<span class="sd">        ...and possibly also</span>
<span class="sd">            `uncertainty` = the calculated uncertainty per bin</span>


<span class="sd">    The order of precendence for setting the new grid is</span>
<span class="sd">    [`newx_edges`, `newx`, `dx`, `nx`]</span>
<span class="sd">    The first will be used, and others will be ignored.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># check that an OK set of inputs has been supplied</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">x_edges</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;🌈 Both `x` and `x_edges` were supplied to `bintogrid`. Confusing!&quot;&quot;&quot;</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">x_edges</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;🌈 At least one of `x` or `x_edges` must be supplied to `bintogrid`.&quot;&quot;&quot;</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="n">y</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;🌈 `y` must be supplied to `bintogrid`.&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="c1"># make sure the edges and the centers are set</span>
    <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">x_left</span><span class="p">,</span> <span class="n">x_right</span> <span class="o">=</span> <span class="n">edges_to_leftright</span><span class="p">(</span><span class="n">x_edges</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">left</span> <span class="o">+</span> <span class="n">right</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">x_left</span><span class="p">,</span> <span class="n">x_right</span> <span class="o">=</span> <span class="n">calculate_bin_leftright</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">x_edges</span> <span class="o">=</span> <span class="n">leftright_to_edges</span><span class="p">(</span><span class="n">x_left</span><span class="p">,</span> <span class="n">x_right</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">x_unit</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">unit</span>
        <span class="n">x_without_unit</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">value</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="n">x_unit</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">x_without_unit</span> <span class="o">=</span> <span class="n">x</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">y_unit</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">unit</span>
        <span class="n">y_without_unit</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">value</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="n">y_unit</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">y_without_unit</span> <span class="o">=</span> <span class="n">y</span>

    <span class="c1"># warn if multiple inputs are provided</span>
    <span class="n">number_of_grid_options</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span><span class="n">z</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="p">[</span><span class="n">newx_edges</span><span class="p">,</span> <span class="n">newx</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">nx</span><span class="p">]])</span>
    <span class="k">if</span> <span class="n">number_of_grid_options</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">cheerfully_suggest</span><span class="p">(</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;More than one output grid sent to `bintogrid`.</span>
<span class="sd">                         The one being used is the first to appear in</span>
<span class="sd">                         [`newx_edges`, `newx`, `dx`, `nx`]</span>
<span class="sd">                         but you might want to choose more carefully.&quot;&quot;&quot;</span>
        <span class="p">)</span>

    <span class="c1"># define inputs based on the following order</span>
    <span class="k">if</span> <span class="n">newx_edges</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># define grid by its edges (and define others from there)</span>
        <span class="n">newx_edges_without_unit</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">newx_edges</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">x_unit</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
        <span class="n">dx_without_unit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">newx_edges_without_unit</span><span class="p">)</span>
        <span class="n">newx_without_unit</span> <span class="o">=</span> <span class="n">newx_edges_without_unit</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">dx_without_unit</span>
        <span class="n">newx_left_without_unit</span> <span class="o">=</span> <span class="n">newx_edges_without_unit</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">newx_right_without_unit</span> <span class="o">=</span> <span class="n">newx_edges_without_unit</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

        <span class="c1"># make sure the final output grid is defined</span>
        <span class="n">final_newx</span><span class="p">,</span> <span class="n">final_newx_left</span><span class="p">,</span> <span class="n">final_newx_right</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">newx_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
            <span class="n">newx_left_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
            <span class="n">newx_right_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="n">newx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># define grid by its centers (and define others from there)</span>
        <span class="n">newx_without_unit</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">newx</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">x_unit</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
        <span class="n">newx_left_without_unit</span><span class="p">,</span> <span class="n">newx_right_without_unit</span> <span class="o">=</span> <span class="n">calculate_bin_leftright</span><span class="p">(</span>
            <span class="n">newx_without_unit</span>
        <span class="p">)</span>
        <span class="n">newx_edges_without_unit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span>
            <span class="p">[</span><span class="n">newx_left_without_unit</span><span class="p">,</span> <span class="n">newx_right_without_unit</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
        <span class="p">)</span>
        <span class="n">dx_without_unit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">newx_edges_without_unit</span><span class="p">)</span>

        <span class="c1"># make sure the final output grid is defined</span>
        <span class="n">final_newx</span><span class="p">,</span> <span class="n">final_newx_left</span><span class="p">,</span> <span class="n">final_newx_right</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">newx_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
            <span class="n">newx_left_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
            <span class="n">newx_right_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="n">dx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># define grid by a bin width (and define others from there)</span>
        <span class="n">dx_without_unit</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">dx</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">x_unit</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
        <span class="n">newx_without_unit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">x_without_unit</span><span class="p">),</span>
            <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">x_without_unit</span><span class="p">)</span> <span class="o">+</span> <span class="n">dx_without_unit</span><span class="p">,</span>
            <span class="n">dx_without_unit</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">newx_left_without_unit</span><span class="p">,</span> <span class="n">newx_right_without_unit</span> <span class="o">=</span> <span class="n">calculate_bin_leftright</span><span class="p">(</span>
            <span class="n">newx_without_unit</span>
        <span class="p">)</span>
        <span class="n">newx_edges_without_unit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span>
            <span class="p">[</span><span class="n">newx_left_without_unit</span><span class="p">,</span> <span class="n">newx_right_without_unit</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
        <span class="p">)</span>

        <span class="c1"># make sure the final output grid is defined</span>
        <span class="n">final_newx</span><span class="p">,</span> <span class="n">final_newx_left</span><span class="p">,</span> <span class="n">final_newx_right</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">newx_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
            <span class="n">newx_left_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
            <span class="n">newx_right_without_unit</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">elif</span> <span class="n">nx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># keep track of the original input x values</span>
        <span class="n">original_x_without_unit</span> <span class="o">=</span> <span class="n">x_without_unit</span>

        <span class="c1"># redefine the input x to indices, to do interpolation in index space</span>
        <span class="n">x_without_unit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">x_without_unit</span><span class="p">))</span>

        <span class="c1"># define a grid of edges that will enclose the right number of indices</span>
        <span class="n">x_left_i</span><span class="p">,</span> <span class="n">x_right_i</span> <span class="o">=</span> <span class="n">calculate_bin_leftright</span><span class="p">(</span><span class="n">x_without_unit</span><span class="p">)</span>
        <span class="n">newx_edges_without_unit</span> <span class="o">=</span> <span class="n">leftright_to_edges</span><span class="p">(</span><span class="n">x_left_i</span><span class="p">,</span> <span class="n">x_right_i</span><span class="p">)[::</span><span class="n">nx</span><span class="p">]</span>
        <span class="n">newx_without_unit</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span>
            <span class="n">newx_edges_without_unit</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">+</span> <span class="n">newx_edges_without_unit</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="p">)</span>

        <span class="c1"># calculate the actual x values corresponding to the bins</span>
        <span class="n">original_edges</span> <span class="o">=</span> <span class="n">leftright_to_edges</span><span class="p">(</span>
            <span class="o">*</span><span class="n">calculate_bin_leftright</span><span class="p">(</span><span class="n">original_x_without_unit</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">final_edges</span> <span class="o">=</span> <span class="n">original_edges</span><span class="p">[::</span><span class="n">nx</span><span class="p">]</span> <span class="o">*</span> <span class="n">x_unit</span>
        <span class="n">final_newx_left</span><span class="p">,</span> <span class="n">final_newx_right</span> <span class="o">=</span> <span class="n">edges_to_leftright</span><span class="p">(</span><span class="n">final_edges</span><span class="p">)</span>
        <span class="n">final_newx</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">final_newx_left</span> <span class="o">+</span> <span class="n">final_newx_right</span><span class="p">)</span>
        <span class="n">dx_without_unit</span> <span class="o">=</span> <span class="p">(</span><span class="n">final_newx_right</span> <span class="o">-</span> <span class="n">final_newx_left</span><span class="p">)</span> <span class="o">/</span> <span class="n">x_unit</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;No output grid sent to `bintogrid`.</span>
<span class="sd">                              Please choose one of the following:</span>
<span class="sd">                              [`newx_edges`, `newx`, `dx`, `nx`]&quot;&quot;&quot;</span>
        <span class="p">)</span>

    <span class="c1"># don&#39;t complain about zero-divisions in here (to allow infinite uncertainties)</span>
    <span class="k">with</span> <span class="n">np</span><span class="o">.</span><span class="n">errstate</span><span class="p">(</span><span class="n">divide</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">invalid</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">):</span>

        <span class="c1"># calculate weight integrals for the bin array</span>
        <span class="n">ok</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">y_without_unit</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span>

        <span class="c1"># resample the sums onto that new grid</span>
        <span class="k">if</span> <span class="n">unc</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">x_without_unit</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">weighting</span> <span class="o">==</span> <span class="s2">&quot;inversevariance&quot;</span><span class="p">:</span>
                <span class="n">weights</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">unc</span><span class="o">**</span><span class="mi">2</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">x_without_unit</span><span class="p">)</span>

            <span class="c1"># ignore infinite weights (= 0 uncertainties)</span>
            <span class="n">ok</span> <span class="o">*=</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">ok</span><span class="p">):</span>
            <span class="n">numerator</span> <span class="o">=</span> <span class="n">resample_while_conserving_flux</span><span class="p">(</span>
                <span class="n">xin</span><span class="o">=</span><span class="n">x_without_unit</span><span class="p">[</span><span class="n">ok</span><span class="p">],</span>
                <span class="n">yin</span><span class="o">=</span><span class="p">(</span><span class="n">y_without_unit</span> <span class="o">*</span> <span class="n">weights</span><span class="p">)[</span><span class="n">ok</span><span class="p">],</span>
                <span class="n">xout_edges</span><span class="o">=</span><span class="n">newx_edges_without_unit</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">denominator</span> <span class="o">=</span> <span class="n">resample_while_conserving_flux</span><span class="p">(</span>
                <span class="n">xin</span><span class="o">=</span><span class="n">x_without_unit</span><span class="p">[</span><span class="n">ok</span><span class="p">],</span>
                <span class="n">yin</span><span class="o">=</span><span class="n">weights</span><span class="p">[</span><span class="n">ok</span><span class="p">],</span>
                <span class="n">xout_edges</span><span class="o">=</span><span class="n">newx_edges_without_unit</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="c1"># the binned weighted means on the new grid</span>
            <span class="n">newy</span> <span class="o">=</span> <span class="n">numerator</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">denominator</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span>

            <span class="c1"># the standard error on the means, for those bins</span>
            <span class="n">newunc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">denominator</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">])</span>

            <span class="c1"># keep track of the number of original bins going into each new bin</span>
            <span class="n">number_of_original_bins_per_new_bin</span> <span class="o">=</span> <span class="n">resample_while_conserving_flux</span><span class="p">(</span>
                <span class="n">xin</span><span class="o">=</span><span class="n">x_without_unit</span><span class="p">[</span><span class="n">ok</span><span class="p">],</span>
                <span class="n">yin</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">y_without_unit</span><span class="p">)[</span><span class="n">ok</span><span class="p">],</span>
                <span class="n">xout_edges</span><span class="o">=</span><span class="n">newx_edges_without_unit</span><span class="p">,</span>
            <span class="p">)[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">newy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="o">*</span> <span class="n">newx_without_unit</span>
            <span class="n">newunc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="o">*</span> <span class="n">newx_without_unit</span>
            <span class="n">number_of_original_bins_per_new_bin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">newx_without_unit</span><span class="p">)</span>

    <span class="c1"># remove any empty bins</span>
    <span class="k">if</span> <span class="n">drop_nans</span><span class="p">:</span>
        <span class="n">ok</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">newy</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ok</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">newx_without_unit</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>

    <span class="c1"># if no uncertainties were given, don&#39;t return uncertainties</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># populate the new grid centers + edges + values</span>
    <span class="n">result</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">final_newx</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span>
    <span class="n">result</span><span class="p">[</span><span class="s2">&quot;x_edge_lower&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">final_newx_left</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span>
    <span class="n">result</span><span class="p">[</span><span class="s2">&quot;x_edge_upper&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">final_newx_right</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span>

    <span class="c1"># populate the new grid values</span>
    <span class="n">result</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">newy</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span> <span class="o">*</span> <span class="n">y_unit</span>

    <span class="c1"># populate the new grid value uncertainties</span>
    <span class="k">if</span> <span class="n">unc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">result</span><span class="p">[</span><span class="s2">&quot;uncertainty&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">newunc</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span> <span class="o">*</span> <span class="n">y_unit</span>

    <span class="c1"># store how many of the original pixels made it into this new one</span>
    <span class="n">result</span><span class="p">[</span><span class="s2">&quot;N_unbinned/N_binned&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">number_of_original_bins_per_new_bin</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">visualize</span><span class="p">:</span>
        <span class="n">fi</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span>
            <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">gridspec_kw</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">height_ratios</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">])</span>
        <span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">plot_as_boxes</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">xleft</span><span class="o">=</span><span class="n">x_left</span><span class="p">,</span> <span class="n">xright</span><span class="o">=</span><span class="n">x_right</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;silver&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">ekw</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">elinewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">unc</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;silver&quot;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">ekw</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">],</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">],</span>
            <span class="n">yerr</span><span class="o">=</span><span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;uncertainty&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
            <span class="n">xerr</span><span class="o">=</span><span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s2">&quot;x_edge_upper&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;x_edge_lower&quot;</span><span class="p">])</span> <span class="o">*</span> <span class="n">x_unit</span><span class="p">,</span>
            <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
            <span class="n">zorder</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
            <span class="o">**</span><span class="n">ekw</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">plot_as_boxes</span><span class="p">(</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">],</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;N_unbinned/N_binned&quot;</span><span class="p">],</span>
            <span class="n">xleft</span><span class="o">=</span><span class="n">result</span><span class="p">[</span><span class="s2">&quot;x_edge_lower&quot;</span><span class="p">],</span>
            <span class="n">xright</span><span class="o">=</span><span class="n">result</span><span class="p">[</span><span class="s2">&quot;x_edge_upper&quot;</span><span class="p">],</span>
        <span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;$N_</span><span class="si">{unbinned}</span><span class="s2">/N_</span><span class="si">{binned}</span><span class="s2">$&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.imports.calculate_bin_leftright" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">calculate_bin_leftright</span><span class="p">(</span><span class="n">x</span><span class="p">)</span></code>

<a href="#chromatic.imports.calculate_bin_leftright" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>If x is an array of bin centers, calculate the bin edges.
(assumes outermost bins are same size as their neighbors)</p>
<h4 id="chromatic.imports.calculate_bin_leftright--parameters">Parameters<a class="headerlink" href="#chromatic.imports.calculate_bin_leftright--parameters" title="Permanent link">#</a></h4>
<p>x : array
    The array of bin centers.</p>
<h4 id="chromatic.imports.calculate_bin_leftright--returns">Returns<a class="headerlink" href="#chromatic.imports.calculate_bin_leftright--returns" title="Permanent link">#</a></h4>
<p>l : array
    The left edges of the bins.
r : array
    The right edges of the bins.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/tools/resampling.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">calculate_bin_leftright</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    If x is an array of bin centers, calculate the bin edges.</span>
<span class="sd">    (assumes outermost bins are same size as their neighbors)</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : array</span>
<span class="sd">        The array of bin centers.</span>

<span class="sd">    Returns</span>
<span class="sd">    ----------</span>
<span class="sd">    l : array</span>
<span class="sd">        The left edges of the bins.</span>
<span class="sd">    r : array</span>
<span class="sd">        The right edges of the bins.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># what are bin edges (making a guess for those on the ends)</span>
    <span class="c1"># xbinsize = calculate_bin_widths(x)</span>
    <span class="c1"># left = x - xbinsize / 2.0</span>
    <span class="c1"># right = x + xbinsize / 2.0</span>

    <span class="c1"># weird corner case!</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">left</span><span class="p">,</span> <span class="n">right</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">left</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">right</span><span class="p">])</span>

    <span class="n">inner_edges</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="n">x</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">first_edge</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="n">inner_edges</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">last_edge</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">inner_edges</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

    <span class="n">left</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">first_edge</span><span class="p">,</span> <span class="n">inner_edges</span><span class="p">])</span>
    <span class="n">right</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">inner_edges</span><span class="p">,</span> <span class="n">last_edge</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.imports.edges_to_leftright" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">edges_to_leftright</span><span class="p">(</span><span class="n">edges</span><span class="p">)</span></code>

<a href="#chromatic.imports.edges_to_leftright" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Convert N+1 contiguous edges to two arrays of N left/right edges.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/tools/resampling.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">edges_to_leftright</span><span class="p">(</span><span class="n">edges</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert N+1 contiguous edges to two arrays of N left/right edges.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">left</span><span class="p">,</span> <span class="n">right</span> <span class="o">=</span> <span class="n">edges</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">edges</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="k">return</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.imports.expand_filenames" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">expand_filenames</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span></code>

<a href="#chromatic.imports.expand_filenames" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>A wrapper to expand a string or list into a list of filenames.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/imports.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">expand_filenames</span><span class="p">(</span><span class="n">filepath</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A wrapper to expand a string or list into a list of filenames.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
        <span class="n">filenames</span> <span class="o">=</span> <span class="n">filepath</span>
    <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span> <span class="o">==</span> <span class="n">Column</span><span class="p">:</span>
        <span class="n">filenames</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>
    <span class="k">elif</span> <span class="s2">&quot;*&quot;</span> <span class="ow">in</span> <span class="n">filepath</span><span class="p">:</span>
        <span class="n">filenames</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">filepath</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">filenames</span> <span class="o">=</span> <span class="p">[</span><span class="n">filepath</span><span class="p">]</span>
    <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">filenames</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.imports.leftright_to_edges" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">leftright_to_edges</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">)</span></code>

<a href="#chromatic.imports.leftright_to_edges" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Convert two arrays of N left/right edges to N+1 continugous edges.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/tools/resampling.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">leftright_to_edges</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert two arrays of N left/right edges to N+1 continugous edges.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">edges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>
    <span class="k">return</span> <span class="n">edges</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.imports.name2color" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">name2color</span><span class="p">(</span><span class="n">name</span><span class="p">)</span></code>

<a href="#chromatic.imports.name2color" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Return the 3-element RGB array of a given color name.</p>
<h4 id="chromatic.imports.name2color--parameters">Parameters<a class="headerlink" href="#chromatic.imports.name2color--parameters" title="Permanent link">#</a></h4>
<p>name : str
    The name of a color</p>
<h4 id="chromatic.imports.name2color--returns">Returns<a class="headerlink" href="#chromatic.imports.name2color--returns" title="Permanent link">#</a></h4>
<p>rgb : tuple
    3-element RGB color, with numbers from 0.0 to 1.0</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/imports.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">name2color</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return the 3-element RGB array of a given color name.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    name : str</span>
<span class="sd">        The name of a color</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    rgb : tuple</span>
<span class="sd">        3-element RGB color, with numbers from 0.0 to 1.0</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># give a friendly warning if the color name can&#39;t be found</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">color_hex</span> <span class="o">=</span> <span class="n">col</span><span class="o">.</span><span class="n">cnames</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">col</span><span class="o">.</span><span class="n">hex2color</span><span class="p">(</span><span class="n">color_hex</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="n">cheerfully_suggest</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The color </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> can&#39;t be found. (Returning black.)&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.imports.one2another" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">one2another</span><span class="p">(</span><span class="n">bottom</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">alpha_bottom</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">alpha_top</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">256</span><span class="p">)</span></code>

<a href="#chromatic.imports.one2another" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Create a cmap that goes smoothly (linearly in RGBA) from "bottom" to "top".</p>
<h4 id="chromatic.imports.one2another--parameters">Parameters<a class="headerlink" href="#chromatic.imports.one2another--parameters" title="Permanent link">#</a></h4>
<p>bottom : str
    Name of a color for the bottom of cmap (0.0)
top : str
    Name of a color for the top of the cmap (1.0)
alpha_bottom : float
    Opacity at the bottom of the cmap
alpha_top : float
    Opacitiy at the top of the cmap
N : int
    The number of levels in the listed color map</p>
<h4 id="chromatic.imports.one2another--returns">Returns<a class="headerlink" href="#chromatic.imports.one2another--returns" title="Permanent link">#</a></h4>
<p>cmap : Colormap
    A color map that goes linearly from the
    bottom to top color (and alpha).</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/imports.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">one2another</span><span class="p">(</span><span class="n">bottom</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">alpha_bottom</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">alpha_top</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">256</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a cmap that goes smoothly (linearly in RGBA) from &quot;bottom&quot; to &quot;top&quot;.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    bottom : str</span>
<span class="sd">        Name of a color for the bottom of cmap (0.0)</span>
<span class="sd">    top : str</span>
<span class="sd">        Name of a color for the top of the cmap (1.0)</span>
<span class="sd">    alpha_bottom : float</span>
<span class="sd">        Opacity at the bottom of the cmap</span>
<span class="sd">    alpha_top : float</span>
<span class="sd">        Opacitiy at the top of the cmap</span>
<span class="sd">    N : int</span>
<span class="sd">        The number of levels in the listed color map</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    cmap : Colormap</span>
<span class="sd">        A color map that goes linearly from the</span>
<span class="sd">        bottom to top color (and alpha).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># get the RGB values of the bottom and top of the cmap</span>
    <span class="n">rgb_bottom</span><span class="p">,</span> <span class="n">rgb_top</span> <span class="o">=</span> <span class="n">name2color</span><span class="p">(</span><span class="n">bottom</span><span class="p">),</span> <span class="n">name2color</span><span class="p">(</span><span class="n">top</span><span class="p">)</span>

    <span class="c1"># create linear gradients for all four RGBA channels</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">rgb_bottom</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">rgb_top</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">N</span><span class="p">)</span>
    <span class="n">g</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">rgb_bottom</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">rgb_top</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">N</span><span class="p">)</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">rgb_bottom</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">rgb_top</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">N</span><span class="p">)</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">alpha_bottom</span><span class="p">,</span> <span class="n">alpha_top</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>

    <span class="c1"># create (N,4) array + populate a listed colormap</span>
    <span class="n">colors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">]))</span>
    <span class="n">cmap</span> <span class="o">=</span> <span class="n">col</span><span class="o">.</span><span class="n">ListedColormap</span><span class="p">(</span><span class="n">colors</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{bottom}</span><span class="s2">2</span><span class="si">{top}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="nb">locals</span><span class="p">()))</span>

    <span class="c1"># return the colormap</span>
    <span class="k">return</span> <span class="n">cmap</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.imports.remove_unit" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">remove_unit</span><span class="p">(</span><span class="n">x</span><span class="p">)</span></code>

<a href="#chromatic.imports.remove_unit" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Quick wrapper to remove the unit from a quantity,
but not complain if it doesn't have one.</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/imports.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">remove_unit</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Quick wrapper to remove the unit from a quantity,</span>
<span class="sd">    but not complain if it doesn&#39;t have one.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">x</span><span class="o">.</span><span class="n">value</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">x</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="chromatic.imports.resample_while_conserving_flux" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">resample_while_conserving_flux</span><span class="p">(</span><span class="n">xin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">yin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xout</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xin_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xout_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">replace_nans</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">visualize</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">pause</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#chromatic.imports.resample_while_conserving_flux" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">

        <p>Starting from some initial x and y, resample onto a
different grid (either higher or lower resolution),
while conserving total flux.</p>
<p>When including the entire range of <code>xin</code>,
<code>sum(yout) == sum(yin)</code> should be true.</p>
<p>When including only part of the range of <code>xin</code>,
the integral between any two points should be conserved.</p>
<h4 id="chromatic.imports.resample_while_conserving_flux--parameters">Parameters<a class="headerlink" href="#chromatic.imports.resample_while_conserving_flux--parameters" title="Permanent link">#</a></h4>
<p>xin : array
    The original independent variable.
yin : array
    The original dependent variable (same size as x).
xout : array
    The new grid of independent variables onto which
    you want to resample the y values. Refers to the
    center of each bin (use <code>xout_edges</code> for finer
    control over the exact edges of the bins)
xin_edges : array
    The edges of the original independent variable bins.
    The left and right edges of the bins are interpreted
    to be <code>xin_edges[:-1]</code> and <code>xin_edges[1:]</code>,
    respectively, so the associated <code>yin</code> should have exactly
    1 fewer element than <code>xin_edges</code>. This provides finer
    control over the size of each bin in the input than
    simply supplying <code>xin</code>(still a little experimental)
    They should probably be sorted?
xout_edges : array
    The edges of the new grid of bins for the independent
    variable, onto which you want to resample the y
    values. The left and right edges of the bins will be,
    respectively, <code>xout_edges[:-1]</code> and <code>xout_edges[1:]</code>,
    so the size of the output array will be
    <code>len(xout_edges) - 1</code>
replace_nans : float, str
    Replace nan values with this value.
    <code>replace_nans = 0</code>
        will add no flux where nans are
    <code>replace_nans = nan</code>
        will ensure you get nans returned everywhere
        if you try to resample over any nan
    <code>replace_nans = 'interpolate'</code>
        will try to replace nans by linearly interpolating
        from nearby values (not yet implemented)
visualize : bool
    Should we make a plot showing whether it worked?
pause : bool
    Should we pause to wait for a key press?</p>
<h4 id="chromatic.imports.resample_while_conserving_flux--returns">Returns<a class="headerlink" href="#chromatic.imports.resample_while_conserving_flux--returns" title="Permanent link">#</a></h4>
<p>result : dict
    A dictionary containing...
        <code>x</code> = the center of the output grid
        <code>y</code> = the resampled value on the output grid
        <code>edges</code> = the edges of the output grid, which will
            have one more element than x or y</p>


            <details class="quote">
              <summary>Source code in <code>chromatic/tools/resampling.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">resample_while_conserving_flux</span><span class="p">(</span>
    <span class="n">xin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">yin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">xout</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">xin_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">xout_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">replace_nans</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
    <span class="n">visualize</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">pause</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Starting from some initial x and y, resample onto a</span>
<span class="sd">    different grid (either higher or lower resolution),</span>
<span class="sd">    while conserving total flux.</span>

<span class="sd">    When including the entire range of `xin`,</span>
<span class="sd">    `sum(yout) == sum(yin)` should be true.</span>

<span class="sd">    When including only part of the range of `xin`,</span>
<span class="sd">    the integral between any two points should be conserved.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    xin : array</span>
<span class="sd">        The original independent variable.</span>
<span class="sd">    yin : array</span>
<span class="sd">        The original dependent variable (same size as x).</span>
<span class="sd">    xout : array</span>
<span class="sd">        The new grid of independent variables onto which</span>
<span class="sd">        you want to resample the y values. Refers to the</span>
<span class="sd">        center of each bin (use `xout_edges` for finer</span>
<span class="sd">        control over the exact edges of the bins)</span>
<span class="sd">    xin_edges : array</span>
<span class="sd">        The edges of the original independent variable bins.</span>
<span class="sd">        The left and right edges of the bins are interpreted</span>
<span class="sd">        to be `xin_edges[:-1]` and `xin_edges[1:]`,</span>
<span class="sd">        respectively, so the associated `yin` should have exactly</span>
<span class="sd">        1 fewer element than `xin_edges`. This provides finer</span>
<span class="sd">        control over the size of each bin in the input than</span>
<span class="sd">        simply supplying `xin`(still a little experimental)</span>
<span class="sd">        They should probably be sorted?</span>
<span class="sd">    xout_edges : array</span>
<span class="sd">        The edges of the new grid of bins for the independent</span>
<span class="sd">        variable, onto which you want to resample the y</span>
<span class="sd">        values. The left and right edges of the bins will be,</span>
<span class="sd">        respectively, `xout_edges[:-1]` and `xout_edges[1:]`,</span>
<span class="sd">        so the size of the output array will be</span>
<span class="sd">        `len(xout_edges) - 1`</span>
<span class="sd">    replace_nans : float, str</span>
<span class="sd">        Replace nan values with this value.</span>
<span class="sd">        `replace_nans = 0`</span>
<span class="sd">            will add no flux where nans are</span>
<span class="sd">        `replace_nans = nan`</span>
<span class="sd">            will ensure you get nans returned everywhere</span>
<span class="sd">            if you try to resample over any nan</span>
<span class="sd">        `replace_nans = &#39;interpolate&#39;`</span>
<span class="sd">            will try to replace nans by linearly interpolating</span>
<span class="sd">            from nearby values (not yet implemented)</span>
<span class="sd">    visualize : bool</span>
<span class="sd">        Should we make a plot showing whether it worked?</span>
<span class="sd">    pause : bool</span>
<span class="sd">        Should we pause to wait for a key press?</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    result : dict</span>
<span class="sd">        A dictionary containing...</span>
<span class="sd">            `x` = the center of the output grid</span>
<span class="sd">            `y` = the resampled value on the output grid</span>
<span class="sd">            `edges` = the edges of the output grid, which will</span>
<span class="sd">                have one more element than x or y</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># make sure there are some reasonable input options</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">xin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">xin_edges</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">yin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">xout</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">xout_edges</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>

    <span class="c1"># set up the bins, to calculate cumulative distribution of y</span>
    <span class="k">if</span> <span class="n">xin_edges</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># make sure the sizes match up</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">xin</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">yin</span><span class="p">)</span>
        <span class="c1"># sort to make sure x is strictly increasing</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">xin</span><span class="p">)</span>
        <span class="n">xin_sorted</span> <span class="o">=</span> <span class="n">xin</span><span class="p">[</span><span class="n">s</span><span class="p">]</span>
        <span class="n">yin_sorted</span> <span class="o">=</span> <span class="n">yin</span><span class="p">[</span><span class="n">s</span><span class="p">]</span>
        <span class="c1"># estimate some bin edges (might fail for non-uniform grids)</span>
        <span class="n">xin_left</span><span class="p">,</span> <span class="n">xin_right</span> <span class="o">=</span> <span class="n">calculate_bin_leftright</span><span class="p">(</span><span class="n">xin_sorted</span><span class="p">)</span>
        <span class="c1"># define an array of edges</span>
        <span class="n">xin_edges</span> <span class="o">=</span> <span class="n">leftright_to_edges</span><span class="p">(</span><span class="n">xin_left</span><span class="p">,</span> <span class="n">xin_right</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># make sure the sizes match up</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">xin_edges</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">yin</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="c1"># sort to make sure x is strictly increasing</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">xin_edges</span><span class="p">)</span>
        <span class="n">xin_left</span><span class="p">,</span> <span class="n">xin_right</span> <span class="o">=</span> <span class="n">edges_to_leftright</span><span class="p">(</span><span class="n">xin_edges</span><span class="p">[</span><span class="n">s</span><span class="p">])</span>
        <span class="n">xin_sorted</span> <span class="o">=</span> <span class="p">(</span><span class="n">xin_left</span> <span class="o">+</span> <span class="n">xin_right</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">yin_sorted</span> <span class="o">=</span> <span class="n">yin</span><span class="p">[</span><span class="n">s</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>

    <span class="c1"># the first element should be the left edge of the first pixel</span>
    <span class="c1"># last element will be right edge of last pixel</span>
    <span class="n">xin_for_cdf</span> <span class="o">=</span> <span class="n">xin_edges</span>

    <span class="c1"># to the left of the first pixel, assume flux is zero</span>
    <span class="n">yin_for_cdf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">yin_sorted</span><span class="p">])</span>

    <span class="c1"># correct for any non-finite values</span>
    <span class="n">bad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">yin_for_cdf</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">replace_nans</span> <span class="o">==</span> <span class="s2">&quot;interpolate&quot;</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
            <span class="s2">&quot;The `replace_nans=&#39;interpolate&#39;`` option doens&#39;t exist yet!&quot;</span>
        <span class="p">)</span>
    <span class="n">yin_for_cdf</span><span class="p">[</span><span class="n">bad</span><span class="p">]</span> <span class="o">=</span> <span class="n">replace_nans</span>

    <span class="c1"># calculate the CDF of the flux (at pixel edge locations)</span>
    <span class="n">cdfin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">yin_for_cdf</span><span class="p">)</span>

    <span class="c1"># create an interpolator for that CDF</span>
    <span class="n">cdfinterpolator</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span>
        <span class="n">xin_for_cdf</span><span class="p">,</span>
        <span class="n">cdfin</span><span class="p">,</span>
        <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span>
        <span class="n">bounds_error</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">fill_value</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">yin</span><span class="p">)),</span>
    <span class="p">)</span>

    <span class="c1"># calculate bin edges (of size len(xout)+1)</span>
    <span class="k">if</span> <span class="n">xout_edges</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">xout_left</span><span class="p">,</span> <span class="n">xout_right</span> <span class="o">=</span> <span class="n">calculate_bin_leftright</span><span class="p">(</span><span class="n">xout</span><span class="p">)</span>
        <span class="n">xout_edges</span> <span class="o">=</span> <span class="n">leftright_to_edges</span><span class="p">(</span><span class="n">xout_left</span><span class="p">,</span> <span class="n">xout_right</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">xout_left</span><span class="p">,</span> <span class="n">xout_right</span> <span class="o">=</span> <span class="n">edges_to_leftright</span><span class="p">(</span><span class="n">xout_edges</span><span class="p">)</span>
        <span class="n">xout</span> <span class="o">=</span> <span class="p">(</span><span class="n">xout_left</span> <span class="o">+</span> <span class="n">xout_right</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>

    <span class="n">xout_for_cdf</span> <span class="o">=</span> <span class="n">leftright_to_edges</span><span class="p">(</span><span class="n">xout_left</span><span class="p">,</span> <span class="n">xout_right</span><span class="p">)</span>

    <span class="c1"># interpolate the CDF onto those bin edges</span>
    <span class="n">cdfout</span> <span class="o">=</span> <span class="n">cdfinterpolator</span><span class="p">(</span><span class="n">xout_for_cdf</span><span class="p">)</span>

    <span class="c1"># take  derivative of the CDF to get flux per resampled bin</span>
    <span class="c1"># (xout is bin center, and yout is the flux in that bin)</span>
    <span class="n">yout</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">cdfout</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">visualize</span><span class="p">:</span>
        <span class="n">fi</span><span class="p">,</span> <span class="p">(</span><span class="n">ax_cdf</span><span class="p">,</span> <span class="n">ax_pdf</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
        <span class="n">inkw</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
            <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span>
            <span class="n">markeredgecolor</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">outkw</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;darkorange&quot;</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span>
            <span class="n">markersize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
            <span class="n">markeredgecolor</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">legkw</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper left&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">xinbinsize</span> <span class="o">=</span> <span class="n">xin_right</span> <span class="o">-</span> <span class="n">xin_left</span>
        <span class="n">xoutbinsize</span> <span class="o">=</span> <span class="n">xout_right</span> <span class="o">-</span> <span class="n">xout_left</span>
        <span class="c1"># plot the PDFs</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="n">ax_pdf</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Flux per (Original) Pixel&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Pixel&quot;</span><span class="p">)</span>
        <span class="c1"># plot the original pixels (in df/dpixel to compare with resampled)</span>
        <span class="n">plot_as_boxes</span><span class="p">(</span>
            <span class="n">xin_sorted</span><span class="p">,</span> <span class="n">yin_sorted</span> <span class="o">/</span> <span class="n">xinbinsize</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Original Pixels&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">inkw</span>
        <span class="p">)</span>

        <span class="c1"># what would a bad interpolation look like?</span>
        <span class="n">interpolate_badly</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span>
            <span class="n">xin_sorted</span><span class="p">,</span>
            <span class="n">yin_sorted</span> <span class="o">/</span> <span class="n">xinbinsize</span><span class="p">,</span>
            <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span>
            <span class="n">bounds_error</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">fill_value</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
            <span class="n">xout</span><span class="p">,</span>
            <span class="n">interpolate_badly</span><span class="p">(</span><span class="n">xout</span><span class="p">),</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;cornflowerblue&quot;</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span>
            <span class="n">markersize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
            <span class="n">markeredgecolor</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Silly Simple Interpolation&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># plot the flux-conserving resampled data (again, in df/d&quot;pixel&quot;)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
            <span class="n">xout</span><span class="p">,</span> <span class="n">yout</span> <span class="o">/</span> <span class="n">xoutbinsize</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Flux-Conserving Interpolation&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">outkw</span>
        <span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="o">**</span><span class="n">legkw</span><span class="p">)</span>

        <span class="c1"># plot the CDFs</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="n">ax_cdf</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Cumulative Flux (from left)&quot;</span><span class="p">)</span>

        <span class="c1"># plot the original CDF</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xin_for_cdf</span><span class="p">,</span> <span class="n">cdfin</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Original Pixels&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">inkw</span><span class="p">)</span>

        <span class="c1"># plot the interpolated CDF</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xout_for_cdf</span><span class="p">,</span> <span class="n">cdfout</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Flux-Conserved Resample&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">outkw</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">pause</span><span class="p">:</span>
            <span class="n">a</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span>
                <span class="s2">&quot;Pausing a moment to check on interpolation; press return to continue.&quot;</span>
            <span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{:&gt;6}</span><span class="s2"> = </span><span class="si">{:.5f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;Actual&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">yin</span><span class="p">)))</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="s2">&quot;</span><span class="si">{:&gt;6}</span><span class="s2"> = </span><span class="si">{:.5f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="s2">&quot;Silly&quot;</span><span class="p">,</span>
                <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">interpolate_badly</span><span class="p">(</span><span class="n">xout</span><span class="p">)</span> <span class="o">*</span> <span class="n">xoutbinsize</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{:&gt;6}</span><span class="s2"> = </span><span class="si">{:.5f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;CDF&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">yout</span><span class="p">)))</span>

    <span class="c1"># return the resampled y-values</span>
    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="n">xout</span><span class="p">,</span> <span class="s2">&quot;x_edge_lower&quot;</span><span class="p">:</span> <span class="n">xout_left</span><span class="p">,</span> <span class="s2">&quot;x_edge_upper&quot;</span><span class="p">:</span> <span class="n">xout_right</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="n">yout</span><span class="p">}</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.tracking"], "search": "../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.c8b220af.min.js"></script>
      
    
  </body>
</html>